{"version":3,"sources":["../node_modules/fft.js/lib/fft.js","../node_modules/@tonaljs/pitch/index.ts","../node_modules/@tonaljs/pitch-interval/index.ts","../node_modules/@tonaljs/pitch-note/index.ts","../node_modules/@tonaljs/pitch-distance/index.ts","../node_modules/@tonaljs/collection/index.ts","../node_modules/@tonaljs/pcset/index.ts","../node_modules/@tonaljs/chord-type/data.ts","../node_modules/@tonaljs/chord-type/index.ts","../node_modules/@tonaljs/chord-detect/index.ts","../node_modules/@tonaljs/interval/index.ts","../node_modules/@tonaljs/scale-type/data.ts","../node_modules/@tonaljs/scale-type/index.ts","../node_modules/@tonaljs/chord/index.ts","../node_modules/@tonaljs/duration-value/data.ts","../node_modules/@tonaljs/duration-value/index.ts","../node_modules/@tonaljs/midi/index.ts","../node_modules/@tonaljs/note/index.ts","../node_modules/@tonaljs/mode/index.ts","../node_modules/@tonaljs/scale/index.ts","../js/utils/music-theory.ts","../js/midi/midi-manager.ts","../node_modules/pitchy/index.js","../js/utils/pitch-detector.ts","../js/input/audio-manager.ts","../js/notation/staff-renderer.ts","../js/notation/falling-notes.ts","../js/utils/storage.ts","../js/utils/instrument-config.ts","../js/utils/audio-tone.ts","../js/modules/sight-reading.ts","../js/app.ts"],"names":["FFT","pitch","name","chroma","fillStr","cache","parse","pitchName","REGEX","midi","freq","note","tr","index","num","intervals","notes","get","chord","interval","names","data_default","dictionary","scale","all","add","addAlias","transpose","distance","modes","mode","chords","triads","tokenize","detect","extended","reduced","degrees","steps","index_default","midiToNoteName","dist_exports","octave","range","PitchDetector"],"mappings":"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","file":"app.js","sourcesContent":["'use strict';\n\nfunction FFT(size) {\n  this.size = size | 0;\n  if (this.size <= 1 || (this.size & (this.size - 1)) !== 0)\n    throw new Error('FFT size must be a power of two and bigger than 1');\n\n  this._csize = size << 1;\n\n  // NOTE: Use of `var` is intentional for old V8 versions\n  var table = new Array(this.size * 2);\n  for (var i = 0; i < table.length; i += 2) {\n    const angle = Math.PI * i / this.size;\n    table[i] = Math.cos(angle);\n    table[i + 1] = -Math.sin(angle);\n  }\n  this.table = table;\n\n  // Find size's power of two\n  var power = 0;\n  for (var t = 1; this.size > t; t <<= 1)\n    power++;\n\n  // Calculate initial step's width:\n  //   * If we are full radix-4 - it is 2x smaller to give inital len=8\n  //   * Otherwise it is the same as `power` to give len=4\n  this._width = power % 2 === 0 ? power - 1 : power;\n\n  // Pre-compute bit-reversal patterns\n  this._bitrev = new Array(1 << this._width);\n  for (var j = 0; j < this._bitrev.length; j++) {\n    this._bitrev[j] = 0;\n    for (var shift = 0; shift < this._width; shift += 2) {\n      var revShift = this._width - shift - 2;\n      this._bitrev[j] |= ((j >>> shift) & 3) << revShift;\n    }\n  }\n\n  this._out = null;\n  this._data = null;\n  this._inv = 0;\n}\nmodule.exports = FFT;\n\nFFT.prototype.fromComplexArray = function fromComplexArray(complex, storage) {\n  var res = storage || new Array(complex.length >>> 1);\n  for (var i = 0; i < complex.length; i += 2)\n    res[i >>> 1] = complex[i];\n  return res;\n};\n\nFFT.prototype.createComplexArray = function createComplexArray() {\n  const res = new Array(this._csize);\n  for (var i = 0; i < res.length; i++)\n    res[i] = 0;\n  return res;\n};\n\nFFT.prototype.toComplexArray = function toComplexArray(input, storage) {\n  var res = storage || this.createComplexArray();\n  for (var i = 0; i < res.length; i += 2) {\n    res[i] = input[i >>> 1];\n    res[i + 1] = 0;\n  }\n  return res;\n};\n\nFFT.prototype.completeSpectrum = function completeSpectrum(spectrum) {\n  var size = this._csize;\n  var half = size >>> 1;\n  for (var i = 2; i < half; i += 2) {\n    spectrum[size - i] = spectrum[i];\n    spectrum[size - i + 1] = -spectrum[i + 1];\n  }\n};\n\nFFT.prototype.transform = function transform(out, data) {\n  if (out === data)\n    throw new Error('Input and output buffers must be different');\n\n  this._out = out;\n  this._data = data;\n  this._inv = 0;\n  this._transform4();\n  this._out = null;\n  this._data = null;\n};\n\nFFT.prototype.realTransform = function realTransform(out, data) {\n  if (out === data)\n    throw new Error('Input and output buffers must be different');\n\n  this._out = out;\n  this._data = data;\n  this._inv = 0;\n  this._realTransform4();\n  this._out = null;\n  this._data = null;\n};\n\nFFT.prototype.inverseTransform = function inverseTransform(out, data) {\n  if (out === data)\n    throw new Error('Input and output buffers must be different');\n\n  this._out = out;\n  this._data = data;\n  this._inv = 1;\n  this._transform4();\n  for (var i = 0; i < out.length; i++)\n    out[i] /= this.size;\n  this._out = null;\n  this._data = null;\n};\n\n// radix-4 implementation\n//\n// NOTE: Uses of `var` are intentional for older V8 version that do not\n// support both `let compound assignments` and `const phi`\nFFT.prototype._transform4 = function _transform4() {\n  var out = this._out;\n  var size = this._csize;\n\n  // Initial step (permute and transform)\n  var width = this._width;\n  var step = 1 << width;\n  var len = (size / step) << 1;\n\n  var outOff;\n  var t;\n  var bitrev = this._bitrev;\n  if (len === 4) {\n    for (outOff = 0, t = 0; outOff < size; outOff += len, t++) {\n      const off = bitrev[t];\n      this._singleTransform2(outOff, off, step);\n    }\n  } else {\n    // len === 8\n    for (outOff = 0, t = 0; outOff < size; outOff += len, t++) {\n      const off = bitrev[t];\n      this._singleTransform4(outOff, off, step);\n    }\n  }\n\n  // Loop through steps in decreasing order\n  var inv = this._inv ? -1 : 1;\n  var table = this.table;\n  for (step >>= 2; step >= 2; step >>= 2) {\n    len = (size / step) << 1;\n    var quarterLen = len >>> 2;\n\n    // Loop through offsets in the data\n    for (outOff = 0; outOff < size; outOff += len) {\n      // Full case\n      var limit = outOff + quarterLen;\n      for (var i = outOff, k = 0; i < limit; i += 2, k += step) {\n        const A = i;\n        const B = A + quarterLen;\n        const C = B + quarterLen;\n        const D = C + quarterLen;\n\n        // Original values\n        const Ar = out[A];\n        const Ai = out[A + 1];\n        const Br = out[B];\n        const Bi = out[B + 1];\n        const Cr = out[C];\n        const Ci = out[C + 1];\n        const Dr = out[D];\n        const Di = out[D + 1];\n\n        // Middle values\n        const MAr = Ar;\n        const MAi = Ai;\n\n        const tableBr = table[k];\n        const tableBi = inv * table[k + 1];\n        const MBr = Br * tableBr - Bi * tableBi;\n        const MBi = Br * tableBi + Bi * tableBr;\n\n        const tableCr = table[2 * k];\n        const tableCi = inv * table[2 * k + 1];\n        const MCr = Cr * tableCr - Ci * tableCi;\n        const MCi = Cr * tableCi + Ci * tableCr;\n\n        const tableDr = table[3 * k];\n        const tableDi = inv * table[3 * k + 1];\n        const MDr = Dr * tableDr - Di * tableDi;\n        const MDi = Dr * tableDi + Di * tableDr;\n\n        // Pre-Final values\n        const T0r = MAr + MCr;\n        const T0i = MAi + MCi;\n        const T1r = MAr - MCr;\n        const T1i = MAi - MCi;\n        const T2r = MBr + MDr;\n        const T2i = MBi + MDi;\n        const T3r = inv * (MBr - MDr);\n        const T3i = inv * (MBi - MDi);\n\n        // Final values\n        const FAr = T0r + T2r;\n        const FAi = T0i + T2i;\n\n        const FCr = T0r - T2r;\n        const FCi = T0i - T2i;\n\n        const FBr = T1r + T3i;\n        const FBi = T1i - T3r;\n\n        const FDr = T1r - T3i;\n        const FDi = T1i + T3r;\n\n        out[A] = FAr;\n        out[A + 1] = FAi;\n        out[B] = FBr;\n        out[B + 1] = FBi;\n        out[C] = FCr;\n        out[C + 1] = FCi;\n        out[D] = FDr;\n        out[D + 1] = FDi;\n      }\n    }\n  }\n};\n\n// radix-2 implementation\n//\n// NOTE: Only called for len=4\nFFT.prototype._singleTransform2 = function _singleTransform2(outOff, off,\n                                                             step) {\n  const out = this._out;\n  const data = this._data;\n\n  const evenR = data[off];\n  const evenI = data[off + 1];\n  const oddR = data[off + step];\n  const oddI = data[off + step + 1];\n\n  const leftR = evenR + oddR;\n  const leftI = evenI + oddI;\n  const rightR = evenR - oddR;\n  const rightI = evenI - oddI;\n\n  out[outOff] = leftR;\n  out[outOff + 1] = leftI;\n  out[outOff + 2] = rightR;\n  out[outOff + 3] = rightI;\n};\n\n// radix-4\n//\n// NOTE: Only called for len=8\nFFT.prototype._singleTransform4 = function _singleTransform4(outOff, off,\n                                                             step) {\n  const out = this._out;\n  const data = this._data;\n  const inv = this._inv ? -1 : 1;\n  const step2 = step * 2;\n  const step3 = step * 3;\n\n  // Original values\n  const Ar = data[off];\n  const Ai = data[off + 1];\n  const Br = data[off + step];\n  const Bi = data[off + step + 1];\n  const Cr = data[off + step2];\n  const Ci = data[off + step2 + 1];\n  const Dr = data[off + step3];\n  const Di = data[off + step3 + 1];\n\n  // Pre-Final values\n  const T0r = Ar + Cr;\n  const T0i = Ai + Ci;\n  const T1r = Ar - Cr;\n  const T1i = Ai - Ci;\n  const T2r = Br + Dr;\n  const T2i = Bi + Di;\n  const T3r = inv * (Br - Dr);\n  const T3i = inv * (Bi - Di);\n\n  // Final values\n  const FAr = T0r + T2r;\n  const FAi = T0i + T2i;\n\n  const FBr = T1r + T3i;\n  const FBi = T1i - T3r;\n\n  const FCr = T0r - T2r;\n  const FCi = T0i - T2i;\n\n  const FDr = T1r - T3i;\n  const FDi = T1i + T3r;\n\n  out[outOff] = FAr;\n  out[outOff + 1] = FAi;\n  out[outOff + 2] = FBr;\n  out[outOff + 3] = FBi;\n  out[outOff + 4] = FCr;\n  out[outOff + 5] = FCi;\n  out[outOff + 6] = FDr;\n  out[outOff + 7] = FDi;\n};\n\n// Real input radix-4 implementation\nFFT.prototype._realTransform4 = function _realTransform4() {\n  var out = this._out;\n  var size = this._csize;\n\n  // Initial step (permute and transform)\n  var width = this._width;\n  var step = 1 << width;\n  var len = (size / step) << 1;\n\n  var outOff;\n  var t;\n  var bitrev = this._bitrev;\n  if (len === 4) {\n    for (outOff = 0, t = 0; outOff < size; outOff += len, t++) {\n      const off = bitrev[t];\n      this._singleRealTransform2(outOff, off >>> 1, step >>> 1);\n    }\n  } else {\n    // len === 8\n    for (outOff = 0, t = 0; outOff < size; outOff += len, t++) {\n      const off = bitrev[t];\n      this._singleRealTransform4(outOff, off >>> 1, step >>> 1);\n    }\n  }\n\n  // Loop through steps in decreasing order\n  var inv = this._inv ? -1 : 1;\n  var table = this.table;\n  for (step >>= 2; step >= 2; step >>= 2) {\n    len = (size / step) << 1;\n    var halfLen = len >>> 1;\n    var quarterLen = halfLen >>> 1;\n    var hquarterLen = quarterLen >>> 1;\n\n    // Loop through offsets in the data\n    for (outOff = 0; outOff < size; outOff += len) {\n      for (var i = 0, k = 0; i <= hquarterLen; i += 2, k += step) {\n        var A = outOff + i;\n        var B = A + quarterLen;\n        var C = B + quarterLen;\n        var D = C + quarterLen;\n\n        // Original values\n        var Ar = out[A];\n        var Ai = out[A + 1];\n        var Br = out[B];\n        var Bi = out[B + 1];\n        var Cr = out[C];\n        var Ci = out[C + 1];\n        var Dr = out[D];\n        var Di = out[D + 1];\n\n        // Middle values\n        var MAr = Ar;\n        var MAi = Ai;\n\n        var tableBr = table[k];\n        var tableBi = inv * table[k + 1];\n        var MBr = Br * tableBr - Bi * tableBi;\n        var MBi = Br * tableBi + Bi * tableBr;\n\n        var tableCr = table[2 * k];\n        var tableCi = inv * table[2 * k + 1];\n        var MCr = Cr * tableCr - Ci * tableCi;\n        var MCi = Cr * tableCi + Ci * tableCr;\n\n        var tableDr = table[3 * k];\n        var tableDi = inv * table[3 * k + 1];\n        var MDr = Dr * tableDr - Di * tableDi;\n        var MDi = Dr * tableDi + Di * tableDr;\n\n        // Pre-Final values\n        var T0r = MAr + MCr;\n        var T0i = MAi + MCi;\n        var T1r = MAr - MCr;\n        var T1i = MAi - MCi;\n        var T2r = MBr + MDr;\n        var T2i = MBi + MDi;\n        var T3r = inv * (MBr - MDr);\n        var T3i = inv * (MBi - MDi);\n\n        // Final values\n        var FAr = T0r + T2r;\n        var FAi = T0i + T2i;\n\n        var FBr = T1r + T3i;\n        var FBi = T1i - T3r;\n\n        out[A] = FAr;\n        out[A + 1] = FAi;\n        out[B] = FBr;\n        out[B + 1] = FBi;\n\n        // Output final middle point\n        if (i === 0) {\n          var FCr = T0r - T2r;\n          var FCi = T0i - T2i;\n          out[C] = FCr;\n          out[C + 1] = FCi;\n          continue;\n        }\n\n        // Do not overwrite ourselves\n        if (i === hquarterLen)\n          continue;\n\n        // In the flipped case:\n        // MAi = -MAi\n        // MBr=-MBi, MBi=-MBr\n        // MCr=-MCr\n        // MDr=MDi, MDi=MDr\n        var ST0r = T1r;\n        var ST0i = -T1i;\n        var ST1r = T0r;\n        var ST1i = -T0i;\n        var ST2r = -inv * T3i;\n        var ST2i = -inv * T3r;\n        var ST3r = -inv * T2i;\n        var ST3i = -inv * T2r;\n\n        var SFAr = ST0r + ST2r;\n        var SFAi = ST0i + ST2i;\n\n        var SFBr = ST1r + ST3i;\n        var SFBi = ST1i - ST3r;\n\n        var SA = outOff + quarterLen - i;\n        var SB = outOff + halfLen - i;\n\n        out[SA] = SFAr;\n        out[SA + 1] = SFAi;\n        out[SB] = SFBr;\n        out[SB + 1] = SFBi;\n      }\n    }\n  }\n};\n\n// radix-2 implementation\n//\n// NOTE: Only called for len=4\nFFT.prototype._singleRealTransform2 = function _singleRealTransform2(outOff,\n                                                                     off,\n                                                                     step) {\n  const out = this._out;\n  const data = this._data;\n\n  const evenR = data[off];\n  const oddR = data[off + step];\n\n  const leftR = evenR + oddR;\n  const rightR = evenR - oddR;\n\n  out[outOff] = leftR;\n  out[outOff + 1] = 0;\n  out[outOff + 2] = rightR;\n  out[outOff + 3] = 0;\n};\n\n// radix-4\n//\n// NOTE: Only called for len=8\nFFT.prototype._singleRealTransform4 = function _singleRealTransform4(outOff,\n                                                                     off,\n                                                                     step) {\n  const out = this._out;\n  const data = this._data;\n  const inv = this._inv ? -1 : 1;\n  const step2 = step * 2;\n  const step3 = step * 3;\n\n  // Original values\n  const Ar = data[off];\n  const Br = data[off + step];\n  const Cr = data[off + step2];\n  const Dr = data[off + step3];\n\n  // Pre-Final values\n  const T0r = Ar + Cr;\n  const T1r = Ar - Cr;\n  const T2r = Br + Dr;\n  const T3r = inv * (Br - Dr);\n\n  // Final values\n  const FAr = T0r + T2r;\n\n  const FBr = T1r;\n  const FBi = -T3r;\n\n  const FCr = T0r - T2r;\n\n  const FDr = T1r;\n  const FDi = T3r;\n\n  out[outOff] = FAr;\n  out[outOff + 1] = 0;\n  out[outOff + 2] = FBr;\n  out[outOff + 3] = FBi;\n  out[outOff + 4] = FCr;\n  out[outOff + 5] = 0;\n  out[outOff + 6] = FDr;\n  out[outOff + 7] = FDi;\n};\n","export interface NamedPitch {\n  readonly name: string;\n}\n\n/*** @deprecated use NamedPitch */\nexport interface Named {\n  readonly name: string;\n}\n\nexport interface NotFound extends NamedPitch {\n  readonly empty: true;\n  readonly name: \"\";\n}\n\nexport function isNamedPitch(src: unknown): src is NamedPitch {\n  return src !== null &&\n    typeof src === \"object\" &&\n    \"name\" in src &&\n    typeof src.name === \"string\"\n    ? true\n    : false;\n}\n\ntype Fifths = number;\ntype Octaves = number;\nexport type Direction = 1 | -1;\n\nexport type PitchClassCoordinates = [Fifths];\nexport type NoteCoordinates = [Fifths, Octaves];\nexport type IntervalCoordinates = [Fifths, Octaves, Direction];\nexport type PitchCoordinates =\n  | PitchClassCoordinates\n  | NoteCoordinates\n  | IntervalCoordinates;\n\n/**\n * Pitch properties\n *\n * - {number} step - The step number: 0 = C, 1 = D, ... 6 = B\n * - {number} alt - Number of alterations: -2 = 'bb', -1 = 'b', 0 = '', 1 = '#', ...\n * - {number} [oct] = The octave (undefined when is a coord class)\n * - {number} [dir] = Interval direction (undefined when is not an interval)\n */\nexport interface Pitch {\n  readonly step: number;\n  readonly alt: number;\n  readonly oct?: number; // undefined for pitch classes\n  readonly dir?: Direction; // undefined for notes\n}\n\nconst SIZES = [0, 2, 4, 5, 7, 9, 11];\nexport const chroma = ({ step, alt }: Pitch) => (SIZES[step] + alt + 120) % 12;\n\nexport const height = ({ step, alt, oct, dir = 1 }: Pitch) =>\n  dir * (SIZES[step] + alt + 12 * (oct === undefined ? -100 : oct));\n\nexport const midi = (pitch: Pitch) => {\n  const h = height(pitch);\n  return pitch.oct !== undefined && h >= -12 && h <= 115 ? h + 12 : null;\n};\n\nexport function isPitch(pitch: unknown): pitch is Pitch {\n  return pitch !== null &&\n    typeof pitch === \"object\" &&\n    \"step\" in pitch &&\n    typeof pitch.step === \"number\" &&\n    \"alt\" in pitch &&\n    typeof pitch.alt === \"number\" &&\n    !isNaN(pitch.step) &&\n    !isNaN(pitch.alt)\n    ? true\n    : false;\n}\n\n// The number of fifths of [C, D, E, F, G, A, B]\nconst FIFTHS = [0, 2, 4, -1, 1, 3, 5];\n// The number of octaves it span each step\nconst STEPS_TO_OCTS = FIFTHS.map((fifths: number) =>\n  Math.floor((fifths * 7) / 12),\n);\n\n/**\n * Get coordinates from pitch object\n */\nexport function coordinates(pitch: Pitch): PitchCoordinates {\n  const { step, alt, oct, dir = 1 } = pitch;\n  const f = FIFTHS[step] + 7 * alt;\n  if (oct === undefined) {\n    return [dir * f];\n  }\n  const o = oct - STEPS_TO_OCTS[step] - 4 * alt;\n  return [dir * f, dir * o];\n}\n\n// We need to get the steps from fifths\n// Fifths for CDEFGAB are [ 0, 2, 4, -1, 1, 3, 5 ]\n// We add 1 to fifths to avoid negative numbers, so:\n// for [\"F\", \"C\", \"G\", \"D\", \"A\", \"E\", \"B\"] we have:\nconst FIFTHS_TO_STEPS = [3, 0, 4, 1, 5, 2, 6];\n\n/**\n * Get pitch from coordinate objects\n */\nexport function pitch(coord: PitchCoordinates): Pitch {\n  const [f, o, dir] = coord;\n  const step = FIFTHS_TO_STEPS[unaltered(f)];\n  const alt = Math.floor((f + 1) / 7);\n  if (o === undefined) {\n    return { step, alt, dir };\n  }\n  const oct = o + 4 * alt + STEPS_TO_OCTS[step];\n  return { step, alt, oct, dir };\n}\n\n// Return the number of fifths as if it were unaltered\nfunction unaltered(f: number): number {\n  const i = (f + 1) % 7;\n  return i < 0 ? 7 + i : i;\n}\n","import {\n  coordinates,\n  Direction,\n  IntervalCoordinates,\n  isNamedPitch,\n  isPitch,\n  NamedPitch,\n  Pitch,\n  pitch,\n  PitchCoordinates,\n} from \"@tonaljs/pitch\";\n\nconst fillStr = (s: string, n: number) => Array(Math.abs(n) + 1).join(s);\n\nexport type IntervalName = string;\nexport type IntervalLiteral = IntervalName | Pitch | NamedPitch;\n\ntype Quality =\n  | \"dddd\"\n  | \"ddd\"\n  | \"dd\"\n  | \"d\"\n  | \"m\"\n  | \"M\"\n  | \"P\"\n  | \"A\"\n  | \"AA\"\n  | \"AAA\"\n  | \"AAAA\";\ntype Type = \"perfectable\" | \"majorable\";\n\nexport interface Interval extends Pitch, NamedPitch {\n  readonly empty: boolean;\n  readonly name: IntervalName;\n  readonly num: number;\n  readonly q: Quality;\n  readonly type: Type;\n  readonly step: number;\n  readonly alt: number;\n  readonly dir: Direction;\n  readonly simple: number;\n  readonly semitones: number;\n  readonly chroma: number;\n  readonly coord: IntervalCoordinates;\n  readonly oct: number;\n}\n\nexport type IntervalType = Interval;\n\nconst NoInterval: Interval = Object.freeze({\n  empty: true,\n  name: \"\",\n  num: NaN,\n  q: \"\" as Quality,\n  type: \"\" as Type,\n  step: NaN,\n  alt: NaN,\n  dir: NaN as Direction,\n  simple: NaN,\n  semitones: NaN,\n  chroma: NaN,\n  coord: [] as unknown as IntervalCoordinates,\n  oct: NaN,\n});\n\n// shorthand tonal notation (with quality after number)\nconst INTERVAL_TONAL_REGEX = \"([-+]?\\\\d+)(d{1,4}|m|M|P|A{1,4})\";\n// standard shorthand notation (with quality before number)\nconst INTERVAL_SHORTHAND_REGEX = \"(AA|A|P|M|m|d|dd)([-+]?\\\\d+)\";\nconst REGEX = new RegExp(\n  \"^\" + INTERVAL_TONAL_REGEX + \"|\" + INTERVAL_SHORTHAND_REGEX + \"$\",\n);\n\ntype IntervalTokens = [string, string];\n\n/**\n * @private\n */\nexport function tokenizeInterval(str?: IntervalName): IntervalTokens {\n  const m = REGEX.exec(`${str}`);\n  if (m === null) {\n    return [\"\", \"\"];\n  }\n  return m[1] ? [m[1], m[2]] : [m[4], m[3]];\n}\n\nconst cache: { [key in string]: Interval } = {};\n\n/**\n * Get interval properties. It returns an object with:\n *\n * - name: the interval name\n * - num: the interval number\n * - type: 'perfectable' or 'majorable'\n * - q: the interval quality (d, m, M, A)\n * - dir: interval direction (1 ascending, -1 descending)\n * - simple: the simplified number\n * - semitones: the size in semitones\n * - chroma: the interval chroma\n *\n * @param {string} interval - the interval name\n * @return {Object} the interval properties\n *\n * @example\n * import { interval } from '@tonaljs/core'\n * interval('P5').semitones // => 7\n * interval('m3').type // => 'majorable'\n */\nexport function interval(src: IntervalLiteral): Interval {\n  return typeof src === \"string\"\n    ? cache[src] || (cache[src] = parse(src))\n    : isPitch(src)\n      ? interval(pitchName(src))\n      : isNamedPitch(src)\n        ? interval(src.name)\n        : NoInterval;\n}\n\nconst SIZES = [0, 2, 4, 5, 7, 9, 11];\nconst TYPES = \"PMMPPMM\";\nfunction parse(str?: string): Interval {\n  const tokens = tokenizeInterval(str);\n  if (tokens[0] === \"\") {\n    return NoInterval;\n  }\n  const num = +tokens[0];\n  const q = tokens[1] as Quality;\n  const step = (Math.abs(num) - 1) % 7;\n  const t = TYPES[step];\n  if (t === \"M\" && q === \"P\") {\n    return NoInterval;\n  }\n  const type = t === \"M\" ? \"majorable\" : \"perfectable\";\n\n  const name = \"\" + num + q;\n  const dir = num < 0 ? -1 : 1;\n  const simple = num === 8 || num === -8 ? num : dir * (step + 1);\n  const alt = qToAlt(type, q);\n  const oct = Math.floor((Math.abs(num) - 1) / 7);\n  const semitones = dir * (SIZES[step] + alt + 12 * oct);\n  const chroma = (((dir * (SIZES[step] + alt)) % 12) + 12) % 12;\n  const coord = coordinates({ step, alt, oct, dir }) as IntervalCoordinates;\n  return {\n    empty: false,\n    name,\n    num,\n    q,\n    step,\n    alt,\n    dir,\n    type,\n    simple,\n    semitones,\n    chroma,\n    coord,\n    oct,\n  };\n}\n\n/**\n * @private\n *\n * forceDescending is used in the case of unison (#243)\n */\nexport function coordToInterval(\n  coord: PitchCoordinates,\n  forceDescending?: boolean,\n): Interval {\n  const [f, o = 0] = coord;\n  const isDescending = f * 7 + o * 12 < 0;\n  const ivl: IntervalCoordinates =\n    forceDescending || isDescending ? [-f, -o, -1] : [f, o, 1];\n  return interval(pitch(ivl)) as Interval;\n}\n\nfunction qToAlt(type: Type, q: string): number {\n  return (q === \"M\" && type === \"majorable\") ||\n    (q === \"P\" && type === \"perfectable\")\n    ? 0\n    : q === \"m\" && type === \"majorable\"\n      ? -1\n      : /^A+$/.test(q)\n        ? q.length\n        : /^d+$/.test(q)\n          ? -1 * (type === \"perfectable\" ? q.length : q.length + 1)\n          : 0;\n}\n\n// return the interval name of a pitch\nfunction pitchName(props: Pitch): string {\n  const { step, alt, oct = 0, dir } = props;\n  if (!dir) {\n    return \"\";\n  }\n  const calcNum = step + 1 + 7 * oct;\n  // this is an edge case: descending pitch class unison (see #243)\n  const num = calcNum === 0 ? step + 1 : calcNum;\n  const d = dir < 0 ? \"-\" : \"\";\n  const type = TYPES[step] === \"M\" ? \"majorable\" : \"perfectable\";\n  const name = d + num + altToQ(type, alt);\n  return name;\n}\n\nfunction altToQ(type: Type, alt: number): Quality {\n  if (alt === 0) {\n    return type === \"majorable\" ? \"M\" : \"P\";\n  } else if (alt === -1 && type === \"majorable\") {\n    return \"m\";\n  } else if (alt > 0) {\n    return fillStr(\"A\", alt) as Quality;\n  } else {\n    return fillStr(\"d\", type === \"perfectable\" ? alt : alt + 1) as Quality;\n  }\n}\n","import {\n  coordinates,\n  isNamedPitch,\n  isPitch,\n  NamedPitch,\n  Pitch,\n  pitch,\n  PitchCoordinates,\n} from \"@tonaljs/pitch\";\n\nconst fillStr = (s: string, n: number) => Array(Math.abs(n) + 1).join(s);\n\nexport type NoteWithOctave = string;\nexport type PcName = string;\nexport type NoteName = NoteWithOctave | PcName;\nexport type NoteLiteral = NoteName | Pitch | NamedPitch;\n\nexport interface Note extends Pitch, NamedPitch {\n  readonly empty: boolean;\n  readonly name: NoteName;\n  readonly letter: string;\n  readonly acc: string;\n  readonly pc: PcName;\n  readonly chroma: number;\n  readonly height: number;\n  readonly coord: PitchCoordinates;\n  readonly midi: number | null;\n  readonly freq: number | null;\n}\n\nexport type NoteType = Note;\n\nconst NoNote: Note = Object.freeze({\n  empty: true,\n  name: \"\",\n  letter: \"\",\n  acc: \"\",\n  pc: \"\",\n  step: NaN,\n  alt: NaN,\n  chroma: NaN,\n  height: NaN,\n  coord: [] as unknown as PitchCoordinates,\n  midi: null,\n  freq: null,\n});\n\nconst cache: Map<NoteLiteral | undefined, Note> = new Map();\n\nexport const stepToLetter = (step: number) => \"CDEFGAB\".charAt(step);\nexport const altToAcc = (alt: number): string =>\n  alt < 0 ? fillStr(\"b\", -alt) : fillStr(\"#\", alt);\nexport const accToAlt = (acc: string): number =>\n  acc[0] === \"b\" ? -acc.length : acc.length;\n\n/**\n * Given a note literal (a note name or a note object), returns the Note object\n * @example\n * note('Bb4') // => { name: \"Bb4\", midi: 70, chroma: 10, ... }\n */\nexport function note(src: NoteLiteral): Note {\n  const stringSrc = JSON.stringify(src);\n\n  const cached = cache.get(stringSrc);\n  if (cached) {\n    return cached;\n  }\n\n  const value =\n    typeof src === \"string\"\n      ? parse(src)\n      : isPitch(src)\n        ? note(pitchName(src))\n        : isNamedPitch(src)\n          ? note(src.name)\n          : NoNote;\n  cache.set(stringSrc, value);\n  return value;\n}\n\ntype NoteTokens = [string, string, string, string];\n\nconst REGEX = /^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\\d*)\\s*(.*)$/;\n\n/**\n * @private\n */\nexport function tokenizeNote(str: string): NoteTokens {\n  const m = REGEX.exec(str) as string[];\n  return m\n    ? [m[1].toUpperCase(), m[2].replace(/x/g, \"##\"), m[3], m[4]]\n    : [\"\", \"\", \"\", \"\"];\n}\n\n/**\n * @private\n */\nexport function coordToNote(noteCoord: PitchCoordinates): Note {\n  return note(pitch(noteCoord)) as Note;\n}\n\nconst mod = (n: number, m: number) => ((n % m) + m) % m;\n\nconst SEMI = [0, 2, 4, 5, 7, 9, 11];\nfunction parse(noteName: NoteName): Note {\n  const tokens = tokenizeNote(noteName);\n  if (tokens[0] === \"\" || tokens[3] !== \"\") {\n    return NoNote;\n  }\n\n  const letter = tokens[0];\n  const acc = tokens[1];\n  const octStr = tokens[2];\n\n  const step = (letter.charCodeAt(0) + 3) % 7;\n  const alt = accToAlt(acc);\n  const oct = octStr.length ? +octStr : undefined;\n  const coord = coordinates({ step, alt, oct });\n\n  const name = letter + acc + octStr;\n  const pc = letter + acc;\n  const chroma = (SEMI[step] + alt + 120) % 12;\n  const height =\n    oct === undefined\n      ? mod(SEMI[step] + alt, 12) - 12 * 99\n      : SEMI[step] + alt + 12 * (oct + 1);\n  const midi = height >= 0 && height <= 127 ? height : null;\n  const freq = oct === undefined ? null : Math.pow(2, (height - 69) / 12) * 440;\n\n  return {\n    empty: false,\n    acc,\n    alt,\n    chroma,\n    coord,\n    freq,\n    height,\n    letter,\n    midi,\n    name,\n    oct,\n    pc,\n    step,\n  };\n}\n\nfunction pitchName(props: Pitch): NoteName {\n  const { step, alt, oct } = props;\n  const letter = stepToLetter(step);\n  if (!letter) {\n    return \"\";\n  }\n\n  const pc = letter + altToAcc(alt);\n  return oct || oct === 0 ? pc + oct : pc;\n}\n","import { PitchCoordinates } from \"@tonaljs/pitch\";\nimport {\n  IntervalLiteral,\n  IntervalName,\n  interval as asInterval,\n  coordToInterval,\n} from \"@tonaljs/pitch-interval\";\nimport {\n  NoteLiteral,\n  NoteName,\n  note as asNote,\n  coordToNote,\n} from \"@tonaljs/pitch-note\";\n\n/**\n * Transpose a note by an interval.\n *\n * @param {string} note - the note or note name\n * @param {string} interval - the interval or interval name\n * @return {string} the transposed note name or empty string if not valid notes\n * @example\n * import { transpose } from \"@tonaljs/core\"\n * transpose(\"d3\", \"3M\") // => \"F#3\"\n * transpose(\"D\", \"3M\") // => \"F#\"\n * [\"C\", \"D\", \"E\", \"F\", \"G\"].map(pc => transpose(pc, \"M3)) // => [\"E\", \"F#\", \"G#\", \"A\", \"B\"]\n */\nexport function transpose(\n  noteName: NoteLiteral,\n  intervalName: IntervalLiteral | [number, number],\n): NoteName {\n  const note = asNote(noteName);\n  const intervalCoord = Array.isArray(intervalName)\n    ? intervalName\n    : asInterval(intervalName).coord;\n  if (note.empty || !intervalCoord || intervalCoord.length < 2) {\n    return \"\";\n  }\n  const noteCoord = note.coord;\n  const tr: PitchCoordinates =\n    noteCoord.length === 1\n      ? [noteCoord[0] + intervalCoord[0]]\n      : [noteCoord[0] + intervalCoord[0], noteCoord[1] + intervalCoord[1]];\n  return coordToNote(tr).name;\n}\n\n// Private\nexport function tonicIntervalsTransposer(\n  intervals: string[],\n  tonic: string | undefined | null,\n) {\n  const len = intervals.length;\n  return (normalized: number) => {\n    if (!tonic) return \"\";\n    const index =\n      normalized < 0 ? (len - (-normalized % len)) % len : normalized % len;\n    const octaves = Math.floor(normalized / len);\n    const root = transpose(tonic, [0, octaves]);\n    return transpose(root, intervals[index]);\n  };\n}\n\n/**\n * Find the interval distance between two notes or coord classes.\n *\n * To find distance between coord classes, both notes must be coord classes and\n * the interval is always ascending\n *\n * @param {Note|string} from - the note or note name to calculate distance from\n * @param {Note|string} to - the note or note name to calculate distance to\n * @return {string} the interval name or empty string if not valid notes\n *\n */\nexport function distance(\n  fromNote: NoteLiteral,\n  toNote: NoteLiteral,\n): IntervalName {\n  const from = asNote(fromNote);\n  const to = asNote(toNote);\n  if (from.empty || to.empty) {\n    return \"\";\n  }\n\n  const fcoord = from.coord;\n  const tcoord = to.coord;\n  const fifths = tcoord[0] - fcoord[0];\n  const octs =\n    fcoord.length === 2 && tcoord.length === 2\n      ? tcoord[1] - fcoord[1]\n      : -Math.floor((fifths * 7) / 12);\n\n  // If it's unison, not pitch class, and in the same octave\n  // it can be descending interval (see #243 & #428)\n  const forceDescending =\n    to.height === from.height &&\n    to.midi !== null &&\n    from.oct === to.oct &&\n    from.step > to.step;\n  return coordToInterval([fifths, octs], forceDescending).name;\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n// ascending range\nfunction ascR(b: number, n: number) {\n  const a = [];\n  // tslint:disable-next-line:curly\n  for (; n--; a[n] = n + b);\n  return a;\n}\n// descending range\nfunction descR(b: number, n: number) {\n  const a = [];\n  // tslint:disable-next-line:curly\n  for (; n--; a[n] = b - n);\n  return a;\n}\n\n/**\n * Creates a numeric range\n *\n * @param {number} from\n * @param {number} to\n * @return {Array<number>}\n *\n * @example\n * range(-2, 2) // => [-2, -1, 0, 1, 2]\n * range(2, -2) // => [2, 1, 0, -1, -2]\n */\nexport function range(from: number, to: number): number[] {\n  return from < to ? ascR(from, to - from + 1) : descR(from, from - to + 1);\n}\n\n/**\n * Rotates a list a number of times. It\"s completly agnostic about the\n * contents of the list.\n *\n * @param {Integer} times - the number of rotations\n * @param {Array} collection\n * @return {Array} the rotated collection\n *\n * @example\n * rotate(1, [1, 2, 3]) // => [2, 3, 1]\n */\nexport function rotate<T>(times: number, arr: T[]): T[] {\n  const len = arr.length;\n  const n = ((times % len) + len) % len;\n  return arr.slice(n, len).concat(arr.slice(0, n));\n}\n\n/**\n * Return a copy of the collection with the null values removed\n * @function\n * @param {Array} collection\n * @return {Array}\n *\n * @example\n * compact([\"a\", \"b\", null, \"c\"]) // => [\"a\", \"b\", \"c\"]\n */\nexport function compact(arr: any[]): any[] {\n  return arr.filter((n) => n === 0 || n);\n}\n\n/**\n * Randomizes the order of the specified collection in-place, using the FisherYates shuffle.\n *\n * @function\n * @param {Array} collection\n * @return {Array} the collection shuffled\n *\n * @example\n * shuffle([\"C\", \"D\", \"E\", \"F\"]) // => [...]\n */\nexport function shuffle(arr: any[], rnd = Math.random): any[] {\n  let i: number;\n  let t: any;\n  let m: number = arr.length;\n  while (m) {\n    i = Math.floor(rnd() * m--);\n    t = arr[m];\n    arr[m] = arr[i];\n    arr[i] = t;\n  }\n  return arr;\n}\n\n/**\n * Get all permutations of an collection\n *\n * @param {Array} collection - the collection\n * @return {Array<Array>} an collection with all the permutations\n * @example\n * permutations([\"a\", \"b\", \"c\"])) // =>\n * [\n *   [\"a\", \"b\", \"c\"],\n *   [\"b\", \"a\", \"c\"],\n *   [\"b\", \"c\", \"a\"],\n *   [\"a\", \"c\", \"b\"],\n *   [\"c\", \"a\", \"b\"],\n *   [\"c\", \"b\", \"a\"]\n * ]\n */\nexport function permutations(arr: any[]): any[] {\n  if (arr.length === 0) {\n    return [[]];\n  }\n  return permutations(arr.slice(1)).reduce((acc, perm) => {\n    return acc.concat(\n      arr.map((e, pos) => {\n        const newPerm = perm.slice();\n        newPerm.splice(pos, 0, arr[0]);\n        return newPerm;\n      }),\n    );\n  }, []);\n}\n\n/** @deprecated */\nexport default {\n  compact,\n  permutations,\n  range,\n  rotate,\n  shuffle,\n};\n","import { compact, range, rotate } from \"@tonaljs/collection\";\nimport { NotFound } from \"@tonaljs/pitch\";\nimport { transpose } from \"@tonaljs/pitch-distance\";\nimport { Interval, IntervalName, interval } from \"@tonaljs/pitch-interval\";\nimport { Note, NoteName, note } from \"@tonaljs/pitch-note\";\n\n/**\n * The properties of a pitch class set\n * @param {number} num - a number between 1 and 4095 (both included) that\n * uniquely identifies the set. It's the decimal number of the chroma.\n * @param {string} chroma - a string representation of the set: a 12-char string\n * with either \"1\" or \"0\" as characters, representing a pitch class or not\n * for the given position in the octave. For example, a \"1\" at index 0 means 'C',\n * a \"1\" at index 2 means 'D', and so on...\n * @param {string} normalized - the chroma but shifted to the first 1\n * @param {number} length - the number of notes of the pitch class set\n * @param {IntervalName[]} intervals - the intervals of the pitch class set\n * *starting from C*\n */\nexport interface Pcset {\n  readonly name: string;\n  readonly empty: boolean;\n  readonly setNum: number;\n  readonly chroma: PcsetChroma;\n  readonly normalized: PcsetChroma;\n  readonly intervals: IntervalName[];\n}\n\nexport const EmptyPcset: Pcset = {\n  empty: true,\n  name: \"\",\n  setNum: 0,\n  chroma: \"000000000000\",\n  normalized: \"000000000000\",\n  intervals: [],\n};\n\nexport type PcsetChroma = string;\nexport type PcsetNum = number;\n\n// UTILITIES\nconst setNumToChroma = (num: number): string =>\n  Number(num).toString(2).padStart(12, \"0\");\nconst chromaToNumber = (chroma: string): number => parseInt(chroma, 2);\nconst REGEX = /^[01]{12}$/;\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function isChroma(set: any): set is PcsetChroma {\n  return REGEX.test(set);\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst isPcsetNum = (set: any): set is PcsetNum =>\n  typeof set === \"number\" && set >= 0 && set <= 4095;\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst isPcset = (set: any): set is Pcset => set && isChroma(set.chroma);\n\nconst cache: { [key in string]: Pcset } = { [EmptyPcset.chroma]: EmptyPcset };\n\n/**\n * A definition of a pitch class set. It could be:\n * - The pitch class set chroma (a 12-length string with only 1s or 0s)\n * - The pitch class set number (an integer between 1 and 4095)\n * - An array of note names\n * - An array of interval names\n */\nexport type Set =\n  | Partial<Pcset>\n  | PcsetChroma\n  | PcsetNum\n  | NoteName[]\n  | IntervalName[];\n\n/**\n * Get the pitch class set of a collection of notes or set number or chroma\n */\nexport function get(src: Set): Pcset {\n  const chroma: PcsetChroma = isChroma(src)\n    ? src\n    : isPcsetNum(src)\n      ? setNumToChroma(src)\n      : Array.isArray(src)\n        ? listToChroma(src)\n        : isPcset(src)\n          ? src.chroma\n          : EmptyPcset.chroma;\n\n  return (cache[chroma] = cache[chroma] || chromaToPcset(chroma));\n}\n\n/**\n * @use Pcset.get\n * @deprecated\n */\nexport const pcset = get;\n\n/**\n * Get pitch class set chroma\n * @function\n * @example\n * Pcset.chroma([\"c\", \"d\", \"e\"]); //=> \"101010000000\"\n */\nexport const chroma = (set: Set) => get(set).chroma;\n\n/**\n * Get intervals (from C) of a set\n * @function\n * @example\n * Pcset.intervals([\"c\", \"d\", \"e\"]); //=>\n */\nexport const intervals = (set: Set) => get(set).intervals;\n\n/**\n * Get pitch class set number\n * @function\n * @example\n * Pcset.num([\"c\", \"d\", \"e\"]); //=> 2192\n */\nexport const num = (set: Set) => get(set).setNum;\n\nconst IVLS = [\n  \"1P\",\n  \"2m\",\n  \"2M\",\n  \"3m\",\n  \"3M\",\n  \"4P\",\n  \"5d\",\n  \"5P\",\n  \"6m\",\n  \"6M\",\n  \"7m\",\n  \"7M\",\n];\n\n/**\n * Get the intervals of a pcset *starting from C*\n * @private\n * @param {Set} set - the pitch class set\n * @return {IntervalName[]} an array of interval names or an empty array\n * if not a valid pitch class set\n */\nfunction chromaToIntervals(chroma: PcsetChroma): IntervalName[] {\n  const intervals = [];\n  for (let i = 0; i < 12; i++) {\n    // tslint:disable-next-line:curly\n    if (chroma.charAt(i) === \"1\") intervals.push(IVLS[i]);\n  }\n  return intervals;\n}\n\nexport function notes(set: Set): NoteName[] {\n  return get(set).intervals.map((ivl) => transpose(\"C\", ivl));\n}\n\n/**\n * Get a list of all possible pitch class sets (all possible chromas) *having\n * C as root*. There are 2048 different chromas. If you want them with another\n * note you have to transpose it\n *\n * @see http://allthescales.org/\n * @return {Array<PcsetChroma>} an array of possible chromas from '10000000000' to '11111111111'\n */\nexport function chromas(): PcsetChroma[] {\n  return range(2048, 4095).map(setNumToChroma);\n}\n\n/**\n * Given a a list of notes or a pcset chroma, produce the rotations\n * of the chroma discarding the ones that starts with \"0\"\n *\n * This is used, for example, to get all the modes of a scale.\n *\n * @param {Array|string} set - the list of notes or pitchChr of the set\n * @param {boolean} normalize - (Optional, true by default) remove all\n * the rotations that starts with \"0\"\n * @return {Array<string>} an array with all the modes of the chroma\n *\n * @example\n * Pcset.modes([\"C\", \"D\", \"E\"]).map(Pcset.intervals)\n */\nexport function modes(set: Set, normalize = true): PcsetChroma[] {\n  const pcs = get(set);\n\n  const binary = pcs.chroma.split(\"\");\n  return compact(\n    binary.map((_, i) => {\n      const r = rotate(i, binary);\n      return normalize && r[0] === \"0\" ? null : r.join(\"\");\n    }),\n  );\n}\n\n/**\n * Test if two pitch class sets are equal\n *\n * @param {Array|string} set1 - one of the pitch class sets\n * @param {Array|string} set2 - the other pitch class set\n * @return {boolean} true if they are equal\n * @example\n * Pcset.isEqual([\"c2\", \"d3\"], [\"c5\", \"d2\"]) // => true\n */\nexport function isEqual(s1: Set, s2: Set) {\n  return get(s1).setNum === get(s2).setNum;\n}\n\n/**\n * Create a function that test if a collection of notes is a\n * subset of a given set\n *\n * The function is curried.\n *\n * @param {PcsetChroma|NoteName[]} set - the superset to test against (chroma or\n * list of notes)\n * @return{function(PcsetChroma|NoteNames[]): boolean} a function accepting a set\n * to test against (chroma or list of notes)\n * @example\n * const inCMajor = Pcset.isSubsetOf([\"C\", \"E\", \"G\"])\n * inCMajor([\"e6\", \"c4\"]) // => true\n * inCMajor([\"e6\", \"c4\", \"d3\"]) // => false\n */\nexport function isSubsetOf(set: Set) {\n  const s = get(set).setNum;\n\n  return (notes: Set | Pcset) => {\n    const o = get(notes).setNum;\n    // tslint:disable-next-line: no-bitwise\n    return s && s !== o && (o & s) === o;\n  };\n}\n\n/**\n * Create a function that test if a collection of notes is a\n * superset of a given set (it contains all notes and at least one more)\n *\n * @param {Set} set - an array of notes or a chroma set string to test against\n * @return {(subset: Set): boolean} a function that given a set\n * returns true if is a subset of the first one\n * @example\n * const extendsCMajor = Pcset.isSupersetOf([\"C\", \"E\", \"G\"])\n * extendsCMajor([\"e6\", \"a\", \"c4\", \"g2\"]) // => true\n * extendsCMajor([\"c6\", \"e4\", \"g3\"]) // => false\n */\nexport function isSupersetOf(set: Set) {\n  const s = get(set).setNum;\n  return (notes: Set) => {\n    const o = get(notes).setNum;\n    // tslint:disable-next-line: no-bitwise\n    return s && s !== o && (o | s) === o;\n  };\n}\n\n/**\n * Test if a given pitch class set includes a note\n *\n * @param {Array<string>} set - the base set to test against\n * @param {string} note - the note to test\n * @return {boolean} true if the note is included in the pcset\n *\n * Can be partially applied\n *\n * @example\n * const isNoteInCMajor = isNoteIncludedIn(['C', 'E', 'G'])\n * isNoteInCMajor('C4') // => true\n * isNoteInCMajor('C#4') // => false\n */\nexport function isNoteIncludedIn(set: Set) {\n  const s = get(set);\n\n  return (noteName: NoteName): boolean => {\n    const n = note(noteName);\n    return s && !n.empty && s.chroma.charAt(n.chroma) === \"1\";\n  };\n}\n\n/** @deprecated use: isNoteIncludedIn */\nexport const includes = isNoteIncludedIn;\n\n/**\n * Filter a list with a pitch class set\n *\n * @param {Array|string} set - the pitch class set notes\n * @param {Array|string} notes - the note list to be filtered\n * @return {Array} the filtered notes\n *\n * @example\n * Pcset.filter([\"C\", \"D\", \"E\"], [\"c2\", \"c#2\", \"d2\", \"c3\", \"c#3\", \"d3\"]) // => [ \"c2\", \"d2\", \"c3\", \"d3\" ])\n * Pcset.filter([\"C2\"], [\"c2\", \"c#2\", \"d2\", \"c3\", \"c#3\", \"d3\"]) // => [ \"c2\", \"c3\" ])\n */\nexport function filter(set: Set) {\n  const isIncluded = isNoteIncludedIn(set);\n  return (notes: NoteName[]) => {\n    return notes.filter(isIncluded);\n  };\n}\n\n/** @deprecated */\nexport default {\n  get,\n  chroma,\n  num,\n  intervals,\n  chromas,\n  isSupersetOf,\n  isSubsetOf,\n  isNoteIncludedIn,\n  isEqual,\n  filter,\n  modes,\n  notes,\n  // deprecated\n  pcset,\n};\n\n//// PRIVATE ////\n\nfunction chromaRotations(chroma: string): string[] {\n  const binary = chroma.split(\"\");\n  return binary.map((_, i) => rotate(i, binary).join(\"\"));\n}\n\nfunction chromaToPcset(chroma: PcsetChroma): Pcset {\n  const setNum = chromaToNumber(chroma);\n  const normalizedNum = chromaRotations(chroma)\n    .map(chromaToNumber)\n    .filter((n) => n >= 2048)\n    .sort()[0];\n  const normalized = setNumToChroma(normalizedNum);\n\n  const intervals = chromaToIntervals(chroma);\n\n  return {\n    empty: false,\n    name: \"\",\n    setNum,\n    chroma,\n    normalized,\n    intervals,\n  };\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction listToChroma(set: any[]): PcsetChroma {\n  if (set.length === 0) {\n    return EmptyPcset.chroma;\n  }\n\n  let pitch: Note | Interval | NotFound;\n  const binary = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n  // tslint:disable-next-line:prefer-for-of\n  for (let i = 0; i < set.length; i++) {\n    pitch = note(set[i]);\n    // tslint:disable-next-line: curly\n    if (pitch.empty) pitch = interval(set[i]);\n    // tslint:disable-next-line: curly\n    if (!pitch.empty) binary[pitch.chroma] = 1;\n  }\n  return binary.join(\"\");\n}\n","/**\n * @private\n * Chord List\n * Source: https://en.wikibooks.org/wiki/Music_Theory/Complete_List_of_Chord_Patterns\n * Format: [\"intervals\", \"full name\", \"abrv1 abrv2\"]\n */\nconst CHORDS: string[][] = [\n  // ==Major==\n  [\"1P 3M 5P\", \"major\", \"M ^  maj\"],\n  [\"1P 3M 5P 7M\", \"major seventh\", \"maj7  ma7 M7 Maj7 ^7\"],\n  [\"1P 3M 5P 7M 9M\", \"major ninth\", \"maj9 9 ^9\"],\n  [\"1P 3M 5P 7M 9M 13M\", \"major thirteenth\", \"maj13 Maj13 ^13\"],\n  [\"1P 3M 5P 6M\", \"sixth\", \"6 add6 add13 M6\"],\n  [\"1P 3M 5P 6M 9M\", \"sixth added ninth\", \"6add9 6/9 69 M69\"],\n  [\"1P 3M 6m 7M\", \"major seventh flat sixth\", \"M7b6 ^7b6\"],\n  [\n    \"1P 3M 5P 7M 11A\",\n    \"major seventh sharp eleventh\",\n    \"maj#4 #4 #11 M7#11 ^7#11 maj7#11\",\n  ],\n  // ==Minor==\n  // '''Normal'''\n  [\"1P 3m 5P\", \"minor\", \"m min -\"],\n  [\"1P 3m 5P 7m\", \"minor seventh\", \"m7 min7 mi7 -7\"],\n  [\n    \"1P 3m 5P 7M\",\n    \"minor/major seventh\",\n    \"m/ma7 m/maj7 mM7 mMaj7 m/M7 -7 m -^7 -maj7\",\n  ],\n  [\"1P 3m 5P 6M\", \"minor sixth\", \"m6 -6\"],\n  [\"1P 3m 5P 7m 9M\", \"minor ninth\", \"m9 -9\"],\n  [\"1P 3m 5P 7M 9M\", \"minor/major ninth\", \"mM9 mMaj9 -^9\"],\n  [\"1P 3m 5P 7m 9M 11P\", \"minor eleventh\", \"m11 -11\"],\n  [\"1P 3m 5P 7m 9M 13M\", \"minor thirteenth\", \"m13 -13\"],\n  // '''Diminished'''\n  [\"1P 3m 5d\", \"diminished\", \"dim  o\"],\n  [\"1P 3m 5d 7d\", \"diminished seventh\", \"dim7 7 o7\"],\n  [\"1P 3m 5d 7m\", \"half-diminished\", \"m7b5  -7b5 h7 h\"],\n  // ==Dominant/Seventh==\n  // '''Normal'''\n  [\"1P 3M 5P 7m\", \"dominant seventh\", \"7 dom\"],\n  [\"1P 3M 5P 7m 9M\", \"dominant ninth\", \"9\"],\n  [\"1P 3M 5P 7m 9M 13M\", \"dominant thirteenth\", \"13\"],\n  [\"1P 3M 5P 7m 11A\", \"lydian dominant seventh\", \"7#11 7#4\"],\n  // '''Altered'''\n  [\"1P 3M 5P 7m 9m\", \"dominant flat ninth\", \"7b9\"],\n  [\"1P 3M 5P 7m 9A\", \"dominant sharp ninth\", \"7#9\"],\n  [\"1P 3M 7m 9m\", \"altered\", \"alt7\"],\n  // '''Suspended'''\n  [\"1P 4P 5P\", \"suspended fourth\", \"sus4 sus\"],\n  [\"1P 2M 5P\", \"suspended second\", \"sus2\"],\n  [\"1P 4P 5P 7m\", \"suspended fourth seventh\", \"7sus4 7sus\"],\n  [\"1P 5P 7m 9M 11P\", \"eleventh\", \"11\"],\n  [\n    \"1P 4P 5P 7m 9m\",\n    \"suspended fourth flat ninth\",\n    \"b9sus phryg 7b9sus 7b9sus4\",\n  ],\n  // ==Other==\n  [\"1P 5P\", \"fifth\", \"5\"],\n  [\"1P 3M 5A\", \"augmented\", \"aug + +5 ^#5\"],\n  [\"1P 3m 5A\", \"minor augmented\", \"m#5 -#5 m+\"],\n  [\"1P 3M 5A 7M\", \"augmented seventh\", \"maj7#5 maj7+5 +maj7 ^7#5\"],\n  [\n    \"1P 3M 5P 7M 9M 11A\",\n    \"major sharp eleventh (lydian)\",\n    \"maj9#11 9#11 ^9#11\",\n  ],\n  // ==Legacy==\n  [\"1P 2M 4P 5P\", \"\", \"sus24 sus4add9\"],\n  [\"1P 3M 5A 7M 9M\", \"\", \"maj9#5 Maj9#5\"],\n  [\"1P 3M 5A 7m\", \"\", \"7#5 +7 7+ 7aug aug7\"],\n  [\"1P 3M 5A 7m 9A\", \"\", \"7#5#9 7#9#5 7alt\"],\n  [\"1P 3M 5A 7m 9M\", \"\", \"9#5 9+\"],\n  [\"1P 3M 5A 7m 9M 11A\", \"\", \"9#5#11\"],\n  [\"1P 3M 5A 7m 9m\", \"\", \"7#5b9 7b9#5\"],\n  [\"1P 3M 5A 7m 9m 11A\", \"\", \"7#5b9#11\"],\n  [\"1P 3M 5A 9A\", \"\", \"+add#9\"],\n  [\"1P 3M 5A 9M\", \"\", \"M#5add9 +add9\"],\n  [\"1P 3M 5P 6M 11A\", \"\", \"M6#11 M6b5 6#11 6b5\"],\n  [\"1P 3M 5P 6M 7M 9M\", \"\", \"M7add13\"],\n  [\"1P 3M 5P 6M 9M 11A\", \"\", \"69#11\"],\n  [\"1P 3m 5P 6M 9M\", \"\", \"m69 -69\"],\n  [\"1P 3M 5P 6m 7m\", \"\", \"7b6\"],\n  [\"1P 3M 5P 7M 9A 11A\", \"\", \"maj7#9#11\"],\n  [\"1P 3M 5P 7M 9M 11A 13M\", \"\", \"M13#11 maj13#11 M13+4 M13#4\"],\n  [\"1P 3M 5P 7M 9m\", \"\", \"M7b9\"],\n  [\"1P 3M 5P 7m 11A 13m\", \"\", \"7#11b13 7b5b13\"],\n  [\"1P 3M 5P 7m 13M\", \"\", \"7add6 67 7add13\"],\n  [\"1P 3M 5P 7m 9A 11A\", \"\", \"7#9#11 7b5#9 7#9b5\"],\n  [\"1P 3M 5P 7m 9A 11A 13M\", \"\", \"13#9#11\"],\n  [\"1P 3M 5P 7m 9A 11A 13m\", \"\", \"7#9#11b13\"],\n  [\"1P 3M 5P 7m 9A 13M\", \"\", \"13#9\"],\n  [\"1P 3M 5P 7m 9A 13m\", \"\", \"7#9b13\"],\n  [\"1P 3M 5P 7m 9M 11A\", \"\", \"9#11 9+4 9#4\"],\n  [\"1P 3M 5P 7m 9M 11A 13M\", \"\", \"13#11 13+4 13#4\"],\n  [\"1P 3M 5P 7m 9M 11A 13m\", \"\", \"9#11b13 9b5b13\"],\n  [\"1P 3M 5P 7m 9m 11A\", \"\", \"7b9#11 7b5b9 7b9b5\"],\n  [\"1P 3M 5P 7m 9m 11A 13M\", \"\", \"13b9#11\"],\n  [\"1P 3M 5P 7m 9m 11A 13m\", \"\", \"7b9b13#11 7b9#11b13 7b5b9b13\"],\n  [\"1P 3M 5P 7m 9m 13M\", \"\", \"13b9\"],\n  [\"1P 3M 5P 7m 9m 13m\", \"\", \"7b9b13\"],\n  [\"1P 3M 5P 7m 9m 9A\", \"\", \"7b9#9\"],\n  [\"1P 3M 5P 9M\", \"\", \"Madd9 2 add9 add2\"],\n  [\"1P 3M 5P 9m\", \"\", \"Maddb9\"],\n  [\"1P 3M 5d\", \"\", \"Mb5\"],\n  [\"1P 3M 5d 6M 7m 9M\", \"\", \"13b5\"],\n  [\"1P 3M 5d 7M\", \"\", \"M7b5\"],\n  [\"1P 3M 5d 7M 9M\", \"\", \"M9b5\"],\n  [\"1P 3M 5d 7m\", \"\", \"7b5\"],\n  [\"1P 3M 5d 7m 9M\", \"\", \"9b5\"],\n  [\"1P 3M 7m\", \"\", \"7no5\"],\n  [\"1P 3M 7m 13m\", \"\", \"7b13\"],\n  [\"1P 3M 7m 9M\", \"\", \"9no5\"],\n  [\"1P 3M 7m 9M 13M\", \"\", \"13no5\"],\n  [\"1P 3M 7m 9M 13m\", \"\", \"9b13\"],\n  [\"1P 3m 4P 5P\", \"\", \"madd4\"],\n  [\"1P 3m 5P 6m 7M\", \"\", \"mMaj7b6\"],\n  [\"1P 3m 5P 6m 7M 9M\", \"\", \"mMaj9b6\"],\n  [\"1P 3m 5P 7m 11P\", \"\", \"m7add11 m7add4\"],\n  [\"1P 3m 5P 9M\", \"\", \"madd9\"],\n  [\"1P 3m 5d 6M 7M\", \"\", \"o7M7\"],\n  [\"1P 3m 5d 7M\", \"\", \"oM7\"],\n  [\"1P 3m 6m 7M\", \"\", \"mb6M7\"],\n  [\"1P 3m 6m 7m\", \"\", \"m7#5\"],\n  [\"1P 3m 6m 7m 9M\", \"\", \"m9#5\"],\n  [\"1P 3m 5A 7m 9M 11P\", \"\", \"m11A\"],\n  [\"1P 3m 6m 9m\", \"\", \"mb6b9\"],\n  [\"1P 2M 3m 5d 7m\", \"\", \"m9b5\"],\n  [\"1P 4P 5A 7M\", \"\", \"M7#5sus4\"],\n  [\"1P 4P 5A 7M 9M\", \"\", \"M9#5sus4\"],\n  [\"1P 4P 5A 7m\", \"\", \"7#5sus4\"],\n  [\"1P 4P 5P 7M\", \"\", \"M7sus4\"],\n  [\"1P 4P 5P 7M 9M\", \"\", \"M9sus4\"],\n  [\"1P 4P 5P 7m 9M\", \"\", \"9sus4 9sus\"],\n  [\"1P 4P 5P 7m 9M 13M\", \"\", \"13sus4 13sus\"],\n  [\"1P 4P 5P 7m 9m 13m\", \"\", \"7sus4b9b13 7b9b13sus4\"],\n  [\"1P 4P 7m 10m\", \"\", \"4 quartal\"],\n  [\"1P 5P 7m 9m 11P\", \"\", \"11b9\"],\n];\n\nexport default CHORDS;\n","import {\n  EmptyPcset,\n  get as pcset,\n  Pcset,\n  PcsetChroma,\n  PcsetNum,\n} from \"@tonaljs/pcset\";\nimport data from \"./data\";\n\nexport type ChordQuality =\n  | \"Major\"\n  | \"Minor\"\n  | \"Augmented\"\n  | \"Diminished\"\n  | \"Unknown\";\n\nexport interface ChordType extends Pcset {\n  name: string;\n  quality: ChordQuality;\n  aliases: string[];\n}\nconst NoChordType: ChordType = {\n  ...EmptyPcset,\n  name: \"\",\n  quality: \"Unknown\",\n  intervals: [],\n  aliases: [],\n};\n\ntype ChordTypeName = string | PcsetChroma | PcsetNum;\n\nlet dictionary: ChordType[] = [];\nlet index: Record<ChordTypeName, ChordType> = {};\n\n/**\n * Given a chord name or chroma, return the chord properties\n * @param {string} source - chord name or pitch class set chroma\n * @example\n * import { get } from 'tonaljs/chord-type'\n * get('major') // => { name: 'major', ... }\n */\nexport function get(type: ChordTypeName): ChordType {\n  return index[type] || NoChordType;\n}\n\n/** @deprecated */\nexport const chordType = get;\n\n/**\n * Get all chord (long) names\n */\nexport function names() {\n  return dictionary.map((chord) => chord.name).filter((x) => x);\n}\n\n/**\n * Get all chord symbols\n */\nexport function symbols() {\n  return dictionary.map((chord) => chord.aliases[0]).filter((x) => x);\n}\n\n/**\n * Keys used to reference chord types\n */\nexport function keys() {\n  return Object.keys(index);\n}\n\n/**\n * Return a list of all chord types\n */\nexport function all(): ChordType[] {\n  return dictionary.slice();\n}\n\n/** @deprecated */\nexport const entries = all;\n\n/**\n * Clear the dictionary\n */\nexport function removeAll() {\n  dictionary = [];\n  index = {};\n}\n\n/**\n * Add a chord to the dictionary.\n * @param intervals\n * @param aliases\n * @param [fullName]\n */\nexport function add(intervals: string[], aliases: string[], fullName?: string) {\n  const quality = getQuality(intervals);\n  const chord = {\n    ...pcset(intervals),\n    name: fullName || \"\",\n    quality,\n    intervals,\n    aliases,\n  };\n  dictionary.push(chord);\n  if (chord.name) {\n    index[chord.name] = chord;\n  }\n  index[chord.setNum] = chord;\n  index[chord.chroma] = chord;\n  chord.aliases.forEach((alias) => addAlias(chord, alias));\n}\n\nexport function addAlias(chord: ChordType, alias: string) {\n  index[alias] = chord;\n}\n\nfunction getQuality(intervals: string[]): ChordQuality {\n  const has = (interval: string) => intervals.indexOf(interval) !== -1;\n  return has(\"5A\")\n    ? \"Augmented\"\n    : has(\"3M\")\n      ? \"Major\"\n      : has(\"5d\")\n        ? \"Diminished\"\n        : has(\"3m\")\n          ? \"Minor\"\n          : \"Unknown\";\n}\n\ndata.forEach(([ivls, fullName, names]: string[]) =>\n  add(ivls.split(\" \"), names.split(\" \"), fullName),\n);\ndictionary.sort((a, b) => a.setNum - b.setNum);\n\n/** @deprecated */\nexport default {\n  names,\n  symbols,\n  get,\n  all,\n  add,\n  removeAll,\n  keys,\n  // deprecated\n  entries,\n  chordType,\n};\n","import { all, ChordType } from \"@tonaljs/chord-type\";\nimport { modes } from \"@tonaljs/pcset\";\nimport { note } from \"@tonaljs/pitch-note\";\n\ninterface FoundChord {\n  readonly weight: number;\n  readonly name: string;\n}\n\nconst namedSet = (notes: string[]) => {\n  const pcToName = notes.reduce<Record<number, string>>((record, n) => {\n    const chroma = note(n).chroma;\n    if (chroma !== undefined) {\n      record[chroma] = record[chroma] || note(n).name;\n    }\n    return record;\n  }, {});\n\n  return (chroma: number) => pcToName[chroma];\n};\n\ntype DetectOptions = {\n  assumePerfectFifth: boolean;\n};\nexport function detect(\n  source: string[],\n  options: Partial<DetectOptions> = {},\n): string[] {\n  const notes = source.map((n) => note(n).pc).filter((x) => x);\n  if (note.length === 0) {\n    return [];\n  }\n\n  const found: FoundChord[] = findMatches(notes, 1, options);\n\n  return found\n    .filter((chord) => chord.weight)\n    .sort((a, b) => b.weight - a.weight)\n    .map((chord) => chord.name);\n}\n\n/* tslint:disable:no-bitwise */\nconst BITMASK = {\n  // 3m 000100000000\n  // 3M 000010000000\n  anyThirds: 384,\n  // 5P 000000010000\n  perfectFifth: 16,\n  // 5d 000000100000\n  // 5A 000000001000\n  nonPerfectFifths: 40,\n  anySeventh: 3,\n};\n\nconst testChromaNumber = (bitmask: number) => (chromaNumber: number) =>\n  Boolean(chromaNumber & bitmask);\nconst hasAnyThird = testChromaNumber(BITMASK.anyThirds);\nconst hasPerfectFifth = testChromaNumber(BITMASK.perfectFifth);\nconst hasAnySeventh = testChromaNumber(BITMASK.anySeventh);\nconst hasNonPerfectFifth = testChromaNumber(BITMASK.nonPerfectFifths);\n\nfunction hasAnyThirdAndPerfectFifthAndAnySeventh(chordType: ChordType) {\n  const chromaNumber = parseInt(chordType.chroma, 2);\n  return (\n    hasAnyThird(chromaNumber) &&\n    hasPerfectFifth(chromaNumber) &&\n    hasAnySeventh(chromaNumber)\n  );\n}\n\nfunction withPerfectFifth(chroma: string): string {\n  const chromaNumber = parseInt(chroma, 2);\n  return hasNonPerfectFifth(chromaNumber)\n    ? chroma\n    : (chromaNumber | 16).toString(2);\n}\n\n/* tslint:enable:no-bitwise */\n\ntype FindMatchesOptions = {\n  assumePerfectFifth: boolean;\n};\nfunction findMatches(\n  notes: string[],\n  weight: number,\n  options: Partial<FindMatchesOptions>,\n): FoundChord[] {\n  const tonic = notes[0];\n  const tonicChroma = note(tonic).chroma;\n  const noteName = namedSet(notes);\n  // we need to test all chromas to get the correct baseNote\n  const allModes = modes(notes, false);\n\n  const found: FoundChord[] = [];\n  allModes.forEach((mode, index) => {\n    const modeWithPerfectFifth =\n      options.assumePerfectFifth && withPerfectFifth(mode);\n    // some chords could have the same chroma but different interval spelling\n    const chordTypes = all().filter((chordType) => {\n      if (\n        options.assumePerfectFifth &&\n        hasAnyThirdAndPerfectFifthAndAnySeventh(chordType)\n      ) {\n        return chordType.chroma === modeWithPerfectFifth;\n      }\n      return chordType.chroma === mode;\n    });\n\n    chordTypes.forEach((chordType) => {\n      const chordName = chordType.aliases[0];\n      const baseNote = noteName(index);\n      const isInversion = index !== tonicChroma;\n      if (isInversion) {\n        found.push({\n          weight: 0.5 * weight,\n          name: `${baseNote}${chordName}/${tonic}`,\n        });\n      } else {\n        found.push({ weight: 1 * weight, name: `${baseNote}${chordName}` });\n      }\n    });\n  });\n\n  return found;\n}\n\n/** @deprecated */\nexport default { detect };\n","import { IntervalCoordinates, NoteCoordinates } from \"@tonaljs/pitch\";\nimport { distance as dist } from \"@tonaljs/pitch-distance\";\nimport {\n  IntervalName,\n  coordToInterval,\n  interval as props,\n} from \"@tonaljs/pitch-interval\";\n\n/**\n * Get the natural list of names\n */\nexport function names(): IntervalName[] {\n  return \"1P 2M 3M 4P 5P 6m 7m\".split(\" \");\n}\n\n/**\n * Get properties of an interval\n *\n * @function\n * @example\n * Interval.get('P4') // => {\"alt\": 0,  \"dir\": 1,  \"name\": \"4P\", \"num\": 4, \"oct\": 0, \"q\": \"P\", \"semitones\": 5, \"simple\": 4, \"step\": 3, \"type\": \"perfectable\"}\n */\nexport const get = props;\n\n/**\n * Get name of an interval\n *\n * @function\n * @example\n * Interval.name('4P') // => \"4P\"\n * Interval.name('P4') // => \"4P\"\n * Interval.name('C4') // => \"\"\n */\nexport const name = (name: string) => props(name).name;\n\n/**\n * Get semitones of an interval\n * @function\n * @example\n * Interval.semitones('P4') // => 5\n */\nexport const semitones = (name: string) => props(name).semitones;\n\n/**\n * Get quality of an interval\n * @function\n * @example\n * Interval.quality('P4') // => \"P\"\n */\nexport const quality = (name: string) => props(name).q;\n\n/**\n * Get number of an interval\n * @function\n * @example\n * Interval.num('P4') // => 4\n */\nexport const num = (name: string) => props(name).num;\n\n/**\n * Get the simplified version of an interval.\n *\n * @function\n * @param {string} interval - the interval to simplify\n * @return {string} the simplified interval\n *\n * @example\n * Interval.simplify(\"9M\") // => \"2M\"\n * Interval.simplify(\"2M\") // => \"2M\"\n * Interval.simplify(\"-2M\") // => \"7m\"\n * [\"8P\", \"9M\", \"10M\", \"11P\", \"12P\", \"13M\", \"14M\", \"15P\"].map(Interval.simplify)\n * // => [ \"8P\", \"2M\", \"3M\", \"4P\", \"5P\", \"6M\", \"7M\", \"8P\" ]\n */\nexport function simplify(name: IntervalName): IntervalName {\n  const i = props(name);\n  return i.empty ? \"\" : i.simple + i.q;\n}\n\n/**\n * Get the inversion (https://en.wikipedia.org/wiki/Inversion_(music)#Intervals)\n * of an interval.\n *\n * @function\n * @param {string} interval - the interval to invert in interval shorthand\n * notation or interval array notation\n * @return {string} the inverted interval\n *\n * @example\n * Interval.invert(\"3m\") // => \"6M\"\n * Interval.invert(\"2M\") // => \"7m\"\n */\nexport function invert(name: IntervalName): IntervalName {\n  const i = props(name);\n  if (i.empty) {\n    return \"\";\n  }\n  const step = (7 - i.step) % 7;\n  const alt = i.type === \"perfectable\" ? -i.alt : -(i.alt + 1);\n  return props({ step, alt, oct: i.oct, dir: i.dir }).name;\n}\n\n// interval numbers\nconst IN = [1, 2, 2, 3, 3, 4, 5, 5, 6, 6, 7, 7];\n// interval qualities\nconst IQ = \"P m M m M P d P m M m M\".split(\" \");\n\n/**\n * Get interval name from semitones number. Since there are several interval\n * names for the same number, the name it's arbitrary, but deterministic.\n *\n * @param {Integer} num - the number of semitones (can be negative)\n * @return {string} the interval name\n * @example\n * Interval.fromSemitones(7) // => \"5P\"\n * Interval.fromSemitones(-7) // => \"-5P\"\n */\nexport function fromSemitones(semitones: number): IntervalName {\n  const d = semitones < 0 ? -1 : 1;\n  const n = Math.abs(semitones);\n  const c = n % 12;\n  const o = Math.floor(n / 12);\n  return d * (IN[c] + 7 * o) + IQ[c];\n}\n\n/**\n * Find interval between two notes\n *\n * @example\n * Interval.distance(\"C4\", \"G4\"); // => \"5P\"\n */\nexport const distance = dist;\n\n/**\n * Adds two intervals\n *\n * @function\n * @param {string} interval1\n * @param {string} interval2\n * @return {string} the added interval name\n * @example\n * Interval.add(\"3m\", \"5P\") // => \"7m\"\n */\nexport const add = combinator((a, b) => [a[0] + b[0], a[1] + b[1]]);\n\n/**\n * Returns a function that adds an interval\n *\n * @function\n * @example\n * ['1P', '2M', '3M'].map(Interval.addTo('5P')) // => [\"5P\", \"6M\", \"7M\"]\n */\nexport const addTo = (interval: string) => (other: string) =>\n  add(interval, other);\n\n/**\n * Subtracts two intervals\n *\n * @function\n * @param {string} minuendInterval\n * @param {string} subtrahendInterval\n * @return {string} the subtracted interval name\n * @example\n * Interval.subtract('5P', '3M') // => '3m'\n * Interval.subtract('3M', '5P') // => '-3m'\n */\nexport const subtract = combinator((a, b) => [a[0] - b[0], a[1] - b[1]]);\n\nexport function transposeFifths(\n  interval: IntervalName,\n  fifths: number,\n): IntervalName {\n  const ivl = get(interval);\n  if (ivl.empty) return \"\";\n\n  const [nFifths, nOcts, dir] = ivl.coord;\n  return coordToInterval([nFifths + fifths, nOcts, dir]).name;\n}\n\n/** @deprecated */\nexport default {\n  names,\n  get,\n  name,\n  num,\n  semitones,\n  quality,\n  fromSemitones,\n  distance,\n  invert,\n  simplify,\n  add,\n  addTo,\n  subtract,\n  transposeFifths,\n};\n\n//// PRIVATE ////\n\ntype Operation = (\n  a: IntervalCoordinates,\n  b: IntervalCoordinates,\n) => NoteCoordinates;\n\nfunction combinator(fn: Operation) {\n  return (a: IntervalName, b: IntervalName): IntervalName | undefined => {\n    const coordA = props(a).coord;\n    const coordB = props(b).coord;\n    if (coordA && coordB) {\n      const coord = fn(coordA, coordB);\n      return coordToInterval(coord).name;\n    }\n  };\n}\n","// SCALES\n// Format: [\"intervals\", \"name\", \"alias1\", \"alias2\", ...]\nconst SCALES: string[][] = [\n  // Basic scales\n  [\"1P 2M 3M 5P 6M\", \"major pentatonic\", \"pentatonic\"],\n  [\"1P 2M 3M 4P 5P 6M 7M\", \"major\", \"ionian\"],\n  [\"1P 2M 3m 4P 5P 6m 7m\", \"minor\", \"aeolian\"],\n\n  // Jazz common scales\n  [\"1P 2M 3m 3M 5P 6M\", \"major blues\"],\n  [\"1P 3m 4P 5d 5P 7m\", \"minor blues\", \"blues\"],\n  [\"1P 2M 3m 4P 5P 6M 7M\", \"melodic minor\"],\n  [\"1P 2M 3m 4P 5P 6m 7M\", \"harmonic minor\"],\n  [\"1P 2M 3M 4P 5P 6M 7m 7M\", \"bebop\"],\n  [\"1P 2M 3m 4P 5d 6m 6M 7M\", \"diminished\", \"whole-half diminished\"],\n\n  // Modes\n  [\"1P 2M 3m 4P 5P 6M 7m\", \"dorian\"],\n  [\"1P 2M 3M 4A 5P 6M 7M\", \"lydian\"],\n  [\"1P 2M 3M 4P 5P 6M 7m\", \"mixolydian\", \"dominant\"],\n  [\"1P 2m 3m 4P 5P 6m 7m\", \"phrygian\"],\n  [\"1P 2m 3m 4P 5d 6m 7m\", \"locrian\"],\n\n  // 5-note scales\n  [\"1P 3M 4P 5P 7M\", \"ionian pentatonic\"],\n  [\"1P 3M 4P 5P 7m\", \"mixolydian pentatonic\", \"indian\"],\n  [\"1P 2M 4P 5P 6M\", \"ritusen\"],\n  [\"1P 2M 4P 5P 7m\", \"egyptian\"],\n  [\"1P 3M 4P 5d 7m\", \"neopolitan major pentatonic\"],\n  [\"1P 3m 4P 5P 6m\", \"vietnamese 1\"],\n  [\"1P 2m 3m 5P 6m\", \"pelog\"],\n  [\"1P 2m 4P 5P 6m\", \"kumoijoshi\"],\n  [\"1P 2M 3m 5P 6m\", \"hirajoshi\"],\n  [\"1P 2m 4P 5d 7m\", \"iwato\"],\n  [\"1P 2m 4P 5P 7m\", \"in-sen\"],\n  [\"1P 3M 4A 5P 7M\", \"lydian pentatonic\", \"chinese\"],\n  [\"1P 3m 4P 6m 7m\", \"malkos raga\"],\n  [\"1P 3m 4P 5d 7m\", \"locrian pentatonic\", \"minor seven flat five pentatonic\"],\n  [\"1P 3m 4P 5P 7m\", \"minor pentatonic\", \"vietnamese 2\"],\n  [\"1P 3m 4P 5P 6M\", \"minor six pentatonic\"],\n  [\"1P 2M 3m 5P 6M\", \"flat three pentatonic\", \"kumoi\"],\n  [\"1P 2M 3M 5P 6m\", \"flat six pentatonic\"],\n  [\"1P 2m 3M 5P 6M\", \"scriabin\"],\n  [\"1P 3M 5d 6m 7m\", \"whole tone pentatonic\"],\n  [\"1P 3M 4A 5A 7M\", \"lydian #5P pentatonic\"],\n  [\"1P 3M 4A 5P 7m\", \"lydian dominant pentatonic\"],\n  [\"1P 3m 4P 5P 7M\", \"minor #7M pentatonic\"],\n  [\"1P 3m 4d 5d 7m\", \"super locrian pentatonic\"],\n\n  // 6-note scales\n  [\"1P 2M 3m 4P 5P 7M\", \"minor hexatonic\"],\n  [\"1P 2A 3M 5P 5A 7M\", \"augmented\"],\n  [\"1P 2M 4P 5P 6M 7m\", \"piongio\"],\n  [\"1P 2m 3M 4A 6M 7m\", \"prometheus neopolitan\"],\n  [\"1P 2M 3M 4A 6M 7m\", \"prometheus\"],\n  [\"1P 2m 3M 5d 6m 7m\", \"mystery #1\"],\n  [\"1P 2m 3M 4P 5A 6M\", \"six tone symmetric\"],\n  [\"1P 2M 3M 4A 5A 6A\", \"whole tone\", \"messiaen's mode #1\"],\n  [\"1P 2m 4P 4A 5P 7M\", \"messiaen's mode #5\"],\n\n  // 7-note scales\n  [\"1P 2M 3M 4P 5d 6m 7m\", \"locrian major\", \"arabian\"],\n  [\"1P 2m 3M 4A 5P 6m 7M\", \"double harmonic lydian\"],\n  [\n    \"1P 2m 2A 3M 4A 6m 7m\",\n    \"altered\",\n    \"super locrian\",\n    \"diminished whole tone\",\n    \"pomeroy\",\n  ],\n  [\"1P 2M 3m 4P 5d 6m 7m\", \"locrian #2\", \"half-diminished\", \"aeolian b5\"],\n  [\n    \"1P 2M 3M 4P 5P 6m 7m\",\n    \"mixolydian b6\",\n    \"melodic minor fifth mode\",\n    \"hindu\",\n  ],\n  [\"1P 2M 3M 4A 5P 6M 7m\", \"lydian dominant\", \"lydian b7\", \"overtone\"],\n  [\"1P 2M 3M 4A 5A 6M 7M\", \"lydian augmented\"],\n  [\n    \"1P 2m 3m 4P 5P 6M 7m\",\n    \"dorian b2\",\n    \"phrygian #6\",\n    \"melodic minor second mode\",\n  ],\n  [\n    \"1P 2m 3m 4d 5d 6m 7d\",\n    \"ultralocrian\",\n    \"superlocrian bb7\",\n    \"superlocrian diminished\",\n  ],\n  [\"1P 2m 3m 4P 5d 6M 7m\", \"locrian 6\", \"locrian natural 6\", \"locrian sharp 6\"],\n  [\"1P 2A 3M 4P 5P 5A 7M\", \"augmented heptatonic\"],\n  // Source https://en.wikipedia.org/wiki/Ukrainian_Dorian_scale\n  [\n    \"1P 2M 3m 4A 5P 6M 7m\",\n    \"dorian #4\",\n    \"ukrainian dorian\",\n    \"romanian minor\",\n    \"altered dorian\",\n  ],\n  [\"1P 2M 3m 4A 5P 6M 7M\", \"lydian diminished\"],\n  [\"1P 2M 3M 4A 5A 7m 7M\", \"leading whole tone\"],\n  [\"1P 2M 3M 4A 5P 6m 7m\", \"lydian minor\"],\n  [\"1P 2m 3M 4P 5P 6m 7m\", \"phrygian dominant\", \"spanish\", \"phrygian major\"],\n  [\"1P 2m 3m 4P 5P 6m 7M\", \"balinese\"],\n  [\"1P 2m 3m 4P 5P 6M 7M\", \"neopolitan major\"],\n  [\"1P 2M 3M 4P 5P 6m 7M\", \"harmonic major\"],\n  [\"1P 2m 3M 4P 5P 6m 7M\", \"double harmonic major\", \"gypsy\"],\n  [\"1P 2M 3m 4A 5P 6m 7M\", \"hungarian minor\"],\n  [\"1P 2A 3M 4A 5P 6M 7m\", \"hungarian major\"],\n  [\"1P 2m 3M 4P 5d 6M 7m\", \"oriental\"],\n  [\"1P 2m 3m 3M 4A 5P 7m\", \"flamenco\"],\n  [\"1P 2m 3m 4A 5P 6m 7M\", \"todi raga\"],\n  [\"1P 2m 3M 4P 5d 6m 7M\", \"persian\"],\n  [\"1P 2m 3M 5d 6m 7m 7M\", \"enigmatic\"],\n  [\n    \"1P 2M 3M 4P 5A 6M 7M\",\n    \"major augmented\",\n    \"major #5\",\n    \"ionian augmented\",\n    \"ionian #5\",\n  ],\n  [\"1P 2A 3M 4A 5P 6M 7M\", \"lydian #9\"],\n\n  // 8-note scales\n  [\"1P 2m 2M 4P 4A 5P 6m 7M\", \"messiaen's mode #4\"],\n  [\"1P 2m 3M 4P 4A 5P 6m 7M\", \"purvi raga\"],\n  [\"1P 2m 3m 3M 4P 5P 6m 7m\", \"spanish heptatonic\"],\n  [\"1P 2M 3m 3M 4P 5P 6M 7m\", \"bebop minor\"],\n  [\"1P 2M 3M 4P 5P 5A 6M 7M\", \"bebop major\"],\n  [\"1P 2m 3m 4P 5d 5P 6m 7m\", \"bebop locrian\"],\n  [\"1P 2M 3m 4P 5P 6m 7m 7M\", \"minor bebop\"],\n  [\"1P 2M 3M 4P 5d 5P 6M 7M\", \"ichikosucho\"],\n  [\"1P 2M 3m 4P 5P 6m 6M 7M\", \"minor six diminished\"],\n  [\n    \"1P 2m 3m 3M 4A 5P 6M 7m\",\n    \"half-whole diminished\",\n    \"dominant diminished\",\n    \"messiaen's mode #2\",\n  ],\n  [\"1P 3m 3M 4P 5P 6M 7m 7M\", \"kafi raga\"],\n  [\"1P 2M 3M 4P 4A 5A 6A 7M\", \"messiaen's mode #6\"],\n\n  // 9-note scales\n  [\"1P 2M 3m 3M 4P 5d 5P 6M 7m\", \"composite blues\"],\n  [\"1P 2M 3m 3M 4A 5P 6m 7m 7M\", \"messiaen's mode #3\"],\n\n  // 10-note scales\n  [\"1P 2m 2M 3m 4P 4A 5P 6m 6M 7M\", \"messiaen's mode #7\"],\n\n  // 12-note scales\n  [\"1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M\", \"chromatic\"],\n];\n\nexport default SCALES;\n","import {\n  EmptyPcset,\n  get as pcset,\n  Pcset,\n  PcsetChroma,\n  PcsetNum,\n} from \"@tonaljs/pcset\";\nimport data from \"./data\";\n\n/**\n * Properties for a scale in the scale dictionary. It's a pitch class set\n * properties with the following additional information:\n * - name: the scale name\n * - aliases: alternative list of names\n * - intervals: an array of interval names\n */\nexport interface ScaleType extends Pcset {\n  readonly name: string;\n  readonly aliases: string[];\n}\n\nexport const NoScaleType: ScaleType = {\n  ...EmptyPcset,\n  intervals: [],\n  aliases: [],\n};\n\ntype ScaleTypeName = string | PcsetChroma | PcsetNum;\n\nlet dictionary: ScaleType[] = [];\nlet index: Record<ScaleTypeName, ScaleType> = {};\n\nexport function names() {\n  return dictionary.map((scale) => scale.name);\n}\n\n/**\n * Given a scale name or chroma, return the scale properties\n *\n * @param {string} type - scale name or pitch class set chroma\n * @example\n * import { get } from 'tonaljs/scale-type'\n * get('major') // => { name: 'major', ... }\n */\nexport function get(type: ScaleTypeName): ScaleType {\n  return index[type] || NoScaleType;\n}\n\n/**\n * @deprecated\n * @use ScaleType.get\n */\nexport const scaleType = get;\n\n/**\n * Return a list of all scale types\n */\nexport function all() {\n  return dictionary.slice();\n}\n\n/**\n * @deprecated\n * @use ScaleType.all\n */\nexport const entries = all;\n\n/**\n * Keys used to reference scale types\n */\nexport function keys() {\n  return Object.keys(index);\n}\n\n/**\n * Clear the dictionary\n */\nexport function removeAll() {\n  dictionary = [];\n  index = {};\n}\n\n/**\n * Add a scale into dictionary\n * @param intervals\n * @param name\n * @param aliases\n */\nexport function add(\n  intervals: string[],\n  name: string,\n  aliases: string[] = [],\n): ScaleType {\n  const scale = { ...pcset(intervals), name, intervals, aliases };\n  dictionary.push(scale);\n  index[scale.name] = scale;\n  index[scale.setNum] = scale;\n  index[scale.chroma] = scale;\n  scale.aliases.forEach((alias) => addAlias(scale, alias));\n  return scale;\n}\n\nexport function addAlias(scale: ScaleType, alias: string) {\n  index[alias] = scale;\n}\n\ndata.forEach(([ivls, name, ...aliases]: string[]) =>\n  add(ivls.split(\" \"), name, aliases),\n);\n\n/** @deprecated */\nexport default {\n  names,\n  get,\n  all,\n  add,\n  removeAll,\n  keys,\n\n  // deprecated\n  entries,\n  scaleType,\n};\n","import { detect } from \"@tonaljs/chord-detect\";\nimport {\n  ChordType,\n  all as chordTypes,\n  get as getChordType,\n} from \"@tonaljs/chord-type\";\nimport { subtract } from \"@tonaljs/interval\";\nimport { isSubsetOf, isSupersetOf } from \"@tonaljs/pcset\";\nimport {\n  distance,\n  tonicIntervalsTransposer,\n  transpose as transposeNote,\n} from \"@tonaljs/pitch-distance\";\nimport { NoteName, note, tokenizeNote } from \"@tonaljs/pitch-note\";\nimport { all as scaleTypes } from \"@tonaljs/scale-type\";\n\nexport { detect } from \"@tonaljs/chord-detect\";\n\ntype ChordNameOrTokens =\n  | string // full name to be parsed\n  | [string] // only the name\n  | [string, string] // tonic, name\n  | [string, string, string]; // tonic, name, bass\ntype ChordNameTokens = [string, string, string]; // [TONIC, SCALE TYPE, BASS]\n\nexport interface Chord extends ChordType {\n  tonic: string | null;\n  type: string;\n  root: string;\n  bass: string;\n  rootDegree: number;\n  symbol: string;\n  notes: NoteName[];\n}\n\nconst NoChord: Chord = {\n  empty: true,\n  name: \"\",\n  symbol: \"\",\n  root: \"\",\n  bass: \"\",\n  rootDegree: 0,\n  type: \"\",\n  tonic: null,\n  setNum: NaN,\n  quality: \"Unknown\",\n  chroma: \"\",\n  normalized: \"\",\n  aliases: [],\n  notes: [],\n  intervals: [],\n};\n\n// 6, 64, 7, 9, 11 and 13 are consider part of the chord\n// (see https://github.com/danigb/tonal/issues/55)\n//const NUM_TYPES = /^(6|64|7|9|11|13)$/;\n/**\n * Tokenize a chord name. It returns an array with the tonic, chord type and bass\n * If not tonic is found, all the name is considered the chord name.\n *\n * This function does NOT check if the chord type exists or not. It only tries\n * to split the tonic and chord type.\n *\n * This function does NOT check if the bass is part of the chord or not but it\n * only accepts a pitch class as bass\n *\n * @function\n * @param {string} name - the chord name\n * @return {Array} an array with [tonic, type, bass]\n * @example\n * tokenize(\"Cmaj7\") // => [ \"C\", \"maj7\" ]\n * tokenize(\"C7\") // => [ \"C\", \"7\" ]\n * tokenize(\"mMaj7\") // => [ null, \"mMaj7\" ]\n * tokenize(\"Cnonsense\") // => [ null, \"nonsense\" ]\n */\nexport function tokenize(name: string): ChordNameTokens {\n  const [letter, acc, oct, type] = tokenizeNote(name);\n  if (letter === \"\") {\n    return tokenizeBass(\"\", name);\n  } else if (letter === \"A\" && type === \"ug\") {\n    return tokenizeBass(\"\", \"aug\");\n  } else {\n    return tokenizeBass(letter + acc, oct + type);\n  }\n}\n\nfunction tokenizeBass(note: string, chord: string): ChordNameTokens {\n  const split = chord.split(\"/\");\n  if (split.length === 1) {\n    return [note, split[0], \"\"];\n  }\n  const [letter, acc, oct, type] = tokenizeNote(split[1]);\n  // Only a pitch class is accepted as bass note\n  if (letter !== \"\" && oct === \"\" && type === \"\") {\n    return [note, split[0], letter + acc];\n  } else {\n    return [note, chord, \"\"];\n  }\n}\n\n/**\n * Get a Chord from a chord name.\n */\nexport function get(src: ChordNameOrTokens): Chord {\n  if (Array.isArray(src)) {\n    return getChord(src[1] || \"\", src[0], src[2]);\n  } else if (src === \"\") {\n    return NoChord;\n  } else {\n    const [tonic, type, bass] = tokenize(src);\n    const chord = getChord(type, tonic, bass);\n    return chord.empty ? getChord(src) : chord;\n  }\n}\n\n/**\n * Get chord properties\n *\n * @param typeName - the chord type name\n * @param [tonic] - Optional tonic\n * @param [root]  - Optional root (requires a tonic)\n */\nexport function getChord(\n  typeName: string,\n  optionalTonic?: string,\n  optionalBass?: string,\n): Chord {\n  const type = getChordType(typeName);\n  const tonic = note(optionalTonic || \"\");\n  const bass = note(optionalBass || \"\");\n\n  if (\n    type.empty ||\n    (optionalTonic && tonic.empty) ||\n    (optionalBass && bass.empty)\n  ) {\n    return NoChord;\n  }\n\n  const bassInterval = distance(tonic.pc, bass.pc);\n  const bassIndex = type.intervals.indexOf(bassInterval);\n  const hasRoot = bassIndex >= 0;\n  const root = hasRoot ? bass : note(\"\");\n  const rootDegree = bassIndex === -1 ? NaN : bassIndex + 1;\n  const hasBass = bass.pc && bass.pc !== tonic.pc;\n\n  const intervals = Array.from(type.intervals);\n\n  if (hasRoot) {\n    for (let i = 1; i < rootDegree; i++) {\n      const num = intervals[0][0];\n      const quality = intervals[0][1];\n      const newNum = parseInt(num, 10) + 7;\n      intervals.push(`${newNum}${quality}`);\n      intervals.shift();\n    }\n  } else if (hasBass) {\n    const ivl = subtract(distance(tonic.pc, bass.pc), \"8P\");\n    if (ivl) intervals.unshift(ivl);\n  }\n\n  const notes = tonic.empty\n    ? []\n    : intervals.map((i) => transposeNote(tonic.pc, i));\n\n  typeName = type.aliases.indexOf(typeName) !== -1 ? typeName : type.aliases[0];\n  const symbol = `${tonic.empty ? \"\" : tonic.pc}${typeName}${\n    hasRoot && rootDegree > 1 ? \"/\" + root.pc : hasBass ? \"/\" + bass.pc : \"\"\n  }`;\n  const name = `${optionalTonic ? tonic.pc + \" \" : \"\"}${type.name}${\n    hasRoot && rootDegree > 1\n      ? \" over \" + root.pc\n      : hasBass\n        ? \" over \" + bass.pc\n        : \"\"\n  }`;\n  return {\n    ...type,\n    name,\n    symbol,\n    tonic: tonic.pc,\n    type: type.name,\n    root: root.pc,\n    bass: hasBass ? bass.pc : \"\",\n    intervals,\n    rootDegree,\n    notes,\n  };\n}\n\nexport const chord = get;\n\n/**\n * Transpose a chord name\n *\n * @param {string} chordName - the chord name\n * @return {string} the transposed chord\n *\n * @example\n * transpose('Dm7', 'P4') // => 'Gm7\n */\nexport function transpose(chordName: string, interval: string): string {\n  const [tonic, type, bass] = tokenize(chordName);\n  if (!tonic) {\n    return chordName;\n  }\n  const tr = transposeNote(bass, interval);\n  const slash = tr ? \"/\" + tr : \"\";\n  return transposeNote(tonic, interval) + type + slash;\n}\n\n/**\n * Get all scales where the given chord fits\n *\n * @example\n * chordScales('C7b9')\n * // => [\"phrygian dominant\", \"flamenco\", \"spanish heptatonic\", \"half-whole diminished\", \"chromatic\"]\n */\nexport function chordScales(name: string): string[] {\n  const s = get(name);\n  const isChordIncluded = isSupersetOf(s.chroma);\n  return scaleTypes()\n    .filter((scale) => isChordIncluded(scale.chroma))\n    .map((scale) => scale.name);\n}\n/**\n * Get all chords names that are a superset of the given one\n * (has the same notes and at least one more)\n *\n * @function\n * @example\n * extended(\"CMaj7\")\n * // => [ 'Cmaj#4', 'Cmaj7#9#11', 'Cmaj9', 'CM7add13', 'Cmaj13', 'Cmaj9#11', 'CM13#11', 'CM7b9' ]\n */\nexport function extended(chordName: string): string[] {\n  const s = get(chordName);\n  const isSuperset = isSupersetOf(s.chroma);\n  return chordTypes()\n    .filter((chord) => isSuperset(chord.chroma))\n    .map((chord) => s.tonic + chord.aliases[0]);\n}\n\n/**\n * Find all chords names that are a subset of the given one\n * (has less notes but all from the given chord)\n *\n * @example\n */\nexport function reduced(chordName: string): string[] {\n  const s = get(chordName);\n  const isSubset = isSubsetOf(s.chroma);\n  return chordTypes()\n    .filter((chord) => isSubset(chord.chroma))\n    .map((chord) => s.tonic + chord.aliases[0]);\n}\n\n/**\n * Return the chord notes\n */\nexport function notes(chordName: ChordNameOrTokens, tonic?: string): string[] {\n  const chord = get(chordName);\n  const note = tonic || chord.tonic;\n  if (!note || chord.empty) return [];\n  return chord.intervals.map((ivl) => transposeNote(note, ivl));\n}\n\n/**\n * Returns a function to get a note name from the scale degree.\n *\n * @example\n * [1, 2, 3, 4].map(Chord.degrees(\"C\")) => [\"C\", \"E\", \"G\", \"C\"]\n * [1, 2, 3, 4].map(Chord.degrees(\"C4\")) => [\"C4\", \"E4\", \"G4\", \"C5\"]\n */\nexport function degrees(chordName: ChordNameOrTokens, tonic?: string) {\n  const chord = get(chordName);\n  const note = tonic || chord.tonic;\n  const transpose = tonicIntervalsTransposer(chord.intervals, note);\n  return (degree: number) =>\n    degree ? transpose(degree > 0 ? degree - 1 : degree) : \"\";\n}\n\n/**\n * Sames as `degree` but with 0-based index\n */\nexport function steps(chordName: ChordNameOrTokens, tonic?: string) {\n  const chord = get(chordName);\n  const note = tonic || chord.tonic;\n  return tonicIntervalsTransposer(chord.intervals, note);\n}\n\n/** @deprecated */\nexport default {\n  getChord,\n  get,\n  detect,\n  chordScales,\n  extended,\n  reduced,\n  tokenize,\n  transpose,\n  degrees,\n  steps,\n  notes,\n  chord,\n};\n","// source: https://en.wikipedia.org/wiki/Note_value\nconst DATA: [number, string, string[]][] = [\n  [\n    0.125,\n    \"dl\",\n    [\"large\", \"duplex longa\", \"maxima\", \"octuple\", \"octuple whole\"],\n  ],\n  [0.25, \"l\", [\"long\", \"longa\"]],\n  [0.5, \"d\", [\"double whole\", \"double\", \"breve\"]],\n  [1, \"w\", [\"whole\", \"semibreve\"]],\n  [2, \"h\", [\"half\", \"minim\"]],\n  [4, \"q\", [\"quarter\", \"crotchet\"]],\n  [8, \"e\", [\"eighth\", \"quaver\"]],\n  [16, \"s\", [\"sixteenth\", \"semiquaver\"]],\n  [32, \"t\", [\"thirty-second\", \"demisemiquaver\"]],\n  [64, \"sf\", [\"sixty-fourth\", \"hemidemisemiquaver\"]],\n  [128, \"h\", [\"hundred twenty-eighth\"]],\n  [256, \"th\", [\"two hundred fifty-sixth\"]],\n];\n\nexport default DATA;\n","import DATA from \"./data\";\n\ntype Fraction = [number, number];\n\nconst VALUES: DurationValue[] = [];\n\nDATA.forEach(([denominator, shorthand, names]) =>\n  add(denominator, shorthand, names),\n);\n\nexport interface DurationValue {\n  empty: boolean;\n  value: number;\n  name: string;\n  fraction: Fraction;\n  shorthand: string;\n  dots: string;\n  names: string[];\n}\n\nconst NoDuration: DurationValue = {\n  empty: true,\n  name: \"\",\n  value: 0,\n  fraction: [0, 0],\n  shorthand: \"\",\n  dots: \"\",\n  names: [],\n};\n\nexport function names(): string[] {\n  return VALUES.reduce((names, duration) => {\n    duration.names.forEach((name) => names.push(name));\n    return names;\n  }, [] as string[]);\n}\n\nexport function shorthands(): string[] {\n  return VALUES.map((dur) => dur.shorthand);\n}\n\nconst REGEX = /^([^.]+)(\\.*)$/;\n\nexport function get(name: string): DurationValue {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const [_, simple, dots] = REGEX.exec(name) || [];\n  const base = VALUES.find(\n    (dur) => dur.shorthand === simple || dur.names.includes(simple),\n  );\n  if (!base) {\n    return NoDuration;\n  }\n\n  const fraction = calcDots(base.fraction, dots.length);\n  const value = fraction[0] / fraction[1];\n\n  return { ...base, name, dots, value, fraction };\n}\n\nexport const value = (name: string) => get(name).value;\nexport const fraction = (name: string) => get(name).fraction;\n\n/** @deprecated */\nexport default { names, shorthands, get, value, fraction };\n\n//// PRIVATE ////\n\nfunction add(denominator: number, shorthand: string, names: string[]) {\n  VALUES.push({\n    empty: false,\n    dots: \"\",\n    name: \"\",\n    value: 1 / denominator,\n    fraction: denominator < 1 ? [1 / denominator, 1] : [1, denominator],\n    shorthand,\n    names,\n  });\n}\n\nfunction calcDots(fraction: Fraction, dots: number): Fraction {\n  const pow = Math.pow(2, dots);\n\n  let numerator = fraction[0] * pow;\n  let denominator = fraction[1] * pow;\n  const base = numerator;\n\n  // add fractions\n  for (let i = 0; i < dots; i++) {\n    numerator += base / Math.pow(2, i + 1);\n  }\n\n  // simplify\n  while (numerator % 2 === 0 && denominator % 2 === 0) {\n    numerator /= 2;\n    denominator /= 2;\n  }\n  return [numerator, denominator];\n}\n","import { NoteName, note as props } from \"@tonaljs/pitch-note\";\n\ntype Midi = number;\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function isMidi(arg: any): arg is Midi {\n  return +arg >= 0 && +arg <= 127;\n}\n\n/**\n * Get the note midi number (a number between 0 and 127)\n *\n * It returns undefined if not valid note name\n *\n * @function\n * @param {string|number} note - the note name or midi number\n * @return {Integer} the midi number or undefined if not valid note\n * @example\n * import { toMidi } from '@tonaljs/midi'\n * toMidi(\"C4\") // => 60\n * toMidi(60) // => 60\n * toMidi('60') // => 60\n */\nexport function toMidi(note: NoteName | number): number | null {\n  if (isMidi(note)) {\n    return +note;\n  }\n  const n = props(note);\n  return n.empty ? null : n.midi;\n}\n\n/**\n * Get the frequency in hertz from midi number\n *\n * @param {number} midi - the note midi number\n * @param {number} [tuning = 440] - A4 tuning frequency in Hz (440 by default)\n * @return {number} the frequency or null if not valid note midi\n * @example\n * import { midiToFreq} from '@tonaljs/midi'\n * midiToFreq(69) // => 440\n */\nexport function midiToFreq(midi: number, tuning = 440): number {\n  return Math.pow(2, (midi - 69) / 12) * tuning;\n}\n\nconst L2 = Math.log(2);\nconst L440 = Math.log(440);\n\n/**\n * Get the midi number from a frequency in hertz. The midi number can\n * contain decimals (with two digits precision)\n *\n * @param {number} frequency\n * @return {number}\n * @example\n * import { freqToMidi} from '@tonaljs/midi'\n * freqToMidi(220)); //=> 57\n * freqToMidi(261.62)); //=> 60\n * freqToMidi(261)); //=> 59.96\n */\nexport function freqToMidi(freq: number): number {\n  const v = (12 * (Math.log(freq) - L440)) / L2 + 69;\n  return Math.round(v * 100) / 100;\n}\n\nexport interface ToNoteNameOptions {\n  pitchClass?: boolean;\n  sharps?: boolean;\n}\n\nconst SHARPS = \"C C# D D# E F F# G G# A A# B\".split(\" \");\nconst FLATS = \"C Db D Eb E F Gb G Ab A Bb B\".split(\" \");\n/**\n * Given a midi number, returns a note name. The altered notes will have\n * flats unless explicitly set with the optional `useSharps` parameter.\n *\n * @function\n * @param {number} midi - the midi note number\n * @param {Object} options = default: `{ sharps: false, pitchClass: false }`\n * @param {boolean} useSharps - (Optional) set to true to use sharps instead of flats\n * @return {string} the note name\n * @example\n * import { midiToNoteName } from '@tonaljs/midi'\n * midiToNoteName(61) // => \"Db4\"\n * midiToNoteName(61, { pitchClass: true }) // => \"Db\"\n * midiToNoteName(61, { sharps: true }) // => \"C#4\"\n * midiToNoteName(61, { pitchClass: true, sharps: true }) // => \"C#\"\n * // it rounds to nearest note\n * midiToNoteName(61.7) // => \"D4\"\n */\nexport function midiToNoteName(midi: number, options: ToNoteNameOptions = {}) {\n  if (isNaN(midi) || midi === -Infinity || midi === Infinity) return \"\";\n  midi = Math.round(midi);\n  const pcs = options.sharps === true ? SHARPS : FLATS;\n  const pc = pcs[midi % 12];\n  if (options.pitchClass) {\n    return pc;\n  }\n  const o = Math.floor(midi / 12) - 1;\n  return pc + o;\n}\n\nexport function chroma(midi: number): number {\n  return midi % 12;\n}\n\nfunction pcsetFromChroma(chroma: string): number[] {\n  return chroma.split(\"\").reduce((pcset, val, index) => {\n    if (index < 12 && val === \"1\") pcset.push(index);\n    return pcset;\n  }, [] as number[]);\n}\n\nfunction pcsetFromMidi(midi: number[]): number[] {\n  return midi\n    .map(chroma)\n    .sort((a, b) => a - b)\n    .filter((n, i, a) => i === 0 || n !== a[i - 1]);\n}\n\n/**\n * Given a list of midi numbers, returns the pitch class set (unique chroma numbers)\n * @param midi\n * @example\n *\n */\nexport function pcset(notes: number[] | string): number[] {\n  return Array.isArray(notes) ? pcsetFromMidi(notes) : pcsetFromChroma(notes);\n}\n\nexport function pcsetNearest(notes: number[] | string) {\n  const set = pcset(notes);\n  return (midi: number): number | undefined => {\n    const ch = chroma(midi);\n    for (let i = 0; i < 12; i++) {\n      if (set.includes(ch + i)) return midi + i;\n      if (set.includes(ch - i)) return midi - i;\n    }\n    return undefined;\n  };\n}\n\nexport function pcsetSteps(notes: number[] | string, tonic: number) {\n  const set = pcset(notes);\n  const len = set.length;\n  return (step: number): number => {\n    const index = step < 0 ? (len - (-step % len)) % len : step % len;\n    const octaves = Math.floor(step / len);\n    return set[index] + octaves * 12 + tonic;\n  };\n}\n\nexport function pcsetDegrees(notes: number[] | string, tonic: number) {\n  const steps = pcsetSteps(notes, tonic);\n  return (degree: number): number | undefined => {\n    if (degree === 0) return undefined;\n    return steps(degree > 0 ? degree - 1 : degree);\n  };\n}\n\n/** @deprecated */\nexport default {\n  chroma,\n  freqToMidi,\n  isMidi,\n  midiToFreq,\n  midiToNoteName,\n  pcsetNearest,\n  pcset,\n  pcsetDegrees,\n  pcsetSteps,\n  toMidi,\n};\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { freqToMidi, midiToNoteName } from \"@tonaljs/midi\";\nimport { Pitch } from \"@tonaljs/pitch\";\nimport { distance as _dist, transpose as _tr } from \"@tonaljs/pitch-distance\";\nimport { IntervalName } from \"@tonaljs/pitch-interval\";\nimport {\n  Note,\n  NoteLiteral,\n  NoteName,\n  note as props,\n} from \"@tonaljs/pitch-note\";\n\nexport type { NoteType } from \"@tonaljs/pitch-note\";\n\nconst NAMES = [\"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\"];\n\nconst toName = (n: Note) => n.name;\nconst onlyNotes = (array: any[]) =>\n  array.map(props).filter((n) => !n.empty) as Note[];\n\n/**\n * Return the natural note names without octave\n * @function\n * @example\n * Note.names(); // => [\"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\"]\n */\nexport function names(array?: any[]): string[] {\n  if (array === undefined) {\n    return NAMES.slice();\n  } else if (!Array.isArray(array)) {\n    return [];\n  } else {\n    return onlyNotes(array).map(toName);\n  }\n}\n\n/**\n * Get a note from a note name\n *\n * @function\n * @example\n * Note.get('Bb4') // => { name: \"Bb4\", midi: 70, chroma: 10, ... }\n */\nexport const get = props;\n\n/**\n * Get the note name\n * @function\n */\nexport const name = (note: NoteLiteral) => get(note).name;\n\n/**\n * Get the note pitch class name\n * @function\n */\nexport const pitchClass = (note: NoteLiteral) => get(note).pc;\n\n/**\n * Get the note accidentals\n * @function\n */\nexport const accidentals = (note: NoteLiteral) => get(note).acc;\n\n/**\n * Get the note octave\n * @function\n */\nexport const octave = (note: NoteLiteral) => get(note).oct;\n\n/**\n * Get the note midi\n * @function\n */\nexport const midi = (note: NoteLiteral) => get(note).midi;\n\n/**\n * Get the note midi\n * @function\n */\nexport const freq = (note: NoteLiteral) => get(note).freq;\n\n/**\n * Get the note chroma\n * @function\n */\nexport const chroma = (note: NoteLiteral) => get(note).chroma;\n\n/**\n * Given a midi number, returns a note name. Uses flats for altered notes.\n *\n * @function\n * @param {number} midi - the midi note number\n * @return {string} the note name\n * @example\n * Note.fromMidi(61) // => \"Db4\"\n * Note.fromMidi(61.7) // => \"D4\"\n */\nexport function fromMidi(midi: number) {\n  return midiToNoteName(midi);\n}\n\n/**\n * Given a midi number, returns a note name. Uses flats for altered notes.\n */\nexport function fromFreq(freq: number) {\n  return midiToNoteName(freqToMidi(freq));\n}\n/**\n * Given a midi number, returns a note name. Uses flats for altered notes.\n */\nexport function fromFreqSharps(freq: number) {\n  return midiToNoteName(freqToMidi(freq), { sharps: true });\n}\n\n/**\n * Given a midi number, returns a note name. Uses flats for altered notes.\n *\n * @function\n * @param {number} midi - the midi note number\n * @return {string} the note name\n * @example\n * Note.fromMidiSharps(61) // => \"C#4\"\n */\n\nexport function fromMidiSharps(midi: number) {\n  return midiToNoteName(midi, { sharps: true });\n}\n\nexport const distance = _dist;\n\n/**\n * Transpose a note by an interval\n */\nexport const transpose = _tr;\nexport const tr = _tr;\n\n/**\n * Transpose by an interval.\n * @function\n * @param {string} interval\n * @return {function} a function that transposes by the given interval\n * @example\n * [\"C\", \"D\", \"E\"].map(Note.transposeBy(\"5P\"));\n * // => [\"G\", \"A\", \"B\"]\n */\nexport const transposeBy = (interval: IntervalName) => (note: NoteName) =>\n  transpose(note, interval);\nexport const trBy = transposeBy;\n\n/**\n * Transpose from a note\n * @function\n * @param {string} note\n * @return {function}  a function that transposes the the note by an interval\n * [\"1P\", \"3M\", \"5P\"].map(Note.transposeFrom(\"C\"));\n * // => [\"C\", \"E\", \"G\"]\n */\nexport const transposeFrom = (note: NoteName) => (interval: IntervalName) =>\n  transpose(note, interval);\nexport const trFrom = transposeFrom;\n\n/**\n * Transpose a note by a number of perfect fifths.\n *\n * @function\n * @param {string} note - the note name\n * @param {number} fifths - the number of fifths\n * @return {string} the transposed note name\n *\n * @example\n * import { transposeFifths } from \"@tonaljs/note\"\n * transposeFifths(\"G4\", 1) // => \"D\"\n * [0, 1, 2, 3, 4].map(fifths => transposeFifths(\"C\", fifths)) // => [\"C\", \"G\", \"D\", \"A\", \"E\"]\n */\nexport function transposeFifths(noteName: NoteName, fifths: number): NoteName {\n  return transpose(noteName, [fifths, 0]);\n}\nexport const trFifths = transposeFifths;\n\n// TODO: documentation\nexport function transposeOctaves(\n  noteName: NoteName,\n  octaves: number,\n): NoteName {\n  return transpose(noteName, [0, octaves]);\n}\n\nexport type NoteComparator = (a: Note, b: Note) => number;\n\nexport const ascending: NoteComparator = (a, b) => a.height - b.height;\nexport const descending: NoteComparator = (a, b) => b.height - a.height;\n\nexport function sortedNames(\n  notes: any[],\n  comparator?: NoteComparator,\n): string[] {\n  comparator = comparator || ascending;\n  return onlyNotes(notes).sort(comparator).map(toName);\n}\n\nexport function sortedUniqNames(notes: any[]): string[] {\n  return sortedNames(notes, ascending).filter(\n    (n, i, a) => i === 0 || n !== a[i - 1],\n  );\n}\n\n/**\n * Simplify a note\n *\n * @function\n * @param {string} note - the note to be simplified\n * - sameAccType: default true. Use same kind of accidentals that source\n * @return {string} the simplified note or '' if not valid note\n * @example\n * simplify(\"C##\") // => \"D\"\n * simplify(\"C###\") // => \"D#\"\n * simplify(\"C###\")\n * simplify(\"B#4\") // => \"C5\"\n */\nexport const simplify = (noteName: NoteName | Pitch): string => {\n  const note = get(noteName);\n  if (note.empty) {\n    return \"\";\n  }\n  return midiToNoteName(note.midi || note.chroma, {\n    sharps: note.alt > 0,\n    pitchClass: note.midi === null,\n  });\n};\n/**\n * Get enharmonic of a note\n *\n * @function\n * @param {string} note\n * @param [string] - [optional] Destination pitch class\n * @return {string} the enharmonic note name or '' if not valid note\n * @example\n * Note.enharmonic(\"Db\") // => \"C#\"\n * Note.enharmonic(\"C\") // => \"C\"\n * Note.enharmonic(\"F2\",\"E#\") // => \"E#2\"\n * Note.enharmonic(\"C##b\"); // => \"\"\n */\nexport function enharmonic(noteName: string, destName?: string) {\n  const src = get(noteName);\n  if (src.empty) {\n    return \"\";\n  }\n\n  // destination: use given or generate one\n  const dest = get(\n    destName ||\n      midiToNoteName(src.midi || src.chroma, {\n        sharps: src.alt < 0,\n        pitchClass: true,\n      }),\n  );\n\n  // ensure destination is valid\n  if (dest.empty || dest.chroma !== src.chroma) {\n    return \"\";\n  }\n\n  // if src has no octave, no need to calculate anything else\n  if (src.oct === undefined) {\n    return dest.pc;\n  }\n\n  // detect any octave overflow\n  const srcChroma = src.chroma - src.alt;\n  const destChroma = dest.chroma - dest.alt;\n  const destOctOffset =\n    srcChroma > 11 || destChroma < 0\n      ? -1\n      : srcChroma < 0 || destChroma > 11\n        ? +1\n        : 0;\n  // calculate the new octave\n  const destOct = src.oct + destOctOffset;\n  return dest.pc + destOct;\n}\n\n/** @deprecated */\nexport default {\n  names,\n  get,\n  name,\n  pitchClass,\n  accidentals,\n  octave,\n  midi,\n  ascending,\n  descending,\n  distance,\n  sortedNames,\n  sortedUniqNames,\n  fromMidi,\n  fromMidiSharps,\n  freq,\n  fromFreq,\n  fromFreqSharps,\n  chroma,\n  transpose,\n  tr,\n  transposeBy,\n  trBy,\n  transposeFrom,\n  trFrom,\n  transposeFifths,\n  transposeOctaves,\n  trFifths,\n  simplify,\n  enharmonic,\n};\n","import { rotate } from \"@tonaljs/collection\";\nimport { simplify, transposeFifths } from \"@tonaljs/interval\";\nimport { EmptyPcset, Pcset } from \"@tonaljs/pcset\";\nimport { transpose } from \"@tonaljs/pitch-distance\";\nimport { NoteName } from \"@tonaljs/pitch-note\";\nimport { get as getType } from \"@tonaljs/scale-type\";\n\nconst MODES = [\n  [0, 2773, 0, \"ionian\", \"\", \"Maj7\", \"major\"],\n  [1, 2902, 2, \"dorian\", \"m\", \"m7\"],\n  [2, 3418, 4, \"phrygian\", \"m\", \"m7\"],\n  [3, 2741, -1, \"lydian\", \"\", \"Maj7\"],\n  [4, 2774, 1, \"mixolydian\", \"\", \"7\"],\n  [5, 2906, 3, \"aeolian\", \"m\", \"m7\", \"minor\"],\n  [6, 3434, 5, \"locrian\", \"dim\", \"m7b5\"],\n] as const;\n\ntype ModeDatum = (typeof MODES)[number];\n\nexport interface Mode extends Pcset {\n  readonly name: string;\n  readonly modeNum: number;\n  readonly alt: number; // number of alterations === number of fifths\n  readonly triad: string;\n  readonly seventh: string;\n  readonly aliases: string[];\n}\n\nconst NoMode: Mode = {\n  ...EmptyPcset,\n  name: \"\",\n  alt: 0,\n  modeNum: NaN,\n  triad: \"\",\n  seventh: \"\",\n  aliases: [],\n};\n\nconst modes: Mode[] = MODES.map(toMode);\nconst index: Record<string, Mode> = {};\nmodes.forEach((mode) => {\n  index[mode.name] = mode;\n  mode.aliases.forEach((alias) => {\n    index[alias] = mode;\n  });\n});\n\ntype ModeLiteral = string | { name: string };\n\n/**\n * Get a Mode by it's name\n *\n * @example\n * get('dorian')\n * // =>\n * // {\n * //   intervals: [ '1P', '2M', '3m', '4P', '5P', '6M', '7m' ],\n * //   modeNum: 1,\n * //   chroma: '101101010110',\n * //   normalized: '101101010110',\n * //   name: 'dorian',\n * //   setNum: 2902,\n * //   alt: 2,\n * //   triad: 'm',\n * //   seventh: 'm7',\n * //   aliases: []\n * // }\n */\nexport function get(name: ModeLiteral): Mode {\n  return typeof name === \"string\"\n    ? index[name.toLowerCase()] || NoMode\n    : name && name.name\n      ? get(name.name)\n      : NoMode;\n}\n\n/** @deprecated */\nexport const mode = get;\n\n/**\n * Get a list of all modes\n */\nexport function all() {\n  return modes.slice();\n}\n\n/** @deprecated */\nexport const entries = all;\n\n/**\n * Get a list of all mode names\n */\nexport function names() {\n  return modes.map((mode) => mode.name);\n}\n\nfunction toMode(mode: ModeDatum): Mode {\n  const [modeNum, setNum, alt, name, triad, seventh, alias] = mode;\n  const aliases = alias ? [alias] : [];\n  const chroma = Number(setNum).toString(2);\n  const intervals = getType(name).intervals;\n  return {\n    empty: false,\n    intervals,\n    modeNum,\n    chroma,\n    normalized: chroma,\n    name,\n    setNum,\n    alt,\n    triad,\n    seventh,\n    aliases,\n  };\n}\n\nexport function notes(modeName: ModeLiteral, tonic: NoteName) {\n  return get(modeName).intervals.map((ivl) => transpose(tonic, ivl));\n}\n\nfunction chords(chords: string[]) {\n  return (modeName: ModeLiteral, tonic: NoteName) => {\n    const mode = get(modeName);\n    if (mode.empty) return [];\n    const triads = rotate(mode.modeNum, chords);\n    const tonics = mode.intervals.map((i) => transpose(tonic, i));\n    return triads.map((triad, i) => tonics[i] + triad);\n  };\n}\n\nexport const triads = chords(MODES.map((x) => x[4]));\nexport const seventhChords = chords(MODES.map((x) => x[5]));\n\nexport function distance(destination: ModeLiteral, source: ModeLiteral) {\n  const from = get(source);\n  const to = get(destination);\n  if (from.empty || to.empty) return \"\";\n  return simplify(transposeFifths(\"1P\", to.alt - from.alt));\n}\n\nexport function relativeTonic(\n  destination: ModeLiteral,\n  source: ModeLiteral,\n  tonic: NoteName,\n) {\n  return transpose(tonic, distance(destination, source));\n}\n\n/** @deprecated */\nexport default {\n  get,\n  names,\n  all,\n  distance,\n  relativeTonic,\n  notes,\n  triads,\n  seventhChords,\n  // deprecated\n  entries,\n  mode,\n};\n","/**\n * References:\n * - https://www.researchgate.net/publication/327567188_An_Algorithm_for_Spelling_the_Pitches_of_Any_Musical_Scale\n * @module scale\n */\nimport { all as chordTypes } from \"@tonaljs/chord-type\";\nimport { range as nums, rotate } from \"@tonaljs/collection\";\nimport { enharmonic, fromMidi, sortedUniqNames } from \"@tonaljs/note\";\nimport {\n  chroma,\n  isChroma,\n  isSubsetOf,\n  isSupersetOf,\n  modes,\n} from \"@tonaljs/pcset\";\nimport { tonicIntervalsTransposer, transpose } from \"@tonaljs/pitch-distance\";\nimport { note, NoteName } from \"@tonaljs/pitch-note\";\nimport {\n  all,\n  get as getScaleType,\n  ScaleType,\n  names as scaleTypeNames,\n  all as scaleTypes,\n} from \"@tonaljs/scale-type\";\n\ntype ScaleName = string;\ntype ScaleNameTokens = [string, string]; // [TONIC, SCALE TYPE]\n\nexport interface Scale extends ScaleType {\n  tonic: string | null;\n  type: string;\n  notes: NoteName[];\n}\n\nconst NoScale: Scale = {\n  empty: true,\n  name: \"\",\n  type: \"\",\n  tonic: null,\n  setNum: NaN,\n  chroma: \"\",\n  normalized: \"\",\n  aliases: [],\n  notes: [],\n  intervals: [],\n};\n\n/**\n * Given a string with a scale name and (optionally) a tonic, split\n * that components.\n *\n * It returns an array with the form [ name, tonic ] where tonic can be a\n * note name or null and name can be any arbitrary string\n * (this function doesn't check if that scale name exists)\n *\n * @function\n * @param {string} name - the scale name\n * @return {Array} an array [tonic, name]\n * @example\n * tokenize(\"C mixolydian\") // => [\"C\", \"mixolydian\"]\n * tokenize(\"anything is valid\") // => [\"\", \"anything is valid\"]\n * tokenize() // => [\"\", \"\"]\n */\nexport function tokenize(name: ScaleName): ScaleNameTokens {\n  if (typeof name !== \"string\") {\n    return [\"\", \"\"];\n  }\n  const i = name.indexOf(\" \");\n  const tonic = note(name.substring(0, i));\n  if (tonic.empty) {\n    const n = note(name);\n    return n.empty ? [\"\", name.toLowerCase()] : [n.name, \"\"];\n  }\n\n  const type = name.substring(tonic.name.length + 1).toLowerCase();\n  return [tonic.name, type.length ? type : \"\"];\n}\n\n/**\n * Get all scale names\n * @function\n */\nexport const names = scaleTypeNames;\n\n/**\n * Get a Scale from a scale name.\n */\nexport function get(src: ScaleName | ScaleNameTokens): Scale {\n  const tokens = Array.isArray(src) ? src : tokenize(src);\n  const tonic = note(tokens[0]).name;\n  const st = getScaleType(tokens[1]);\n  if (st.empty) {\n    return NoScale;\n  }\n\n  const type = st.name;\n  const notes: string[] = tonic\n    ? st.intervals.map((i) => transpose(tonic, i))\n    : [];\n\n  const name = tonic ? tonic + \" \" + type : type;\n\n  return { ...st, name, type, tonic, notes };\n}\n\n/**\n * @deprecated\n * @use Scale.get\n */\nexport const scale = get;\n\nexport function detect(\n  notes: string[],\n  options: { tonic?: string; match?: \"exact\" | \"fit\" } = {},\n): string[] {\n  const notesChroma = chroma(notes);\n  const tonic = note(options.tonic ?? notes[0] ?? \"\");\n  const tonicChroma = tonic.chroma;\n  if (tonicChroma === undefined) {\n    return [];\n  }\n\n  const pitchClasses = notesChroma.split(\"\");\n  pitchClasses[tonicChroma] = \"1\";\n  const scaleChroma = rotate(tonicChroma, pitchClasses).join(\"\");\n  const match = all().find((scaleType) => scaleType.chroma === scaleChroma);\n\n  const results: string[] = [];\n  if (match) {\n    results.push(tonic.name + \" \" + match.name);\n  }\n  if (options.match === \"exact\") {\n    return results;\n  }\n\n  extended(scaleChroma).forEach((scaleName) => {\n    results.push(tonic.name + \" \" + scaleName);\n  });\n\n  return results;\n}\n\n/**\n * Get all chords that fits a given scale\n *\n * @function\n * @param {string} name - the scale name\n * @return {Array<string>} - the chord names\n *\n * @example\n * scaleChords(\"pentatonic\") // => [\"5\", \"64\", \"M\", \"M6\", \"Madd9\", \"Msus2\"]\n */\nexport function scaleChords(name: string): string[] {\n  const s = get(name);\n  const inScale = isSubsetOf(s.chroma);\n  return chordTypes()\n    .filter((chord) => inScale(chord.chroma))\n    .map((chord) => chord.aliases[0]);\n}\n/**\n * Get all scales names that are a superset of the given one\n * (has the same notes and at least one more)\n *\n * @function\n * @param {string} name\n * @return {Array} a list of scale names\n * @example\n * extended(\"major\") // => [\"bebop\", \"bebop dominant\", \"bebop major\", \"chromatic\", \"ichikosucho\"]\n */\nexport function extended(name: string): string[] {\n  const chroma = isChroma(name) ? name : get(name).chroma;\n  const isSuperset = isSupersetOf(chroma);\n  return scaleTypes()\n    .filter((scale) => isSuperset(scale.chroma))\n    .map((scale) => scale.name);\n}\n\n/**\n * Find all scales names that are a subset of the given one\n * (has less notes but all from the given scale)\n *\n * @function\n * @param {string} name\n * @return {Array} a list of scale names\n *\n * @example\n * reduced(\"major\") // => [\"ionian pentatonic\", \"major pentatonic\", \"ritusen\"]\n */\nexport function reduced(name: string): string[] {\n  const isSubset = isSubsetOf(get(name).chroma);\n  return scaleTypes()\n    .filter((scale) => isSubset(scale.chroma))\n    .map((scale) => scale.name);\n}\n\n/**\n * Given an array of notes, return the scale: a pitch class set starting from\n * the first note of the array\n *\n * @function\n * @param {string[]} notes\n * @return {string[]} pitch classes with same tonic\n * @example\n * scaleNotes(['C4', 'c3', 'C5', 'C4', 'c4']) // => [\"C\"]\n * scaleNotes(['D4', 'c#5', 'A5', 'F#6']) // => [\"D\", \"F#\", \"A\", \"C#\"]\n */\nexport function scaleNotes(notes: NoteName[]) {\n  const pcset: string[] = notes.map((n) => note(n).pc).filter((x) => x);\n  const tonic = pcset[0];\n  const scale = sortedUniqNames(pcset);\n  return rotate(scale.indexOf(tonic), scale);\n}\n\ntype ScaleMode = [string, string];\n/**\n * Find mode names of a scale\n *\n * @function\n * @param {string} name - scale name\n * @example\n * modeNames(\"C pentatonic\") // => [\n *   [\"C\", \"major pentatonic\"],\n *   [\"D\", \"egyptian\"],\n *   [\"E\", \"malkos raga\"],\n *   [\"G\", \"ritusen\"],\n *   [\"A\", \"minor pentatonic\"]\n * ]\n */\nexport function modeNames(name: string): ScaleMode[] {\n  const s = get(name);\n  if (s.empty) {\n    return [];\n  }\n\n  const tonics = s.tonic ? s.notes : s.intervals;\n  return modes(s.chroma)\n    .map((chroma: string, i: number): ScaleMode => {\n      const modeName = get(chroma).name;\n      return modeName ? [tonics[i], modeName] : [\"\", \"\"];\n    })\n    .filter((x) => x[0]);\n}\n\nfunction getNoteNameOf(scale: string | string[]) {\n  const names = Array.isArray(scale) ? scaleNotes(scale) : get(scale).notes;\n  const chromas = names.map((name) => note(name).chroma);\n\n  return (noteOrMidi: string | number): string | undefined => {\n    const currNote =\n      typeof noteOrMidi === \"number\"\n        ? note(fromMidi(noteOrMidi))\n        : note(noteOrMidi);\n    const height = currNote.height;\n\n    if (height === undefined) return undefined;\n    const chroma = height % 12;\n    const position = chromas.indexOf(chroma);\n    if (position === -1) return undefined;\n    return enharmonic(currNote.name, names[position]);\n  };\n}\n\nexport function rangeOf(scale: string | string[]) {\n  const getName = getNoteNameOf(scale);\n  return (fromNote: string, toNote: string) => {\n    const from = note(fromNote).height;\n    const to = note(toNote).height;\n    if (from === undefined || to === undefined) return [];\n\n    return nums(from, to)\n      .map(getName)\n      .filter((x) => x);\n  };\n}\n\n/**\n * Returns a function to get a note name from the scale degree.\n *\n * @example\n * [1, 2, 3].map(Scale.degrees(\"C major\")) => [\"C\", \"D\", \"E\"]\n * [1, 2, 3].map(Scale.degrees(\"C4 major\")) => [\"C4\", \"D4\", \"E4\"]\n */\nexport function degrees(scaleName: string | ScaleNameTokens) {\n  const { intervals, tonic } = get(scaleName);\n  const transpose = tonicIntervalsTransposer(intervals, tonic);\n  return (degree: number) =>\n    degree ? transpose(degree > 0 ? degree - 1 : degree) : \"\";\n}\n\n/**\n * Sames as `degree` but with 0-based index\n */\nexport function steps(scaleName: string | ScaleNameTokens) {\n  const { intervals, tonic } = get(scaleName);\n  return tonicIntervalsTransposer(intervals, tonic);\n}\n\n/** @deprecated */\nexport default {\n  degrees,\n  detect,\n  extended,\n  get,\n  modeNames,\n  names,\n  rangeOf,\n  reduced,\n  scaleChords,\n  scaleNotes,\n  steps,\n  tokenize,\n\n  // deprecated\n  scale,\n};\n","/**\n * Music Theory Utilities\n * Provides helper functions for note generation, validation, and music theory operations\n */\n\nimport { Note, Scale, Chord } from 'tonal';\n\n// Type definitions\nexport interface NoteInfo {\n    vexflowNote: string;\n    midiNote: number;\n}\n\nexport interface ValidationResult {\n    isCorrect: boolean;\n    message: string;\n    centsOff?: number;\n}\n\nexport interface ValidationOptions {\n    allowOctaveError?: boolean;\n    tolerance?: number;\n    pitchToleranceCents?: number;\n}\n\nexport interface KeySignature {\n    name: string;\n    sharps: number;\n    flats: number;\n}\n\nexport type ClefType = 'treble' | 'bass';\n\n// Note names and their MIDI numbers (C4 = Middle C = 60)\nexport const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\n\n// VexFlow note names (with octaves) - natural notes only for basic mode\nexport const vexflowNoteNames: Record<ClefType, Record<string, number>> = {\n    treble: {\n        'c/4': 60, 'd/4': 62, 'e/4': 64, 'f/4': 65, 'g/4': 67, 'a/4': 69, 'b/4': 71,\n        'c/5': 72, 'd/5': 74, 'e/5': 76, 'f/5': 77, 'g/5': 79, 'a/5': 81, 'b/5': 83,\n        'c/6': 84\n    },\n    bass: {\n        'a/2': 45, 'b/2': 47,\n        'c/3': 48, 'd/3': 50, 'e/3': 52, 'f/3': 53, 'g/3': 55, 'a/3': 57, 'b/3': 59,\n        'c/4': 60, 'd/4': 62, 'e/4': 64, 'f/4': 65\n    }\n};\n\n/**\n * Convert MIDI note number to note name with octave using Tonal\n */\nexport function midiToNoteName(midiNote: number): string {\n    return Note.fromMidi(midiNote) || '';\n}\n\n/**\n * Convert note name to MIDI number using Tonal\n */\nexport function noteNameToMidi(noteName: string): number {\n    const midi = Note.midi(noteName);\n    return midi !== null ? midi : -1;\n}\n\n/**\n * Convert MIDI note to VexFlow notation format\n */\nexport function midiToVexflow(midiNote: number, clef: ClefType = 'treble'): string | null {\n    const octave = Math.floor(midiNote / 12) - 1;\n    const noteIndex = midiNote % 12;\n    const noteName = noteNames[noteIndex].toLowerCase().replace('#', '#');\n\n    // For natural notes only (no sharps/flats in basic implementation)\n    if (noteName.includes('#')) {\n        return null; // Skip sharps for now in basic mode\n    }\n\n    return `${noteName}/${octave}`;\n}\n\n/**\n * Generate a random note within a specified range\n */\nexport function generateRandomNote(\n    range: string = 'c4-c5',\n    clef: ClefType = 'treble',\n    naturalsOnly: boolean = true\n): NoteInfo | null {\n    const [start, end] = range.split('-');\n    const startMidi = noteNameToMidi(start.toUpperCase());\n    const endMidi = noteNameToMidi(end.toUpperCase());\n\n    if (startMidi === -1 || endMidi === -1) {\n        console.error('Invalid range');\n        return null;\n    }\n\n    // Get available notes from VexFlow mapping for the clef\n    const availableNotes = Object.entries(vexflowNoteNames[clef])\n        .filter(([_, midi]) => midi >= startMidi && midi <= endMidi)\n        .map(([note, midi]) => ({ vexflowNote: note, midiNote: midi }));\n\n    if (availableNotes.length === 0) {\n        console.error('No notes available in range');\n        return null;\n    }\n\n    const randomIndex = Math.floor(Math.random() * availableNotes.length);\n    return availableNotes[randomIndex];\n}\n\n/**\n * Generate a random note from MIDI range\n */\nexport function generateRandomNoteFromMidiRange(minMidi: number, maxMidi: number, naturalsOnly: boolean = true): number {\n    const availableNotes: number[] = [];\n\n    for (let midi = minMidi; midi <= maxMidi; midi++) {\n        if (naturalsOnly) {\n            const noteIndex = midi % 12;\n            // Only include natural notes (no sharps/flats)\n            if (![1, 3, 6, 8, 10].includes(noteIndex)) {\n                availableNotes.push(midi);\n            }\n        } else {\n            availableNotes.push(midi);\n        }\n    }\n\n    if (availableNotes.length === 0) {\n        return minMidi;\n    }\n\n    return availableNotes[Math.floor(Math.random() * availableNotes.length)];\n}\n\n/**\n * Validate if a played note matches the target note\n */\nexport function validateNote(\n    playedMidi: number,\n    targetMidi: number,\n    options: ValidationOptions = {}\n): ValidationResult {\n    const {\n        allowOctaveError = true,\n        tolerance = 0,\n        pitchToleranceCents = 0\n    } = options;\n\n    if (playedMidi === targetMidi) {\n        return { isCorrect: true, message: 'Perfect!', centsOff: 0 };\n    }\n\n    // Check for octave errors\n    if (allowOctaveError) {\n        const playedPitch = playedMidi % 12;\n        const targetPitch = targetMidi % 12;\n\n        if (playedPitch === targetPitch) {\n            return {\n                isCorrect: true,\n                message: 'Correct note, wrong octave!'\n            };\n        }\n    }\n\n    // Check tolerance (for MIDI semitone tolerance)\n    if (tolerance > 0) {\n        const diff = Math.abs(playedMidi - targetMidi);\n        if (diff <= tolerance) {\n            return {\n                isCorrect: true,\n                message: 'Close enough!'\n            };\n        }\n    }\n\n    return {\n        isCorrect: false,\n        message: `Try again. You played ${midiToNoteName(playedMidi)}`\n    };\n}\n\n/**\n * Validate pitch with cents tolerance (for microphone input)\n */\nexport function validatePitchWithCents(\n    playedFrequency: number,\n    targetMidi: number,\n    toleranceCents: number = 50\n): ValidationResult {\n    const targetFrequency = midiToFrequency(targetMidi);\n    const playedMidi = frequencyToMidi(playedFrequency);\n    const centsOff = getCentsDeviation(playedFrequency, targetFrequency);\n\n    if (Math.abs(centsOff) <= toleranceCents) {\n        let message = 'Perfect!';\n        if (Math.abs(centsOff) > 5) {\n            message = `${Math.abs(centsOff).toFixed(0)} cents ${centsOff > 0 ? 'sharp' : 'flat'}`;\n        }\n        return {\n            isCorrect: true,\n            message,\n            centsOff\n        };\n    }\n\n    return {\n        isCorrect: false,\n        message: `Try again. You played ${midiToNoteName(playedMidi)} (${Math.abs(centsOff).toFixed(0)} cents ${centsOff > 0 ? 'sharp' : 'flat'})`,\n        centsOff\n    };\n}\n\n/**\n * Get frequency from MIDI note number using Tonal\n */\nexport function midiToFrequency(midiNote: number): number {\n    const noteName = Note.fromMidi(midiNote);\n    return noteName ? Note.freq(noteName) || 440 : 440;\n}\n\n/**\n * Convert frequency to MIDI note number\n */\nexport function frequencyToMidi(frequency: number): number {\n    return Math.round(12 * Math.log2(frequency / 440) + 69);\n}\n\n/**\n * Get cents deviation between two frequencies\n */\nexport function getCentsDeviation(frequency: number, targetFrequency: number): number {\n    return 1200 * Math.log2(frequency / targetFrequency);\n}\n\n/**\n * Get cents deviation from target MIDI note\n */\nexport function getCentsFromMidi(frequency: number, targetMidi: number): number {\n    const targetFrequency = midiToFrequency(targetMidi);\n    return getCentsDeviation(frequency, targetFrequency);\n}\n\n/**\n * Generate a major scale using Tonal\n */\nexport function generateMajorScale(root: string): number[] {\n    const scale = Scale.get(`${root} major`);\n    return scale.notes.map(note => noteNameToMidi(note)).filter(midi => midi !== -1);\n}\n\n/**\n * Generate a minor scale (natural minor) using Tonal\n */\nexport function generateMinorScale(root: string): number[] {\n    const scale = Scale.get(`${root} minor`);\n    return scale.notes.map(note => noteNameToMidi(note)).filter(midi => midi !== -1);\n}\n\n/**\n * Generate a scale by type using Tonal\n */\nexport function generateScale(root: string, scaleType: string = 'major'): number[] {\n    const scale = Scale.get(`${root} ${scaleType}`);\n    return scale.notes.map(note => noteNameToMidi(note)).filter(midi => midi !== -1);\n}\n\n/**\n * Generate a chord using Tonal\n */\nexport function generateChord(root: string, type: string = 'major'): number[] {\n    const chord = Chord.get(`${root}${type}`);\n    return chord.notes.map(note => noteNameToMidi(note)).filter(midi => midi !== -1);\n}\n\n/**\n * Get all key signatures\n */\nexport function getAllKeySignatures(): KeySignature[] {\n    return [\n        { name: 'C Major / A Minor', sharps: 0, flats: 0 },\n        { name: 'G Major / E Minor', sharps: 1, flats: 0 },\n        { name: 'D Major / B Minor', sharps: 2, flats: 0 },\n        { name: 'A Major / F# Minor', sharps: 3, flats: 0 },\n        { name: 'E Major / C# Minor', sharps: 4, flats: 0 },\n        { name: 'B Major / G# Minor', sharps: 5, flats: 0 },\n        { name: 'F# Major / D# Minor', sharps: 6, flats: 0 },\n        { name: 'F Major / D Minor', sharps: 0, flats: 1 },\n        { name: 'Bb Major / G Minor', sharps: 0, flats: 2 },\n        { name: 'Eb Major / C Minor', sharps: 0, flats: 3 },\n        { name: 'Ab Major / F Minor', sharps: 0, flats: 4 },\n        { name: 'Db Major / Bb Minor', sharps: 0, flats: 5 },\n        { name: 'Gb Major / Eb Minor', sharps: 0, flats: 6 }\n    ];\n}\n\n/**\n * Get interval between two notes in semitones\n */\nexport function getInterval(note1: string, note2: string): number {\n    const midi1 = noteNameToMidi(note1);\n    const midi2 = noteNameToMidi(note2);\n    return Math.abs(midi2 - midi1);\n}\n\n/**\n * Check if frequency is within valid range for instrument\n */\nexport function isFrequencyInRange(frequency: number, minFreq: number, maxFreq: number): boolean {\n    return frequency >= minFreq && frequency <= maxFreq;\n}\n\n// Export as namespace for backward compatibility\nexport const MusicTheory = {\n    noteNames,\n    vexflowNoteNames,\n    midiToNoteName,\n    noteNameToMidi,\n    midiToVexflow,\n    generateRandomNote,\n    generateRandomNoteFromMidiRange,\n    validateNote,\n    validatePitchWithCents,\n    midiToFrequency,\n    frequencyToMidi,\n    getCentsDeviation,\n    getCentsFromMidi,\n    generateMajorScale,\n    generateMinorScale,\n    generateScale,\n    generateChord,\n    getAllKeySignatures,\n    getInterval,\n    isFrequencyInRange\n};\n\n// Make available globally for legacy code\nif (typeof window !== 'undefined') {\n    (window as any).MusicTheory = MusicTheory;\n}\n","/**\n * MIDI Manager\n * Handles MIDI device connection, input detection, and note events\n */\n\nimport { midiToNoteName, midiToFrequency } from '../utils/music-theory.js';\n\n// Type definitions\nexport interface MIDIDevice {\n    id: string;\n    name: string;\n    manufacturer: string;\n    state: MIDIPortDeviceState;\n    connection: MIDIPortConnectionState;\n}\n\nexport interface NoteOnEvent {\n    note: number;\n    velocity: number;\n    noteName: string;\n    frequency: number;\n    timestamp: number;\n}\n\nexport interface NoteOffEvent {\n    note: number;\n    noteName: string;\n    timestamp: number;\n}\n\nexport interface DeviceChangeEvent {\n    connected?: boolean;\n    device?: MIDIInput | null;\n    type?: string;\n    port?: MIDIPort;\n}\n\nexport interface ErrorEvent {\n    message: string;\n}\n\ntype EventCallback<T> = (event: T) => void;\n\ninterface Listeners {\n    noteOn: EventCallback<NoteOnEvent>[];\n    noteOff: EventCallback<NoteOffEvent>[];\n    deviceChange: EventCallback<DeviceChangeEvent>[];\n    error: EventCallback<ErrorEvent>[];\n}\n\nexport type EventType = keyof Listeners;\n\nexport class MidiManager {\n    private midiAccess: MIDIAccess | null = null;\n    private selectedInput: MIDIInput | null = null;\n    private listeners: Listeners;\n    private activeNotes: Set<number>;\n\n    constructor() {\n        this.listeners = {\n            noteOn: [],\n            noteOff: [],\n            deviceChange: [],\n            error: []\n        };\n        this.activeNotes = new Set<number>();\n    }\n\n    /**\n     * Initialize MIDI access\n     */\n    async init(): Promise<boolean> {\n        try {\n            // Check for Web MIDI API support\n            if (!navigator.requestMIDIAccess) {\n                this.emitError('Web MIDI API is not supported in this browser. Try Chrome or Edge.');\n                return false;\n            }\n\n            // Request MIDI access\n            this.midiAccess = await navigator.requestMIDIAccess();\n\n            // Listen for device connections/disconnections\n            this.midiAccess.addEventListener('statechange', (e: Event) => {\n                this.handleStateChange(e as MIDIConnectionEvent);\n            });\n\n            // Initialize available devices\n            this.updateDeviceList();\n\n            console.log('MIDI initialized successfully');\n            return true;\n        } catch (error) {\n            console.error('Failed to initialize MIDI:', error);\n            this.emitError('Failed to access MIDI devices. Please check your browser permissions.');\n            return false;\n        }\n    }\n\n    /**\n     * Get list of available MIDI input devices\n     */\n    getInputDevices(): MIDIDevice[] {\n        if (!this.midiAccess) return [];\n\n        const devices: MIDIDevice[] = [];\n        for (const input of this.midiAccess.inputs.values()) {\n            devices.push({\n                id: input.id,\n                name: input.name || 'Unknown Device',\n                manufacturer: input.manufacturer || 'Unknown',\n                state: input.state,\n                connection: input.connection\n            });\n        }\n\n        return devices;\n    }\n\n    /**\n     * Connect to a specific MIDI input device\n     */\n    connectDevice(deviceId: string): boolean {\n        if (!this.midiAccess) {\n            console.error('MIDI not initialized');\n            return false;\n        }\n\n        // Disconnect current device\n        this.disconnectDevice();\n\n        // Get the input device\n        const input = this.midiAccess.inputs.get(deviceId);\n\n        if (!input) {\n            console.error('Device not found:', deviceId);\n            return false;\n        }\n\n        // Attach event listener\n        input.onmidimessage = (message: MIDIMessageEvent) => this.handleMidiMessage(message);\n\n        this.selectedInput = input;\n        this.emitDeviceChange({ connected: true, device: input });\n\n        console.log('Connected to MIDI device:', input.name);\n        return true;\n    }\n\n    /**\n     * Disconnect current MIDI device\n     */\n    disconnectDevice(): void {\n        if (this.selectedInput) {\n            this.selectedInput.onmidimessage = null;\n            this.selectedInput = null;\n            this.activeNotes.clear();\n            this.emitDeviceChange({ connected: false, device: null });\n            console.log('Disconnected MIDI device');\n        }\n    }\n\n    /**\n     * Handle incoming MIDI messages\n     */\n    private handleMidiMessage(message: MIDIMessageEvent): void {\n        if (!message.data || message.data.length < 3) return;\n\n        const status = message.data[0];\n        const note = message.data[1];\n        const velocity = message.data[2];\n\n        // Extract message type from status byte\n        const messageType = status & 0xf0;\n\n        switch (messageType) {\n            case 0x90: // Note On\n                if (velocity > 0) {\n                    this.handleNoteOn(note, velocity);\n                } else {\n                    // Note on with velocity 0 is treated as note off\n                    this.handleNoteOff(note);\n                }\n                break;\n\n            case 0x80: // Note Off\n                this.handleNoteOff(note);\n                break;\n\n            default:\n                // Ignore other MIDI messages (control change, pitch bend, etc.)\n                break;\n        }\n    }\n\n    /**\n     * Handle note on event\n     */\n    private handleNoteOn(note: number, velocity: number): void {\n        this.activeNotes.add(note);\n\n        // Emit to all registered listeners\n        this.listeners.noteOn.forEach(callback => {\n            try {\n                callback({\n                    note,\n                    velocity,\n                    noteName: midiToNoteName(note),\n                    frequency: midiToFrequency(note),\n                    timestamp: Date.now()\n                });\n            } catch (error) {\n                console.error('Error in noteOn listener:', error);\n            }\n        });\n    }\n\n    /**\n     * Handle note off event\n     */\n    private handleNoteOff(note: number): void {\n        this.activeNotes.delete(note);\n\n        // Emit to all registered listeners\n        this.listeners.noteOff.forEach(callback => {\n            try {\n                callback({\n                    note,\n                    noteName: midiToNoteName(note),\n                    timestamp: Date.now()\n                });\n            } catch (error) {\n                console.error('Error in noteOff listener:', error);\n            }\n        });\n    }\n\n    /**\n     * Handle device state changes (connection/disconnection)\n     */\n    private handleStateChange(event: MIDIConnectionEvent): void {\n        if (!event.port) return;\n\n        console.log('MIDI device state changed:', event.port.name, event.port.state);\n        this.updateDeviceList();\n\n        // If the currently selected device was disconnected\n        if (this.selectedInput && event.port.id === this.selectedInput.id && event.port.state === 'disconnected') {\n            this.disconnectDevice();\n        }\n\n        this.emitDeviceChange({\n            type: 'statechange',\n            port: event.port\n        });\n    }\n\n    /**\n     * Update the device list (called on state changes)\n     */\n    private updateDeviceList(): void {\n        const devices = this.getInputDevices();\n        console.log('Available MIDI devices:', devices);\n\n        // Auto-connect to first device if none selected\n        if (!this.selectedInput && devices.length > 0) {\n            this.connectDevice(devices[0].id);\n        }\n    }\n\n    /**\n     * Register an event listener\n     */\n    on<T extends EventType>(event: T, callback: Listeners[T][number]): void {\n        if (this.listeners[event]) {\n            this.listeners[event].push(callback as any);\n        } else {\n            console.warn('Unknown event type:', event);\n        }\n    }\n\n    /**\n     * Remove an event listener\n     */\n    off<T extends EventType>(event: T, callback: Listeners[T][number]): void {\n        if (this.listeners[event]) {\n            const index = this.listeners[event].indexOf(callback as any);\n            if (index > -1) {\n                this.listeners[event].splice(index, 1);\n            }\n        }\n    }\n\n    /**\n     * Emit device change event\n     */\n    private emitDeviceChange(data: DeviceChangeEvent): void {\n        this.listeners.deviceChange.forEach(callback => {\n            try {\n                callback(data);\n            } catch (error) {\n                console.error('Error in deviceChange listener:', error);\n            }\n        });\n    }\n\n    /**\n     * Emit error event\n     */\n    private emitError(message: string): void {\n        this.listeners.error.forEach(callback => {\n            try {\n                callback({ message });\n            } catch (error) {\n                console.error('Error in error listener:', error);\n            }\n        });\n    }\n\n    /**\n     * Check if a note is currently being played\n     */\n    isNoteActive(note: number): boolean {\n        return this.activeNotes.has(note);\n    }\n\n    /**\n     * Get all currently active notes\n     */\n    getActiveNotes(): number[] {\n        return Array.from(this.activeNotes);\n    }\n\n    /**\n     * Simulate a note (for testing without MIDI device)\n     */\n    simulateNote(note: number, velocity: number = 64, duration: number = 500): void {\n        this.handleNoteOn(note, velocity);\n\n        setTimeout(() => {\n            this.handleNoteOff(note);\n        }, duration);\n    }\n\n    /**\n     * Check if MIDI is supported\n     */\n    static isSupported(): boolean {\n        return typeof navigator !== 'undefined' && !!navigator.requestMIDIAccess;\n    }\n\n    /**\n     * Get current connected device\n     */\n    getConnectedDevice(): MIDIDevice | null {\n        if (!this.selectedInput) return null;\n\n        return {\n            id: this.selectedInput.id,\n            name: this.selectedInput.name || 'Unknown Device',\n            manufacturer: this.selectedInput.manufacturer || 'Unknown',\n            state: this.selectedInput.state,\n            connection: this.selectedInput.connection\n        };\n    }\n}\n\n// Make available globally for legacy code\nif (typeof window !== 'undefined') {\n    (window as any).MidiManager = MidiManager;\n}\n","import FFT from \"fft.js\";\n\n/**\n * @typedef {Float32Array | Float64Array | number[]} Buffer One of the supported\n * buffer types. Other numeric array types may not work correctly.\n */\n\n/**\n * A class that can perform autocorrelation on input arrays of a given size.\n *\n * The class holds internal buffers so that no additional allocations are\n * necessary while performing the operation.\n *\n * @template {Buffer} T the buffer type to use. While inputs to the\n * autocorrelation process can be any array-like type, the output buffer\n * (whether provided explicitly or using a fresh buffer) is always of this type.\n */\nexport class Autocorrelator {\n  /** @private @readonly @type {number} */\n  _inputLength;\n  /** @private @type {FFT} */\n  _fft;\n  /** @private @type {(size: number) => T} */\n  _bufferSupplier;\n  /** @private @type {T} */\n  _paddedInputBuffer;\n  /** @private @type {T} */\n  _transformBuffer;\n  /** @private @type {T} */\n  _inverseBuffer;\n\n  /**\n   * A helper method to create an {@link Autocorrelator} using\n   * {@link Float32Array} buffers.\n   *\n   * @param inputLength {number} the input array length to support\n   * @returns {Autocorrelator<Float32Array>}\n   */\n  static forFloat32Array(inputLength) {\n    return new Autocorrelator(\n      inputLength,\n      (length) => new Float32Array(length),\n    );\n  }\n\n  /**\n   * A helper method to create an {@link Autocorrelator} using\n   * {@link Float64Array} buffers.\n   *\n   * @param inputLength {number} the input array length to support\n   * @returns {Autocorrelator<Float64Array>}\n   */\n  static forFloat64Array(inputLength) {\n    return new Autocorrelator(\n      inputLength,\n      (length) => new Float64Array(length),\n    );\n  }\n\n  /**\n   * A helper method to create an {@link Autocorrelator} using `number[]`\n   * buffers.\n   *\n   * @param inputLength {number} the input array length to support\n   * @returns {Autocorrelator<number[]>}\n   */\n  static forNumberArray(inputLength) {\n    return new Autocorrelator(inputLength, (length) => Array(length));\n  }\n\n  /**\n   * Constructs a new {@link Autocorrelator} able to handle input arrays of the\n   * given length.\n   *\n   * @param inputLength {number} the input array length to support. This\n   * `Autocorrelator` will only support operation on arrays of this length.\n   * @param bufferSupplier {(length: number) => T} the function to use for\n   * creating buffers, accepting the length of the buffer to create and\n   * returning a new buffer of that length. The values of the returned buffer\n   * need not be initialized in any particular way.\n   */\n  constructor(inputLength, bufferSupplier) {\n    if (inputLength < 1) {\n      throw new Error(`Input length must be at least one`);\n    }\n    this._inputLength = inputLength;\n    // We need to double the input length to get correct results, and the FFT\n    // algorithm we use requires a length that's a power of 2\n    this._fft = new FFT(ceilPow2(2 * inputLength));\n    this._bufferSupplier = bufferSupplier;\n    this._paddedInputBuffer = this._bufferSupplier(this._fft.size);\n    this._transformBuffer = this._bufferSupplier(2 * this._fft.size);\n    this._inverseBuffer = this._bufferSupplier(2 * this._fft.size);\n  }\n\n  /**\n   * Returns the supported input length.\n   *\n   * @returns {number} the supported input length\n   */\n  get inputLength() {\n    return this._inputLength;\n  }\n\n  /**\n   * Autocorrelates the given input data.\n   *\n   * @param input {ArrayLike<number>} the input data to autocorrelate\n   * @param output {T} the output buffer into which to write the autocorrelated\n   * data. If not provided, a new buffer will be created.\n   * @returns {T} `output`\n   */\n  autocorrelate(input, output = this._bufferSupplier(input.length)) {\n    if (input.length !== this._inputLength) {\n      throw new Error(\n        `Input must have length ${this._inputLength} but had length ${input.length}`,\n      );\n    }\n    // Step 0: pad the input array with zeros\n    for (let i = 0; i < input.length; i++) {\n      this._paddedInputBuffer[i] = input[i];\n    }\n    for (let i = input.length; i < this._paddedInputBuffer.length; i++) {\n      this._paddedInputBuffer[i] = 0;\n    }\n\n    // Step 1: get the DFT of the input array\n    this._fft.realTransform(this._transformBuffer, this._paddedInputBuffer);\n    // We need to fill in the right half of the array too\n    this._fft.completeSpectrum(this._transformBuffer);\n    // Step 2: multiply each entry by its conjugate\n    const tb = this._transformBuffer;\n    for (let i = 0; i < tb.length; i += 2) {\n      tb[i] = tb[i] * tb[i] + tb[i + 1] * tb[i + 1];\n      tb[i + 1] = 0;\n    }\n    // Step 3: perform the inverse transform\n    this._fft.inverseTransform(this._inverseBuffer, this._transformBuffer);\n\n    // This last result (the inverse transform) contains the autocorrelation\n    // data, which is completely real\n    for (let i = 0; i < input.length; i++) {\n      output[i] = this._inverseBuffer[2 * i];\n    }\n    return output;\n  }\n}\n\n/**\n * Returns an array of all the key maximum positions in the given input array.\n *\n * In McLeod's paper, a key maximum is the highest maximum between a positively\n * sloped zero crossing and a negatively sloped one.\n *\n * TODO: it may be more efficient not to construct a new output array each time,\n * but that would also make the code more complicated (more so than the changes\n * that were needed to remove the other allocations).\n *\n * @param input {ArrayLike<number>}\n * @returns {number[]}\n */\nfunction getKeyMaximumIndices(input) {\n  // The indices of the key maxima\n  /** @type {number[]} */ const keyIndices = [];\n  // Whether the last zero crossing found was positively sloped; equivalently,\n  // whether we're looking for a key maximum\n  let lookingForMaximum = false;\n  // The largest local maximum found so far\n  let max = -Infinity;\n  // The index of the largest local maximum so far\n  let maxIndex = -1;\n\n  for (let i = 1; i < input.length - 1; i++) {\n    if (input[i - 1] <= 0 && input[i] > 0) {\n      // Positively sloped zero crossing\n      lookingForMaximum = true;\n      maxIndex = i;\n      max = input[i];\n    } else if (input[i - 1] > 0 && input[i] <= 0) {\n      // Negatively sloped zero crossing\n      lookingForMaximum = false;\n      if (maxIndex !== -1) {\n        keyIndices.push(maxIndex);\n      }\n    } else if (lookingForMaximum && input[i] > max) {\n      max = input[i];\n      maxIndex = i;\n    }\n  }\n\n  return keyIndices;\n}\n\n/**\n * Refines the chosen key maximum index chosen from the given data by\n * interpolating a parabola using the key maximum index and its two neighbors\n * and finding the position of that parabola's maximum value.\n *\n * This is described in section 5 of the MPM paper as a way to refine the\n * position of the maximum.\n *\n * @param index {number} the chosen key maximum index. This must be between `1`\n * and `data.length - 2`, inclusive, since it and its two neighbors need to be\n * valid indexes of `data`.\n * @param data {ArrayLike<number>} the input array from which `index` was chosen\n * @returns {[number, number]} a pair consisting of the refined key maximum index and the\n * interpolated value of `data` at that index (the latter of which is used as a\n * measure of clarity)\n */\nfunction refineResultIndex(index, data) {\n  const [x0, x1, x2] = [index - 1, index, index + 1];\n  const [y0, y1, y2] = [data[x0], data[x1], data[x2]];\n\n  // The parabola going through the three data points can be written as\n  // y = y0(x - x1)(x - x2)/(x0 - x1)(x0 - x2)\n  //   + y1(x - x0)(x - x2)/(x1 - x0)(x1 - x2)\n  //   + y2(x - x0)(x - x1)/(x2 - x0)(x2 - x1)\n  // Given the definitions of x0, x1, and x2, we can simplify the denominators:\n  // y = y0(x - x1)(x - x2)/2\n  //   - y1(x - x0)(x - x2)\n  //   + y2(x - x0)(x - x1)/2\n  // We can expand this out and get the coefficients in standard form:\n  // a = y0/2 - y1 + y2/2\n  // b = -(y0/2)(x1 + x2) + y1(x0 + x2) - (y2/2)(x0 + x1)\n  // c = y0x1x2/2 - y1x0x2 + y2x0x1/2\n  // The index of the maximum is -b / 2a (by solving for x where the derivative\n  // is 0).\n\n  const a = y0 / 2 - y1 + y2 / 2;\n  const b = -(y0 / 2) * (x1 + x2) + y1 * (x0 + x2) - (y2 / 2) * (x0 + x1);\n  const c = (y0 * x1 * x2) / 2 - y1 * x0 * x2 + (y2 * x0 * x1) / 2;\n\n  const xMax = -b / (2 * a);\n  const yMax = a * xMax * xMax + b * xMax + c;\n  return [xMax, yMax];\n}\n\n/**\n * A class that can detect the pitch of a note from a time-domain input array.\n *\n * This class uses the McLeod pitch method (MPM) to detect pitches. MPM is\n * described in the paper 'A Smarter Way to Find Pitch' by Philip McLeod and\n * Geoff Wyvill\n * (http://miracle.otago.ac.nz/tartini/papers/A_Smarter_Way_to_Find_Pitch.pdf).\n *\n * The class holds internal buffers so that a minimal number of additional\n * allocations are necessary while performing the operation.\n *\n * @template {Buffer} T the buffer type to use internally. Inputs to the\n * pitch-detection process can be any numeric array type.\n */\nexport class PitchDetector {\n  /** @private @type {Autocorrelator<T>} */\n  _autocorrelator;\n  /** @private @type {T} */\n  _nsdfBuffer;\n  /** @private @type {number} */\n  _clarityThreshold = 0.9;\n  /** @private @type {number} */\n  _minVolumeAbsolute = 0.0;\n  /** @private @type {number} */\n  _maxInputAmplitude = 1.0;\n\n  /**\n   * A helper method to create an {@link PitchDetector} using {@link Float32Array} buffers.\n   *\n   * @param inputLength {number} the input array length to support\n   * @returns {PitchDetector<Float32Array>}\n   */\n  static forFloat32Array(inputLength) {\n    return new PitchDetector(inputLength, (length) => new Float32Array(length));\n  }\n\n  /**\n   * A helper method to create an {@link PitchDetector} using {@link Float64Array} buffers.\n   *\n   * @param inputLength {number} the input array length to support\n   * @returns {PitchDetector<Float64Array>}\n   */\n  static forFloat64Array(inputLength) {\n    return new PitchDetector(inputLength, (length) => new Float64Array(length));\n  }\n\n  /**\n   * A helper method to create an {@link PitchDetector} using `number[]` buffers.\n   *\n   * @param inputLength {number} the input array length to support\n   * @returns {PitchDetector<number[]>}\n   */\n  static forNumberArray(inputLength) {\n    return new PitchDetector(inputLength, (length) => Array(length));\n  }\n\n  /**\n   * Constructs a new {@link PitchDetector} able to handle input arrays of the\n   * given length.\n   *\n   * @param inputLength {number} the input array length to support. This\n   * `PitchDetector` will only support operation on arrays of this length.\n   * @param bufferSupplier {(inputLength: number) => T} the function to use for\n   * creating buffers, accepting the length of the buffer to create and\n   * returning a new buffer of that length. The values of the returned buffer\n   * need not be initialized in any particular way.\n   */\n  constructor(inputLength, bufferSupplier) {\n    this._autocorrelator = new Autocorrelator(inputLength, bufferSupplier);\n    this._nsdfBuffer = bufferSupplier(inputLength);\n  }\n\n  /**\n   * Returns the supported input length.\n   *\n   * @returns {number} the supported input length\n   */\n  get inputLength() {\n    return this._autocorrelator.inputLength;\n  }\n\n  /**\n   * Sets the clarity threshold used when identifying the correct pitch (the constant\n   * `k` from the MPM paper). The value must be between 0 (exclusive) and 1\n   * (inclusive), with the most suitable range being between 0.8 and 1.\n   *\n   * @param threshold {number} the clarity threshold\n   */\n  set clarityThreshold(threshold) {\n    if (!Number.isFinite(threshold) || threshold <= 0 || threshold > 1) {\n      throw new Error(\"clarityThreshold must be a number in the range (0, 1]\");\n    }\n    this._clarityThreshold = threshold;\n  }\n\n  /**\n   * Sets the minimum detectable volume, as an absolute number between 0 and\n   * `maxInputAmplitude`, inclusive, to consider in a sample when detecting the\n   * pitch. If a sample fails to meet this minimum volume, `findPitch` will\n   * return a clarity of 0.\n   *\n   * Volume is calculated as the RMS (root mean square) of the input samples.\n   *\n   * @param volume {number} the minimum volume as an absolute amplitude value\n   */\n  set minVolumeAbsolute(volume) {\n    if (\n      !Number.isFinite(volume) ||\n      volume < 0 ||\n      volume > this._maxInputAmplitude\n    ) {\n      throw new Error(\n        `minVolumeAbsolute must be a number in the range [0, ${this._maxInputAmplitude}]`,\n      );\n    }\n    this._minVolumeAbsolute = volume;\n  }\n\n  /**\n   * Sets the minimum volume using a decibel measurement. Must be less than or\n   * equal to 0: 0 indicates the loudest possible sound (see\n   * `maxInputAmplitude`), -10 is a sound with a tenth of the volume of the\n   * loudest possible sound, etc.\n   *\n   * Volume is calculated as the RMS (root mean square) of the input samples.\n   *\n   * @param db {number} the minimum volume in decibels, with 0 being the loudest\n   * sound\n   */\n  set minVolumeDecibels(db) {\n    if (!Number.isFinite(db) || db > 0) {\n      throw new Error(\"minVolumeDecibels must be a number <= 0\");\n    }\n    this._minVolumeAbsolute = this._maxInputAmplitude * 10 ** (db / 10);\n  }\n\n  /**\n   * Sets the maximum amplitude of an input reading. Must be greater than 0.\n   *\n   * @param amplitude {number} the maximum amplitude (absolute value) of an input reading\n   */\n  set maxInputAmplitude(amplitude) {\n    if (!Number.isFinite(amplitude) || amplitude <= 0) {\n      throw new Error(\"maxInputAmplitude must be a number > 0\");\n    }\n    this._maxInputAmplitude = amplitude;\n  }\n\n  /**\n   * Returns the pitch detected using McLeod Pitch Method (MPM) along with a\n   * measure of its clarity.\n   *\n   * The clarity is a value between 0 and 1 (potentially inclusive) that\n   * represents how \"clear\" the pitch was. A clarity value of 1 indicates that\n   * the pitch was very distinct, while lower clarity values indicate less\n   * definite pitches.\n   *\n   * @param input {ArrayLike<number>} the time-domain input data\n   * @param sampleRate {number} the sample rate at which the input data was\n   * collected\n   * @returns {[number, number]} the detected pitch, in Hz, followed by the\n   * clarity. If a pitch cannot be determined from the input, such as if the\n   * volume is too low (see `minVolumeAbsolute` and `minVolumeDecibels`), this\n   * will be `[0, 0]`.\n   */\n  findPitch(input, sampleRate) {\n    // If the highest key maximum is less than the minimum volume, we don't need\n    // to bother detecting the pitch, as the sample is too quiet.\n    if (this._belowMinimumVolume(input)) return [0, 0];\n    this._nsdf(input);\n    const keyMaximumIndices = getKeyMaximumIndices(this._nsdfBuffer);\n    if (keyMaximumIndices.length === 0) {\n      // No key maxima means that we either don't have enough data to analyze or\n      // that the data was flawed (such as an input array of zeroes)\n      return [0, 0];\n    }\n    // The highest key maximum\n    const nMax = Math.max(...keyMaximumIndices.map((i) => this._nsdfBuffer[i]));\n    // Following the paper, we return the pitch corresponding to the first key\n    // maximum higher than K * nMax. This is guaranteed not to be undefined, since\n    // we know of at least one key maximum satisfying this condition (whichever\n    // key maximum gave us nMax).\n    const resultIndex = keyMaximumIndices.find(\n      (i) => this._nsdfBuffer[i] >= this._clarityThreshold * nMax,\n    );\n    const [refinedResultIndex, clarity] = refineResultIndex(\n      // @ts-expect-error resultIndex is guaranteed to be defined\n      resultIndex,\n      this._nsdfBuffer,\n    );\n\n    // Due to floating point errors, the clarity may occasionally come out to be\n    // slightly over 1.0. We can avoid incorrect results by clamping the value.\n    return [sampleRate / refinedResultIndex, Math.min(clarity, 1.0)];\n  }\n\n  /**\n   * Returns whether the input audio data is below the minimum volume allowed by\n   * the pitch detector.\n   *\n   * @private\n   * @param input {ArrayLike<number>}\n   * @returns {boolean}\n   */\n  _belowMinimumVolume(input) {\n    if (this._minVolumeAbsolute === 0) return false;\n    let squareSum = 0;\n    for (let i = 0; i < input.length; i++) {\n      squareSum += input[i] ** 2;\n    }\n    return Math.sqrt(squareSum / input.length) < this._minVolumeAbsolute;\n  }\n\n  /**\n   * Computes the NSDF of the input and stores it in the internal buffer. This\n   * is equation (9) in the McLeod pitch method paper.\n   *\n   * @private\n   * @param input {ArrayLike<number>}\n   */\n  _nsdf(input) {\n    // The function r'(tau) is the autocorrelation\n    this._autocorrelator.autocorrelate(input, this._nsdfBuffer);\n    // The function m'(tau) (defined in equation (6)) can be computed starting\n    // with m'(0), which is equal to 2r'(0), and then iteratively modified to\n    // get m'(1), m'(2), etc. For example, to get m'(1), we take m'(0) and\n    // subtract x_0^2 and x_{W-1}^2. Then, to get m'(2), we take m'(1) and\n    // subtract x_1^2 and x_{W-2}^2, and further values are similar (see the\n    // note at the end of section 6 in the MPM paper).\n    //\n    // The resulting array values are 2 * r'(tau) / m'(tau). We use m below as\n    // the incremental value of m'.\n    let m = 2 * this._nsdfBuffer[0];\n    /** @type {number} */ let i;\n    // As pointed out by issuefiler on GitHub, we can take advantage of the fact\n    // that m will never increase to avoid division by zero by ending this loop\n    // once m === 0. The rest of the array values after m becomes 0 will just be\n    // set to 0 themselves. We actually check for m > 0 rather than m === 0\n    // because there may be small floating-point errors that cause m to become\n    // negative rather than exactly 0.\n    for (i = 0; i < this._nsdfBuffer.length && m > 0; i++) {\n      this._nsdfBuffer[i] = (2 * this._nsdfBuffer[i]) / m;\n      m -= input[i] ** 2 + input[input.length - i - 1] ** 2;\n    }\n    // If there are any array values remaining, it means m === 0 for those\n    // values of tau, so we can just set them to 0\n    for (; i < this._nsdfBuffer.length; i++) {\n      this._nsdfBuffer[i] = 0;\n    }\n  }\n}\n\n/**\n * Rounds up the input to the next power of 2.\n *\n * @param {number} v\n * @returns {number} the next power of 2 at least as large as `v`\n */\nfunction ceilPow2(v) {\n  // https://graphics.stanford.edu/~seander/bithacks.html#RoundUpPowerOf2\n  v--;\n  v |= v >> 1;\n  v |= v >> 2;\n  v |= v >> 4;\n  v |= v >> 8;\n  v |= v >> 16;\n  v++;\n  return v;\n}\n","/**\n * Pitch Detector\n * Wraps the pitchy library for real-time monophonic pitch detection\n * Uses McLeod Pitch Method (MPM) for accurate fundamental frequency detection\n */\n\nimport { PitchDetector as PitchyDetector } from 'pitchy';\nimport { frequencyToMidi, getCentsFromMidi } from './music-theory.js';\n\n// Type definitions\nexport interface PitchResult {\n    frequency: number;\n    midi: number;\n    cents: number;\n    clarity: number;\n    detected: boolean;\n}\n\nexport interface DetectorConfig {\n    bufferSize: number;\n    sampleRate: number;\n    minClarity: number;\n    minFrequency: number;\n    maxFrequency: number;\n}\n\nexport class PitchDetector {\n    private detector: PitchyDetector<Float32Array>;\n    private config: DetectorConfig;\n\n    constructor(config: Partial<DetectorConfig> = {}) {\n        // Default configuration optimized for musical instruments\n        this.config = {\n            bufferSize: config.bufferSize || 2048,\n            sampleRate: config.sampleRate || 44100,\n            minClarity: config.minClarity || 0.75,\n            minFrequency: config.minFrequency || 70,  // Below E2 (guitar low E)\n            maxFrequency: config.maxFrequency || 1600 // Above G6 (violin high range)\n        };\n\n        // Initialize pitchy detector\n        this.detector = PitchyDetector.forFloat32Array(this.config.bufferSize);\n        this.detector.minVolumeDecibels = -40; // Noise gate\n    }\n\n    /**\n     * Detect pitch from audio buffer\n     * @param buffer - Float32Array of audio samples\n     * @param sampleRate - Sample rate of the audio (optional, uses config default)\n     * @returns PitchResult with frequency, MIDI note, and clarity\n     */\n    detectPitch(buffer: Float32Array, sampleRate?: number): PitchResult {\n        const rate = sampleRate || this.config.sampleRate;\n\n        // Use pitchy's findPitch method (returns [frequency, clarity])\n        const [frequency, clarity] = this.detector.findPitch(buffer, rate);\n\n        // Check if detection is valid\n        const isValid = this.isValidDetection(frequency, clarity);\n\n        if (!isValid) {\n            return {\n                frequency: 0,\n                midi: 0,\n                cents: 0,\n                clarity: clarity || 0,\n                detected: false\n            };\n        }\n\n        // Convert frequency to MIDI note\n        const midi = frequencyToMidi(frequency);\n\n        // Calculate cents deviation from the MIDI note\n        const cents = getCentsFromMidi(frequency, midi);\n\n        return {\n            frequency,\n            midi,\n            cents,\n            clarity: clarity || 0,\n            detected: true\n        };\n    }\n\n    /**\n     * Check if detected pitch is valid based on clarity and frequency range\n     */\n    private isValidDetection(frequency: number, clarity: number): boolean {\n        if (!frequency || frequency <= 0) return false;\n        if (!clarity || clarity < this.config.minClarity) return false;\n        if (frequency < this.config.minFrequency) return false;\n        if (frequency > this.config.maxFrequency) return false;\n        return true;\n    }\n\n    /**\n     * Update detector configuration\n     */\n    updateConfig(config: Partial<DetectorConfig>): void {\n        this.config = { ...this.config, ...config };\n\n        // Recreate detector if buffer size changed\n        if (config.bufferSize && config.bufferSize !== this.config.bufferSize) {\n            this.detector = PitchyDetector.forFloat32Array(this.config.bufferSize);\n            this.detector.minVolumeDecibels = -40;\n        }\n    }\n\n    /**\n     * Get current configuration\n     */\n    getConfig(): DetectorConfig {\n        return { ...this.config };\n    }\n\n    /**\n     * Set minimum clarity threshold\n     */\n    setMinClarity(clarity: number): void {\n        this.config.minClarity = Math.max(0, Math.min(1, clarity));\n    }\n\n    /**\n     * Set frequency range for detection\n     */\n    setFrequencyRange(min: number, max: number): void {\n        this.config.minFrequency = min;\n        this.config.maxFrequency = max;\n    }\n\n    /**\n     * Create detector optimized for specific instrument\n     */\n    static forInstrument(instrument: 'guitar' | 'violin' | 'voice'): PitchDetector {\n        const configs = {\n            guitar: {\n                bufferSize: 2048,\n                minClarity: 0.75,\n                minFrequency: 70,   // E2\n                maxFrequency: 1400  // E6\n            },\n            violin: {\n                bufferSize: 2048,\n                minClarity: 0.80,\n                minFrequency: 180,  // Below G3\n                maxFrequency: 1600  // Above G6\n            },\n            voice: {\n                bufferSize: 2048,\n                minClarity: 0.85,\n                minFrequency: 80,   // E2\n                maxFrequency: 1200  // D6\n            }\n        };\n\n        return new PitchDetector(configs[instrument]);\n    }\n}\n\n/**\n * Helper function to create a pitch detector with default settings\n */\nexport function createPitchDetector(config?: Partial<DetectorConfig>): PitchDetector {\n    return new PitchDetector(config);\n}\n\n/**\n * Simplified pitch detection function for quick use\n * @param buffer - Audio buffer\n * @param sampleRate - Sample rate\n * @param minClarity - Minimum clarity threshold (0-1)\n * @returns Detected frequency or null if no pitch detected\n */\nexport function detectFrequency(\n    buffer: Float32Array,\n    sampleRate: number = 44100,\n    minClarity: number = 0.75\n): number | null {\n    const detector = new PitchDetector({ sampleRate, minClarity });\n    const result = detector.detectPitch(buffer);\n    return result.detected ? result.frequency : null;\n}\n","/**\n * Audio Manager\n * Manages microphone access and real-time pitch detection for stringed/bowed instruments\n */\n\nimport { PitchDetector, PitchResult } from '../utils/pitch-detector.js';\nimport { midiToNoteName, midiToFrequency } from '../utils/music-theory.js';\n\n// Type definitions\nexport interface AudioConfig {\n    bufferSize: number;\n    smoothing: number;\n    minClarity: number;\n    minFrequency: number;\n    maxFrequency: number;\n}\n\nexport interface PitchDetectedEvent {\n    frequency: number;\n    midi: number;\n    cents: number;\n    clarity: number;\n    noteName: string;\n    timestamp: number;\n}\n\nexport interface AudioLevelEvent {\n    level: number; // 0-1\n    timestamp: number;\n}\n\nexport interface ErrorEvent {\n    message: string;\n    error?: Error;\n}\n\nexport interface StatusChangeEvent {\n    listening: boolean;\n    microphoneActive: boolean;\n}\n\ntype EventCallback<T> = (event: T) => void;\n\ninterface Listeners {\n    pitchDetected: EventCallback<PitchDetectedEvent>[];\n    audioLevel: EventCallback<AudioLevelEvent>[];\n    error: EventCallback<ErrorEvent>[];\n    statusChange: EventCallback<StatusChangeEvent>[];\n}\n\nexport type EventType = keyof Listeners;\n\nexport class AudioManager {\n    private audioContext: AudioContext | null = null;\n    private microphone: MediaStreamAudioSourceNode | null = null;\n    private analyser: AnalyserNode | null = null;\n    private pitchDetector: PitchDetector | null = null;\n    private animationFrameId: number | null = null;\n    private stream: MediaStream | null = null;\n\n    private config: AudioConfig;\n    private listeners: Listeners;\n    private isListening: boolean = false;\n    private buffer: Float32Array<ArrayBuffer> | null = null;\n\n    // Debouncing for note detection\n    private lastDetectedMidi: number | null = null;\n    private lastDetectedTime: number = 0;\n    private noteDebounceMs: number = 100; // Min time between note detections\n\n    constructor(config: Partial<AudioConfig> = {}) {\n        this.config = {\n            bufferSize: config.bufferSize || 2048,\n            smoothing: config.smoothing || 0.8,\n            minClarity: config.minClarity || 0.75,\n            minFrequency: config.minFrequency || 70,\n            maxFrequency: config.maxFrequency || 1600\n        };\n\n        this.listeners = {\n            pitchDetected: [],\n            audioLevel: [],\n            error: [],\n            statusChange: []\n        };\n    }\n\n    /**\n     * Initialize audio context and request microphone access\n     * @param deviceId - Optional specific device ID to use\n     */\n    async init(deviceId?: string): Promise<boolean> {\n        try {\n            // Check if getUserMedia is supported\n            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n                this.emitError('Microphone access is not supported in this browser. Try Chrome or Edge.');\n                return false;\n            }\n\n            // Create audio context\n            this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n\n            // Set up error handler for audio context\n            this.setupAudioContextErrorHandlers();\n\n            // Resume audio context if it's suspended\n            if (this.audioContext.state === 'suspended') {\n                await this.audioContext.resume();\n            }\n\n            // Request microphone access\n            const audioConstraints: MediaTrackConstraints = {\n                echoCancellation: false,\n                noiseSuppression: false,\n                autoGainControl: false,\n                sampleRate: 44100\n            };\n\n            // Add device ID if specified\n            if (deviceId) {\n                audioConstraints.deviceId = { exact: deviceId };\n            }\n\n            this.stream = await navigator.mediaDevices.getUserMedia({\n                audio: audioConstraints\n            });\n\n            // Create audio nodes\n            this.microphone = this.audioContext.createMediaStreamSource(this.stream);\n            this.analyser = this.audioContext.createAnalyser();\n            this.analyser.fftSize = this.config.bufferSize * 2;\n            this.analyser.smoothingTimeConstant = this.config.smoothing;\n\n            // Connect nodes\n            this.microphone.connect(this.analyser);\n\n            // Create buffer for time-domain data\n            this.buffer = new Float32Array(this.config.bufferSize) as Float32Array<ArrayBuffer>;\n\n            // Initialize pitch detector\n            this.pitchDetector = new PitchDetector({\n                bufferSize: this.config.bufferSize,\n                sampleRate: this.audioContext.sampleRate,\n                minClarity: this.config.minClarity,\n                minFrequency: this.config.minFrequency,\n                maxFrequency: this.config.maxFrequency\n            });\n\n            console.log('Audio Manager initialized successfully');\n            console.log('Sample rate:', this.audioContext.sampleRate);\n            console.log('Buffer size:', this.config.bufferSize);\n            console.log('Audio context state:', this.audioContext.state);\n\n            this.emitStatusChange({ listening: false, microphoneActive: true });\n            return true;\n        } catch (error) {\n            console.error('Failed to initialize audio:', error);\n            this.emitError('Failed to access microphone. Please check your browser permissions.', error as Error);\n            return false;\n        }\n    }\n\n    /**\n     * Setup error handlers for AudioContext\n     */\n    private setupAudioContextErrorHandlers(): void {\n        if (!this.audioContext) return;\n\n        // Handle state changes\n        this.audioContext.addEventListener('statechange', () => {\n            console.log('AudioContext state changed to:', this.audioContext?.state);\n\n            if (this.audioContext?.state === 'suspended') {\n                console.warn('AudioContext suspended, attempting to resume...');\n                this.audioContext.resume().catch(err => {\n                    console.error('Failed to resume AudioContext:', err);\n                });\n            } else if (this.audioContext?.state === 'closed') {\n                console.error('AudioContext closed unexpectedly');\n                this.emitError('Audio system closed unexpectedly. Please reconnect your microphone.');\n            }\n        });\n    }\n\n    /**\n     * Start listening for pitch\n     */\n    startListening(): void {\n        if (!this.audioContext || !this.analyser || !this.pitchDetector || !this.buffer) {\n            console.error('Audio Manager not initialized');\n            return;\n        }\n\n        if (this.isListening) {\n            console.warn('Already listening');\n            return;\n        }\n\n        this.isListening = true;\n        this.emitStatusChange({ listening: true, microphoneActive: true });\n        this.detectPitchLoop();\n        console.log('Started listening for pitch');\n    }\n\n    /**\n     * Stop listening for pitch\n     */\n    stopListening(): void {\n        if (!this.isListening) return;\n\n        this.isListening = false;\n        if (this.animationFrameId !== null) {\n            cancelAnimationFrame(this.animationFrameId);\n            this.animationFrameId = null;\n        }\n\n        this.emitStatusChange({ listening: false, microphoneActive: this.stream !== null });\n        console.log('Stopped listening for pitch');\n    }\n\n    /**\n     * Main pitch detection loop\n     */\n    private detectPitchLoop(): void {\n        if (!this.isListening || !this.analyser || !this.pitchDetector || !this.buffer || !this.audioContext) {\n            return;\n        }\n\n        // Check if audio context is in a valid state\n        if (this.audioContext.state === 'suspended') {\n            console.warn('AudioContext suspended during pitch detection, attempting resume...');\n            this.audioContext.resume().then(() => {\n                console.log('AudioContext resumed successfully');\n            }).catch(err => {\n                console.error('Failed to resume AudioContext:', err);\n                this.stopListening();\n                this.emitError('Audio system paused. Please restart your practice session.');\n            });\n            return;\n        }\n\n        if (this.audioContext.state === 'closed') {\n            console.error('AudioContext closed during pitch detection');\n            this.stopListening();\n            this.emitError('Audio system closed. Please reconnect your microphone.');\n            return;\n        }\n\n        try {\n            // Get time-domain data from analyser\n            this.analyser.getFloatTimeDomainData(this.buffer);\n\n            // Calculate audio level (RMS)\n            const level = this.calculateRMS(this.buffer);\n            this.emitAudioLevel(level);\n\n            // Detect pitch\n            const result: PitchResult = this.pitchDetector.detectPitch(this.buffer, this.audioContext.sampleRate);\n\n            // Emit pitch detected event if valid\n            if (result.detected) {\n                // Debounce rapid detections of the same note\n                const now = Date.now();\n                if (\n                    result.midi !== this.lastDetectedMidi ||\n                    now - this.lastDetectedTime > this.noteDebounceMs\n                ) {\n                    this.emitPitchDetected({\n                        frequency: result.frequency,\n                        midi: result.midi,\n                        cents: result.cents,\n                        clarity: result.clarity,\n                        noteName: midiToNoteName(result.midi),\n                        timestamp: now\n                    });\n\n                    this.lastDetectedMidi = result.midi;\n                    this.lastDetectedTime = now;\n                }\n            }\n        } catch (error) {\n            console.error('Error in pitch detection loop:', error);\n            // Don't stop the loop on error, just log and continue\n        }\n\n        // Continue loop\n        if (this.isListening) {\n            this.animationFrameId = requestAnimationFrame(() => this.detectPitchLoop());\n        }\n    }\n\n    /**\n     * Calculate RMS (Root Mean Square) for audio level\n     */\n    private calculateRMS(buffer: Float32Array<ArrayBuffer>): number {\n        let sum = 0;\n        for (let i = 0; i < buffer.length; i++) {\n            sum += buffer[i] * buffer[i];\n        }\n        return Math.sqrt(sum / buffer.length);\n    }\n\n    /**\n     * Disconnect microphone and clean up resources\n     */\n    disconnect(): void {\n        this.stopListening();\n\n        if (this.microphone) {\n            this.microphone.disconnect();\n            this.microphone = null;\n        }\n\n        if (this.stream) {\n            this.stream.getTracks().forEach(track => track.stop());\n            this.stream = null;\n        }\n\n        if (this.audioContext) {\n            this.audioContext.close();\n            this.audioContext = null;\n        }\n\n        this.analyser = null;\n        this.pitchDetector = null;\n        this.buffer = null;\n\n        this.emitStatusChange({ listening: false, microphoneActive: false });\n        console.log('Audio Manager disconnected');\n    }\n\n    /**\n     * Update configuration\n     */\n    updateConfig(config: Partial<AudioConfig>): void {\n        this.config = { ...this.config, ...config };\n\n        if (this.pitchDetector) {\n            this.pitchDetector.updateConfig({\n                minClarity: this.config.minClarity,\n                minFrequency: this.config.minFrequency,\n                maxFrequency: this.config.maxFrequency\n            });\n        }\n\n        if (this.analyser) {\n            this.analyser.smoothingTimeConstant = this.config.smoothing;\n        }\n    }\n\n    /**\n     * Set note debounce time\n     */\n    setDebounceTime(ms: number): void {\n        this.noteDebounceMs = Math.max(0, ms);\n    }\n\n    /**\n     * Register an event listener\n     */\n    on<T extends EventType>(event: T, callback: Listeners[T][number]): void {\n        if (this.listeners[event]) {\n            this.listeners[event].push(callback as any);\n        } else {\n            console.warn('Unknown event type:', event);\n        }\n    }\n\n    /**\n     * Remove an event listener\n     */\n    off<T extends EventType>(event: T, callback: Listeners[T][number]): void {\n        if (this.listeners[event]) {\n            const index = this.listeners[event].indexOf(callback as any);\n            if (index > -1) {\n                this.listeners[event].splice(index, 1);\n            }\n        }\n    }\n\n    /**\n     * Emit pitch detected event\n     */\n    private emitPitchDetected(data: PitchDetectedEvent): void {\n        this.listeners.pitchDetected.forEach(callback => {\n            try {\n                callback(data);\n            } catch (error) {\n                console.error('Error in pitchDetected listener:', error);\n            }\n        });\n    }\n\n    /**\n     * Emit audio level event\n     */\n    private emitAudioLevel(level: number): void {\n        this.listeners.audioLevel.forEach(callback => {\n            try {\n                callback({ level, timestamp: Date.now() });\n            } catch (error) {\n                console.error('Error in audioLevel listener:', error);\n            }\n        });\n    }\n\n    /**\n     * Emit error event\n     */\n    private emitError(message: string, error?: Error): void {\n        this.listeners.error.forEach(callback => {\n            try {\n                callback({ message, error });\n            } catch (err) {\n                console.error('Error in error listener:', err);\n            }\n        });\n    }\n\n    /**\n     * Emit status change event\n     */\n    private emitStatusChange(status: StatusChangeEvent): void {\n        this.listeners.statusChange.forEach(callback => {\n            try {\n                callback(status);\n            } catch (error) {\n                console.error('Error in statusChange listener:', error);\n            }\n        });\n    }\n\n    /**\n     * Get current audio level (0-1)\n     */\n    getCurrentLevel(): number {\n        if (!this.buffer) return 0;\n        return this.calculateRMS(this.buffer);\n    }\n\n    /**\n     * Check if microphone is active\n     */\n    isMicrophoneActive(): boolean {\n        return this.stream !== null && this.audioContext !== null;\n    }\n\n    /**\n     * Check if currently listening\n     */\n    isCurrentlyListening(): boolean {\n        return this.isListening;\n    }\n\n    /**\n     * Get audio context sample rate\n     */\n    getSampleRate(): number {\n        return this.audioContext?.sampleRate || 44100;\n    }\n\n    /**\n     * Simulate frequency detection (for testing without microphone)\n     */\n    simulateFrequency(frequency: number): void {\n        const midi = Math.round(12 * Math.log2(frequency / 440) + 69);\n        this.emitPitchDetected({\n            frequency,\n            midi,\n            cents: 0,\n            clarity: 1.0,\n            noteName: midiToNoteName(midi),\n            timestamp: Date.now()\n        });\n    }\n\n    /**\n     * Get available audio input devices\n     */\n    static async getAudioInputDevices(): Promise<MediaDeviceInfo[]> {\n        try {\n            // First request permission to enumerate devices\n            await navigator.mediaDevices.getUserMedia({ audio: true });\n\n            // Then enumerate all devices\n            const devices = await navigator.mediaDevices.enumerateDevices();\n            return devices.filter(device => device.kind === 'audioinput');\n        } catch (error) {\n            console.error('Failed to enumerate audio devices:', error);\n            return [];\n        }\n    }\n\n    /**\n     * Get the currently active audio input device\n     */\n    getActiveDevice(): MediaDeviceInfo | null {\n        if (!this.stream) return null;\n\n        const audioTrack = this.stream.getAudioTracks()[0];\n        if (!audioTrack) return null;\n\n        // Return basic device info from the track\n        return {\n            deviceId: audioTrack.getSettings().deviceId || '',\n            groupId: audioTrack.getSettings().groupId || '',\n            kind: 'audioinput',\n            label: audioTrack.label,\n            toJSON: () => ({})\n        } as MediaDeviceInfo;\n    }\n\n    /**\n     * Check if microphone access is supported\n     */\n    static isSupported(): boolean {\n        return !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);\n    }\n}\n\n// Make available globally for legacy code\nif (typeof window !== 'undefined') {\n    (window as any).AudioManager = AudioManager;\n}\n","/**\n * Staff Renderer\n * Uses VexFlow to render musical notation on staff\n */\n\nimport { MusicTheory } from '../utils/music-theory.js';\n\n// VexFlow types (declare global types for VexFlow library)\ndeclare global {\n    interface Window {\n        Vex: any;\n    }\n    const Vex: any;\n}\n\n// Type definitions\nexport type ClefType = 'treble' | 'bass';\n\ninterface RenderOptions {\n    highlight?: boolean;\n}\n\nexport class StaffRenderer {\n    private containerId: string;\n    private container: HTMLElement | null;\n    private renderer: any = null;\n    private context: any = null;\n    private currentNote: string | null = null;\n    private clef: ClefType = 'treble';\n\n    constructor(containerId: string) {\n        this.containerId = containerId;\n        this.container = document.getElementById(containerId);\n\n        if (!this.container) {\n            console.error('Container not found:', containerId);\n            return;\n        }\n\n        this.init();\n    }\n\n    /**\n     * Initialize VexFlow renderer\n     */\n    private init(): void {\n        try {\n            // Check if VexFlow is loaded\n            if (typeof Vex === 'undefined') {\n                console.error('VexFlow not loaded');\n                return;\n            }\n\n            if (!this.container) return;\n\n            // Clear container\n            this.container.innerHTML = '';\n\n            // Create VexFlow renderer\n            const VF = Vex.Flow;\n            this.renderer = new VF.Renderer(\n                this.container,\n                VF.Renderer.Backends.SVG\n            );\n\n            // Size the canvas\n            this.renderer.resize(500, 200);\n\n            // Get drawing context\n            this.context = this.renderer.getContext();\n\n            console.log('StaffRenderer initialized');\n        } catch (error) {\n            console.error('Failed to initialize StaffRenderer:', error);\n        }\n    }\n\n    /**\n     * Set the clef type\n     * @param clef - 'treble' or 'bass'\n     */\n    setClef(clef: ClefType): void {\n        this.clef = clef;\n    }\n\n    /**\n     * Render a single note on the staff\n     * @param vexflowNote - Note in VexFlow format (e.g., \"c/4\")\n     * @param options - Rendering options\n     */\n    renderNote(vexflowNote: string, options: RenderOptions = {}): void {\n        if (!this.context) {\n            console.error('Renderer not initialized');\n            return;\n        }\n\n        try {\n            const VF = Vex.Flow;\n\n            if (!this.container) return;\n\n            // Clear previous content\n            this.context.clear();\n            this.container.innerHTML = '';\n\n            // Recreate context after clear\n            this.renderer = new VF.Renderer(\n                this.container,\n                VF.Renderer.Backends.SVG\n            );\n            this.renderer.resize(500, 200);\n            this.context = this.renderer.getContext();\n\n            // Create a stave\n            const stave = new VF.Stave(10, 20, 400);\n\n            // Add clef\n            stave.addClef(this.clef);\n\n            // Draw the stave\n            stave.setContext(this.context).draw();\n\n            // Create note\n            const note = new VF.StaveNote({\n                keys: [vexflowNote],\n                duration: 'w', // Whole note\n                clef: this.clef\n            });\n\n            // Create a voice and add the note\n            const voice = new VF.Voice({\n                num_beats: 4,\n                beat_value: 4\n            });\n            voice.addTickable(note);\n\n            // Format and draw\n            new VF.Formatter()\n                .joinVoices([voice])\n                .format([voice], 350);\n\n            voice.draw(this.context, stave);\n\n            this.currentNote = vexflowNote;\n\n            // Apply highlight if specified\n            if (options.highlight) {\n                this.highlightNote();\n            }\n\n        } catch (error) {\n            console.error('Failed to render note:', error);\n            this.showError('Unable to display note');\n        }\n    }\n\n    /**\n     * Render multiple notes on the staff\n     * @param notes - Array of VexFlow notes\n     */\n    renderNotes(notes: string[]): void {\n        if (!this.context) {\n            console.error('Renderer not initialized');\n            return;\n        }\n\n        try {\n            const VF = Vex.Flow;\n\n            if (!this.container) return;\n\n            // Clear previous content\n            this.context.clear();\n            this.container.innerHTML = '';\n\n            // Recreate context\n            this.renderer = new VF.Renderer(\n                this.container,\n                VF.Renderer.Backends.SVG\n            );\n            this.renderer.resize(700, 200);\n            this.context = this.renderer.getContext();\n\n            // Create a stave\n            const stave = new VF.Stave(10, 20, 650);\n            stave.addClef(this.clef);\n            stave.setContext(this.context).draw();\n\n            // Create notes\n            const staveNotes = notes.map(note => {\n                return new VF.StaveNote({\n                    keys: [note],\n                    duration: 'q', // Quarter note\n                    clef: this.clef\n                });\n            });\n\n            // Create a voice\n            const voice = new VF.Voice({\n                num_beats: staveNotes.length,\n                beat_value: 4\n            });\n            voice.addTickables(staveNotes);\n\n            // Format and draw\n            new VF.Formatter()\n                .joinVoices([voice])\n                .format([voice], 600);\n\n            voice.draw(this.context, stave);\n\n        } catch (error) {\n            console.error('Failed to render notes:', error);\n            this.showError('Unable to display notes');\n        }\n    }\n\n    /**\n     * Render a scale on the staff\n     * @param midiNotes - Array of MIDI note numbers\n     */\n    renderScale(midiNotes: number[]): void {\n        const vexflowNotes = midiNotes\n            .map(midi => MusicTheory.midiToVexflow(midi, this.clef))\n            .filter((note): note is string => note !== null);\n\n        if (vexflowNotes.length > 0) {\n            this.renderNotes(vexflowNotes);\n        }\n    }\n\n    /**\n     * Highlight the current note (visual feedback)\n     */\n    private highlightNote(): void {\n        if (!this.container) return;\n\n        // Add a visual highlight to the SVG\n        const svg = this.container.querySelector('svg');\n        if (svg) {\n            const noteheads = svg.querySelectorAll('.vf-notehead');\n            noteheads.forEach(notehead => {\n                (notehead as HTMLElement).style.fill = '#3b82f6';\n            });\n        }\n    }\n\n    /**\n     * Show feedback for correct/incorrect note\n     * @param isCorrect - Whether the note was correct\n     */\n    showFeedback(isCorrect: boolean): void {\n        if (!this.container) return;\n\n        const svg = this.container.querySelector('svg');\n        if (!svg) return;\n\n        const noteheads = svg.querySelectorAll('.vf-notehead');\n        const color = isCorrect ? '#10b981' : '#ef4444';\n\n        noteheads.forEach(notehead => {\n            const element = notehead as HTMLElement;\n            element.style.fill = color;\n            element.style.transition = 'fill 0.3s ease';\n        });\n\n        // Reset after animation\n        setTimeout(() => {\n            noteheads.forEach(notehead => {\n                (notehead as HTMLElement).style.fill = '';\n            });\n        }, 500);\n    }\n\n    /**\n     * Show error message\n     * @param message - Error message to display\n     */\n    private showError(message: string): void {\n        if (!this.container) return;\n\n        this.container.innerHTML = `\n            <div style=\"\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                height: 200px;\n                color: var(--text-secondary);\n                font-size: 1rem;\n            \">\n                ${message}\n            </div>\n        `;\n    }\n\n    /**\n     * Show welcome message\n     */\n    showWelcome(): void {\n        if (!this.container) return;\n\n        this.container.innerHTML = `\n            <div style=\"\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n                height: 200px;\n                color: var(--text-secondary);\n                text-align: center;\n                padding: 2rem;\n            \">\n                <p style=\"font-size: 3rem; margin-bottom: 0.5rem;\"></p>\n                <p style=\"font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;\">\n                    Ready to Practice\n                </p>\n                <p style=\"font-size: 0.95rem;\">\n                    Click \"Start Practice\" to begin\n                </p>\n            </div>\n        `;\n    }\n\n    /**\n     * Clear the staff\n     */\n    clear(): void {\n        if (this.context) {\n            this.context.clear();\n        }\n        if (this.container) {\n            this.container.innerHTML = '';\n        }\n        this.currentNote = null;\n    }\n\n    /**\n     * Get the current note\n     * @returns Current VexFlow note\n     */\n    getCurrentNote(): string | null {\n        return this.currentNote;\n    }\n}\n\n// Make available globally\nif (typeof window !== 'undefined') {\n    (window as any).StaffRenderer = StaffRenderer;\n}\n","/**\n * Falling Notes Renderer\n * Alternative visualization mode with notes falling from top to hit zone\n * Inspired by rhythm games and Synthesia\n */\n\n// Type definitions\ninterface NoteConfig {\n    noteWidth: number;\n    noteHeight: number;\n    fallSpeed: number;\n    hitZoneY: number;\n    hitZoneHeight: number;\n    colors: {\n        note: string;\n        hitZone: string;\n        hitZoneBorder: string;\n        correct: string;\n        incorrect: string;\n    };\n}\n\ninterface FallingNote {\n    midiNote: number;\n    noteName: string;\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    color: string;\n    hit: boolean;\n    missed: boolean;\n}\n\nexport class FallingNotesRenderer {\n    private containerId: string;\n    private container: HTMLElement | null;\n    private canvas: HTMLCanvasElement | null = null;\n    private ctx: CanvasRenderingContext2D | null = null;\n    private animationId: number | null = null;\n    private notes: FallingNote[] = [];\n    private currentTargetNote: FallingNote | null = null;\n    private isAnimating: boolean = false;\n\n    // Configuration\n    private config: NoteConfig = {\n        noteWidth: 80,\n        noteHeight: 20,\n        fallSpeed: 2, // pixels per frame\n        hitZoneY: 350, // Y position of hit zone\n        hitZoneHeight: 40,\n        colors: {\n            note: '#3b82f6',\n            hitZone: 'rgba(59, 130, 246, 0.2)',\n            hitZoneBorder: '#3b82f6',\n            correct: '#10b981',\n            incorrect: '#ef4444'\n        }\n    };\n\n    constructor(containerId: string) {\n        this.containerId = containerId;\n        this.container = document.getElementById(containerId);\n\n        if (!this.container) {\n            console.error('Container not found:', containerId);\n            return;\n        }\n\n        this.init();\n    }\n\n    /**\n     * Initialize canvas\n     */\n    private init(): void {\n        try {\n            // Create canvas\n            this.canvas = document.createElement('canvas');\n            this.canvas.width = 600;\n            this.canvas.height = 400;\n            this.canvas.style.width = '100%';\n            this.canvas.style.height = '100%';\n\n            if (!this.container) return;\n\n            this.container.innerHTML = '';\n            this.container.appendChild(this.canvas);\n\n            this.ctx = this.canvas.getContext('2d');\n\n            console.log('FallingNotesRenderer initialized');\n        } catch (error) {\n            console.error('Failed to initialize FallingNotesRenderer:', error);\n        }\n    }\n\n    /**\n     * Add a new falling note\n     * @param midiNote - MIDI note number\n     * @param noteName - Note name for display\n     */\n    addNote(midiNote: number, noteName: string): void {\n        if (!this.canvas) return;\n\n        const note: FallingNote = {\n            midiNote,\n            noteName,\n            x: (this.canvas.width - this.config.noteWidth) / 2,\n            y: 0,\n            width: this.config.noteWidth,\n            height: this.config.noteHeight,\n            color: this.config.colors.note,\n            hit: false,\n            missed: false\n        };\n\n        this.notes.push(note);\n        this.currentTargetNote = note;\n\n        // Start animation if not running\n        if (!this.isAnimating) {\n            this.startAnimation();\n        }\n    }\n\n    /**\n     * Start the animation loop\n     */\n    startAnimation(): void {\n        this.isAnimating = true;\n        this.animate();\n    }\n\n    /**\n     * Stop the animation loop\n     */\n    stopAnimation(): void {\n        this.isAnimating = false;\n        if (this.animationId !== null) {\n            cancelAnimationFrame(this.animationId);\n            this.animationId = null;\n        }\n    }\n\n    /**\n     * Animation loop\n     */\n    private animate(): void {\n        if (!this.isAnimating || !this.ctx || !this.canvas) return;\n\n        // Clear canvas\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\n        // Draw hit zone\n        this.drawHitZone();\n\n        // Update and draw notes\n        this.notes = this.notes.filter(note => {\n            // Move note down\n            note.y += this.config.fallSpeed;\n\n            // Check if note passed the hit zone (missed)\n            if (note.y > this.config.hitZoneY + this.config.hitZoneHeight && !note.hit) {\n                note.missed = true;\n                note.color = this.config.colors.incorrect;\n            }\n\n            // Draw note\n            this.drawNote(note);\n\n            // Remove notes that have fallen off screen\n            return note.y < this.canvas!.height + 50;\n        });\n\n        // Continue animation\n        this.animationId = requestAnimationFrame(() => this.animate());\n    }\n\n    /**\n     * Draw the hit zone\n     */\n    private drawHitZone(): void {\n        if (!this.ctx || !this.canvas) return;\n\n        const ctx = this.ctx;\n        const y = this.config.hitZoneY;\n        const height = this.config.hitZoneHeight;\n\n        // Fill\n        ctx.fillStyle = this.config.colors.hitZone;\n        ctx.fillRect(0, y, this.canvas.width, height);\n\n        // Border\n        ctx.strokeStyle = this.config.colors.hitZoneBorder;\n        ctx.lineWidth = 2;\n        ctx.strokeRect(0, y, this.canvas.width, height);\n\n        // Hit zone label\n        ctx.fillStyle = this.config.colors.hitZoneBorder;\n        ctx.font = '14px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText('Play here', this.canvas.width / 2, y + height / 2 + 5);\n    }\n\n    /**\n     * Draw a note\n     * @param note - Note object\n     */\n    private drawNote(note: FallingNote): void {\n        if (!this.ctx) return;\n\n        const ctx = this.ctx;\n\n        // Note rectangle\n        ctx.fillStyle = note.color;\n        ctx.fillRect(note.x, note.y, note.width, note.height);\n\n        // Note border\n        ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';\n        ctx.lineWidth = 1;\n        ctx.strokeRect(note.x, note.y, note.width, note.height);\n\n        // Note label\n        ctx.fillStyle = 'white';\n        ctx.font = 'bold 14px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n        ctx.fillText(note.noteName, note.x + note.width / 2, note.y + note.height / 2);\n    }\n\n    /**\n     * Check if a played note matches the target\n     * @param playedMidi - MIDI note that was played\n     * @returns True if correct\n     */\n    checkNote(playedMidi: number): boolean {\n        if (!this.currentTargetNote || this.currentTargetNote.hit) {\n            return false;\n        }\n\n        // Check if note is in hit zone\n        const note = this.currentTargetNote;\n        const inHitZone = note.y >= this.config.hitZoneY - 20 &&\n                         note.y <= this.config.hitZoneY + this.config.hitZoneHeight + 20;\n\n        if (inHitZone && note.midiNote === playedMidi) {\n            // Correct note!\n            note.hit = true;\n            note.color = this.config.colors.correct;\n            this.currentTargetNote = null;\n            return true;\n        } else if (inHitZone) {\n            // Wrong note\n            note.color = this.config.colors.incorrect;\n            return false;\n        }\n\n        return false;\n    }\n\n    /**\n     * Set the falling speed\n     * @param speed - Pixels per frame\n     */\n    setSpeed(speed: number): void {\n        this.config.fallSpeed = speed;\n    }\n\n    /**\n     * Clear all notes\n     */\n    clear(): void {\n        this.notes = [];\n        this.currentTargetNote = null;\n        if (this.ctx && this.canvas) {\n            this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        }\n    }\n\n    /**\n     * Show welcome message\n     */\n    showWelcome(): void {\n        if (!this.ctx || !this.canvas) return;\n\n        this.clear();\n        this.stopAnimation();\n\n        const ctx = this.ctx;\n        ctx.fillStyle = 'var(--text-secondary)';\n        ctx.font = '48px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText('', this.canvas.width / 2, this.canvas.height / 2 - 40);\n\n        ctx.font = '18px sans-serif';\n        ctx.fillText('Falling Notes Mode', this.canvas.width / 2, this.canvas.height / 2 + 20);\n\n        ctx.font = '14px sans-serif';\n        ctx.fillText('Notes will fall from top - play them when they reach the hit zone',\n                    this.canvas.width / 2, this.canvas.height / 2 + 50);\n    }\n\n    /**\n     * Destroy the renderer\n     */\n    destroy(): void {\n        this.stopAnimation();\n        this.notes = [];\n        this.currentTargetNote = null;\n        if (this.container) {\n            this.container.innerHTML = '';\n        }\n    }\n}\n\n// Make available globally\nif (typeof window !== 'undefined') {\n    (window as any).FallingNotesRenderer = FallingNotesRenderer;\n}\n","/**\n * Storage Utilities\n * Handles local storage for progress tracking and session data\n */\n\n// Type definitions\nexport interface ModuleStats {\n    sessions: number;\n    correct: number;\n    incorrect: number;\n}\n\nexport interface Stats {\n    totalSessions: number;\n    totalCorrect: number;\n    totalIncorrect: number;\n    totalNotes: number;\n    avgResponseTime: number;\n    bestStreak: number;\n    lastPracticeDate: number | null;\n    byModule: Record<string, ModuleStats>;\n}\n\nexport interface SessionData {\n    module?: string;\n    correct?: number;\n    incorrect?: number;\n    avgResponseTime?: number;\n    bestStreak?: number;\n    instrument?: string;\n    clef?: string;\n    range?: string;\n    timestamp?: number;\n    id?: string;\n    [key: string]: any; // Allow additional properties\n}\n\nexport interface Session extends SessionData {\n    timestamp: number;\n    id: string;\n}\n\nexport interface Settings {\n    theme: 'light' | 'dark';\n    clef: 'treble' | 'bass';\n    range: string;\n    fallingNotesMode: boolean;\n    allowOctaveError: boolean;\n    midiDeviceId: string | null;\n    audioDeviceId: string | null;\n    virtualKeyboard: boolean;\n    instrument?: string;\n    pitchTolerance?: number;\n    [key: string]: any; // Allow additional settings\n}\n\nexport interface ExportData {\n    sessions: Session[];\n    stats: Stats;\n    settings: Settings;\n    exportDate: number;\n}\n\n// Storage keys\nconst KEYS = {\n    SESSIONS: 'music_practice_sessions',\n    SETTINGS: 'music_practice_settings',\n    STATS: 'music_practice_stats'\n} as const;\n\n/**\n * Check if localStorage is available\n */\nfunction isLocalStorageAvailable(): boolean {\n    try {\n        return typeof window !== 'undefined' && typeof localStorage !== 'undefined';\n    } catch {\n        return false;\n    }\n}\n\n/**\n * Save a practice session\n */\nexport function saveSession(sessionData: SessionData): void {\n    if (!isLocalStorageAvailable()) {\n        console.warn('localStorage not available');\n        return;\n    }\n\n    try {\n        const sessions = getSessions();\n        const newSession: Session = {\n            ...sessionData,\n            timestamp: Date.now(),\n            id: generateId()\n        };\n        sessions.push(newSession);\n\n        // Keep only last 100 sessions\n        if (sessions.length > 100) {\n            sessions.shift();\n        }\n\n        localStorage.setItem(KEYS.SESSIONS, JSON.stringify(sessions));\n        updateStats(sessionData);\n    } catch (error) {\n        console.error('Error saving session:', error);\n    }\n}\n\n/**\n * Get all saved sessions\n */\nexport function getSessions(): Session[] {\n    if (!isLocalStorageAvailable()) {\n        return [];\n    }\n\n    try {\n        const data = localStorage.getItem(KEYS.SESSIONS);\n        return data ? JSON.parse(data) : [];\n    } catch (error) {\n        console.error('Error loading sessions:', error);\n        return [];\n    }\n}\n\n/**\n * Get sessions by instrument\n */\nexport function getSessionsByInstrument(instrumentId: string): Session[] {\n    return getSessions().filter(session => session.instrument === instrumentId);\n}\n\n/**\n * Update overall statistics\n */\nexport function updateStats(sessionData: SessionData): void {\n    if (!isLocalStorageAvailable()) {\n        return;\n    }\n\n    try {\n        const stats = getStats();\n\n        // Update counts\n        stats.totalSessions++;\n        stats.totalCorrect += sessionData.correct || 0;\n        stats.totalIncorrect += sessionData.incorrect || 0;\n        stats.totalNotes += (sessionData.correct || 0) + (sessionData.incorrect || 0);\n\n        // Update averages\n        if (sessionData.avgResponseTime) {\n            const totalTime = stats.avgResponseTime * (stats.totalSessions - 1) + sessionData.avgResponseTime;\n            stats.avgResponseTime = totalTime / stats.totalSessions;\n        }\n\n        // Track best streak\n        if ((sessionData.bestStreak || 0) > stats.bestStreak) {\n            stats.bestStreak = sessionData.bestStreak || 0;\n        }\n\n        // Track by module\n        const module = sessionData.module || 'sightReading';\n        if (!stats.byModule[module]) {\n            stats.byModule[module] = {\n                sessions: 0,\n                correct: 0,\n                incorrect: 0\n            };\n        }\n\n        stats.byModule[module].sessions++;\n        stats.byModule[module].correct += sessionData.correct || 0;\n        stats.byModule[module].incorrect += sessionData.incorrect || 0;\n\n        // Save last practice date\n        stats.lastPracticeDate = Date.now();\n\n        localStorage.setItem(KEYS.STATS, JSON.stringify(stats));\n    } catch (error) {\n        console.error('Error updating stats:', error);\n    }\n}\n\n/**\n * Get overall statistics\n */\nexport function getStats(): Stats {\n    if (!isLocalStorageAvailable()) {\n        return getDefaultStats();\n    }\n\n    try {\n        const data = localStorage.getItem(KEYS.STATS);\n        return data ? JSON.parse(data) : getDefaultStats();\n    } catch (error) {\n        console.error('Error loading stats:', error);\n        return getDefaultStats();\n    }\n}\n\n/**\n * Get default statistics object\n */\nexport function getDefaultStats(): Stats {\n    return {\n        totalSessions: 0,\n        totalCorrect: 0,\n        totalIncorrect: 0,\n        totalNotes: 0,\n        avgResponseTime: 0,\n        bestStreak: 0,\n        lastPracticeDate: null,\n        byModule: {}\n    };\n}\n\n/**\n * Save user settings\n */\nexport function saveSettings(settings: Partial<Settings>): void {\n    if (!isLocalStorageAvailable()) {\n        console.warn('localStorage not available');\n        return;\n    }\n\n    try {\n        const currentSettings = getSettings();\n        const updatedSettings = { ...currentSettings, ...settings };\n        localStorage.setItem(KEYS.SETTINGS, JSON.stringify(updatedSettings));\n    } catch (error) {\n        console.error('Error saving settings:', error);\n    }\n}\n\n/**\n * Get user settings\n */\nexport function getSettings(): Settings {\n    if (!isLocalStorageAvailable()) {\n        return getDefaultSettings();\n    }\n\n    try {\n        const data = localStorage.getItem(KEYS.SETTINGS);\n        return data ? JSON.parse(data) : getDefaultSettings();\n    } catch (error) {\n        console.error('Error loading settings:', error);\n        return getDefaultSettings();\n    }\n}\n\n/**\n * Get default settings\n */\nexport function getDefaultSettings(): Settings {\n    return {\n        theme: 'light',\n        clef: 'treble',\n        range: 'c4-c5',\n        fallingNotesMode: false,\n        allowOctaveError: true,\n        midiDeviceId: null,\n        virtualKeyboard: false,\n        instrument: 'piano',\n        pitchTolerance: 50\n    };\n}\n\n/**\n * Clear all data (keep settings)\n */\nexport function clearAll(): void {\n    if (!isLocalStorageAvailable()) {\n        return;\n    }\n\n    try {\n        localStorage.removeItem(KEYS.SESSIONS);\n        localStorage.removeItem(KEYS.STATS);\n        // Keep settings\n    } catch (error) {\n        console.error('Error clearing data:', error);\n    }\n}\n\n/**\n * Clear all data including settings\n */\nexport function clearAllIncludingSettings(): void {\n    if (!isLocalStorageAvailable()) {\n        return;\n    }\n\n    try {\n        localStorage.removeItem(KEYS.SESSIONS);\n        localStorage.removeItem(KEYS.STATS);\n        localStorage.removeItem(KEYS.SETTINGS);\n    } catch (error) {\n        console.error('Error clearing data:', error);\n    }\n}\n\n/**\n * Export data as JSON\n */\nexport function exportData(): string {\n    return JSON.stringify({\n        sessions: getSessions(),\n        stats: getStats(),\n        settings: getSettings(),\n        exportDate: Date.now()\n    }, null, 2);\n}\n\n/**\n * Import data from JSON\n */\nexport function importData(jsonData: string): boolean {\n    if (!isLocalStorageAvailable()) {\n        console.warn('localStorage not available');\n        return false;\n    }\n\n    try {\n        const data: Partial<ExportData> = JSON.parse(jsonData);\n\n        if (data.sessions) {\n            localStorage.setItem(KEYS.SESSIONS, JSON.stringify(data.sessions));\n        }\n        if (data.stats) {\n            localStorage.setItem(KEYS.STATS, JSON.stringify(data.stats));\n        }\n        if (data.settings) {\n            localStorage.setItem(KEYS.SETTINGS, JSON.stringify(data.settings));\n        }\n\n        return true;\n    } catch (error) {\n        console.error('Error importing data:', error);\n        return false;\n    }\n}\n\n/**\n * Generate a unique ID\n */\nexport function generateId(): string {\n    return Date.now().toString(36) + Math.random().toString(36).substr(2);\n}\n\n// Export as namespace for backward compatibility\nexport const Storage = {\n    KEYS,\n    saveSession,\n    getSessions,\n    getSessionsByInstrument,\n    updateStats,\n    getStats,\n    getDefaultStats,\n    saveSettings,\n    getSettings,\n    getDefaultSettings,\n    clearAll,\n    clearAllIncludingSettings,\n    exportData,\n    importData,\n    generateId\n};\n\n// Make available globally for legacy code\nif (typeof window !== 'undefined') {\n    (window as any).Storage = Storage;\n}\n","/**\n * Instrument Configuration System\n * Defines profiles for different instruments with input methods, ranges, and settings\n */\n\n// Instrument type constants\nexport const InstrumentType = {\n    PIANO: 'piano',\n    VIOLIN: 'violin',\n    GUITAR: 'guitar'\n} as const;\n\nexport type InstrumentTypeValue = typeof InstrumentType[keyof typeof InstrumentType];\n\n// Input method constants\nexport const InputMethod = {\n    MIDI: 'midi',\n    MICROPHONE: 'microphone'\n} as const;\n\nexport type InputMethodValue = typeof InputMethod[keyof typeof InputMethod];\n\n// Clef constants\nexport const Clef = {\n    TREBLE: 'treble',\n    BASS: 'bass'\n} as const;\n\nexport type ClefValue = typeof Clef[keyof typeof Clef];\n\n// Type definitions\nexport interface NoteRange {\n    min: number;\n    max: number;\n}\n\nexport interface RangeConfig {\n    min: number;\n    max: number;\n    default: NoteRange;\n}\n\nexport interface TuningInfo {\n    note: string;\n    midi: number;\n    frequency: number;\n    string?: number;\n}\n\nexport interface ValidationConfig {\n    exactMatch: boolean;\n    pitchTolerance: number;\n    pitchToleranceAdvanced?: number;\n    octaveFlexible: boolean;\n    minDuration: number;\n    minClarity?: number;\n}\n\nexport interface PracticeConfig {\n    defaultNoteCount: number;\n    adaptiveDifficulty: boolean;\n    supportedModes: string[];\n    calibrationRequired?: boolean;\n    tuningCheckRecommended?: boolean;\n    fretIndependent?: boolean;\n}\n\nexport interface UIConfig {\n    showVirtualKeyboard: boolean;\n    showMidiStatus: boolean;\n    showPitchAccuracy: boolean;\n    showMicrophoneLevel?: boolean;\n    showTuningReference?: boolean;\n    showCentsDeviation?: boolean;\n    showFretboardReference?: boolean;\n}\n\nexport interface AudioConfig {\n    bufferSize: number;\n    noiseGate: number;\n    minFrequency: number;\n    maxFrequency: number;\n}\n\nexport interface InstrumentConfig {\n    id: InstrumentTypeValue;\n    name: string;\n    displayName: string;\n    emoji: string;\n    inputType: InputMethodValue;\n    range: RangeConfig;\n    clefs: ClefValue[];\n    defaultClef: ClefValue;\n    polyphonic: boolean;\n    requiresSustain: boolean;\n    tuning?: TuningInfo[];\n    validation: ValidationConfig;\n    practice: PracticeConfig;\n    ui: UIConfig;\n    audio?: AudioConfig;\n}\n\n/**\n * Instrument configuration profiles\n * Each profile defines all settings needed for instrument-specific practice\n */\nexport const INSTRUMENTS: Record<InstrumentTypeValue, InstrumentConfig> = {\n    [InstrumentType.PIANO]: {\n        id: InstrumentType.PIANO,\n        name: 'Piano',\n        displayName: 'Piano/Keyboard',\n        emoji: '',\n        inputType: InputMethod.MIDI,\n\n        // Range settings (MIDI note numbers)\n        range: {\n            min: 21,  // A0\n            max: 108, // C8\n            default: {\n                min: 48,  // C3\n                max: 84   // C6\n            }\n        },\n\n        // Clef settings\n        clefs: [Clef.TREBLE, Clef.BASS],\n        defaultClef: Clef.TREBLE,\n\n        // Input capabilities\n        polyphonic: true,  // Can detect multiple simultaneous notes\n        requiresSustain: false,\n\n        // Validation settings\n        validation: {\n            exactMatch: true,  // MIDI requires exact note match\n            pitchTolerance: 0, // No tolerance for MIDI\n            octaveFlexible: false, // Can enable for practice mode\n            minDuration: 0 // No minimum duration required\n        },\n\n        // Practice settings\n        practice: {\n            defaultNoteCount: 20,\n            adaptiveDifficulty: true,\n            supportedModes: ['sight-reading', 'scales', 'chords', 'arpeggios', 'key-signatures']\n        },\n\n        // UI settings\n        ui: {\n            showVirtualKeyboard: true,\n            showMidiStatus: true,\n            showPitchAccuracy: false\n        }\n    },\n\n    [InstrumentType.VIOLIN]: {\n        id: InstrumentType.VIOLIN,\n        name: 'Violin',\n        displayName: 'Violin',\n        emoji: '',\n        inputType: InputMethod.MICROPHONE,\n\n        // Range settings (MIDI note numbers)\n        range: {\n            min: 55,  // G3\n            max: 91,  // G6 (extended range)\n            default: {\n                min: 60,  // C4 (first position, beginner friendly)\n                max: 72   // C5 (one octave, first position only)\n            }\n        },\n\n        // Clef settings\n        clefs: [Clef.TREBLE],\n        defaultClef: Clef.TREBLE,\n\n        // Input capabilities\n        polyphonic: false,  // Monophonic pitch detection\n        requiresSustain: true,\n\n        // String tuning (open strings in scientific pitch notation)\n        tuning: [\n            { note: 'G3', midi: 55, frequency: 196.00 },\n            { note: 'D4', midi: 62, frequency: 293.66 },\n            { note: 'A4', midi: 69, frequency: 440.00 },\n            { note: 'E5', midi: 76, frequency: 659.26 }\n        ],\n\n        // Validation settings\n        validation: {\n            exactMatch: false,\n            pitchTolerance: 50,  // 50 cents for beginners\n            pitchToleranceAdvanced: 20, // 20 cents for advanced\n            octaveFlexible: false,\n            minDuration: 500, // 500ms minimum note sustain\n            minClarity: 0.80  // 80% pitch clarity threshold\n        },\n\n        // Practice settings\n        practice: {\n            defaultNoteCount: 15,\n            adaptiveDifficulty: true,\n            supportedModes: ['sight-reading', 'scales', 'arpeggios', 'intonation', 'key-signatures'],\n            calibrationRequired: true, // Require A4 calibration\n            tuningCheckRecommended: true\n        },\n\n        // UI settings\n        ui: {\n            showVirtualKeyboard: false,\n            showMidiStatus: false,\n            showPitchAccuracy: true,\n            showMicrophoneLevel: true,\n            showTuningReference: true,\n            showCentsDeviation: true\n        },\n\n        // Audio processing settings\n        audio: {\n            bufferSize: 2048,  // ~46ms at 44.1kHz\n            noiseGate: -40,    // dB threshold\n            minFrequency: 180, // Hz (below G3)\n            maxFrequency: 1600 // Hz (above G6)\n        }\n    },\n\n    [InstrumentType.GUITAR]: {\n        id: InstrumentType.GUITAR,\n        name: 'Guitar',\n        displayName: 'Guitar',\n        emoji: '',\n        inputType: InputMethod.MICROPHONE,\n\n        // Range settings (MIDI note numbers)\n        range: {\n            min: 40,  // E2\n            max: 88,  // E6 (24th fret on high E)\n            default: {\n                min: 40,  // E2\n                max: 76   // E5 (12th fret on high E)\n            }\n        },\n\n        // Clef settings\n        clefs: [Clef.TREBLE],\n        defaultClef: Clef.TREBLE,\n\n        // Input capabilities\n        polyphonic: false,  // Monophonic for POC (polyphonic future)\n        requiresSustain: true,\n\n        // Standard tuning (EADGBE in scientific pitch notation)\n        tuning: [\n            { note: 'E2', midi: 40, frequency: 82.41, string: 6 },\n            { note: 'A2', midi: 45, frequency: 110.00, string: 5 },\n            { note: 'D3', midi: 50, frequency: 146.83, string: 4 },\n            { note: 'G3', midi: 55, frequency: 196.00, string: 3 },\n            { note: 'B3', midi: 59, frequency: 246.94, string: 2 },\n            { note: 'E4', midi: 64, frequency: 329.63, string: 1 }\n        ],\n\n        // Validation settings\n        validation: {\n            exactMatch: false,\n            pitchTolerance: 50,  // 50 cents (guitar can be slightly out of tune)\n            pitchToleranceAdvanced: 30, // 30 cents for advanced\n            octaveFlexible: false,\n            minDuration: 400, // 400ms minimum (pluck sustain)\n            minClarity: 0.75  // 75% clarity (guitar harmonics can confuse)\n        },\n\n        // Practice settings\n        practice: {\n            defaultNoteCount: 15,\n            adaptiveDifficulty: true,\n            supportedModes: ['sight-reading', 'scales', 'arpeggios', 'key-signatures'],\n            calibrationRequired: false,\n            tuningCheckRecommended: true,\n            fretIndependent: true // Focus on pitch, not fret position\n        },\n\n        // UI settings\n        ui: {\n            showVirtualKeyboard: false,\n            showMidiStatus: false,\n            showPitchAccuracy: true,\n            showMicrophoneLevel: true,\n            showTuningReference: true,\n            showCentsDeviation: true,\n            showFretboardReference: false // Future feature\n        },\n\n        // Audio processing settings\n        audio: {\n            bufferSize: 2048,  // ~46ms at 44.1kHz\n            noiseGate: -35,    // dB threshold (slightly higher due to picking noise)\n            minFrequency: 70,  // Hz (below E2)\n            maxFrequency: 1400 // Hz (above E6 fundamental)\n        }\n    }\n};\n\n/**\n * Get instrument configuration by ID\n */\nexport function getInstrument(instrumentId: string): InstrumentConfig {\n    const instrument = INSTRUMENTS[instrumentId as InstrumentTypeValue];\n    if (!instrument) {\n        console.warn(`Unknown instrument: ${instrumentId}, defaulting to piano`);\n        return INSTRUMENTS[InstrumentType.PIANO];\n    }\n    return instrument;\n}\n\n/**\n * Get list of all instruments\n */\nexport function getAllInstruments(): InstrumentConfig[] {\n    return Object.values(INSTRUMENTS);\n}\n\n/**\n * Get instruments by input method\n */\nexport function getInstrumentsByInputMethod(inputMethod: InputMethodValue): InstrumentConfig[] {\n    return getAllInstruments().filter(inst => inst.inputType === inputMethod);\n}\n\n/**\n * Check if instrument requires microphone\n */\nexport function requiresMicrophone(instrumentId: string): boolean {\n    const instrument = getInstrument(instrumentId);\n    return instrument.inputType === InputMethod.MICROPHONE;\n}\n\n/**\n * Check if instrument requires MIDI\n */\nexport function requiresMIDI(instrumentId: string): boolean {\n    const instrument = getInstrument(instrumentId);\n    return instrument.inputType === InputMethod.MIDI;\n}\n\n/**\n * Get supported modules for an instrument\n */\nexport function getSupportedModules(instrumentId: string): string[] {\n    const instrument = getInstrument(instrumentId);\n    return instrument.practice.supportedModes;\n}\n\n/**\n * Get MIDI note range for an instrument\n */\nexport function getNoteRange(instrumentId: string, useDefault = true): NoteRange {\n    const instrument = getInstrument(instrumentId);\n    return useDefault ? instrument.range.default : {\n        min: instrument.range.min,\n        max: instrument.range.max\n    };\n}\n\n/**\n * Get tuning information for stringed instruments\n */\nexport function getTuning(instrumentId: string): TuningInfo[] | null {\n    const instrument = getInstrument(instrumentId);\n    return instrument.tuning || null;\n}\n\n/**\n * Validate note is within instrument range\n */\nexport function isNoteInRange(instrumentId: string, midiNote: number): boolean {\n    const instrument = getInstrument(instrumentId);\n    return midiNote >= instrument.range.min && midiNote <= instrument.range.max;\n}\n\n/**\n * Get pitch tolerance for an instrument\n */\nexport function getPitchTolerance(instrumentId: string, advanced = false): number {\n    const instrument = getInstrument(instrumentId);\n    if (advanced && instrument.validation.pitchToleranceAdvanced !== undefined) {\n        return instrument.validation.pitchToleranceAdvanced;\n    }\n    return instrument.validation.pitchTolerance;\n}\n\n/**\n * Create a custom instrument profile (for future extensibility)\n */\nexport function createCustomInstrument(config: Partial<InstrumentConfig>): InstrumentConfig {\n    // Merge with piano defaults as base\n    const defaults = { ...INSTRUMENTS[InstrumentType.PIANO] };\n    return {\n        ...defaults,\n        ...config,\n        range: { ...defaults.range, ...(config.range || {}) },\n        validation: { ...defaults.validation, ...(config.validation || {}) },\n        practice: { ...defaults.practice, ...(config.practice || {}) },\n        ui: { ...defaults.ui, ...(config.ui || {}) }\n    } as InstrumentConfig;\n}\n\n/**\n * Export default instrument (Piano)\n */\nexport const DEFAULT_INSTRUMENT: InstrumentTypeValue = InstrumentType.PIANO;\n","/**\n * Audio Tone Generator\n * Generates sine wave reference tones for practice\n */\n\nexport class AudioToneGenerator {\n    private audioContext: AudioContext | null = null;\n    private currentOscillator: OscillatorNode | null = null;\n    private currentGain: GainNode | null = null;\n\n    constructor() {\n        // Lazy initialization - create on first use\n    }\n\n    /**\n     * Initialize audio context if not already initialized\n     */\n    private initAudioContext(): void {\n        if (!this.audioContext || this.audioContext.state === 'closed') {\n            this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n        }\n\n        // Resume if suspended\n        if (this.audioContext.state === 'suspended') {\n            this.audioContext.resume().catch(err => {\n                console.error('Failed to resume tone generator AudioContext:', err);\n            });\n        }\n    }\n\n    /**\n     * Play a sine wave tone at the specified frequency\n     * @param frequency - Frequency in Hz\n     * @param duration - Duration in milliseconds (default: 1000ms)\n     * @param volume - Volume level 0-1 (default: 0.3)\n     */\n    playTone(frequency: number, duration: number = 1000, volume: number = 0.3): void {\n        try {\n            // Stop any currently playing tone\n            this.stopTone();\n\n            // Initialize audio context\n            this.initAudioContext();\n\n            if (!this.audioContext || this.audioContext.state === 'closed') {\n                console.error('Failed to create audio context');\n                return;\n            }\n\n            // Create oscillator and gain nodes\n            this.currentOscillator = this.audioContext.createOscillator();\n            this.currentGain = this.audioContext.createGain();\n\n            // Configure oscillator\n            this.currentOscillator.type = 'sine';\n            this.currentOscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);\n\n            // Configure gain (volume) with fade in/out\n            const now = this.audioContext.currentTime;\n            const fadeTime = 0.02; // 20ms fade in/out to prevent clicks\n\n            this.currentGain.gain.setValueAtTime(0, now);\n            this.currentGain.gain.linearRampToValueAtTime(volume, now + fadeTime);\n            this.currentGain.gain.setValueAtTime(volume, now + (duration / 1000) - fadeTime);\n            this.currentGain.gain.linearRampToValueAtTime(0, now + (duration / 1000));\n\n            // Connect nodes: oscillator -> gain -> destination\n            this.currentOscillator.connect(this.currentGain);\n            this.currentGain.connect(this.audioContext.destination);\n\n            // Start and stop oscillator\n            this.currentOscillator.start(now);\n            this.currentOscillator.stop(now + (duration / 1000));\n\n            // Clean up after tone finishes\n            this.currentOscillator.onended = () => {\n                this.cleanup();\n            };\n        } catch (error) {\n            console.error('Error playing tone:', error);\n            this.cleanup();\n        }\n    }\n\n    /**\n     * Stop the currently playing tone\n     */\n    stopTone(): void {\n        if (this.currentOscillator) {\n            try {\n                this.currentOscillator.stop();\n            } catch (e) {\n                // Already stopped or not started\n            }\n            this.cleanup();\n        }\n    }\n\n    /**\n     * Clean up oscillator and gain nodes\n     */\n    private cleanup(): void {\n        if (this.currentOscillator) {\n            this.currentOscillator.disconnect();\n            this.currentOscillator = null;\n        }\n        if (this.currentGain) {\n            this.currentGain.disconnect();\n            this.currentGain = null;\n        }\n    }\n\n    /**\n     * Check if audio context is supported\n     */\n    static isSupported(): boolean {\n        return !!(window.AudioContext || (window as any).webkitAudioContext);\n    }\n\n    /**\n     * Close the audio context and release resources\n     */\n    dispose(): void {\n        this.stopTone();\n        if (this.audioContext) {\n            this.audioContext.close();\n            this.audioContext = null;\n        }\n    }\n}\n\n/**\n * Helper function to play a tone from MIDI note number\n * @param midiNote - MIDI note number (0-127)\n * @param duration - Duration in milliseconds\n * @param volume - Volume level 0-1\n */\nexport function playMidiNote(midiNote: number, duration: number = 1000, volume: number = 0.3): void {\n    const frequency = midiToFrequency(midiNote);\n    const generator = new AudioToneGenerator();\n    generator.playTone(frequency, duration, volume);\n}\n\n/**\n * Convert MIDI note number to frequency in Hz\n * Uses A4 = 440 Hz as reference\n */\nexport function midiToFrequency(midiNote: number): number {\n    return 440 * Math.pow(2, (midiNote - 69) / 12);\n}\n","/**\n * Sight Reading Module\n * Manages the sight reading practice session\n */\n\nimport { MidiManager, NoteOnEvent } from '../midi/midi-manager.js';\nimport { AudioManager, PitchDetectedEvent } from '../input/audio-manager.js';\nimport { StaffRenderer } from '../notation/staff-renderer.js';\nimport { FallingNotesRenderer } from '../notation/falling-notes.js';\nimport { MusicTheory, NoteInfo, ClefType, validatePitchWithCents } from '../utils/music-theory.js';\nimport { Storage, SessionData } from '../utils/storage.js';\nimport { InstrumentTypeValue, getInstrument, requiresMicrophone, requiresMIDI, getPitchTolerance, getNoteRange } from '../utils/instrument-config.js';\nimport { AudioToneGenerator } from '../utils/audio-tone.js';\n\n// Type definitions\ninterface SessionStats {\n    correct: number;\n    incorrect: number;\n    streak: number;\n    bestStreak: number;\n    totalTime: number;\n    attempts: Attempt[];\n}\n\ninterface Attempt {\n    targetNote: number;\n    playedNote: number | null;\n    correct: boolean;\n    skipped?: boolean;\n    responseTime: number;\n    timestamp: number;\n}\n\ninterface ModuleSettings {\n    clef: ClefType;\n    range: string;\n    fallingNotesMode: boolean;\n    allowOctaveError: boolean;\n}\n\ninterface UIElements {\n    correctCount: HTMLElement | null;\n    incorrectCount: HTMLElement | null;\n    streakCount: HTMLElement | null;\n    avgTime: HTMLElement | null;\n    feedbackMessage: HTMLElement | null;\n    startBtn: HTMLElement | null;\n    stopBtn: HTMLElement | null;\n    nextBtn: HTMLElement | null;\n    playReferenceBtn: HTMLElement | null;\n}\n\ntype FeedbackType = 'correct' | 'incorrect' | 'info';\n\nexport class SightReadingModule {\n    private midiManager: MidiManager | null;\n    private audioManager: AudioManager | null;\n    private staffRenderer: StaffRenderer;\n    private fallingNotesRenderer: FallingNotesRenderer;\n    private currentInstrument: InstrumentTypeValue;\n    private toneGenerator: AudioToneGenerator;\n\n    // Session state\n    private isActive: boolean = false;\n    private currentNote: NoteInfo | null = null;\n    private currentTargetMidi: number | null = null;\n    private startTime: number | null = null;\n    private responseTimes: number[] = [];\n\n    // Session stats\n    private stats: SessionStats;\n\n    // Settings\n    private settings: ModuleSettings;\n\n    // UI elements\n    private ui: UIElements;\n\n    // Event handler references for cleanup\n    private midiNoteOnHandler: ((event: NoteOnEvent) => void) | null = null;\n    private audioPitchHandler: ((event: PitchDetectedEvent) => void) | null = null;\n\n    constructor(\n        midiManager: MidiManager | null,\n        staffRenderer: StaffRenderer,\n        fallingNotesRenderer: FallingNotesRenderer,\n        audioManager: AudioManager | null = null,\n        instrument: InstrumentTypeValue = 'piano'\n    ) {\n        this.midiManager = midiManager;\n        this.audioManager = audioManager;\n        this.staffRenderer = staffRenderer;\n        this.fallingNotesRenderer = fallingNotesRenderer;\n        this.currentInstrument = instrument;\n        this.toneGenerator = new AudioToneGenerator();\n\n        // Initialize stats\n        this.stats = {\n            correct: 0,\n            incorrect: 0,\n            streak: 0,\n            bestStreak: 0,\n            totalTime: 0,\n            attempts: []\n        };\n\n        // Get instrument configuration\n        const instrumentConfig = getInstrument(this.currentInstrument);\n\n        // Initialize settings with instrument-specific defaults\n        this.settings = {\n            clef: instrumentConfig.defaultClef,\n            range: 'c4-c5', // Will be overridden by instrument range in generateNewNote()\n            fallingNotesMode: false,\n            allowOctaveError: instrumentConfig.validation.octaveFlexible\n        };\n\n        // Initialize UI elements\n        this.ui = {\n            correctCount: document.getElementById('correctCount'),\n            incorrectCount: document.getElementById('incorrectCount'),\n            streakCount: document.getElementById('streakCount'),\n            avgTime: document.getElementById('avgTime'),\n            feedbackMessage: document.getElementById('feedbackMessage'),\n            startBtn: document.getElementById('startSessionBtn'),\n            stopBtn: document.getElementById('stopSessionBtn'),\n            nextBtn: document.getElementById('nextNoteBtn'),\n            playReferenceBtn: document.getElementById('playReferenceBtn')\n        };\n\n        this.initEventListeners();\n    }\n\n    /**\n     * Initialize event listeners\n     */\n    private initEventListeners(): void {\n        // MIDI note input (if MIDI instrument)\n        if (this.midiManager && requiresMIDI(this.currentInstrument)) {\n            this.midiNoteOnHandler = (data: NoteOnEvent) => {\n                if (this.isActive && this.currentTargetMidi !== null) {\n                    this.handleMidiInput(data.note);\n                }\n            };\n            this.midiManager.on('noteOn', this.midiNoteOnHandler);\n        }\n\n        // Microphone pitch detection (if microphone instrument)\n        if (this.audioManager && requiresMicrophone(this.currentInstrument)) {\n            this.audioPitchHandler = (data: PitchDetectedEvent) => {\n                if (this.isActive && this.currentTargetMidi !== null) {\n                    this.handleMicrophoneInput(data);\n                }\n            };\n            this.audioManager.on('pitchDetected', this.audioPitchHandler);\n        }\n\n        // UI controls\n        if (this.ui.startBtn) {\n            this.ui.startBtn.addEventListener('click', () => this.startSession());\n        }\n\n        if (this.ui.stopBtn) {\n            this.ui.stopBtn.addEventListener('click', () => this.stopSession());\n        }\n\n        if (this.ui.nextBtn) {\n            this.ui.nextBtn.addEventListener('click', () => this.nextNote());\n        }\n\n        if (this.ui.playReferenceBtn) {\n            this.ui.playReferenceBtn.addEventListener('click', () => this.playReferenceTone());\n        }\n\n        // Settings\n        const clefSelect = document.getElementById('clefSelect') as HTMLSelectElement | null;\n        if (clefSelect) {\n            clefSelect.addEventListener('change', (e) => {\n                const target = e.target as HTMLSelectElement;\n                this.settings.clef = target.value as ClefType;\n                this.staffRenderer.setClef(target.value as ClefType);\n                if (this.isActive) {\n                    this.generateNewNote();\n                }\n            });\n        }\n\n        const rangeSelect = document.getElementById('rangeSelect') as HTMLSelectElement | null;\n        if (rangeSelect) {\n            rangeSelect.addEventListener('change', (e) => {\n                const target = e.target as HTMLSelectElement;\n                this.settings.range = target.value;\n                if (this.isActive) {\n                    this.generateNewNote();\n                }\n            });\n        }\n\n        const fallingNotesToggle = document.getElementById('fallingNotesToggle') as HTMLInputElement | null;\n        if (fallingNotesToggle) {\n            fallingNotesToggle.addEventListener('change', (e) => {\n                const target = e.target as HTMLInputElement;\n                this.settings.fallingNotesMode = target.checked;\n                this.toggleRenderMode();\n            });\n        }\n    }\n\n    /**\n     * Start practice session\n     */\n    startSession(): void {\n        this.isActive = true;\n        this.resetStats();\n        this.updateUI();\n\n        // Show/hide buttons\n        if (this.ui.startBtn) this.ui.startBtn.classList.add('hidden');\n        if (this.ui.stopBtn) this.ui.stopBtn.classList.remove('hidden');\n\n        // Start microphone listening if using microphone input\n        if (this.audioManager && requiresMicrophone(this.currentInstrument)) {\n            this.audioManager.startListening();\n        }\n\n        // Generate first note\n        this.generateNewNote();\n\n        // Update feedback\n        const instrument = getInstrument(this.currentInstrument);\n        const inputHint = requiresMicrophone(this.currentInstrument)\n            ? 'Play the note on your instrument'\n            : 'Play the note shown above';\n        this.showFeedback(inputHint, 'info');\n    }\n\n    /**\n     * Stop practice session\n     */\n    stopSession(): void {\n        this.isActive = false;\n\n        // Stop microphone listening if using microphone input\n        if (this.audioManager && requiresMicrophone(this.currentInstrument)) {\n            this.audioManager.stopListening();\n        }\n\n        // Show/hide buttons\n        if (this.ui.startBtn) this.ui.startBtn.classList.remove('hidden');\n        if (this.ui.stopBtn) this.ui.stopBtn.classList.add('hidden');\n\n        // Save session\n        this.saveSession();\n\n        // Show summary\n        this.showSessionSummary();\n\n        // Clear displays\n        if (this.settings.fallingNotesMode) {\n            this.fallingNotesRenderer.clear();\n            this.fallingNotesRenderer.stopAnimation();\n        } else {\n            this.staffRenderer.clear();\n        }\n    }\n\n    /**\n     * Generate a new note\n     */\n    private generateNewNote(): void {\n        // Get instrument-specific note range\n        const instrumentRange = getNoteRange(this.currentInstrument);\n        const rangeString = `${MusicTheory.midiToNoteName(instrumentRange.min).toLowerCase()}-${MusicTheory.midiToNoteName(instrumentRange.max).toLowerCase()}`;\n\n        // Generate random note using instrument's range\n        const noteData = MusicTheory.generateRandomNote(\n            rangeString,\n            this.settings.clef,\n            true // naturals only\n        );\n\n        if (!noteData) {\n            console.error('Failed to generate note for instrument:', this.currentInstrument);\n            return;\n        }\n\n        this.currentNote = noteData;\n        this.currentTargetMidi = noteData.midiNote;\n        this.startTime = Date.now();\n\n        // Render based on mode\n        if (this.settings.fallingNotesMode) {\n            this.fallingNotesRenderer.addNote(\n                noteData.midiNote,\n                MusicTheory.midiToNoteName(noteData.midiNote)\n            );\n        } else {\n            this.staffRenderer.renderNote(noteData.vexflowNote);\n        }\n    }\n\n    /**\n     * Handle note input from MIDI\n     */\n    private handleMidiInput(midiNote: number): void {\n        if (this.currentTargetMidi === null || this.startTime === null) return;\n\n        // Validate note\n        const validation = MusicTheory.validateNote(\n            midiNote,\n            this.currentTargetMidi,\n            {\n                allowOctaveError: this.settings.allowOctaveError\n            }\n        );\n\n        // Calculate response time\n        const responseTime = Date.now() - this.startTime;\n        this.responseTimes.push(responseTime);\n\n        // Record attempt\n        this.stats.attempts.push({\n            targetNote: this.currentTargetMidi,\n            playedNote: midiNote,\n            correct: validation.isCorrect,\n            responseTime: responseTime,\n            timestamp: Date.now()\n        });\n\n        if (validation.isCorrect) {\n            this.handleCorrectNote(validation.message, responseTime);\n        } else {\n            this.handleIncorrectNote(validation.message);\n        }\n    }\n\n    /**\n     * Handle pitch input from microphone\n     */\n    private handleMicrophoneInput(data: PitchDetectedEvent): void {\n        if (this.currentTargetMidi === null || this.startTime === null) return;\n\n        // Get pitch tolerance for this instrument\n        const toleranceCents = getPitchTolerance(this.currentInstrument);\n\n        // Validate pitch with cents tolerance\n        const validation = validatePitchWithCents(\n            data.frequency,\n            this.currentTargetMidi,\n            toleranceCents\n        );\n\n        // Only process if correct (ignore incorrect detections to avoid false negatives)\n        if (validation.isCorrect) {\n            // Calculate response time\n            const responseTime = Date.now() - this.startTime;\n            this.responseTimes.push(responseTime);\n\n            // Record attempt\n            this.stats.attempts.push({\n                targetNote: this.currentTargetMidi,\n                playedNote: data.midi,\n                correct: true,\n                responseTime: responseTime,\n                timestamp: Date.now()\n            });\n\n            // Show feedback with pitch accuracy\n            const feedbackMessage = validation.centsOff !== undefined && Math.abs(validation.centsOff) > 5\n                ? ` Correct! ${validation.message}`\n                : ' Perfect pitch!';\n\n            this.handleCorrectNote(feedbackMessage, responseTime);\n        }\n    }\n\n    /**\n     * Handle correct note\n     * @param message - Feedback message\n     * @param responseTime - Response time in ms\n     */\n    private handleCorrectNote(message: string, responseTime: number): void {\n        // Update stats\n        this.stats.correct++;\n        this.stats.streak++;\n        if (this.stats.streak > this.stats.bestStreak) {\n            this.stats.bestStreak = this.stats.streak;\n        }\n\n        // Show feedback\n        this.showFeedback(\n            ` ${message} (${(responseTime / 1000).toFixed(2)}s)`,\n            'correct'\n        );\n\n        // Visual feedback\n        if (this.settings.fallingNotesMode) {\n            // Falling notes handles its own feedback\n        } else {\n            this.staffRenderer.showFeedback(true);\n        }\n\n        // Play success sound (optional - could use Web Audio API)\n        this.playFeedbackSound(true);\n\n        // Update UI\n        this.updateUI();\n\n        // Auto-advance to next note after delay\n        setTimeout(() => {\n            if (this.isActive) {\n                this.generateNewNote();\n            }\n        }, 1000);\n    }\n\n    /**\n     * Handle incorrect note\n     * @param message - Feedback message\n     */\n    private handleIncorrectNote(message: string): void {\n        // Update stats\n        this.stats.incorrect++;\n        this.stats.streak = 0;\n\n        // Show feedback\n        this.showFeedback(` ${message}`, 'incorrect');\n\n        // Visual feedback\n        if (this.settings.fallingNotesMode) {\n            // Falling notes handles its own feedback\n        } else {\n            this.staffRenderer.showFeedback(false);\n        }\n\n        // Play error sound\n        this.playFeedbackSound(false);\n\n        // Update UI\n        this.updateUI();\n\n        // Don't auto-advance - let user try again or click next\n    }\n\n    /**\n     * Move to next note (manual)\n     */\n    nextNote(): void {\n        if (this.isActive) {\n            // Record as skipped if not attempted\n            if (this.currentNote && this.startTime !== null) {\n                this.stats.attempts.push({\n                    targetNote: this.currentNote.midiNote,\n                    playedNote: null,\n                    correct: false,\n                    skipped: true,\n                    responseTime: Date.now() - this.startTime,\n                    timestamp: Date.now()\n                });\n            }\n\n            this.generateNewNote();\n            this.showFeedback('Play the note shown above', 'info');\n        }\n    }\n\n    /**\n     * Play reference tone for the current note\n     */\n    private playReferenceTone(): void {\n        if (this.currentTargetMidi === null) {\n            // If no active note, show a message\n            this.showFeedback('Start practice session first to hear note references', 'info');\n            console.warn('No current note to play');\n            return;\n        }\n\n        // Temporarily stop microphone listening to prevent it from detecting the reference tone\n        const wasListening = this.audioManager?.isCurrentlyListening() || false;\n        if (wasListening && this.audioManager) {\n            this.audioManager.stopListening();\n        }\n\n        // Convert MIDI note to frequency\n        const frequency = 440 * Math.pow(2, (this.currentTargetMidi - 69) / 12);\n\n        // Play tone for 1 second at moderate volume\n        this.toneGenerator.playTone(frequency, 1000, 0.3);\n\n        // Show brief feedback\n        this.showFeedback(' Playing reference tone...', 'info');\n\n        // Reset feedback and restart listening after tone plays\n        setTimeout(() => {\n            // Resume microphone listening if it was active\n            if (wasListening && this.audioManager && this.isActive) {\n                this.audioManager.startListening();\n            }\n\n            if (this.isActive) {\n                const inputHint = requiresMicrophone(this.currentInstrument)\n                    ? 'Play the note on your instrument'\n                    : 'Play the note shown above';\n                this.showFeedback(inputHint, 'info');\n            }\n        }, 1200);\n    }\n\n    /**\n     * Toggle between staff and falling notes rendering\n     */\n    private toggleRenderMode(): void {\n        const staffDisplay = document.getElementById('staffDisplay');\n        const fallingDisplay = document.getElementById('fallingNotesDisplay');\n\n        if (this.settings.fallingNotesMode) {\n            // Switch to falling notes\n            if (staffDisplay) staffDisplay.classList.add('hidden');\n            if (fallingDisplay) fallingDisplay.classList.remove('hidden');\n            this.fallingNotesRenderer.showWelcome();\n        } else {\n            // Switch to staff\n            if (fallingDisplay) fallingDisplay.classList.add('hidden');\n            if (staffDisplay) staffDisplay.classList.remove('hidden');\n            this.staffRenderer.showWelcome();\n        }\n\n        // Regenerate current note if session is active\n        if (this.isActive && this.currentNote) {\n            this.generateNewNote();\n        }\n    }\n\n    /**\n     * Show feedback message\n     * @param message - Message to display\n     * @param type - 'correct', 'incorrect', or 'info'\n     */\n    private showFeedback(message: string, type: FeedbackType = 'info'): void {\n        if (this.ui.feedbackMessage) {\n            this.ui.feedbackMessage.textContent = message;\n            this.ui.feedbackMessage.className = 'feedback-message';\n\n            if (type === 'correct') {\n                this.ui.feedbackMessage.classList.add('correct');\n            } else if (type === 'incorrect') {\n                this.ui.feedbackMessage.classList.add('incorrect');\n            }\n        }\n    }\n\n    /**\n     * Update UI elements with current stats\n     */\n    private updateUI(): void {\n        if (this.ui.correctCount) {\n            this.ui.correctCount.textContent = this.stats.correct.toString();\n        }\n\n        if (this.ui.incorrectCount) {\n            this.ui.incorrectCount.textContent = this.stats.incorrect.toString();\n        }\n\n        if (this.ui.streakCount) {\n            this.ui.streakCount.textContent = this.stats.streak.toString();\n        }\n\n        if (this.ui.avgTime && this.responseTimes.length > 0) {\n            const avgTime = this.responseTimes.reduce((a, b) => a + b, 0) / this.responseTimes.length;\n            this.ui.avgTime.textContent = (avgTime / 1000).toFixed(2) + 's';\n        }\n    }\n\n    /**\n     * Reset session stats\n     */\n    private resetStats(): void {\n        this.stats = {\n            correct: 0,\n            incorrect: 0,\n            streak: 0,\n            bestStreak: 0,\n            totalTime: 0,\n            attempts: []\n        };\n        this.responseTimes = [];\n        this.updateUI();\n    }\n\n    /**\n     * Save session to storage\n     */\n    private saveSession(): void {\n        const sessionData: SessionData = {\n            module: 'sightReading',\n            correct: this.stats.correct,\n            incorrect: this.stats.incorrect,\n            bestStreak: this.stats.bestStreak,\n            avgResponseTime: this.responseTimes.length > 0\n                ? this.responseTimes.reduce((a, b) => a + b, 0) / this.responseTimes.length\n                : 0,\n            attempts: this.stats.attempts,\n            settings: { ...this.settings }\n        };\n\n        Storage.saveSession(sessionData);\n    }\n\n    /**\n     * Show session summary\n     */\n    private showSessionSummary(): void {\n        const total = this.stats.correct + this.stats.incorrect;\n        const accuracy = total > 0 ? ((this.stats.correct / total) * 100).toFixed(1) : '0';\n        const avgTime = this.responseTimes.length > 0\n            ? (this.responseTimes.reduce((a, b) => a + b, 0) / this.responseTimes.length / 1000).toFixed(2)\n            : '0';\n\n        this.showFeedback(\n            `Session Complete! Accuracy: ${accuracy}% | Avg Time: ${avgTime}s | Best Streak: ${this.stats.bestStreak}`,\n            'info'\n        );\n    }\n\n    /**\n     * Play feedback sound\n     * @param isCorrect - Whether the note was correct\n     */\n    private playFeedbackSound(isCorrect: boolean): void {\n        // Simple beep using Web Audio API\n        try {\n            const AudioContext = window.AudioContext || (window as any).webkitAudioContext;\n            const audioContext = new AudioContext();\n            const oscillator = audioContext.createOscillator();\n            const gainNode = audioContext.createGain();\n\n            oscillator.connect(gainNode);\n            gainNode.connect(audioContext.destination);\n\n            oscillator.frequency.value = isCorrect ? 800 : 400;\n            oscillator.type = 'sine';\n\n            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);\n            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);\n\n            oscillator.start(audioContext.currentTime);\n            oscillator.stop(audioContext.currentTime + 0.1);\n        } catch (error) {\n            // Silently fail if audio is not available\n        }\n    }\n\n    /**\n     * Get whether session is active\n     */\n    get active(): boolean {\n        return this.isActive;\n    }\n}\n\n// Make available globally\nif (typeof window !== 'undefined') {\n    (window as any).SightReadingModule = SightReadingModule;\n}\n","/**\n * Main Application Controller\n * Initializes and coordinates all modules\n */\n\nimport { MidiManager, DeviceChangeEvent, ErrorEvent as MidiErrorEvent } from './midi/midi-manager.js';\nimport { AudioManager, PitchDetectedEvent, StatusChangeEvent, ErrorEvent as AudioErrorEvent } from './input/audio-manager.js';\nimport { StaffRenderer } from './notation/staff-renderer.js';\nimport { FallingNotesRenderer } from './notation/falling-notes.js';\nimport { SightReadingModule } from './modules/sight-reading.js';\nimport { MusicTheory } from './utils/music-theory.js';\nimport { Storage } from './utils/storage.js';\nimport {\n    InstrumentType,\n    InstrumentTypeValue,\n    getInstrument,\n    requiresMicrophone,\n    requiresMIDI\n} from './utils/instrument-config.js';\n\n// Type definitions\ninterface UIElements {\n    instrumentSelect: HTMLSelectElement | null;\n    midiStatus: HTMLElement | null;\n    microphoneStatus: HTMLElement | null;\n    midiDeviceSelect: HTMLSelectElement | null;\n    audioDeviceSelect: HTMLSelectElement | null;\n    connectMidiBtn: HTMLElement | null;\n    connectMicrophoneBtn: HTMLElement | null;\n    virtualKeyboardToggle: HTMLInputElement | null;\n    virtualKeyboard: HTMLElement | null;\n    themeToggle: HTMLElement | null;\n    moduleButtons: NodeListOf<HTMLElement>;\n}\n\ntype ModuleName = 'sightReading';\n\nexport class MusicPracticeApp {\n    private midiManager: MidiManager | null = null;\n    private audioManager: AudioManager | null = null;\n    private staffRenderer: StaffRenderer | null = null;\n    private fallingNotesRenderer: FallingNotesRenderer | null = null;\n    private sightReadingModule: SightReadingModule | null = null;\n    private currentModule: ModuleName = 'sightReading';\n    private currentInstrument: InstrumentTypeValue = InstrumentType.PIANO;\n\n    // UI elements\n    private ui: UIElements;\n\n    constructor() {\n        // Initialize UI elements\n        this.ui = {\n            instrumentSelect: document.getElementById('instrumentSelect') as HTMLSelectElement | null,\n            midiStatus: document.getElementById('midiStatus'),\n            microphoneStatus: document.getElementById('microphoneStatus'),\n            midiDeviceSelect: document.getElementById('midiDeviceSelect') as HTMLSelectElement | null,\n            audioDeviceSelect: document.getElementById('audioDeviceSelect') as HTMLSelectElement | null,\n            connectMidiBtn: document.getElementById('connectMidiBtn'),\n            connectMicrophoneBtn: document.getElementById('connectMicrophoneBtn'),\n            virtualKeyboardToggle: document.getElementById('virtualKeyboardToggle') as HTMLInputElement | null,\n            virtualKeyboard: document.getElementById('virtualKeyboard'),\n            themeToggle: document.getElementById('themeToggle'),\n            moduleButtons: document.querySelectorAll('.nav-btn')\n        };\n\n        this.init();\n    }\n\n    /**\n     * Initialize the application\n     */\n    async init(): Promise<void> {\n        console.log('Initializing InstrumentPractice Pro...');\n\n        // Load settings (includes instrument selection)\n        this.loadSettings();\n\n        // Initialize input methods based on instrument\n        await this.initInputMethods();\n\n        // Initialize renderers\n        this.initRenderers();\n\n        // Initialize modules\n        this.initModules();\n\n        // Setup UI event listeners\n        this.setupEventListeners();\n\n        // Show welcome screen\n        this.showWelcome();\n\n        console.log('InstrumentPractice Pro initialized successfully');\n    }\n\n    /**\n     * Initialize input methods (MIDI and/or Microphone) based on instrument\n     */\n    async initInputMethods(): Promise<void> {\n        const instrument = getInstrument(this.currentInstrument);\n\n        // Initialize MIDI if needed\n        if (requiresMIDI(this.currentInstrument)) {\n            await this.initMidi();\n        }\n\n        // Initialize microphone if needed\n        if (requiresMicrophone(this.currentInstrument)) {\n            await this.initAudio();\n        }\n\n        // Update UI to show/hide relevant sections\n        this.updateInputUIVisibility();\n    }\n\n    /**\n     * Initialize MIDI manager\n     */\n    async initMidi(): Promise<void> {\n        this.midiManager = new MidiManager();\n\n        // Register event listeners\n        this.midiManager.on('deviceChange', (data: DeviceChangeEvent) => {\n            this.handleMidiDeviceChange(data);\n        });\n\n        this.midiManager.on('error', (data: MidiErrorEvent) => {\n            this.showError(data.message);\n        });\n\n        // Initialize\n        const success = await this.midiManager.init();\n\n        if (success) {\n            this.updateMidiStatus(true);\n            this.updateDeviceList();\n        } else {\n            this.updateMidiStatus(false);\n            this.showMidiWarning();\n        }\n    }\n\n    /**\n     * Initialize Audio manager (microphone)\n     * Note: Does not automatically request permission - user must click \"Connect Microphone\"\n     */\n    async initAudio(): Promise<void> {\n        const instrument = getInstrument(this.currentInstrument);\n\n        this.audioManager = new AudioManager({\n            minClarity: instrument.validation.minClarity || 0.75,\n            minFrequency: instrument.audio?.minFrequency || 70,\n            maxFrequency: instrument.audio?.maxFrequency || 1600,\n            bufferSize: instrument.audio?.bufferSize || 2048\n        });\n\n        // Register event listeners\n        this.audioManager.on('pitchDetected', (data: PitchDetectedEvent) => {\n            // Update pitch display in UI\n            this.updatePitchDisplay(data);\n        });\n\n        this.audioManager.on('audioLevel', (data) => {\n            // Update audio level bar\n            this.updateAudioLevel(data.level);\n        });\n\n        this.audioManager.on('statusChange', (data: StatusChangeEvent) => {\n            this.handleAudioStatusChange(data);\n        });\n\n        this.audioManager.on('error', (data: AudioErrorEvent) => {\n            this.showError(data.message);\n        });\n\n        // Populate audio device list\n        await this.updateAudioDeviceList();\n\n        console.log('Audio Manager ready (waiting for user to connect microphone)');\n    }\n\n    /**\n     * Initialize notation renderers\n     */\n    initRenderers(): void {\n        this.staffRenderer = new StaffRenderer('staffDisplay');\n        this.fallingNotesRenderer = new FallingNotesRenderer('fallingNotesDisplay');\n    }\n\n    /**\n     * Initialize practice modules\n     */\n    initModules(): void {\n        if (!this.staffRenderer || !this.fallingNotesRenderer) {\n            console.error('Cannot initialize modules: renderers not ready');\n            return;\n        }\n\n        // Pass both MIDI and Audio managers to modules\n        this.sightReadingModule = new SightReadingModule(\n            this.midiManager,\n            this.staffRenderer,\n            this.fallingNotesRenderer,\n            this.audioManager,\n            this.currentInstrument\n        );\n    }\n\n    /**\n     * Setup UI event listeners\n     */\n    setupEventListeners(): void {\n        // Instrument selection\n        if (this.ui.instrumentSelect) {\n            this.ui.instrumentSelect.addEventListener('change', async (e) => {\n                const target = e.target as HTMLSelectElement;\n                await this.switchInstrument(target.value as InstrumentTypeValue);\n            });\n        }\n\n        // Theme toggle\n        if (this.ui.themeToggle) {\n            this.ui.themeToggle.addEventListener('click', () => {\n                this.toggleTheme();\n            });\n        }\n\n        // Microphone connect button - triggers fresh permission request\n        if (this.ui.connectMicrophoneBtn) {\n            this.ui.connectMicrophoneBtn.addEventListener('click', async () => {\n                // Clear the device selection to trigger browser's device picker\n                if (this.ui.audioDeviceSelect) {\n                    this.ui.audioDeviceSelect.value = '';\n                }\n                // Request microphone without specific device ID\n                await this.reconnectMicrophone();\n            });\n        }\n\n        // Audio device selection - use specific device when selected from dropdown\n        if (this.ui.audioDeviceSelect) {\n            this.ui.audioDeviceSelect.addEventListener('change', async (e) => {\n                const target = e.target as HTMLSelectElement;\n                if (target.value && this.audioManager) {\n                    // Reconnect with selected device\n                    await this.reconnectMicrophone(target.value);\n                }\n            });\n        }\n\n        // MIDI device selection\n        if (this.ui.midiDeviceSelect) {\n            this.ui.midiDeviceSelect.addEventListener('change', (e) => {\n                const target = e.target as HTMLSelectElement;\n                if (target.value && this.midiManager) {\n                    this.midiManager.connectDevice(target.value);\n                }\n            });\n        }\n\n        // MIDI connect button\n        if (this.ui.connectMidiBtn) {\n            this.ui.connectMidiBtn.addEventListener('click', () => {\n                this.reconnectMidi();\n            });\n        }\n\n        // Virtual keyboard toggle\n        if (this.ui.virtualKeyboardToggle) {\n            this.ui.virtualKeyboardToggle.addEventListener('change', (e) => {\n                const target = e.target as HTMLInputElement;\n                this.toggleVirtualKeyboard(target.checked);\n            });\n        }\n\n        // Module navigation\n        this.ui.moduleButtons.forEach(btn => {\n            btn.addEventListener('click', (e) => {\n                const target = e.currentTarget as HTMLElement;\n                const module = target.dataset.module as ModuleName | undefined;\n                if (module) {\n                    this.switchModule(module);\n                }\n            });\n        });\n\n        // Keyboard shortcuts\n        document.addEventListener('keydown', (e) => {\n            this.handleKeyboardShortcut(e);\n        });\n    }\n\n    /**\n     * Handle MIDI device connection changes\n     */\n    handleMidiDeviceChange(data: DeviceChangeEvent): void {\n        console.log('MIDI device change:', data);\n\n        if (data.connected && data.device) {\n            this.updateMidiStatus(true, data.device.name || 'Unknown Device');\n        } else {\n            this.updateMidiStatus(false);\n        }\n\n        this.updateDeviceList();\n    }\n\n    /**\n     * Handle audio status changes (microphone)\n     */\n    handleAudioStatusChange(data: StatusChangeEvent): void {\n        console.log('Audio status change:', data);\n        this.updateMicrophoneStatus(data.microphoneActive, data.listening);\n    }\n\n    /**\n     * Update UI visibility based on selected instrument\n     */\n    updateInputUIVisibility(): void {\n        const usesMidi = requiresMIDI(this.currentInstrument);\n        const usesMic = requiresMicrophone(this.currentInstrument);\n\n        // Show/hide MIDI controls\n        const midiSection = document.getElementById('midiSection');\n        if (midiSection) {\n            midiSection.style.display = usesMidi ? 'block' : 'none';\n        }\n\n        // Show/hide microphone controls\n        const microphoneSection = document.getElementById('microphoneSection');\n        if (microphoneSection) {\n            microphoneSection.style.display = usesMic ? 'block' : 'none';\n        }\n    }\n\n    /**\n     * Update MIDI status indicator\n     */\n    updateMidiStatus(connected: boolean, deviceName: string | null = null): void {\n        if (!this.ui.midiStatus) return;\n\n        const statusText = this.ui.midiStatus.querySelector('.status-text');\n\n        if (connected) {\n            this.ui.midiStatus.classList.add('connected');\n            if (statusText) {\n                statusText.textContent = deviceName || 'MIDI Connected';\n            }\n        } else {\n            this.ui.midiStatus.classList.remove('connected');\n            if (statusText) {\n                statusText.textContent = 'No MIDI';\n            }\n        }\n    }\n\n    /**\n     * Update microphone status indicator\n     */\n    updateMicrophoneStatus(active: boolean, listening: boolean = false): void {\n        if (!this.ui.microphoneStatus) return;\n\n        const statusText = this.ui.microphoneStatus.querySelector('.status-text');\n\n        if (active) {\n            this.ui.microphoneStatus.classList.add('connected');\n            if (statusText) {\n                statusText.textContent = listening ? 'Listening...' : 'Microphone Ready';\n            }\n        } else {\n            this.ui.microphoneStatus.classList.remove('connected');\n            if (statusText) {\n                statusText.textContent = 'No Microphone';\n            }\n        }\n    }\n\n    /**\n     * Update pitch display in UI\n     */\n    updatePitchDisplay(data: PitchDetectedEvent): void {\n        const pitchValue = document.getElementById('detectedPitch');\n        const pitchCents = document.getElementById('detectedCents');\n\n        if (pitchValue) {\n            pitchValue.textContent = data.noteName;\n        }\n\n        if (pitchCents) {\n            const centsOff = Math.round(data.cents);\n            const sign = centsOff >= 0 ? '+' : '';\n            pitchCents.textContent = `${sign}${centsOff}`;\n\n            // Color code based on how close to pitch\n            if (Math.abs(centsOff) <= 5) {\n                pitchCents.style.color = '#4caf50'; // Green - perfect\n            } else if (Math.abs(centsOff) <= 20) {\n                pitchCents.style.color = '#ff9800'; // Orange - close\n            } else {\n                pitchCents.style.color = '#f44336'; // Red - off pitch\n            }\n        }\n    }\n\n    /**\n     * Update audio level bar\n     */\n    updateAudioLevel(level: number): void {\n        const levelBar = document.getElementById('audioLevelBar');\n        if (levelBar) {\n            // Convert RMS to percentage (0-1 range, boosted for visibility)\n            const percentage = Math.min(100, level * 500);\n            levelBar.style.width = `${percentage}%`;\n\n            // Color code based on level\n            if (percentage < 10) {\n                levelBar.style.backgroundColor = '#f44336'; // Red - too quiet\n            } else if (percentage < 30) {\n                levelBar.style.backgroundColor = '#ff9800'; // Orange - okay\n            } else {\n                levelBar.style.backgroundColor = '#4caf50'; // Green - good level\n            }\n        }\n    }\n\n    /**\n     * Update MIDI device dropdown list\n     */\n    updateDeviceList(): void {\n        if (!this.ui.midiDeviceSelect || !this.midiManager) return;\n\n        const devices = this.midiManager.getInputDevices();\n        this.ui.midiDeviceSelect.innerHTML = '';\n\n        if (devices.length === 0) {\n            const option = document.createElement('option');\n            option.value = '';\n            option.textContent = 'No device connected';\n            this.ui.midiDeviceSelect.appendChild(option);\n        } else {\n            devices.forEach(device => {\n                const option = document.createElement('option');\n                option.value = device.id;\n                option.textContent = device.name;\n\n                const connectedDevice = this.midiManager!.getConnectedDevice();\n                if (connectedDevice && connectedDevice.id === device.id) {\n                    option.selected = true;\n                }\n\n                this.ui.midiDeviceSelect!.appendChild(option);\n            });\n        }\n    }\n\n    /**\n     * Reconnect MIDI\n     */\n    async reconnectMidi(): Promise<void> {\n        if (!this.midiManager) return;\n        await this.midiManager.init();\n        this.updateDeviceList();\n    }\n\n    /**\n     * Reconnect microphone\n     * @param deviceId - Optional specific device ID to use\n     */\n    async reconnectMicrophone(deviceId?: string): Promise<void> {\n        if (!this.audioManager) {\n            console.error('Audio manager not initialized');\n            return;\n        }\n\n        // Disconnect existing\n        this.audioManager.disconnect();\n\n        // Connect with selected device\n        console.log('Connecting to microphone:', deviceId || 'default');\n        const success = await this.audioManager.init(deviceId);\n\n        if (success) {\n            this.updateMicrophoneStatus(true);\n            console.log('Microphone connected successfully');\n\n            // Save device preference to localStorage\n            Storage.saveSettings({ audioDeviceId: deviceId || null });\n\n            // Update device list to show current selection\n            await this.updateAudioDeviceList();\n        } else {\n            this.updateMicrophoneStatus(false);\n            this.showMicrophoneWarning();\n        }\n    }\n\n    /**\n     * Update audio device dropdown list\n     */\n    async updateAudioDeviceList(): Promise<void> {\n        if (!this.ui.audioDeviceSelect) return;\n\n        try {\n            // Get available audio input devices\n            const devices = await AudioManager.getAudioInputDevices();\n\n            // Get saved device preference\n            const settings = Storage.getSettings();\n            const savedDeviceId = settings.audioDeviceId;\n\n            this.ui.audioDeviceSelect.innerHTML = '';\n\n            if (devices.length === 0) {\n                const option = document.createElement('option');\n                option.value = '';\n                option.textContent = 'No microphones found';\n                this.ui.audioDeviceSelect.appendChild(option);\n            } else {\n                // Add default option\n                const defaultOption = document.createElement('option');\n                defaultOption.value = '';\n                defaultOption.textContent = 'Select microphone...';\n                this.ui.audioDeviceSelect.appendChild(defaultOption);\n\n                // Add each device\n                devices.forEach(device => {\n                    const option = document.createElement('option');\n                    option.value = device.deviceId;\n                    option.textContent = device.label || `Microphone ${device.deviceId.substring(0, 8)}`;\n\n                    // Check if this is the currently active device OR the saved preference\n                    if (this.audioManager) {\n                        const activeDevice = this.audioManager.getActiveDevice();\n                        if (activeDevice && activeDevice.deviceId === device.deviceId) {\n                            option.selected = true;\n                        }\n                    } else if (savedDeviceId && savedDeviceId === device.deviceId) {\n                        // If no active device yet, but we have a saved preference, select it\n                        option.selected = true;\n                    }\n\n                    this.ui.audioDeviceSelect!.appendChild(option);\n                });\n            }\n\n            console.log('Audio device list updated:', devices.length, 'devices found');\n        } catch (error) {\n            console.error('Failed to update audio device list:', error);\n        }\n    }\n\n    /**\n     * Switch instrument\n     */\n    async switchInstrument(instrumentId: InstrumentTypeValue): Promise<void> {\n        console.log('Switching to instrument:', instrumentId);\n\n        // Stop current session if active\n        if (this.sightReadingModule && this.sightReadingModule.active) {\n            this.sightReadingModule.stopSession();\n        }\n\n        // Update current instrument\n        this.currentInstrument = instrumentId;\n\n        // Disconnect current input methods\n        if (this.midiManager) {\n            this.midiManager.disconnectDevice();\n        }\n        if (this.audioManager) {\n            this.audioManager.disconnect();\n            this.audioManager = null;\n        }\n\n        // Initialize new input methods\n        await this.initInputMethods();\n\n        // Reinitialize modules with new instrument\n        this.initModules();\n\n        // Save preference\n        Storage.saveSettings({ instrument: instrumentId });\n\n        console.log('Switched to instrument:', instrumentId);\n    }\n\n    /**\n     * Show MIDI warning\n     */\n    showMidiWarning(): void {\n        console.warn('MIDI not available. Virtual keyboard or manual testing required.');\n    }\n\n    /**\n     * Show microphone warning\n     */\n    showMicrophoneWarning(): void {\n        console.warn('Microphone not available. Please check browser permissions.');\n        this.showError('Microphone access denied. Please allow microphone access in your browser settings.');\n    }\n\n    /**\n     * Show microphone connected message\n     */\n    showMicrophoneConnected(): void {\n        console.log('Microphone connected and ready!');\n        // Could show a success message to the user if desired\n    }\n\n    /**\n     * Toggle theme (light/dark)\n     */\n    toggleTheme(): void {\n        const currentTheme = document.documentElement.getAttribute('data-theme');\n        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';\n\n        document.documentElement.setAttribute('data-theme', newTheme);\n\n        // Update icon\n        const themeIcon = this.ui.themeToggle?.querySelector('.theme-icon');\n        if (themeIcon) {\n            themeIcon.textContent = newTheme === 'dark' ? '' : '';\n        }\n\n        // Save preference\n        Storage.saveSettings({ theme: newTheme });\n    }\n\n    /**\n     * Toggle virtual keyboard\n     * @param show - Whether to show keyboard\n     */\n    toggleVirtualKeyboard(show: boolean): void {\n        if (!this.ui.virtualKeyboard) return;\n\n        if (show) {\n            this.ui.virtualKeyboard.classList.remove('hidden');\n            this.createVirtualKeyboard();\n        } else {\n            this.ui.virtualKeyboard.classList.add('hidden');\n        }\n\n        Storage.saveSettings({ virtualKeyboard: show });\n    }\n\n    /**\n     * Create virtual keyboard\n     */\n    createVirtualKeyboard(): void {\n        if (!this.ui.virtualKeyboard) return;\n\n        const container = this.ui.virtualKeyboard.querySelector('.keyboard-container');\n        if (!container || container.children.length > 0) return;\n\n        // Create one octave of keys (C4 to C5)\n        const whiteKeys = ['C4', 'D4', 'E4', 'F4', 'G4', 'A4', 'B4', 'C5'];\n        const blackKeys: (string | null)[] = ['C#4', 'D#4', null, 'F#4', 'G#4', 'A#4', null];\n\n        whiteKeys.forEach((note, index) => {\n            // White key\n            const whiteKey = document.createElement('div');\n            whiteKey.className = 'key white';\n            whiteKey.dataset.note = note;\n\n            const label = document.createElement('span');\n            label.className = 'key-label';\n            label.textContent = note;\n            whiteKey.appendChild(label);\n\n            whiteKey.addEventListener('mousedown', () => {\n                this.playVirtualNote(note);\n                whiteKey.classList.add('active');\n            });\n\n            whiteKey.addEventListener('mouseup', () => {\n                whiteKey.classList.remove('active');\n            });\n\n            container.appendChild(whiteKey);\n\n            // Black key (if exists)\n            if (index < blackKeys.length && blackKeys[index]) {\n                const blackKeyNote = blackKeys[index]!;\n                const blackKey = document.createElement('div');\n                blackKey.className = 'key black';\n                blackKey.dataset.note = blackKeyNote;\n\n                blackKey.addEventListener('mousedown', () => {\n                    this.playVirtualNote(blackKeyNote);\n                    blackKey.classList.add('active');\n                });\n\n                blackKey.addEventListener('mouseup', () => {\n                    blackKey.classList.remove('active');\n                });\n\n                container.appendChild(blackKey);\n            }\n        });\n    }\n\n    /**\n     * Play a virtual note (simulate MIDI input)\n     * @param noteName - Note name (e.g., \"C4\")\n     */\n    playVirtualNote(noteName: string): void {\n        if (!this.midiManager) return;\n\n        const midiNote = MusicTheory.noteNameToMidi(noteName);\n        if (midiNote !== -1) {\n            this.midiManager.simulateNote(midiNote);\n        }\n    }\n\n    /**\n     * Switch between modules\n     * @param moduleName - Module to switch to\n     */\n    switchModule(moduleName: ModuleName): void {\n        // Update navigation\n        this.ui.moduleButtons.forEach(btn => {\n            if (btn.dataset.module === moduleName) {\n                btn.classList.add('active');\n            } else {\n                btn.classList.remove('active');\n            }\n        });\n\n        // Show/hide modules\n        const modules = document.querySelectorAll('.module');\n        modules.forEach(module => {\n            if (module.id === `${moduleName}Module`) {\n                module.classList.add('active');\n            } else {\n                module.classList.remove('active');\n            }\n        });\n\n        this.currentModule = moduleName;\n    }\n\n    /**\n     * Handle keyboard shortcuts\n     * @param e - Keyboard event\n     */\n    handleKeyboardShortcut(e: KeyboardEvent): void {\n        // Space: Start/stop or next note\n        if (e.code === 'Space') {\n            e.preventDefault();\n            if (this.currentModule === 'sightReading' && this.sightReadingModule) {\n                if (this.sightReadingModule.active) {\n                    this.sightReadingModule.nextNote();\n                } else {\n                    this.sightReadingModule.startSession();\n                }\n            }\n        }\n\n        // Escape: Stop session\n        if (e.code === 'Escape') {\n            if (this.currentModule === 'sightReading' && this.sightReadingModule && this.sightReadingModule.active) {\n                this.sightReadingModule.stopSession();\n            }\n        }\n    }\n\n    /**\n     * Show welcome screen\n     */\n    showWelcome(): void {\n        if (this.staffRenderer) {\n            this.staffRenderer.showWelcome();\n        }\n    }\n\n    /**\n     * Show error message\n     * @param message - Error message\n     */\n    showError(message: string): void {\n        console.error(message);\n        // Could show a toast notification here\n    }\n\n    /**\n     * Load saved settings\n     */\n    loadSettings(): void {\n        const settings = Storage.getSettings();\n\n        // Load instrument preference\n        if (settings.instrument) {\n            this.currentInstrument = settings.instrument as InstrumentTypeValue;\n            if (this.ui.instrumentSelect) {\n                this.ui.instrumentSelect.value = this.currentInstrument;\n            }\n        }\n\n        // Apply theme\n        if (settings.theme) {\n            document.documentElement.setAttribute('data-theme', settings.theme);\n            const themeIcon = this.ui.themeToggle?.querySelector('.theme-icon');\n            if (themeIcon) {\n                themeIcon.textContent = settings.theme === 'dark' ? '' : '';\n            }\n        }\n\n        // Apply virtual keyboard setting\n        if (settings.virtualKeyboard && this.ui.virtualKeyboardToggle) {\n            this.ui.virtualKeyboardToggle.checked = true;\n            this.toggleVirtualKeyboard(true);\n        }\n\n        // Auto-connect to saved audio device if using microphone instrument\n        if (settings.audioDeviceId && requiresMicrophone(this.currentInstrument) && this.audioManager) {\n            // Delay to ensure UI is ready\n            setTimeout(() => {\n                this.reconnectMicrophone(settings.audioDeviceId || undefined);\n            }, 500);\n        }\n    }\n}\n\n// Initialize app when DOM is ready\ndocument.addEventListener('DOMContentLoaded', () => {\n    (window as any).app = new MusicPracticeApp();\n});\n"]}