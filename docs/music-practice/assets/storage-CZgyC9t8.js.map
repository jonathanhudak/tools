{"version":3,"file":"storage-CZgyC9t8.js","sources":["../../../node_modules/.pnpm/lucide-react@0.468.0_react@18.3.1/node_modules/lucide-react/dist/esm/icons/piano.js","../../../node_modules/.pnpm/@tonaljs+pitch@5.0.2/node_modules/@tonaljs/pitch/dist/index.mjs","../../../node_modules/.pnpm/@tonaljs+pitch-interval@6.1.0/node_modules/@tonaljs/pitch-interval/dist/index.mjs","../../../node_modules/.pnpm/@tonaljs+pitch-note@6.1.0/node_modules/@tonaljs/pitch-note/dist/index.mjs","../../../node_modules/.pnpm/@tonaljs+pitch-distance@5.0.5/node_modules/@tonaljs/pitch-distance/dist/index.mjs","../../../node_modules/.pnpm/@tonaljs+collection@4.9.0/node_modules/@tonaljs/collection/dist/index.mjs","../../../node_modules/.pnpm/@tonaljs+pcset@4.10.1/node_modules/@tonaljs/pcset/dist/index.mjs","../../../node_modules/.pnpm/@tonaljs+chord-type@5.1.1/node_modules/@tonaljs/chord-type/dist/index.mjs","../../../node_modules/.pnpm/@tonaljs+interval@5.1.0/node_modules/@tonaljs/interval/dist/index.mjs","../../../node_modules/.pnpm/@tonaljs+scale-type@4.9.1/node_modules/@tonaljs/scale-type/dist/index.mjs","../../../node_modules/.pnpm/@tonaljs+chord@6.1.1/node_modules/@tonaljs/chord/dist/index.mjs","../../../node_modules/.pnpm/@tonaljs+duration-value@4.9.0/node_modules/@tonaljs/duration-value/dist/index.mjs","../../../node_modules/.pnpm/@tonaljs+midi@4.10.2/node_modules/@tonaljs/midi/dist/index.mjs","../../../node_modules/.pnpm/@tonaljs+note@4.12.1/node_modules/@tonaljs/note/dist/index.mjs","../../../node_modules/.pnpm/@tonaljs+mode@4.9.1/node_modules/@tonaljs/mode/dist/index.mjs","../../../node_modules/.pnpm/@tonaljs+scale@4.13.3/node_modules/@tonaljs/scale/dist/index.mjs","../../../apps/music-practice/src/lib/utils/instrument-config.ts","../../../apps/music-practice/src/lib/utils/music-theory.ts","../../../node_modules/.pnpm/fft.js@4.0.4/node_modules/fft.js/lib/fft.js","../../../node_modules/.pnpm/pitchy@4.1.0/node_modules/pitchy/index.js","../../../apps/music-practice/src/lib/utils/pitch-detector.ts","../../../apps/music-practice/src/lib/input/audio-manager.ts","../../../apps/music-practice/src/lib/utils/storage.ts"],"sourcesContent":["/**\n * @license lucide-react v0.468.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Piano = createLucideIcon(\"Piano\", [\n  [\n    \"path\",\n    {\n      d: \"M18.5 8c-1.4 0-2.6-.8-3.2-2A6.87 6.87 0 0 0 2 9v11a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-8.5C22 9.6 20.4 8 18.5 8\",\n      key: \"lag0yf\"\n    }\n  ],\n  [\"path\", { d: \"M2 14h20\", key: \"myj16y\" }],\n  [\"path\", { d: \"M6 14v4\", key: \"9ng0ue\" }],\n  [\"path\", { d: \"M10 14v4\", key: \"1v8uk5\" }],\n  [\"path\", { d: \"M14 14v4\", key: \"1tqops\" }],\n  [\"path\", { d: \"M18 14v4\", key: \"18uqwm\" }]\n]);\n\nexport { Piano as default };\n//# sourceMappingURL=piano.js.map\n","// index.ts\nfunction isNamedPitch(src) {\n  return src !== null && typeof src === \"object\" && \"name\" in src && typeof src.name === \"string\" ? true : false;\n}\nvar SIZES = [0, 2, 4, 5, 7, 9, 11];\nvar chroma = ({ step, alt }) => (SIZES[step] + alt + 120) % 12;\nvar height = ({ step, alt, oct, dir = 1 }) => dir * (SIZES[step] + alt + 12 * (oct === void 0 ? -100 : oct));\nvar midi = (pitch2) => {\n  const h = height(pitch2);\n  return pitch2.oct !== void 0 && h >= -12 && h <= 115 ? h + 12 : null;\n};\nfunction isPitch(pitch2) {\n  return pitch2 !== null && typeof pitch2 === \"object\" && \"step\" in pitch2 && typeof pitch2.step === \"number\" && \"alt\" in pitch2 && typeof pitch2.alt === \"number\" && !isNaN(pitch2.step) && !isNaN(pitch2.alt) ? true : false;\n}\nvar FIFTHS = [0, 2, 4, -1, 1, 3, 5];\nvar STEPS_TO_OCTS = FIFTHS.map(\n  (fifths) => Math.floor(fifths * 7 / 12)\n);\nfunction coordinates(pitch2) {\n  const { step, alt, oct, dir = 1 } = pitch2;\n  const f = FIFTHS[step] + 7 * alt;\n  if (oct === void 0) {\n    return [dir * f];\n  }\n  const o = oct - STEPS_TO_OCTS[step] - 4 * alt;\n  return [dir * f, dir * o];\n}\nvar FIFTHS_TO_STEPS = [3, 0, 4, 1, 5, 2, 6];\nfunction pitch(coord) {\n  const [f, o, dir] = coord;\n  const step = FIFTHS_TO_STEPS[unaltered(f)];\n  const alt = Math.floor((f + 1) / 7);\n  if (o === void 0) {\n    return { step, alt, dir };\n  }\n  const oct = o + 4 * alt + STEPS_TO_OCTS[step];\n  return { step, alt, oct, dir };\n}\nfunction unaltered(f) {\n  const i = (f + 1) % 7;\n  return i < 0 ? 7 + i : i;\n}\nexport {\n  chroma,\n  coordinates,\n  height,\n  isNamedPitch,\n  isPitch,\n  midi,\n  pitch\n};\n//# sourceMappingURL=index.mjs.map","// index.ts\nimport {\n  coordinates,\n  isNamedPitch,\n  isPitch,\n  pitch\n} from \"@tonaljs/pitch\";\nvar fillStr = (s, n) => Array(Math.abs(n) + 1).join(s);\nvar NoInterval = Object.freeze({\n  empty: true,\n  name: \"\",\n  num: NaN,\n  q: \"\",\n  type: \"\",\n  step: NaN,\n  alt: NaN,\n  dir: NaN,\n  simple: NaN,\n  semitones: NaN,\n  chroma: NaN,\n  coord: [],\n  oct: NaN\n});\nvar INTERVAL_TONAL_REGEX = \"([-+]?\\\\d+)(d{1,4}|m|M|P|A{1,4})\";\nvar INTERVAL_SHORTHAND_REGEX = \"(AA|A|P|M|m|d|dd)([-+]?\\\\d+)\";\nvar REGEX = new RegExp(\n  \"^\" + INTERVAL_TONAL_REGEX + \"|\" + INTERVAL_SHORTHAND_REGEX + \"$\"\n);\nfunction tokenizeInterval(str) {\n  const m = REGEX.exec(`${str}`);\n  if (m === null) {\n    return [\"\", \"\"];\n  }\n  return m[1] ? [m[1], m[2]] : [m[4], m[3]];\n}\nvar cache = {};\nfunction interval(src) {\n  return typeof src === \"string\" ? cache[src] || (cache[src] = parse(src)) : isPitch(src) ? interval(pitchName(src)) : isNamedPitch(src) ? interval(src.name) : NoInterval;\n}\nvar SIZES = [0, 2, 4, 5, 7, 9, 11];\nvar TYPES = \"PMMPPMM\";\nfunction parse(str) {\n  const tokens = tokenizeInterval(str);\n  if (tokens[0] === \"\") {\n    return NoInterval;\n  }\n  const num = +tokens[0];\n  const q = tokens[1];\n  const step = (Math.abs(num) - 1) % 7;\n  const t = TYPES[step];\n  if (t === \"M\" && q === \"P\") {\n    return NoInterval;\n  }\n  const type = t === \"M\" ? \"majorable\" : \"perfectable\";\n  const name = \"\" + num + q;\n  const dir = num < 0 ? -1 : 1;\n  const simple = num === 8 || num === -8 ? num : dir * (step + 1);\n  const alt = qToAlt(type, q);\n  const oct = Math.floor((Math.abs(num) - 1) / 7);\n  const semitones = dir * (SIZES[step] + alt + 12 * oct);\n  const chroma = (dir * (SIZES[step] + alt) % 12 + 12) % 12;\n  const coord = coordinates({ step, alt, oct, dir });\n  return {\n    empty: false,\n    name,\n    num,\n    q,\n    step,\n    alt,\n    dir,\n    type,\n    simple,\n    semitones,\n    chroma,\n    coord,\n    oct\n  };\n}\nfunction coordToInterval(coord, forceDescending) {\n  const [f, o = 0] = coord;\n  const isDescending = f * 7 + o * 12 < 0;\n  const ivl = forceDescending || isDescending ? [-f, -o, -1] : [f, o, 1];\n  return interval(pitch(ivl));\n}\nfunction qToAlt(type, q) {\n  return q === \"M\" && type === \"majorable\" || q === \"P\" && type === \"perfectable\" ? 0 : q === \"m\" && type === \"majorable\" ? -1 : /^A+$/.test(q) ? q.length : /^d+$/.test(q) ? -1 * (type === \"perfectable\" ? q.length : q.length + 1) : 0;\n}\nfunction pitchName(props) {\n  const { step, alt, oct = 0, dir } = props;\n  if (!dir) {\n    return \"\";\n  }\n  const calcNum = step + 1 + 7 * oct;\n  const num = calcNum === 0 ? step + 1 : calcNum;\n  const d = dir < 0 ? \"-\" : \"\";\n  const type = TYPES[step] === \"M\" ? \"majorable\" : \"perfectable\";\n  const name = d + num + altToQ(type, alt);\n  return name;\n}\nfunction altToQ(type, alt) {\n  if (alt === 0) {\n    return type === \"majorable\" ? \"M\" : \"P\";\n  } else if (alt === -1 && type === \"majorable\") {\n    return \"m\";\n  } else if (alt > 0) {\n    return fillStr(\"A\", alt);\n  } else {\n    return fillStr(\"d\", type === \"perfectable\" ? alt : alt + 1);\n  }\n}\nexport {\n  coordToInterval,\n  interval,\n  tokenizeInterval\n};\n//# sourceMappingURL=index.mjs.map","// index.ts\nimport {\n  coordinates,\n  isNamedPitch,\n  isPitch,\n  pitch\n} from \"@tonaljs/pitch\";\nvar fillStr = (s, n) => Array(Math.abs(n) + 1).join(s);\nvar NoNote = Object.freeze({\n  empty: true,\n  name: \"\",\n  letter: \"\",\n  acc: \"\",\n  pc: \"\",\n  step: NaN,\n  alt: NaN,\n  chroma: NaN,\n  height: NaN,\n  coord: [],\n  midi: null,\n  freq: null\n});\nvar cache = /* @__PURE__ */ new Map();\nvar stepToLetter = (step) => \"CDEFGAB\".charAt(step);\nvar altToAcc = (alt) => alt < 0 ? fillStr(\"b\", -alt) : fillStr(\"#\", alt);\nvar accToAlt = (acc) => acc[0] === \"b\" ? -acc.length : acc.length;\nfunction note(src) {\n  const stringSrc = JSON.stringify(src);\n  const cached = cache.get(stringSrc);\n  if (cached) {\n    return cached;\n  }\n  const value = typeof src === \"string\" ? parse(src) : isPitch(src) ? note(pitchName(src)) : isNamedPitch(src) ? note(src.name) : NoNote;\n  cache.set(stringSrc, value);\n  return value;\n}\nvar REGEX = /^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\\d*)\\s*(.*)$/;\nfunction tokenizeNote(str) {\n  const m = REGEX.exec(str);\n  return m ? [m[1].toUpperCase(), m[2].replace(/x/g, \"##\"), m[3], m[4]] : [\"\", \"\", \"\", \"\"];\n}\nfunction coordToNote(noteCoord) {\n  return note(pitch(noteCoord));\n}\nvar mod = (n, m) => (n % m + m) % m;\nvar SEMI = [0, 2, 4, 5, 7, 9, 11];\nfunction parse(noteName) {\n  const tokens = tokenizeNote(noteName);\n  if (tokens[0] === \"\" || tokens[3] !== \"\") {\n    return NoNote;\n  }\n  const letter = tokens[0];\n  const acc = tokens[1];\n  const octStr = tokens[2];\n  const step = (letter.charCodeAt(0) + 3) % 7;\n  const alt = accToAlt(acc);\n  const oct = octStr.length ? +octStr : void 0;\n  const coord = coordinates({ step, alt, oct });\n  const name = letter + acc + octStr;\n  const pc = letter + acc;\n  const chroma = (SEMI[step] + alt + 120) % 12;\n  const height = oct === void 0 ? mod(SEMI[step] + alt, 12) - 12 * 99 : SEMI[step] + alt + 12 * (oct + 1);\n  const midi = height >= 0 && height <= 127 ? height : null;\n  const freq = oct === void 0 ? null : Math.pow(2, (height - 69) / 12) * 440;\n  return {\n    empty: false,\n    acc,\n    alt,\n    chroma,\n    coord,\n    freq,\n    height,\n    letter,\n    midi,\n    name,\n    oct,\n    pc,\n    step\n  };\n}\nfunction pitchName(props) {\n  const { step, alt, oct } = props;\n  const letter = stepToLetter(step);\n  if (!letter) {\n    return \"\";\n  }\n  const pc = letter + altToAcc(alt);\n  return oct || oct === 0 ? pc + oct : pc;\n}\nexport {\n  accToAlt,\n  altToAcc,\n  coordToNote,\n  note,\n  stepToLetter,\n  tokenizeNote\n};\n//# sourceMappingURL=index.mjs.map","// index.ts\nimport {\n  interval as asInterval,\n  coordToInterval\n} from \"@tonaljs/pitch-interval\";\nimport {\n  note as asNote,\n  coordToNote\n} from \"@tonaljs/pitch-note\";\nfunction transpose(noteName, intervalName) {\n  const note = asNote(noteName);\n  const intervalCoord = Array.isArray(intervalName) ? intervalName : asInterval(intervalName).coord;\n  if (note.empty || !intervalCoord || intervalCoord.length < 2) {\n    return \"\";\n  }\n  const noteCoord = note.coord;\n  const tr = noteCoord.length === 1 ? [noteCoord[0] + intervalCoord[0]] : [noteCoord[0] + intervalCoord[0], noteCoord[1] + intervalCoord[1]];\n  return coordToNote(tr).name;\n}\nfunction tonicIntervalsTransposer(intervals, tonic) {\n  const len = intervals.length;\n  return (normalized) => {\n    if (!tonic) return \"\";\n    const index = normalized < 0 ? (len - -normalized % len) % len : normalized % len;\n    const octaves = Math.floor(normalized / len);\n    const root = transpose(tonic, [0, octaves]);\n    return transpose(root, intervals[index]);\n  };\n}\nfunction distance(fromNote, toNote) {\n  const from = asNote(fromNote);\n  const to = asNote(toNote);\n  if (from.empty || to.empty) {\n    return \"\";\n  }\n  const fcoord = from.coord;\n  const tcoord = to.coord;\n  const fifths = tcoord[0] - fcoord[0];\n  const octs = fcoord.length === 2 && tcoord.length === 2 ? tcoord[1] - fcoord[1] : -Math.floor(fifths * 7 / 12);\n  const forceDescending = to.height === from.height && to.midi !== null && from.oct === to.oct && from.step > to.step;\n  return coordToInterval([fifths, octs], forceDescending).name;\n}\nexport {\n  distance,\n  tonicIntervalsTransposer,\n  transpose\n};\n//# sourceMappingURL=index.mjs.map","// index.ts\nfunction ascR(b, n) {\n  const a = [];\n  for (; n--; a[n] = n + b) ;\n  return a;\n}\nfunction descR(b, n) {\n  const a = [];\n  for (; n--; a[n] = b - n) ;\n  return a;\n}\nfunction range(from, to) {\n  return from < to ? ascR(from, to - from + 1) : descR(from, from - to + 1);\n}\nfunction rotate(times, arr) {\n  const len = arr.length;\n  const n = (times % len + len) % len;\n  return arr.slice(n, len).concat(arr.slice(0, n));\n}\nfunction compact(arr) {\n  return arr.filter((n) => n === 0 || n);\n}\nfunction shuffle(arr, rnd = Math.random) {\n  let i;\n  let t;\n  let m = arr.length;\n  while (m) {\n    i = Math.floor(rnd() * m--);\n    t = arr[m];\n    arr[m] = arr[i];\n    arr[i] = t;\n  }\n  return arr;\n}\nfunction permutations(arr) {\n  if (arr.length === 0) {\n    return [[]];\n  }\n  return permutations(arr.slice(1)).reduce((acc, perm) => {\n    return acc.concat(\n      arr.map((e, pos) => {\n        const newPerm = perm.slice();\n        newPerm.splice(pos, 0, arr[0]);\n        return newPerm;\n      })\n    );\n  }, []);\n}\nvar collection_default = {\n  compact,\n  permutations,\n  range,\n  rotate,\n  shuffle\n};\nexport {\n  compact,\n  collection_default as default,\n  permutations,\n  range,\n  rotate,\n  shuffle\n};\n//# sourceMappingURL=index.mjs.map","// index.ts\nimport { compact, range, rotate } from \"@tonaljs/collection\";\nimport { transpose } from \"@tonaljs/pitch-distance\";\nimport { interval } from \"@tonaljs/pitch-interval\";\nimport { note } from \"@tonaljs/pitch-note\";\nvar EmptyPcset = {\n  empty: true,\n  name: \"\",\n  setNum: 0,\n  chroma: \"000000000000\",\n  normalized: \"000000000000\",\n  intervals: []\n};\nvar setNumToChroma = (num2) => Number(num2).toString(2).padStart(12, \"0\");\nvar chromaToNumber = (chroma2) => parseInt(chroma2, 2);\nvar REGEX = /^[01]{12}$/;\nfunction isChroma(set) {\n  return REGEX.test(set);\n}\nvar isPcsetNum = (set) => typeof set === \"number\" && set >= 0 && set <= 4095;\nvar isPcset = (set) => set && isChroma(set.chroma);\nvar cache = { [EmptyPcset.chroma]: EmptyPcset };\nfunction get(src) {\n  const chroma2 = isChroma(src) ? src : isPcsetNum(src) ? setNumToChroma(src) : Array.isArray(src) ? listToChroma(src) : isPcset(src) ? src.chroma : EmptyPcset.chroma;\n  return cache[chroma2] = cache[chroma2] || chromaToPcset(chroma2);\n}\nvar pcset = get;\nvar chroma = (set) => get(set).chroma;\nvar intervals = (set) => get(set).intervals;\nvar num = (set) => get(set).setNum;\nvar IVLS = [\n  \"1P\",\n  \"2m\",\n  \"2M\",\n  \"3m\",\n  \"3M\",\n  \"4P\",\n  \"5d\",\n  \"5P\",\n  \"6m\",\n  \"6M\",\n  \"7m\",\n  \"7M\"\n];\nfunction chromaToIntervals(chroma2) {\n  const intervals2 = [];\n  for (let i = 0; i < 12; i++) {\n    if (chroma2.charAt(i) === \"1\") intervals2.push(IVLS[i]);\n  }\n  return intervals2;\n}\nfunction notes(set) {\n  return get(set).intervals.map((ivl) => transpose(\"C\", ivl));\n}\nfunction chromas() {\n  return range(2048, 4095).map(setNumToChroma);\n}\nfunction modes(set, normalize = true) {\n  const pcs = get(set);\n  const binary = pcs.chroma.split(\"\");\n  return compact(\n    binary.map((_, i) => {\n      const r = rotate(i, binary);\n      return normalize && r[0] === \"0\" ? null : r.join(\"\");\n    })\n  );\n}\nfunction isEqual(s1, s2) {\n  return get(s1).setNum === get(s2).setNum;\n}\nfunction isSubsetOf(set) {\n  const s = get(set).setNum;\n  return (notes2) => {\n    const o = get(notes2).setNum;\n    return s && s !== o && (o & s) === o;\n  };\n}\nfunction isSupersetOf(set) {\n  const s = get(set).setNum;\n  return (notes2) => {\n    const o = get(notes2).setNum;\n    return s && s !== o && (o | s) === o;\n  };\n}\nfunction isNoteIncludedIn(set) {\n  const s = get(set);\n  return (noteName) => {\n    const n = note(noteName);\n    return s && !n.empty && s.chroma.charAt(n.chroma) === \"1\";\n  };\n}\nvar includes = isNoteIncludedIn;\nfunction filter(set) {\n  const isIncluded = isNoteIncludedIn(set);\n  return (notes2) => {\n    return notes2.filter(isIncluded);\n  };\n}\nvar pcset_default = {\n  get,\n  chroma,\n  num,\n  intervals,\n  chromas,\n  isSupersetOf,\n  isSubsetOf,\n  isNoteIncludedIn,\n  isEqual,\n  filter,\n  modes,\n  notes,\n  // deprecated\n  pcset\n};\nfunction chromaRotations(chroma2) {\n  const binary = chroma2.split(\"\");\n  return binary.map((_, i) => rotate(i, binary).join(\"\"));\n}\nfunction chromaToPcset(chroma2) {\n  const setNum = chromaToNumber(chroma2);\n  const normalizedNum = chromaRotations(chroma2).map(chromaToNumber).filter((n) => n >= 2048).sort()[0];\n  const normalized = setNumToChroma(normalizedNum);\n  const intervals2 = chromaToIntervals(chroma2);\n  return {\n    empty: false,\n    name: \"\",\n    setNum,\n    chroma: chroma2,\n    normalized,\n    intervals: intervals2\n  };\n}\nfunction listToChroma(set) {\n  if (set.length === 0) {\n    return EmptyPcset.chroma;\n  }\n  let pitch;\n  const binary = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n  for (let i = 0; i < set.length; i++) {\n    pitch = note(set[i]);\n    if (pitch.empty) pitch = interval(set[i]);\n    if (!pitch.empty) binary[pitch.chroma] = 1;\n  }\n  return binary.join(\"\");\n}\nexport {\n  EmptyPcset,\n  chroma,\n  chromas,\n  pcset_default as default,\n  filter,\n  get,\n  includes,\n  intervals,\n  isChroma,\n  isEqual,\n  isNoteIncludedIn,\n  isSubsetOf,\n  isSupersetOf,\n  modes,\n  notes,\n  num,\n  pcset\n};\n//# sourceMappingURL=index.mjs.map","// index.ts\nimport {\n  EmptyPcset,\n  get as pcset\n} from \"@tonaljs/pcset\";\n\n// data.ts\nvar CHORDS = [\n  // ==Major==\n  [\"1P 3M 5P\", \"major\", \"M ^  maj\"],\n  [\"1P 3M 5P 7M\", \"major seventh\", \"maj7 \\u0394 ma7 M7 Maj7 ^7\"],\n  [\"1P 3M 5P 7M 9M\", \"major ninth\", \"maj9 \\u03949 ^9\"],\n  [\"1P 3M 5P 7M 9M 13M\", \"major thirteenth\", \"maj13 Maj13 ^13\"],\n  [\"1P 3M 5P 6M\", \"sixth\", \"6 add6 add13 M6\"],\n  [\"1P 3M 5P 6M 9M\", \"sixth added ninth\", \"6add9 6/9 69 M69\"],\n  [\"1P 3M 6m 7M\", \"major seventh flat sixth\", \"M7b6 ^7b6\"],\n  [\n    \"1P 3M 5P 7M 11A\",\n    \"major seventh sharp eleventh\",\n    \"maj#4 \\u0394#4 \\u0394#11 M7#11 ^7#11 maj7#11\"\n  ],\n  // ==Minor==\n  // '''Normal'''\n  [\"1P 3m 5P\", \"minor\", \"m min -\"],\n  [\"1P 3m 5P 7m\", \"minor seventh\", \"m7 min7 mi7 -7\"],\n  [\n    \"1P 3m 5P 7M\",\n    \"minor/major seventh\",\n    \"m/ma7 m/maj7 mM7 mMaj7 m/M7 -\\u03947 m\\u0394 -^7 -maj7\"\n  ],\n  [\"1P 3m 5P 6M\", \"minor sixth\", \"m6 -6\"],\n  [\"1P 3m 5P 7m 9M\", \"minor ninth\", \"m9 -9\"],\n  [\"1P 3m 5P 7M 9M\", \"minor/major ninth\", \"mM9 mMaj9 -^9\"],\n  [\"1P 3m 5P 7m 9M 11P\", \"minor eleventh\", \"m11 -11\"],\n  [\"1P 3m 5P 7m 9M 13M\", \"minor thirteenth\", \"m13 -13\"],\n  // '''Diminished'''\n  [\"1P 3m 5d\", \"diminished\", \"dim \\xB0 o\"],\n  [\"1P 3m 5d 7d\", \"diminished seventh\", \"dim7 \\xB07 o7\"],\n  [\"1P 3m 5d 7m\", \"half-diminished\", \"m7b5 \\xF8 -7b5 h7 h\"],\n  // ==Dominant/Seventh==\n  // '''Normal'''\n  [\"1P 3M 5P 7m\", \"dominant seventh\", \"7 dom\"],\n  [\"1P 3M 5P 7m 9M\", \"dominant ninth\", \"9\"],\n  [\"1P 3M 5P 7m 9M 13M\", \"dominant thirteenth\", \"13\"],\n  [\"1P 3M 5P 7m 11A\", \"lydian dominant seventh\", \"7#11 7#4\"],\n  // '''Altered'''\n  [\"1P 3M 5P 7m 9m\", \"dominant flat ninth\", \"7b9\"],\n  [\"1P 3M 5P 7m 9A\", \"dominant sharp ninth\", \"7#9\"],\n  [\"1P 3M 7m 9m\", \"altered\", \"alt7\"],\n  // '''Suspended'''\n  [\"1P 4P 5P\", \"suspended fourth\", \"sus4 sus\"],\n  [\"1P 2M 5P\", \"suspended second\", \"sus2\"],\n  [\"1P 4P 5P 7m\", \"suspended fourth seventh\", \"7sus4 7sus\"],\n  [\"1P 5P 7m 9M 11P\", \"eleventh\", \"11\"],\n  [\n    \"1P 4P 5P 7m 9m\",\n    \"suspended fourth flat ninth\",\n    \"b9sus phryg 7b9sus 7b9sus4\"\n  ],\n  // ==Other==\n  [\"1P 5P\", \"fifth\", \"5\"],\n  [\"1P 3M 5A\", \"augmented\", \"aug + +5 ^#5\"],\n  [\"1P 3m 5A\", \"minor augmented\", \"m#5 -#5 m+\"],\n  [\"1P 3M 5A 7M\", \"augmented seventh\", \"maj7#5 maj7+5 +maj7 ^7#5\"],\n  [\n    \"1P 3M 5P 7M 9M 11A\",\n    \"major sharp eleventh (lydian)\",\n    \"maj9#11 \\u03949#11 ^9#11\"\n  ],\n  // ==Legacy==\n  [\"1P 2M 4P 5P\", \"\", \"sus24 sus4add9\"],\n  [\"1P 3M 5A 7M 9M\", \"\", \"maj9#5 Maj9#5\"],\n  [\"1P 3M 5A 7m\", \"\", \"7#5 +7 7+ 7aug aug7\"],\n  [\"1P 3M 5A 7m 9A\", \"\", \"7#5#9 7#9#5 7alt\"],\n  [\"1P 3M 5A 7m 9M\", \"\", \"9#5 9+\"],\n  [\"1P 3M 5A 7m 9M 11A\", \"\", \"9#5#11\"],\n  [\"1P 3M 5A 7m 9m\", \"\", \"7#5b9 7b9#5\"],\n  [\"1P 3M 5A 7m 9m 11A\", \"\", \"7#5b9#11\"],\n  [\"1P 3M 5A 9A\", \"\", \"+add#9\"],\n  [\"1P 3M 5A 9M\", \"\", \"M#5add9 +add9\"],\n  [\"1P 3M 5P 6M 11A\", \"\", \"M6#11 M6b5 6#11 6b5\"],\n  [\"1P 3M 5P 6M 7M 9M\", \"\", \"M7add13\"],\n  [\"1P 3M 5P 6M 9M 11A\", \"\", \"69#11\"],\n  [\"1P 3m 5P 6M 9M\", \"\", \"m69 -69\"],\n  [\"1P 3M 5P 6m 7m\", \"\", \"7b6\"],\n  [\"1P 3M 5P 7M 9A 11A\", \"\", \"maj7#9#11\"],\n  [\"1P 3M 5P 7M 9M 11A 13M\", \"\", \"M13#11 maj13#11 M13+4 M13#4\"],\n  [\"1P 3M 5P 7M 9m\", \"\", \"M7b9\"],\n  [\"1P 3M 5P 7m 11A 13m\", \"\", \"7#11b13 7b5b13\"],\n  [\"1P 3M 5P 7m 13M\", \"\", \"7add6 67 7add13\"],\n  [\"1P 3M 5P 7m 9A 11A\", \"\", \"7#9#11 7b5#9 7#9b5\"],\n  [\"1P 3M 5P 7m 9A 11A 13M\", \"\", \"13#9#11\"],\n  [\"1P 3M 5P 7m 9A 11A 13m\", \"\", \"7#9#11b13\"],\n  [\"1P 3M 5P 7m 9A 13M\", \"\", \"13#9\"],\n  [\"1P 3M 5P 7m 9A 13m\", \"\", \"7#9b13\"],\n  [\"1P 3M 5P 7m 9M 11A\", \"\", \"9#11 9+4 9#4\"],\n  [\"1P 3M 5P 7m 9M 11A 13M\", \"\", \"13#11 13+4 13#4\"],\n  [\"1P 3M 5P 7m 9M 11A 13m\", \"\", \"9#11b13 9b5b13\"],\n  [\"1P 3M 5P 7m 9m 11A\", \"\", \"7b9#11 7b5b9 7b9b5\"],\n  [\"1P 3M 5P 7m 9m 11A 13M\", \"\", \"13b9#11\"],\n  [\"1P 3M 5P 7m 9m 11A 13m\", \"\", \"7b9b13#11 7b9#11b13 7b5b9b13\"],\n  [\"1P 3M 5P 7m 9m 13M\", \"\", \"13b9\"],\n  [\"1P 3M 5P 7m 9m 13m\", \"\", \"7b9b13\"],\n  [\"1P 3M 5P 7m 9m 9A\", \"\", \"7b9#9\"],\n  [\"1P 3M 5P 9M\", \"\", \"Madd9 2 add9 add2\"],\n  [\"1P 3M 5P 9m\", \"\", \"Maddb9\"],\n  [\"1P 3M 5d\", \"\", \"Mb5\"],\n  [\"1P 3M 5d 6M 7m 9M\", \"\", \"13b5\"],\n  [\"1P 3M 5d 7M\", \"\", \"M7b5\"],\n  [\"1P 3M 5d 7M 9M\", \"\", \"M9b5\"],\n  [\"1P 3M 5d 7m\", \"\", \"7b5\"],\n  [\"1P 3M 5d 7m 9M\", \"\", \"9b5\"],\n  [\"1P 3M 7m\", \"\", \"7no5\"],\n  [\"1P 3M 7m 13m\", \"\", \"7b13\"],\n  [\"1P 3M 7m 9M\", \"\", \"9no5\"],\n  [\"1P 3M 7m 9M 13M\", \"\", \"13no5\"],\n  [\"1P 3M 7m 9M 13m\", \"\", \"9b13\"],\n  [\"1P 3m 4P 5P\", \"\", \"madd4\"],\n  [\"1P 3m 5P 6m 7M\", \"\", \"mMaj7b6\"],\n  [\"1P 3m 5P 6m 7M 9M\", \"\", \"mMaj9b6\"],\n  [\"1P 3m 5P 7m 11P\", \"\", \"m7add11 m7add4\"],\n  [\"1P 3m 5P 9M\", \"\", \"madd9\"],\n  [\"1P 3m 5d 6M 7M\", \"\", \"o7M7\"],\n  [\"1P 3m 5d 7M\", \"\", \"oM7\"],\n  [\"1P 3m 6m 7M\", \"\", \"mb6M7\"],\n  [\"1P 3m 6m 7m\", \"\", \"m7#5\"],\n  [\"1P 3m 6m 7m 9M\", \"\", \"m9#5\"],\n  [\"1P 3m 5A 7m 9M 11P\", \"\", \"m11A\"],\n  [\"1P 3m 6m 9m\", \"\", \"mb6b9\"],\n  [\"1P 2M 3m 5d 7m\", \"\", \"m9b5\"],\n  [\"1P 4P 5A 7M\", \"\", \"M7#5sus4\"],\n  [\"1P 4P 5A 7M 9M\", \"\", \"M9#5sus4\"],\n  [\"1P 4P 5A 7m\", \"\", \"7#5sus4\"],\n  [\"1P 4P 5P 7M\", \"\", \"M7sus4\"],\n  [\"1P 4P 5P 7M 9M\", \"\", \"M9sus4\"],\n  [\"1P 4P 5P 7m 9M\", \"\", \"9sus4 9sus\"],\n  [\"1P 4P 5P 7m 9M 13M\", \"\", \"13sus4 13sus\"],\n  [\"1P 4P 5P 7m 9m 13m\", \"\", \"7sus4b9b13 7b9b13sus4\"],\n  [\"1P 4P 7m 10m\", \"\", \"4 quartal\"],\n  [\"1P 5P 7m 9m 11P\", \"\", \"11b9\"]\n];\nvar data_default = CHORDS;\n\n// index.ts\nvar NoChordType = {\n  ...EmptyPcset,\n  name: \"\",\n  quality: \"Unknown\",\n  intervals: [],\n  aliases: []\n};\nvar dictionary = [];\nvar index = {};\nfunction get(type) {\n  return index[type] || NoChordType;\n}\nvar chordType = get;\nfunction names() {\n  return dictionary.map((chord) => chord.name).filter((x) => x);\n}\nfunction symbols() {\n  return dictionary.map((chord) => chord.aliases[0]).filter((x) => x);\n}\nfunction keys() {\n  return Object.keys(index);\n}\nfunction all() {\n  return dictionary.slice();\n}\nvar entries = all;\nfunction removeAll() {\n  dictionary = [];\n  index = {};\n}\nfunction add(intervals, aliases, fullName) {\n  const quality = getQuality(intervals);\n  const chord = {\n    ...pcset(intervals),\n    name: fullName || \"\",\n    quality,\n    intervals,\n    aliases\n  };\n  dictionary.push(chord);\n  if (chord.name) {\n    index[chord.name] = chord;\n  }\n  index[chord.setNum] = chord;\n  index[chord.chroma] = chord;\n  chord.aliases.forEach((alias) => addAlias(chord, alias));\n}\nfunction addAlias(chord, alias) {\n  index[alias] = chord;\n}\nfunction getQuality(intervals) {\n  const has = (interval) => intervals.indexOf(interval) !== -1;\n  return has(\"5A\") ? \"Augmented\" : has(\"3M\") ? \"Major\" : has(\"5d\") ? \"Diminished\" : has(\"3m\") ? \"Minor\" : \"Unknown\";\n}\ndata_default.forEach(\n  ([ivls, fullName, names2]) => add(ivls.split(\" \"), names2.split(\" \"), fullName)\n);\ndictionary.sort((a, b) => a.setNum - b.setNum);\nvar chord_type_default = {\n  names,\n  symbols,\n  get,\n  all,\n  add,\n  removeAll,\n  keys,\n  // deprecated\n  entries,\n  chordType\n};\nexport {\n  add,\n  addAlias,\n  all,\n  chordType,\n  chord_type_default as default,\n  entries,\n  get,\n  keys,\n  names,\n  removeAll,\n  symbols\n};\n//# sourceMappingURL=index.mjs.map","// index.ts\nimport { distance as dist } from \"@tonaljs/pitch-distance\";\nimport {\n  coordToInterval,\n  interval as props\n} from \"@tonaljs/pitch-interval\";\nfunction names() {\n  return \"1P 2M 3M 4P 5P 6m 7m\".split(\" \");\n}\nvar get = props;\nvar name = (name2) => props(name2).name;\nvar semitones = (name2) => props(name2).semitones;\nvar quality = (name2) => props(name2).q;\nvar num = (name2) => props(name2).num;\nfunction simplify(name2) {\n  const i = props(name2);\n  return i.empty ? \"\" : i.simple + i.q;\n}\nfunction invert(name2) {\n  const i = props(name2);\n  if (i.empty) {\n    return \"\";\n  }\n  const step = (7 - i.step) % 7;\n  const alt = i.type === \"perfectable\" ? -i.alt : -(i.alt + 1);\n  return props({ step, alt, oct: i.oct, dir: i.dir }).name;\n}\nvar IN = [1, 2, 2, 3, 3, 4, 5, 5, 6, 6, 7, 7];\nvar IQ = \"P m M m M P d P m M m M\".split(\" \");\nfunction fromSemitones(semitones2) {\n  const d = semitones2 < 0 ? -1 : 1;\n  const n = Math.abs(semitones2);\n  const c = n % 12;\n  const o = Math.floor(n / 12);\n  return d * (IN[c] + 7 * o) + IQ[c];\n}\nvar distance = dist;\nvar add = combinator((a, b) => [a[0] + b[0], a[1] + b[1]]);\nvar addTo = (interval) => (other) => add(interval, other);\nvar subtract = combinator((a, b) => [a[0] - b[0], a[1] - b[1]]);\nfunction transposeFifths(interval, fifths) {\n  const ivl = get(interval);\n  if (ivl.empty) return \"\";\n  const [nFifths, nOcts, dir] = ivl.coord;\n  return coordToInterval([nFifths + fifths, nOcts, dir]).name;\n}\nvar interval_default = {\n  names,\n  get,\n  name,\n  num,\n  semitones,\n  quality,\n  fromSemitones,\n  distance,\n  invert,\n  simplify,\n  add,\n  addTo,\n  subtract,\n  transposeFifths\n};\nfunction combinator(fn) {\n  return (a, b) => {\n    const coordA = props(a).coord;\n    const coordB = props(b).coord;\n    if (coordA && coordB) {\n      const coord = fn(coordA, coordB);\n      return coordToInterval(coord).name;\n    }\n  };\n}\nexport {\n  add,\n  addTo,\n  interval_default as default,\n  distance,\n  fromSemitones,\n  get,\n  invert,\n  name,\n  names,\n  num,\n  quality,\n  semitones,\n  simplify,\n  subtract,\n  transposeFifths\n};\n//# sourceMappingURL=index.mjs.map","// index.ts\nimport {\n  EmptyPcset,\n  get as pcset\n} from \"@tonaljs/pcset\";\n\n// data.ts\nvar SCALES = [\n  // Basic scales\n  [\"1P 2M 3M 5P 6M\", \"major pentatonic\", \"pentatonic\"],\n  [\"1P 2M 3M 4P 5P 6M 7M\", \"major\", \"ionian\"],\n  [\"1P 2M 3m 4P 5P 6m 7m\", \"minor\", \"aeolian\"],\n  // Jazz common scales\n  [\"1P 2M 3m 3M 5P 6M\", \"major blues\"],\n  [\"1P 3m 4P 5d 5P 7m\", \"minor blues\", \"blues\"],\n  [\"1P 2M 3m 4P 5P 6M 7M\", \"melodic minor\"],\n  [\"1P 2M 3m 4P 5P 6m 7M\", \"harmonic minor\"],\n  [\"1P 2M 3M 4P 5P 6M 7m 7M\", \"bebop\"],\n  [\"1P 2M 3m 4P 5d 6m 6M 7M\", \"diminished\", \"whole-half diminished\"],\n  // Modes\n  [\"1P 2M 3m 4P 5P 6M 7m\", \"dorian\"],\n  [\"1P 2M 3M 4A 5P 6M 7M\", \"lydian\"],\n  [\"1P 2M 3M 4P 5P 6M 7m\", \"mixolydian\", \"dominant\"],\n  [\"1P 2m 3m 4P 5P 6m 7m\", \"phrygian\"],\n  [\"1P 2m 3m 4P 5d 6m 7m\", \"locrian\"],\n  // 5-note scales\n  [\"1P 3M 4P 5P 7M\", \"ionian pentatonic\"],\n  [\"1P 3M 4P 5P 7m\", \"mixolydian pentatonic\", \"indian\"],\n  [\"1P 2M 4P 5P 6M\", \"ritusen\"],\n  [\"1P 2M 4P 5P 7m\", \"egyptian\"],\n  [\"1P 3M 4P 5d 7m\", \"neopolitan major pentatonic\"],\n  [\"1P 3m 4P 5P 6m\", \"vietnamese 1\"],\n  [\"1P 2m 3m 5P 6m\", \"pelog\"],\n  [\"1P 2m 4P 5P 6m\", \"kumoijoshi\"],\n  [\"1P 2M 3m 5P 6m\", \"hirajoshi\"],\n  [\"1P 2m 4P 5d 7m\", \"iwato\"],\n  [\"1P 2m 4P 5P 7m\", \"in-sen\"],\n  [\"1P 3M 4A 5P 7M\", \"lydian pentatonic\", \"chinese\"],\n  [\"1P 3m 4P 6m 7m\", \"malkos raga\"],\n  [\"1P 3m 4P 5d 7m\", \"locrian pentatonic\", \"minor seven flat five pentatonic\"],\n  [\"1P 3m 4P 5P 7m\", \"minor pentatonic\", \"vietnamese 2\"],\n  [\"1P 3m 4P 5P 6M\", \"minor six pentatonic\"],\n  [\"1P 2M 3m 5P 6M\", \"flat three pentatonic\", \"kumoi\"],\n  [\"1P 2M 3M 5P 6m\", \"flat six pentatonic\"],\n  [\"1P 2m 3M 5P 6M\", \"scriabin\"],\n  [\"1P 3M 5d 6m 7m\", \"whole tone pentatonic\"],\n  [\"1P 3M 4A 5A 7M\", \"lydian #5P pentatonic\"],\n  [\"1P 3M 4A 5P 7m\", \"lydian dominant pentatonic\"],\n  [\"1P 3m 4P 5P 7M\", \"minor #7M pentatonic\"],\n  [\"1P 3m 4d 5d 7m\", \"super locrian pentatonic\"],\n  // 6-note scales\n  [\"1P 2M 3m 4P 5P 7M\", \"minor hexatonic\"],\n  [\"1P 2A 3M 5P 5A 7M\", \"augmented\"],\n  [\"1P 2M 4P 5P 6M 7m\", \"piongio\"],\n  [\"1P 2m 3M 4A 6M 7m\", \"prometheus neopolitan\"],\n  [\"1P 2M 3M 4A 6M 7m\", \"prometheus\"],\n  [\"1P 2m 3M 5d 6m 7m\", \"mystery #1\"],\n  [\"1P 2m 3M 4P 5A 6M\", \"six tone symmetric\"],\n  [\"1P 2M 3M 4A 5A 6A\", \"whole tone\", \"messiaen's mode #1\"],\n  [\"1P 2m 4P 4A 5P 7M\", \"messiaen's mode #5\"],\n  // 7-note scales\n  [\"1P 2M 3M 4P 5d 6m 7m\", \"locrian major\", \"arabian\"],\n  [\"1P 2m 3M 4A 5P 6m 7M\", \"double harmonic lydian\"],\n  [\n    \"1P 2m 2A 3M 4A 6m 7m\",\n    \"altered\",\n    \"super locrian\",\n    \"diminished whole tone\",\n    \"pomeroy\"\n  ],\n  [\"1P 2M 3m 4P 5d 6m 7m\", \"locrian #2\", \"half-diminished\", \"aeolian b5\"],\n  [\n    \"1P 2M 3M 4P 5P 6m 7m\",\n    \"mixolydian b6\",\n    \"melodic minor fifth mode\",\n    \"hindu\"\n  ],\n  [\"1P 2M 3M 4A 5P 6M 7m\", \"lydian dominant\", \"lydian b7\", \"overtone\"],\n  [\"1P 2M 3M 4A 5A 6M 7M\", \"lydian augmented\"],\n  [\n    \"1P 2m 3m 4P 5P 6M 7m\",\n    \"dorian b2\",\n    \"phrygian #6\",\n    \"melodic minor second mode\"\n  ],\n  [\n    \"1P 2m 3m 4d 5d 6m 7d\",\n    \"ultralocrian\",\n    \"superlocrian bb7\",\n    \"superlocrian diminished\"\n  ],\n  [\"1P 2m 3m 4P 5d 6M 7m\", \"locrian 6\", \"locrian natural 6\", \"locrian sharp 6\"],\n  [\"1P 2A 3M 4P 5P 5A 7M\", \"augmented heptatonic\"],\n  // Source https://en.wikipedia.org/wiki/Ukrainian_Dorian_scale\n  [\n    \"1P 2M 3m 4A 5P 6M 7m\",\n    \"dorian #4\",\n    \"ukrainian dorian\",\n    \"romanian minor\",\n    \"altered dorian\"\n  ],\n  [\"1P 2M 3m 4A 5P 6M 7M\", \"lydian diminished\"],\n  [\"1P 2M 3M 4A 5A 7m 7M\", \"leading whole tone\"],\n  [\"1P 2M 3M 4A 5P 6m 7m\", \"lydian minor\"],\n  [\"1P 2m 3M 4P 5P 6m 7m\", \"phrygian dominant\", \"spanish\", \"phrygian major\"],\n  [\"1P 2m 3m 4P 5P 6m 7M\", \"balinese\"],\n  [\"1P 2m 3m 4P 5P 6M 7M\", \"neopolitan major\"],\n  [\"1P 2M 3M 4P 5P 6m 7M\", \"harmonic major\"],\n  [\"1P 2m 3M 4P 5P 6m 7M\", \"double harmonic major\", \"gypsy\"],\n  [\"1P 2M 3m 4A 5P 6m 7M\", \"hungarian minor\"],\n  [\"1P 2A 3M 4A 5P 6M 7m\", \"hungarian major\"],\n  [\"1P 2m 3M 4P 5d 6M 7m\", \"oriental\"],\n  [\"1P 2m 3m 3M 4A 5P 7m\", \"flamenco\"],\n  [\"1P 2m 3m 4A 5P 6m 7M\", \"todi raga\"],\n  [\"1P 2m 3M 4P 5d 6m 7M\", \"persian\"],\n  [\"1P 2m 3M 5d 6m 7m 7M\", \"enigmatic\"],\n  [\n    \"1P 2M 3M 4P 5A 6M 7M\",\n    \"major augmented\",\n    \"major #5\",\n    \"ionian augmented\",\n    \"ionian #5\"\n  ],\n  [\"1P 2A 3M 4A 5P 6M 7M\", \"lydian #9\"],\n  // 8-note scales\n  [\"1P 2m 2M 4P 4A 5P 6m 7M\", \"messiaen's mode #4\"],\n  [\"1P 2m 3M 4P 4A 5P 6m 7M\", \"purvi raga\"],\n  [\"1P 2m 3m 3M 4P 5P 6m 7m\", \"spanish heptatonic\"],\n  [\"1P 2M 3m 3M 4P 5P 6M 7m\", \"bebop minor\"],\n  [\"1P 2M 3M 4P 5P 5A 6M 7M\", \"bebop major\"],\n  [\"1P 2m 3m 4P 5d 5P 6m 7m\", \"bebop locrian\"],\n  [\"1P 2M 3m 4P 5P 6m 7m 7M\", \"minor bebop\"],\n  [\"1P 2M 3M 4P 5d 5P 6M 7M\", \"ichikosucho\"],\n  [\"1P 2M 3m 4P 5P 6m 6M 7M\", \"minor six diminished\"],\n  [\n    \"1P 2m 3m 3M 4A 5P 6M 7m\",\n    \"half-whole diminished\",\n    \"dominant diminished\",\n    \"messiaen's mode #2\"\n  ],\n  [\"1P 3m 3M 4P 5P 6M 7m 7M\", \"kafi raga\"],\n  [\"1P 2M 3M 4P 4A 5A 6A 7M\", \"messiaen's mode #6\"],\n  // 9-note scales\n  [\"1P 2M 3m 3M 4P 5d 5P 6M 7m\", \"composite blues\"],\n  [\"1P 2M 3m 3M 4A 5P 6m 7m 7M\", \"messiaen's mode #3\"],\n  // 10-note scales\n  [\"1P 2m 2M 3m 4P 4A 5P 6m 6M 7M\", \"messiaen's mode #7\"],\n  // 12-note scales\n  [\"1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M\", \"chromatic\"]\n];\nvar data_default = SCALES;\n\n// index.ts\nvar NoScaleType = {\n  ...EmptyPcset,\n  intervals: [],\n  aliases: []\n};\nvar dictionary = [];\nvar index = {};\nfunction names() {\n  return dictionary.map((scale) => scale.name);\n}\nfunction get(type) {\n  return index[type] || NoScaleType;\n}\nvar scaleType = get;\nfunction all() {\n  return dictionary.slice();\n}\nvar entries = all;\nfunction keys() {\n  return Object.keys(index);\n}\nfunction removeAll() {\n  dictionary = [];\n  index = {};\n}\nfunction add(intervals, name, aliases = []) {\n  const scale = { ...pcset(intervals), name, intervals, aliases };\n  dictionary.push(scale);\n  index[scale.name] = scale;\n  index[scale.setNum] = scale;\n  index[scale.chroma] = scale;\n  scale.aliases.forEach((alias) => addAlias(scale, alias));\n  return scale;\n}\nfunction addAlias(scale, alias) {\n  index[alias] = scale;\n}\ndata_default.forEach(\n  ([ivls, name, ...aliases]) => add(ivls.split(\" \"), name, aliases)\n);\nvar scale_type_default = {\n  names,\n  get,\n  all,\n  add,\n  removeAll,\n  keys,\n  // deprecated\n  entries,\n  scaleType\n};\nexport {\n  NoScaleType,\n  add,\n  addAlias,\n  all,\n  scale_type_default as default,\n  entries,\n  get,\n  keys,\n  names,\n  removeAll,\n  scaleType\n};\n//# sourceMappingURL=index.mjs.map","// index.ts\nimport { detect } from \"@tonaljs/chord-detect\";\nimport {\n  all as chordTypes,\n  get as getChordType\n} from \"@tonaljs/chord-type\";\nimport { subtract } from \"@tonaljs/interval\";\nimport { isSubsetOf, isSupersetOf } from \"@tonaljs/pcset\";\nimport {\n  distance,\n  tonicIntervalsTransposer,\n  transpose as transposeNote\n} from \"@tonaljs/pitch-distance\";\nimport { note, tokenizeNote } from \"@tonaljs/pitch-note\";\nimport { all as scaleTypes } from \"@tonaljs/scale-type\";\nimport { detect as detect2 } from \"@tonaljs/chord-detect\";\nvar NoChord = {\n  empty: true,\n  name: \"\",\n  symbol: \"\",\n  root: \"\",\n  bass: \"\",\n  rootDegree: 0,\n  type: \"\",\n  tonic: null,\n  setNum: NaN,\n  quality: \"Unknown\",\n  chroma: \"\",\n  normalized: \"\",\n  aliases: [],\n  notes: [],\n  intervals: []\n};\nfunction tokenize(name) {\n  const [letter, acc, oct, type] = tokenizeNote(name);\n  if (letter === \"\") {\n    return tokenizeBass(\"\", name);\n  } else if (letter === \"A\" && type === \"ug\") {\n    return tokenizeBass(\"\", \"aug\");\n  } else {\n    return tokenizeBass(letter + acc, oct + type);\n  }\n}\nfunction tokenizeBass(note2, chord2) {\n  const split = chord2.split(\"/\");\n  if (split.length === 1) {\n    return [note2, split[0], \"\"];\n  }\n  const [letter, acc, oct, type] = tokenizeNote(split[1]);\n  if (letter !== \"\" && oct === \"\" && type === \"\") {\n    return [note2, split[0], letter + acc];\n  } else {\n    return [note2, chord2, \"\"];\n  }\n}\nfunction get(src) {\n  if (Array.isArray(src)) {\n    return getChord(src[1] || \"\", src[0], src[2]);\n  } else if (src === \"\") {\n    return NoChord;\n  } else {\n    const [tonic, type, bass] = tokenize(src);\n    const chord2 = getChord(type, tonic, bass);\n    return chord2.empty ? getChord(src) : chord2;\n  }\n}\nfunction getChord(typeName, optionalTonic, optionalBass) {\n  const type = getChordType(typeName);\n  const tonic = note(optionalTonic || \"\");\n  const bass = note(optionalBass || \"\");\n  if (type.empty || optionalTonic && tonic.empty || optionalBass && bass.empty) {\n    return NoChord;\n  }\n  const bassInterval = distance(tonic.pc, bass.pc);\n  const bassIndex = type.intervals.indexOf(bassInterval);\n  const hasRoot = bassIndex >= 0;\n  const root = hasRoot ? bass : note(\"\");\n  const rootDegree = bassIndex === -1 ? NaN : bassIndex + 1;\n  const hasBass = bass.pc && bass.pc !== tonic.pc;\n  const intervals = Array.from(type.intervals);\n  if (hasRoot) {\n    for (let i = 1; i < rootDegree; i++) {\n      const num = intervals[0][0];\n      const quality = intervals[0][1];\n      const newNum = parseInt(num, 10) + 7;\n      intervals.push(`${newNum}${quality}`);\n      intervals.shift();\n    }\n  } else if (hasBass) {\n    const ivl = subtract(distance(tonic.pc, bass.pc), \"8P\");\n    if (ivl) intervals.unshift(ivl);\n  }\n  const notes2 = tonic.empty ? [] : intervals.map((i) => transposeNote(tonic.pc, i));\n  typeName = type.aliases.indexOf(typeName) !== -1 ? typeName : type.aliases[0];\n  const symbol = `${tonic.empty ? \"\" : tonic.pc}${typeName}${hasRoot && rootDegree > 1 ? \"/\" + root.pc : hasBass ? \"/\" + bass.pc : \"\"}`;\n  const name = `${optionalTonic ? tonic.pc + \" \" : \"\"}${type.name}${hasRoot && rootDegree > 1 ? \" over \" + root.pc : hasBass ? \" over \" + bass.pc : \"\"}`;\n  return {\n    ...type,\n    name,\n    symbol,\n    tonic: tonic.pc,\n    type: type.name,\n    root: root.pc,\n    bass: hasBass ? bass.pc : \"\",\n    intervals,\n    rootDegree,\n    notes: notes2\n  };\n}\nvar chord = get;\nfunction transpose(chordName, interval) {\n  const [tonic, type, bass] = tokenize(chordName);\n  if (!tonic) {\n    return chordName;\n  }\n  const tr = transposeNote(bass, interval);\n  const slash = tr ? \"/\" + tr : \"\";\n  return transposeNote(tonic, interval) + type + slash;\n}\nfunction chordScales(name) {\n  const s = get(name);\n  const isChordIncluded = isSupersetOf(s.chroma);\n  return scaleTypes().filter((scale) => isChordIncluded(scale.chroma)).map((scale) => scale.name);\n}\nfunction extended(chordName) {\n  const s = get(chordName);\n  const isSuperset = isSupersetOf(s.chroma);\n  return chordTypes().filter((chord2) => isSuperset(chord2.chroma)).map((chord2) => s.tonic + chord2.aliases[0]);\n}\nfunction reduced(chordName) {\n  const s = get(chordName);\n  const isSubset = isSubsetOf(s.chroma);\n  return chordTypes().filter((chord2) => isSubset(chord2.chroma)).map((chord2) => s.tonic + chord2.aliases[0]);\n}\nfunction notes(chordName, tonic) {\n  const chord2 = get(chordName);\n  const note2 = tonic || chord2.tonic;\n  if (!note2 || chord2.empty) return [];\n  return chord2.intervals.map((ivl) => transposeNote(note2, ivl));\n}\nfunction degrees(chordName, tonic) {\n  const chord2 = get(chordName);\n  const note2 = tonic || chord2.tonic;\n  const transpose2 = tonicIntervalsTransposer(chord2.intervals, note2);\n  return (degree) => degree ? transpose2(degree > 0 ? degree - 1 : degree) : \"\";\n}\nfunction steps(chordName, tonic) {\n  const chord2 = get(chordName);\n  const note2 = tonic || chord2.tonic;\n  return tonicIntervalsTransposer(chord2.intervals, note2);\n}\nvar chord_default = {\n  getChord,\n  get,\n  detect,\n  chordScales,\n  extended,\n  reduced,\n  tokenize,\n  transpose,\n  degrees,\n  steps,\n  notes,\n  chord\n};\nexport {\n  chord,\n  chordScales,\n  chord_default as default,\n  degrees,\n  detect2 as detect,\n  extended,\n  get,\n  getChord,\n  notes,\n  reduced,\n  steps,\n  tokenize,\n  transpose\n};\n//# sourceMappingURL=index.mjs.map","// data.ts\nvar DATA = [\n  [\n    0.125,\n    \"dl\",\n    [\"large\", \"duplex longa\", \"maxima\", \"octuple\", \"octuple whole\"]\n  ],\n  [0.25, \"l\", [\"long\", \"longa\"]],\n  [0.5, \"d\", [\"double whole\", \"double\", \"breve\"]],\n  [1, \"w\", [\"whole\", \"semibreve\"]],\n  [2, \"h\", [\"half\", \"minim\"]],\n  [4, \"q\", [\"quarter\", \"crotchet\"]],\n  [8, \"e\", [\"eighth\", \"quaver\"]],\n  [16, \"s\", [\"sixteenth\", \"semiquaver\"]],\n  [32, \"t\", [\"thirty-second\", \"demisemiquaver\"]],\n  [64, \"sf\", [\"sixty-fourth\", \"hemidemisemiquaver\"]],\n  [128, \"h\", [\"hundred twenty-eighth\"]],\n  [256, \"th\", [\"two hundred fifty-sixth\"]]\n];\nvar data_default = DATA;\n\n// index.ts\nvar VALUES = [];\ndata_default.forEach(\n  ([denominator, shorthand, names2]) => add(denominator, shorthand, names2)\n);\nvar NoDuration = {\n  empty: true,\n  name: \"\",\n  value: 0,\n  fraction: [0, 0],\n  shorthand: \"\",\n  dots: \"\",\n  names: []\n};\nfunction names() {\n  return VALUES.reduce((names2, duration) => {\n    duration.names.forEach((name) => names2.push(name));\n    return names2;\n  }, []);\n}\nfunction shorthands() {\n  return VALUES.map((dur) => dur.shorthand);\n}\nvar REGEX = /^([^.]+)(\\.*)$/;\nfunction get(name) {\n  const [_, simple, dots] = REGEX.exec(name) || [];\n  const base = VALUES.find(\n    (dur) => dur.shorthand === simple || dur.names.includes(simple)\n  );\n  if (!base) {\n    return NoDuration;\n  }\n  const fraction2 = calcDots(base.fraction, dots.length);\n  const value2 = fraction2[0] / fraction2[1];\n  return { ...base, name, dots, value: value2, fraction: fraction2 };\n}\nvar value = (name) => get(name).value;\nvar fraction = (name) => get(name).fraction;\nvar duration_value_default = { names, shorthands, get, value, fraction };\nfunction add(denominator, shorthand, names2) {\n  VALUES.push({\n    empty: false,\n    dots: \"\",\n    name: \"\",\n    value: 1 / denominator,\n    fraction: denominator < 1 ? [1 / denominator, 1] : [1, denominator],\n    shorthand,\n    names: names2\n  });\n}\nfunction calcDots(fraction2, dots) {\n  const pow = Math.pow(2, dots);\n  let numerator = fraction2[0] * pow;\n  let denominator = fraction2[1] * pow;\n  const base = numerator;\n  for (let i = 0; i < dots; i++) {\n    numerator += base / Math.pow(2, i + 1);\n  }\n  while (numerator % 2 === 0 && denominator % 2 === 0) {\n    numerator /= 2;\n    denominator /= 2;\n  }\n  return [numerator, denominator];\n}\nexport {\n  duration_value_default as default,\n  fraction,\n  get,\n  names,\n  shorthands,\n  value\n};\n//# sourceMappingURL=index.mjs.map","// index.ts\nimport { note as props } from \"@tonaljs/pitch-note\";\nfunction isMidi(arg) {\n  return +arg >= 0 && +arg <= 127;\n}\nfunction toMidi(note) {\n  if (isMidi(note)) {\n    return +note;\n  }\n  const n = props(note);\n  return n.empty ? null : n.midi;\n}\nfunction midiToFreq(midi, tuning = 440) {\n  return Math.pow(2, (midi - 69) / 12) * tuning;\n}\nvar L2 = Math.log(2);\nvar L440 = Math.log(440);\nfunction freqToMidi(freq) {\n  const v = 12 * (Math.log(freq) - L440) / L2 + 69;\n  return Math.round(v * 100) / 100;\n}\nvar SHARPS = \"C C# D D# E F F# G G# A A# B\".split(\" \");\nvar FLATS = \"C Db D Eb E F Gb G Ab A Bb B\".split(\" \");\nfunction midiToNoteName(midi, options = {}) {\n  if (isNaN(midi) || midi === -Infinity || midi === Infinity) return \"\";\n  midi = Math.round(midi);\n  const pcs = options.sharps === true ? SHARPS : FLATS;\n  const pc = pcs[midi % 12];\n  if (options.pitchClass) {\n    return pc;\n  }\n  const o = Math.floor(midi / 12) - 1;\n  return pc + o;\n}\nfunction chroma(midi) {\n  return midi % 12;\n}\nfunction pcsetFromChroma(chroma2) {\n  return chroma2.split(\"\").reduce((pcset2, val, index) => {\n    if (index < 12 && val === \"1\") pcset2.push(index);\n    return pcset2;\n  }, []);\n}\nfunction pcsetFromMidi(midi) {\n  return midi.map(chroma).sort((a, b) => a - b).filter((n, i, a) => i === 0 || n !== a[i - 1]);\n}\nfunction pcset(notes) {\n  return Array.isArray(notes) ? pcsetFromMidi(notes) : pcsetFromChroma(notes);\n}\nfunction pcsetNearest(notes) {\n  const set = pcset(notes);\n  return (midi) => {\n    const ch = chroma(midi);\n    for (let i = 0; i < 12; i++) {\n      if (set.includes(ch + i)) return midi + i;\n      if (set.includes(ch - i)) return midi - i;\n    }\n    return void 0;\n  };\n}\nfunction pcsetSteps(notes, tonic) {\n  const set = pcset(notes);\n  const len = set.length;\n  return (step) => {\n    const index = step < 0 ? (len - -step % len) % len : step % len;\n    const octaves = Math.floor(step / len);\n    return set[index] + octaves * 12 + tonic;\n  };\n}\nfunction pcsetDegrees(notes, tonic) {\n  const steps = pcsetSteps(notes, tonic);\n  return (degree) => {\n    if (degree === 0) return void 0;\n    return steps(degree > 0 ? degree - 1 : degree);\n  };\n}\nvar index_default = {\n  chroma,\n  freqToMidi,\n  isMidi,\n  midiToFreq,\n  midiToNoteName,\n  pcsetNearest,\n  pcset,\n  pcsetDegrees,\n  pcsetSteps,\n  toMidi\n};\nexport {\n  chroma,\n  index_default as default,\n  freqToMidi,\n  isMidi,\n  midiToFreq,\n  midiToNoteName,\n  pcset,\n  pcsetDegrees,\n  pcsetNearest,\n  pcsetSteps,\n  toMidi\n};\n//# sourceMappingURL=index.mjs.map","// index.ts\nimport { freqToMidi, midiToNoteName } from \"@tonaljs/midi\";\nimport { distance as _dist, transpose as _tr } from \"@tonaljs/pitch-distance\";\nimport {\n  note as props\n} from \"@tonaljs/pitch-note\";\nvar NAMES = [\"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\"];\nvar toName = (n) => n.name;\nvar onlyNotes = (array) => array.map(props).filter((n) => !n.empty);\nfunction names(array) {\n  if (array === void 0) {\n    return NAMES.slice();\n  } else if (!Array.isArray(array)) {\n    return [];\n  } else {\n    return onlyNotes(array).map(toName);\n  }\n}\nvar get = props;\nvar name = (note) => get(note).name;\nvar pitchClass = (note) => get(note).pc;\nvar accidentals = (note) => get(note).acc;\nvar octave = (note) => get(note).oct;\nvar midi = (note) => get(note).midi;\nvar freq = (note) => get(note).freq;\nvar chroma = (note) => get(note).chroma;\nfunction fromMidi(midi2) {\n  return midiToNoteName(midi2);\n}\nfunction fromFreq(freq2) {\n  return midiToNoteName(freqToMidi(freq2));\n}\nfunction fromFreqSharps(freq2) {\n  return midiToNoteName(freqToMidi(freq2), { sharps: true });\n}\nfunction fromMidiSharps(midi2) {\n  return midiToNoteName(midi2, { sharps: true });\n}\nvar distance = _dist;\nvar transpose = _tr;\nvar tr = _tr;\nvar transposeBy = (interval) => (note) => transpose(note, interval);\nvar trBy = transposeBy;\nvar transposeFrom = (note) => (interval) => transpose(note, interval);\nvar trFrom = transposeFrom;\nfunction transposeFifths(noteName, fifths) {\n  return transpose(noteName, [fifths, 0]);\n}\nvar trFifths = transposeFifths;\nfunction transposeOctaves(noteName, octaves) {\n  return transpose(noteName, [0, octaves]);\n}\nvar ascending = (a, b) => a.height - b.height;\nvar descending = (a, b) => b.height - a.height;\nfunction sortedNames(notes, comparator) {\n  comparator = comparator || ascending;\n  return onlyNotes(notes).sort(comparator).map(toName);\n}\nfunction sortedUniqNames(notes) {\n  return sortedNames(notes, ascending).filter(\n    (n, i, a) => i === 0 || n !== a[i - 1]\n  );\n}\nvar simplify = (noteName) => {\n  const note = get(noteName);\n  if (note.empty) {\n    return \"\";\n  }\n  return midiToNoteName(note.midi || note.chroma, {\n    sharps: note.alt > 0,\n    pitchClass: note.midi === null\n  });\n};\nfunction enharmonic(noteName, destName) {\n  const src = get(noteName);\n  if (src.empty) {\n    return \"\";\n  }\n  const dest = get(\n    destName || midiToNoteName(src.midi || src.chroma, {\n      sharps: src.alt < 0,\n      pitchClass: true\n    })\n  );\n  if (dest.empty || dest.chroma !== src.chroma) {\n    return \"\";\n  }\n  if (src.oct === void 0) {\n    return dest.pc;\n  }\n  const srcChroma = src.chroma - src.alt;\n  const destChroma = dest.chroma - dest.alt;\n  const destOctOffset = srcChroma > 11 || destChroma < 0 ? -1 : srcChroma < 0 || destChroma > 11 ? 1 : 0;\n  const destOct = src.oct + destOctOffset;\n  return dest.pc + destOct;\n}\nvar index_default = {\n  names,\n  get,\n  name,\n  pitchClass,\n  accidentals,\n  octave,\n  midi,\n  ascending,\n  descending,\n  distance,\n  sortedNames,\n  sortedUniqNames,\n  fromMidi,\n  fromMidiSharps,\n  freq,\n  fromFreq,\n  fromFreqSharps,\n  chroma,\n  transpose,\n  tr,\n  transposeBy,\n  trBy,\n  transposeFrom,\n  trFrom,\n  transposeFifths,\n  transposeOctaves,\n  trFifths,\n  simplify,\n  enharmonic\n};\nexport {\n  accidentals,\n  ascending,\n  chroma,\n  index_default as default,\n  descending,\n  distance,\n  enharmonic,\n  freq,\n  fromFreq,\n  fromFreqSharps,\n  fromMidi,\n  fromMidiSharps,\n  get,\n  midi,\n  name,\n  names,\n  octave,\n  pitchClass,\n  simplify,\n  sortedNames,\n  sortedUniqNames,\n  tr,\n  trBy,\n  trFifths,\n  trFrom,\n  transpose,\n  transposeBy,\n  transposeFifths,\n  transposeFrom,\n  transposeOctaves\n};\n//# sourceMappingURL=index.mjs.map","// index.ts\nimport { rotate } from \"@tonaljs/collection\";\nimport { simplify, transposeFifths } from \"@tonaljs/interval\";\nimport { EmptyPcset } from \"@tonaljs/pcset\";\nimport { transpose } from \"@tonaljs/pitch-distance\";\nimport { get as getType } from \"@tonaljs/scale-type\";\nvar MODES = [\n  [0, 2773, 0, \"ionian\", \"\", \"Maj7\", \"major\"],\n  [1, 2902, 2, \"dorian\", \"m\", \"m7\"],\n  [2, 3418, 4, \"phrygian\", \"m\", \"m7\"],\n  [3, 2741, -1, \"lydian\", \"\", \"Maj7\"],\n  [4, 2774, 1, \"mixolydian\", \"\", \"7\"],\n  [5, 2906, 3, \"aeolian\", \"m\", \"m7\", \"minor\"],\n  [6, 3434, 5, \"locrian\", \"dim\", \"m7b5\"]\n];\nvar NoMode = {\n  ...EmptyPcset,\n  name: \"\",\n  alt: 0,\n  modeNum: NaN,\n  triad: \"\",\n  seventh: \"\",\n  aliases: []\n};\nvar modes = MODES.map(toMode);\nvar index = {};\nmodes.forEach((mode2) => {\n  index[mode2.name] = mode2;\n  mode2.aliases.forEach((alias) => {\n    index[alias] = mode2;\n  });\n});\nfunction get(name) {\n  return typeof name === \"string\" ? index[name.toLowerCase()] || NoMode : name && name.name ? get(name.name) : NoMode;\n}\nvar mode = get;\nfunction all() {\n  return modes.slice();\n}\nvar entries = all;\nfunction names() {\n  return modes.map((mode2) => mode2.name);\n}\nfunction toMode(mode2) {\n  const [modeNum, setNum, alt, name, triad, seventh, alias] = mode2;\n  const aliases = alias ? [alias] : [];\n  const chroma = Number(setNum).toString(2);\n  const intervals = getType(name).intervals;\n  return {\n    empty: false,\n    intervals,\n    modeNum,\n    chroma,\n    normalized: chroma,\n    name,\n    setNum,\n    alt,\n    triad,\n    seventh,\n    aliases\n  };\n}\nfunction notes(modeName, tonic) {\n  return get(modeName).intervals.map((ivl) => transpose(tonic, ivl));\n}\nfunction chords(chords2) {\n  return (modeName, tonic) => {\n    const mode2 = get(modeName);\n    if (mode2.empty) return [];\n    const triads2 = rotate(mode2.modeNum, chords2);\n    const tonics = mode2.intervals.map((i) => transpose(tonic, i));\n    return triads2.map((triad, i) => tonics[i] + triad);\n  };\n}\nvar triads = chords(MODES.map((x) => x[4]));\nvar seventhChords = chords(MODES.map((x) => x[5]));\nfunction distance(destination, source) {\n  const from = get(source);\n  const to = get(destination);\n  if (from.empty || to.empty) return \"\";\n  return simplify(transposeFifths(\"1P\", to.alt - from.alt));\n}\nfunction relativeTonic(destination, source, tonic) {\n  return transpose(tonic, distance(destination, source));\n}\nvar mode_default = {\n  get,\n  names,\n  all,\n  distance,\n  relativeTonic,\n  notes,\n  triads,\n  seventhChords,\n  // deprecated\n  entries,\n  mode\n};\nexport {\n  all,\n  mode_default as default,\n  distance,\n  entries,\n  get,\n  mode,\n  names,\n  notes,\n  relativeTonic,\n  seventhChords,\n  triads\n};\n//# sourceMappingURL=index.mjs.map","// index.ts\nimport { all as chordTypes } from \"@tonaljs/chord-type\";\nimport { range as nums, rotate } from \"@tonaljs/collection\";\nimport { enharmonic, fromMidi, sortedUniqNames } from \"@tonaljs/note\";\nimport {\n  chroma,\n  isChroma,\n  isSubsetOf,\n  isSupersetOf,\n  modes\n} from \"@tonaljs/pcset\";\nimport { tonicIntervalsTransposer, transpose } from \"@tonaljs/pitch-distance\";\nimport { note } from \"@tonaljs/pitch-note\";\nimport {\n  all,\n  get as getScaleType,\n  names as scaleTypeNames,\n  all as scaleTypes\n} from \"@tonaljs/scale-type\";\nvar NoScale = {\n  empty: true,\n  name: \"\",\n  type: \"\",\n  tonic: null,\n  setNum: NaN,\n  chroma: \"\",\n  normalized: \"\",\n  aliases: [],\n  notes: [],\n  intervals: []\n};\nfunction tokenize(name) {\n  if (typeof name !== \"string\") {\n    return [\"\", \"\"];\n  }\n  const i = name.indexOf(\" \");\n  const tonic = note(name.substring(0, i));\n  if (tonic.empty) {\n    const n = note(name);\n    return n.empty ? [\"\", name.toLowerCase()] : [n.name, \"\"];\n  }\n  const type = name.substring(tonic.name.length + 1).toLowerCase();\n  return [tonic.name, type.length ? type : \"\"];\n}\nvar names = scaleTypeNames;\nfunction get(src) {\n  const tokens = Array.isArray(src) ? src : tokenize(src);\n  const tonic = note(tokens[0]).name;\n  const st = getScaleType(tokens[1]);\n  if (st.empty) {\n    return NoScale;\n  }\n  const type = st.name;\n  const notes = tonic ? st.intervals.map((i) => transpose(tonic, i)) : [];\n  const name = tonic ? tonic + \" \" + type : type;\n  return { ...st, name, type, tonic, notes };\n}\nvar scale = get;\nfunction detect(notes, options = {}) {\n  const notesChroma = chroma(notes);\n  const tonic = note(options.tonic ?? notes[0] ?? \"\");\n  const tonicChroma = tonic.chroma;\n  if (tonicChroma === void 0) {\n    return [];\n  }\n  const pitchClasses = notesChroma.split(\"\");\n  pitchClasses[tonicChroma] = \"1\";\n  const scaleChroma = rotate(tonicChroma, pitchClasses).join(\"\");\n  const match = all().find((scaleType) => scaleType.chroma === scaleChroma);\n  const results = [];\n  if (match) {\n    results.push(tonic.name + \" \" + match.name);\n  }\n  if (options.match === \"exact\") {\n    return results;\n  }\n  extended(scaleChroma).forEach((scaleName) => {\n    results.push(tonic.name + \" \" + scaleName);\n  });\n  return results;\n}\nfunction scaleChords(name) {\n  const s = get(name);\n  const inScale = isSubsetOf(s.chroma);\n  return chordTypes().filter((chord) => inScale(chord.chroma)).map((chord) => chord.aliases[0]);\n}\nfunction extended(name) {\n  const chroma2 = isChroma(name) ? name : get(name).chroma;\n  const isSuperset = isSupersetOf(chroma2);\n  return scaleTypes().filter((scale2) => isSuperset(scale2.chroma)).map((scale2) => scale2.name);\n}\nfunction reduced(name) {\n  const isSubset = isSubsetOf(get(name).chroma);\n  return scaleTypes().filter((scale2) => isSubset(scale2.chroma)).map((scale2) => scale2.name);\n}\nfunction scaleNotes(notes) {\n  const pcset = notes.map((n) => note(n).pc).filter((x) => x);\n  const tonic = pcset[0];\n  const scale2 = sortedUniqNames(pcset);\n  return rotate(scale2.indexOf(tonic), scale2);\n}\nfunction modeNames(name) {\n  const s = get(name);\n  if (s.empty) {\n    return [];\n  }\n  const tonics = s.tonic ? s.notes : s.intervals;\n  return modes(s.chroma).map((chroma2, i) => {\n    const modeName = get(chroma2).name;\n    return modeName ? [tonics[i], modeName] : [\"\", \"\"];\n  }).filter((x) => x[0]);\n}\nfunction getNoteNameOf(scale2) {\n  const names2 = Array.isArray(scale2) ? scaleNotes(scale2) : get(scale2).notes;\n  const chromas = names2.map((name) => note(name).chroma);\n  return (noteOrMidi) => {\n    const currNote = typeof noteOrMidi === \"number\" ? note(fromMidi(noteOrMidi)) : note(noteOrMidi);\n    const height = currNote.height;\n    if (height === void 0) return void 0;\n    const chroma2 = height % 12;\n    const position = chromas.indexOf(chroma2);\n    if (position === -1) return void 0;\n    return enharmonic(currNote.name, names2[position]);\n  };\n}\nfunction rangeOf(scale2) {\n  const getName = getNoteNameOf(scale2);\n  return (fromNote, toNote) => {\n    const from = note(fromNote).height;\n    const to = note(toNote).height;\n    if (from === void 0 || to === void 0) return [];\n    return nums(from, to).map(getName).filter((x) => x);\n  };\n}\nfunction degrees(scaleName) {\n  const { intervals, tonic } = get(scaleName);\n  const transpose2 = tonicIntervalsTransposer(intervals, tonic);\n  return (degree) => degree ? transpose2(degree > 0 ? degree - 1 : degree) : \"\";\n}\nfunction steps(scaleName) {\n  const { intervals, tonic } = get(scaleName);\n  return tonicIntervalsTransposer(intervals, tonic);\n}\nvar index_default = {\n  degrees,\n  detect,\n  extended,\n  get,\n  modeNames,\n  names,\n  rangeOf,\n  reduced,\n  scaleChords,\n  scaleNotes,\n  steps,\n  tokenize,\n  // deprecated\n  scale\n};\nexport {\n  index_default as default,\n  degrees,\n  detect,\n  extended,\n  get,\n  modeNames,\n  names,\n  rangeOf,\n  reduced,\n  scale,\n  scaleChords,\n  scaleNotes,\n  steps,\n  tokenize\n};\n//# sourceMappingURL=index.mjs.map","/**\n * Instrument Configuration System\n * Defines profiles for different instruments with input methods, ranges, and settings\n */\n\n// Instrument type constants\nexport const InstrumentType = {\n    PIANO: 'piano',\n    PIANO_VIRTUAL: 'piano-virtual',\n    VIOLIN: 'violin',\n    GUITAR: 'guitar'\n} as const;\n\nexport type InstrumentTypeValue = typeof InstrumentType[keyof typeof InstrumentType];\n\n// Input method constants\nexport const InputMethod = {\n    MIDI: 'midi',\n    MICROPHONE: 'microphone',\n    VIRTUAL: 'virtual'\n} as const;\n\nexport type InputMethodValue = typeof InputMethod[keyof typeof InputMethod];\n\n// Clef constants\nexport const Clef = {\n    TREBLE: 'treble',\n    BASS: 'bass'\n} as const;\n\nexport type ClefValue = typeof Clef[keyof typeof Clef];\n\n// Type definitions\nexport interface NoteRange {\n    min: number;\n    max: number;\n}\n\nexport interface RangeConfig {\n    min: number;\n    max: number;\n    default: NoteRange;\n}\n\nexport interface TuningInfo {\n    note: string;\n    midi: number;\n    frequency: number;\n    string?: number;\n}\n\nexport interface ValidationConfig {\n    exactMatch: boolean;\n    pitchTolerance: number;\n    pitchToleranceAdvanced?: number;\n    octaveFlexible: boolean;\n    minDuration: number;\n    minClarity?: number;\n}\n\nexport interface PracticeConfig {\n    defaultNoteCount: number;\n    adaptiveDifficulty: boolean;\n    supportedModes: string[];\n    calibrationRequired?: boolean;\n    tuningCheckRecommended?: boolean;\n    fretIndependent?: boolean;\n}\n\nexport interface UIConfig {\n    showVirtualKeyboard: boolean;\n    showMidiStatus: boolean;\n    showPitchAccuracy: boolean;\n    showMicrophoneLevel?: boolean;\n    showTuningReference?: boolean;\n    showCentsDeviation?: boolean;\n    showFretboardReference?: boolean;\n}\n\nexport interface AudioConfig {\n    bufferSize: number;\n    noiseGate: number;\n    minFrequency: number;\n    maxFrequency: number;\n}\n\nexport interface InstrumentConfig {\n    id: InstrumentTypeValue;\n    name: string;\n    displayName: string;\n    emoji: string;\n    inputType: InputMethodValue;\n    range: RangeConfig;\n    clefs: ClefValue[];\n    defaultClef: ClefValue;\n    polyphonic: boolean;\n    requiresSustain: boolean;\n    tuning?: TuningInfo[];\n    validation: ValidationConfig;\n    practice: PracticeConfig;\n    ui: UIConfig;\n    audio?: AudioConfig;\n}\n\n/**\n * Instrument configuration profiles\n * Each profile defines all settings needed for instrument-specific practice\n */\nexport const INSTRUMENTS: Record<InstrumentTypeValue, InstrumentConfig> = {\n    [InstrumentType.PIANO]: {\n        id: InstrumentType.PIANO,\n        name: 'Piano',\n        displayName: 'Piano/Keyboard',\n        emoji: '',\n        inputType: InputMethod.MIDI,\n\n        // Range settings (MIDI note numbers)\n        range: {\n            min: 21,  // A0\n            max: 108, // C8\n            default: {\n                min: 48,  // C3\n                max: 84   // C6\n            }\n        },\n\n        // Clef settings\n        clefs: [Clef.TREBLE, Clef.BASS],\n        defaultClef: Clef.TREBLE,\n\n        // Input capabilities\n        polyphonic: true,  // Can detect multiple simultaneous notes\n        requiresSustain: false,\n\n        // Validation settings\n        validation: {\n            exactMatch: true,  // MIDI requires exact note match\n            pitchTolerance: 0, // No tolerance for MIDI\n            octaveFlexible: false, // Can enable for practice mode\n            minDuration: 0 // No minimum duration required\n        },\n\n        // Practice settings\n        practice: {\n            defaultNoteCount: 20,\n            adaptiveDifficulty: true,\n            supportedModes: ['sight-reading', 'scales', 'chords', 'arpeggios', 'key-signatures']\n        },\n\n        // UI settings\n        ui: {\n            showVirtualKeyboard: false,\n            showMidiStatus: true,\n            showPitchAccuracy: false\n        }\n    },\n\n    [InstrumentType.PIANO_VIRTUAL]: {\n        id: InstrumentType.PIANO_VIRTUAL,\n        name: 'Piano (Virtual)',\n        displayName: 'Piano/Keyboard (Virtual)',\n        emoji: '',\n        inputType: InputMethod.VIRTUAL,\n\n        // Range settings (MIDI note numbers)\n        range: {\n            min: 21,  // A0\n            max: 108, // C8\n            default: {\n                min: 48,  // C3\n                max: 84   // C6\n            }\n        },\n\n        // Clef settings\n        clefs: [Clef.TREBLE, Clef.BASS],\n        defaultClef: Clef.TREBLE,\n\n        // Input capabilities\n        polyphonic: true,  // Can play multiple simultaneous notes\n        requiresSustain: false,\n\n        // Validation settings\n        validation: {\n            exactMatch: true,  // Virtual keyboard gives exact notes\n            pitchTolerance: 0, // No tolerance needed\n            octaveFlexible: false,\n            minDuration: 0 // No minimum duration required\n        },\n\n        // Practice settings\n        practice: {\n            defaultNoteCount: 20,\n            adaptiveDifficulty: true,\n            supportedModes: ['sight-reading', 'scales', 'chords', 'arpeggios', 'key-signatures']\n        },\n\n        // UI settings\n        ui: {\n            showVirtualKeyboard: true,\n            showMidiStatus: false,\n            showPitchAccuracy: false\n        }\n    },\n\n    [InstrumentType.VIOLIN]: {\n        id: InstrumentType.VIOLIN,\n        name: 'Violin',\n        displayName: 'Violin',\n        emoji: '',\n        inputType: InputMethod.MICROPHONE,\n\n        // Range settings (MIDI note numbers)\n        range: {\n            min: 55,  // G3\n            max: 91,  // G6 (extended range)\n            default: {\n                min: 60,  // C4 (first position, beginner friendly)\n                max: 72   // C5 (one octave, first position only)\n            }\n        },\n\n        // Clef settings\n        clefs: [Clef.TREBLE],\n        defaultClef: Clef.TREBLE,\n\n        // Input capabilities\n        polyphonic: false,  // Monophonic pitch detection\n        requiresSustain: true,\n\n        // String tuning (open strings in scientific pitch notation)\n        tuning: [\n            { note: 'G3', midi: 55, frequency: 196.00 },\n            { note: 'D4', midi: 62, frequency: 293.66 },\n            { note: 'A4', midi: 69, frequency: 440.00 },\n            { note: 'E5', midi: 76, frequency: 659.26 }\n        ],\n\n        // Validation settings\n        validation: {\n            exactMatch: false,\n            pitchTolerance: 50,  // 50 cents for beginners\n            pitchToleranceAdvanced: 20, // 20 cents for advanced\n            octaveFlexible: false,\n            minDuration: 500, // 500ms minimum note sustain\n            minClarity: 0.80  // 80% pitch clarity threshold\n        },\n\n        // Practice settings\n        practice: {\n            defaultNoteCount: 15,\n            adaptiveDifficulty: true,\n            supportedModes: ['sight-reading', 'scales', 'arpeggios', 'intonation', 'key-signatures'],\n            calibrationRequired: true, // Require A4 calibration\n            tuningCheckRecommended: true\n        },\n\n        // UI settings\n        ui: {\n            showVirtualKeyboard: false,\n            showMidiStatus: false,\n            showPitchAccuracy: true,\n            showMicrophoneLevel: true,\n            showTuningReference: true,\n            showCentsDeviation: true\n        },\n\n        // Audio processing settings\n        audio: {\n            bufferSize: 2048,  // ~46ms at 44.1kHz\n            noiseGate: -40,    // dB threshold\n            minFrequency: 180, // Hz (below G3)\n            maxFrequency: 1600 // Hz (above G6)\n        }\n    },\n\n    [InstrumentType.GUITAR]: {\n        id: InstrumentType.GUITAR,\n        name: 'Guitar',\n        displayName: 'Guitar',\n        emoji: '',\n        inputType: InputMethod.MICROPHONE,\n\n        // Range settings (MIDI note numbers)\n        range: {\n            min: 40,  // E2\n            max: 88,  // E6 (24th fret on high E)\n            default: {\n                min: 40,  // E2\n                max: 76   // E5 (12th fret on high E)\n            }\n        },\n\n        // Clef settings\n        clefs: [Clef.TREBLE],\n        defaultClef: Clef.TREBLE,\n\n        // Input capabilities\n        polyphonic: false,  // Monophonic for POC (polyphonic future)\n        requiresSustain: true,\n\n        // Standard tuning (EADGBE in scientific pitch notation)\n        tuning: [\n            { note: 'E2', midi: 40, frequency: 82.41, string: 6 },\n            { note: 'A2', midi: 45, frequency: 110.00, string: 5 },\n            { note: 'D3', midi: 50, frequency: 146.83, string: 4 },\n            { note: 'G3', midi: 55, frequency: 196.00, string: 3 },\n            { note: 'B3', midi: 59, frequency: 246.94, string: 2 },\n            { note: 'E4', midi: 64, frequency: 329.63, string: 1 }\n        ],\n\n        // Validation settings\n        validation: {\n            exactMatch: false,\n            pitchTolerance: 50,  // 50 cents (guitar can be slightly out of tune)\n            pitchToleranceAdvanced: 30, // 30 cents for advanced\n            octaveFlexible: false,\n            minDuration: 400, // 400ms minimum (pluck sustain)\n            minClarity: 0.75  // 75% clarity (guitar harmonics can confuse)\n        },\n\n        // Practice settings\n        practice: {\n            defaultNoteCount: 15,\n            adaptiveDifficulty: true,\n            supportedModes: ['sight-reading', 'scales', 'arpeggios', 'key-signatures'],\n            calibrationRequired: false,\n            tuningCheckRecommended: true,\n            fretIndependent: true // Focus on pitch, not fret position\n        },\n\n        // UI settings\n        ui: {\n            showVirtualKeyboard: false,\n            showMidiStatus: false,\n            showPitchAccuracy: true,\n            showMicrophoneLevel: true,\n            showTuningReference: true,\n            showCentsDeviation: true,\n            showFretboardReference: false // Future feature\n        },\n\n        // Audio processing settings\n        audio: {\n            bufferSize: 2048,  // ~46ms at 44.1kHz\n            noiseGate: -35,    // dB threshold (slightly higher due to picking noise)\n            minFrequency: 70,  // Hz (below E2)\n            maxFrequency: 1400 // Hz (above E6 fundamental)\n        }\n    }\n};\n\n/**\n * Get instrument configuration by ID\n */\nexport function getInstrument(instrumentId: string): InstrumentConfig {\n    const instrument = INSTRUMENTS[instrumentId as InstrumentTypeValue];\n    if (!instrument) {\n        console.warn(`Unknown instrument: ${instrumentId}, defaulting to piano`);\n        return INSTRUMENTS[InstrumentType.PIANO];\n    }\n    return instrument;\n}\n\n/**\n * Get list of all instruments\n */\nexport function getAllInstruments(): InstrumentConfig[] {\n    return Object.values(INSTRUMENTS);\n}\n\n/**\n * Get instruments by input method\n */\nexport function getInstrumentsByInputMethod(inputMethod: InputMethodValue): InstrumentConfig[] {\n    return getAllInstruments().filter(inst => inst.inputType === inputMethod);\n}\n\n/**\n * Check if instrument requires microphone\n */\nexport function requiresMicrophone(instrumentId: string): boolean {\n    const instrument = getInstrument(instrumentId);\n    return instrument.inputType === InputMethod.MICROPHONE;\n}\n\n/**\n * Check if instrument requires MIDI\n */\nexport function requiresMIDI(instrumentId: string): boolean {\n    const instrument = getInstrument(instrumentId);\n    return instrument.inputType === InputMethod.MIDI;\n}\n\n/**\n * Check if instrument uses virtual keyboard\n */\nexport function requiresVirtualKeyboard(instrumentId: string): boolean {\n    const instrument = getInstrument(instrumentId);\n    return instrument.inputType === InputMethod.VIRTUAL;\n}\n\n/**\n * Get supported modules for an instrument\n */\nexport function getSupportedModules(instrumentId: string): string[] {\n    const instrument = getInstrument(instrumentId);\n    return instrument.practice.supportedModes;\n}\n\n/**\n * Get MIDI note range for an instrument\n */\nexport function getNoteRange(instrumentId: string, useDefault = true): NoteRange {\n    const instrument = getInstrument(instrumentId);\n    return useDefault ? instrument.range.default : {\n        min: instrument.range.min,\n        max: instrument.range.max\n    };\n}\n\n/**\n * Get tuning information for stringed instruments\n */\nexport function getTuning(instrumentId: string): TuningInfo[] | null {\n    const instrument = getInstrument(instrumentId);\n    return instrument.tuning || null;\n}\n\n/**\n * Validate note is within instrument range\n */\nexport function isNoteInRange(instrumentId: string, midiNote: number): boolean {\n    const instrument = getInstrument(instrumentId);\n    return midiNote >= instrument.range.min && midiNote <= instrument.range.max;\n}\n\n/**\n * Get pitch tolerance for an instrument\n */\nexport function getPitchTolerance(instrumentId: string, advanced = false): number {\n    const instrument = getInstrument(instrumentId);\n    if (advanced && instrument.validation.pitchToleranceAdvanced !== undefined) {\n        return instrument.validation.pitchToleranceAdvanced;\n    }\n    return instrument.validation.pitchTolerance;\n}\n\n/**\n * Create a custom instrument profile (for future extensibility)\n */\nexport function createCustomInstrument(config: Partial<InstrumentConfig>): InstrumentConfig {\n    // Merge with piano defaults as base\n    const defaults = { ...INSTRUMENTS[InstrumentType.PIANO] };\n    return {\n        ...defaults,\n        ...config,\n        range: { ...defaults.range, ...(config.range || {}) },\n        validation: { ...defaults.validation, ...(config.validation || {}) },\n        practice: { ...defaults.practice, ...(config.practice || {}) },\n        ui: { ...defaults.ui, ...(config.ui || {}) }\n    } as InstrumentConfig;\n}\n\n/**\n * Export default instrument (Piano)\n */\nexport const DEFAULT_INSTRUMENT: InstrumentTypeValue = InstrumentType.PIANO;\n","/**\n * Music Theory Utilities\n * Provides helper functions for note generation, validation, and music theory operations\n */\n\nimport { Note, Scale, Chord } from 'tonal';\nimport { getTuning } from './instrument-config';\n\n// Type definitions\nexport interface NoteInfo {\n    vexflowNote: string;\n    midiNote: number;\n}\n\nexport interface ValidationResult {\n    isCorrect: boolean;\n    message: string;\n    centsOff?: number;\n}\n\nexport interface ValidationOptions {\n    allowOctaveError?: boolean;\n    tolerance?: number;\n    pitchToleranceCents?: number;\n}\n\nexport interface KeySignature {\n    name: string;\n    sharps: number;\n    flats: number;\n}\n\nexport type ClefType = 'treble' | 'bass';\n\n// Note names and their MIDI numbers (C4 = Middle C = 60)\nexport const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\n\n// VexFlow note names (with octaves) - natural notes only for basic mode\nexport const vexflowNoteNames: Record<ClefType, Record<string, number>> = {\n    treble: {\n        'c/4': 60, 'd/4': 62, 'e/4': 64, 'f/4': 65, 'g/4': 67, 'a/4': 69, 'b/4': 71,\n        'c/5': 72, 'd/5': 74, 'e/5': 76, 'f/5': 77, 'g/5': 79, 'a/5': 81, 'b/5': 83,\n        'c/6': 84\n    },\n    bass: {\n        'a/2': 45, 'b/2': 47,\n        'c/3': 48, 'd/3': 50, 'e/3': 52, 'f/3': 53, 'g/3': 55, 'a/3': 57, 'b/3': 59,\n        'c/4': 60, 'd/4': 62, 'e/4': 64, 'f/4': 65\n    }\n};\n\n/**\n * Convert MIDI note number to note name with octave using Tonal\n */\nexport function midiToNoteName(midiNote: number): string {\n    return Note.fromMidi(midiNote) || '';\n}\n\n/**\n * Convert note name to MIDI number using Tonal\n */\nexport function noteNameToMidi(noteName: string): number {\n    const midi = Note.midi(noteName);\n    return midi !== null ? midi : -1;\n}\n\n/**\n * Convert MIDI note to VexFlow notation format\n */\nexport function midiToVexflow(midiNote: number, clef: ClefType = 'treble'): string | null {\n    const octave = Math.floor(midiNote / 12) - 1;\n    const noteIndex = midiNote % 12;\n    const noteName = noteNames[noteIndex].toLowerCase().replace('#', '#');\n\n    // For natural notes only (no sharps/flats in basic implementation)\n    if (noteName.includes('#')) {\n        return null; // Skip sharps for now in basic mode\n    }\n\n    return `${noteName}/${octave}`;\n}\n\n/**\n * Generate a random note within a specified range\n */\nexport function generateRandomNote(\n    range: string = 'c4-c5',\n    clef: ClefType = 'treble',\n    naturalsOnly: boolean = true\n): NoteInfo | null {\n    const [start, end] = range.split('-');\n    const startMidi = noteNameToMidi(start.toUpperCase());\n    const endMidi = noteNameToMidi(end.toUpperCase());\n\n    if (startMidi === -1 || endMidi === -1) {\n        console.error('Invalid range');\n        return null;\n    }\n\n    // Get available notes from VexFlow mapping for the clef\n    const availableNotes = Object.entries(vexflowNoteNames[clef])\n        .filter(([_, midi]) => midi >= startMidi && midi <= endMidi)\n        .map(([note, midi]) => ({ vexflowNote: note, midiNote: midi }));\n\n    if (availableNotes.length === 0) {\n        console.error('No notes available in range');\n        return null;\n    }\n\n    const randomIndex = Math.floor(Math.random() * availableNotes.length);\n    return availableNotes[randomIndex];\n}\n\n/**\n * Generate a random note from MIDI range\n */\nexport function generateRandomNoteFromMidiRange(minMidi: number, maxMidi: number, naturalsOnly: boolean = true): number {\n    const availableNotes: number[] = [];\n\n    for (let midi = minMidi; midi <= maxMidi; midi++) {\n        if (naturalsOnly) {\n            const noteIndex = midi % 12;\n            // Only include natural notes (no sharps/flats)\n            if (![1, 3, 6, 8, 10].includes(noteIndex)) {\n                availableNotes.push(midi);\n            }\n        } else {\n            availableNotes.push(midi);\n        }\n    }\n\n    if (availableNotes.length === 0) {\n        return minMidi;\n    }\n\n    return availableNotes[Math.floor(Math.random() * availableNotes.length)];\n}\n\n/**\n * Validate if a played note matches the target note\n */\nexport function validateNote(\n    playedMidi: number,\n    targetMidi: number,\n    options: ValidationOptions = {}\n): ValidationResult {\n    const {\n        allowOctaveError = true,\n        tolerance = 0,\n        pitchToleranceCents = 0\n    } = options;\n\n    if (playedMidi === targetMidi) {\n        return { isCorrect: true, message: 'Perfect!', centsOff: 0 };\n    }\n\n    // Check for octave errors\n    if (allowOctaveError) {\n        const playedPitch = playedMidi % 12;\n        const targetPitch = targetMidi % 12;\n\n        if (playedPitch === targetPitch) {\n            return {\n                isCorrect: true,\n                message: 'Correct note, wrong octave!'\n            };\n        }\n    }\n\n    // Check tolerance (for MIDI semitone tolerance)\n    if (tolerance > 0) {\n        const diff = Math.abs(playedMidi - targetMidi);\n        if (diff <= tolerance) {\n            return {\n                isCorrect: true,\n                message: 'Close enough!'\n            };\n        }\n    }\n\n    return {\n        isCorrect: false,\n        message: `Try again. You played ${midiToNoteName(playedMidi)}`\n    };\n}\n\n/**\n * Validate pitch with cents tolerance (for microphone input)\n */\nexport function validatePitchWithCents(\n    playedFrequency: number,\n    targetMidi: number,\n    toleranceCents: number = 50\n): ValidationResult {\n    const targetFrequency = midiToFrequency(targetMidi);\n    const playedMidi = frequencyToMidi(playedFrequency);\n    const centsOff = getCentsDeviation(playedFrequency, targetFrequency);\n\n    if (Math.abs(centsOff) <= toleranceCents) {\n        let message = 'Perfect!';\n        if (Math.abs(centsOff) > 5) {\n            message = `${Math.abs(centsOff).toFixed(0)} cents ${centsOff > 0 ? 'sharp' : 'flat'}`;\n        }\n        return {\n            isCorrect: true,\n            message,\n            centsOff\n        };\n    }\n\n    return {\n        isCorrect: false,\n        message: `Try again. You played ${midiToNoteName(playedMidi)} (${Math.abs(centsOff).toFixed(0)} cents ${centsOff > 0 ? 'sharp' : 'flat'})`,\n        centsOff\n    };\n}\n\n/**\n * Get frequency from MIDI note number using Tonal\n */\nexport function midiToFrequency(midiNote: number): number {\n    const noteName = Note.fromMidi(midiNote);\n    return noteName ? Note.freq(noteName) || 440 : 440;\n}\n\n/**\n * Convert frequency to MIDI note number\n */\nexport function frequencyToMidi(frequency: number): number {\n    return Math.round(12 * Math.log2(frequency / 440) + 69);\n}\n\n/**\n * Get cents deviation between two frequencies\n */\nexport function getCentsDeviation(frequency: number, targetFrequency: number): number {\n    return 1200 * Math.log2(frequency / targetFrequency);\n}\n\n/**\n * Get cents deviation from target MIDI note\n */\nexport function getCentsFromMidi(frequency: number, targetMidi: number): number {\n    const targetFrequency = midiToFrequency(targetMidi);\n    return getCentsDeviation(frequency, targetFrequency);\n}\n\n/**\n * Generate a major scale using Tonal\n */\nexport function generateMajorScale(root: string): number[] {\n    const scale = Scale.get(`${root} major`);\n    return scale.notes.map(note => noteNameToMidi(note)).filter(midi => midi !== -1);\n}\n\n/**\n * Generate a minor scale (natural minor) using Tonal\n */\nexport function generateMinorScale(root: string): number[] {\n    const scale = Scale.get(`${root} minor`);\n    return scale.notes.map(note => noteNameToMidi(note)).filter(midi => midi !== -1);\n}\n\n/**\n * Generate a scale by type using Tonal\n */\nexport function generateScale(root: string, scaleType: string = 'major'): number[] {\n    const scale = Scale.get(`${root} ${scaleType}`);\n    return scale.notes.map(note => noteNameToMidi(note)).filter(midi => midi !== -1);\n}\n\n/**\n * Generate a chord using Tonal\n */\nexport function generateChord(root: string, type: string = 'major'): number[] {\n    const chord = Chord.get(`${root}${type}`);\n    return chord.notes.map(note => noteNameToMidi(note)).filter(midi => midi !== -1);\n}\n\n/**\n * Get all key signatures\n */\nexport function getAllKeySignatures(): KeySignature[] {\n    return [\n        { name: 'C Major / A Minor', sharps: 0, flats: 0 },\n        { name: 'G Major / E Minor', sharps: 1, flats: 0 },\n        { name: 'D Major / B Minor', sharps: 2, flats: 0 },\n        { name: 'A Major / F# Minor', sharps: 3, flats: 0 },\n        { name: 'E Major / C# Minor', sharps: 4, flats: 0 },\n        { name: 'B Major / G# Minor', sharps: 5, flats: 0 },\n        { name: 'F# Major / D# Minor', sharps: 6, flats: 0 },\n        { name: 'F Major / D Minor', sharps: 0, flats: 1 },\n        { name: 'Bb Major / G Minor', sharps: 0, flats: 2 },\n        { name: 'Eb Major / C Minor', sharps: 0, flats: 3 },\n        { name: 'Ab Major / F Minor', sharps: 0, flats: 4 },\n        { name: 'Db Major / Bb Minor', sharps: 0, flats: 5 },\n        { name: 'Gb Major / Eb Minor', sharps: 0, flats: 6 }\n    ];\n}\n\n/**\n * Get interval between two notes in semitones\n */\nexport function getInterval(note1: string, note2: string): number {\n    const midi1 = noteNameToMidi(note1);\n    const midi2 = noteNameToMidi(note2);\n    return Math.abs(midi2 - midi1);\n}\n\n/**\n * Check if frequency is within valid range for instrument\n */\nexport function isFrequencyInRange(frequency: number, minFreq: number, maxFreq: number): boolean {\n    return frequency >= minFreq && frequency <= maxFreq;\n}\n\n/**\n * Convert MIDI note to guitar tablature position\n * Returns the optimal string and fret combination for a given note\n */\nexport interface TabPosition {\n    string: number; // 1-6, where 1 is highest (thinnest E) and 6 is lowest (thickest E)\n    fret: number;   // 0-24, where 0 is open string\n}\n\nexport function midiToTabPosition(midiNote: number, instrumentId: string = 'guitar'): TabPosition | null {\n    // Get tuning for the instrument\n    const tuning = getTuning(instrumentId);\n    if (!tuning) {\n        console.error('No tuning information available for instrument:', instrumentId);\n        return null;\n    }\n\n    // Find all possible positions for this note\n    const possiblePositions: TabPosition[] = [];\n\n    tuning.forEach((stringInfo) => {\n        const openStringMidi = stringInfo.midi;\n        const stringNumber = stringInfo.string || 0;\n\n        // Calculate fret number (difference from open string)\n        const fret = midiNote - openStringMidi;\n\n        // Check if this is a valid position (within typical fret range 0-24)\n        if (fret >= 0 && fret <= 24) {\n            possiblePositions.push({\n                string: stringNumber,\n                fret: fret\n            });\n        }\n    });\n\n    if (possiblePositions.length === 0) {\n        console.warn('Note out of range for tablature:', midiNote);\n        return null;\n    }\n\n    // Choose the optimal position\n    // Strategy: Prefer lower frets (easier to play) and middle strings when possible\n    // Priority: 1) Lowest fret number, 2) Middle strings (strings 2-4)\n    possiblePositions.sort((a, b) => {\n        // First, compare by fret (prefer lower frets)\n        if (a.fret !== b.fret) {\n            return a.fret - b.fret;\n        }\n\n        // If same fret, prefer middle strings (2-4)\n        const aMiddleBonus = (a.string >= 2 && a.string <= 4) ? -1 : 0;\n        const bMiddleBonus = (b.string >= 2 && b.string <= 4) ? -1 : 0;\n        return aMiddleBonus - bMiddleBonus;\n    });\n\n    return possiblePositions[0];\n}\n\n/**\n * Get all possible tab positions for a MIDI note\n * Useful for showing alternative fingerings\n */\nexport function getAllTabPositions(midiNote: number, instrumentId: string = 'guitar'): TabPosition[] {\n    const tuning = getTuning(instrumentId);\n    if (!tuning) {\n        return [];\n    }\n\n    const positions: TabPosition[] = [];\n\n    tuning.forEach((stringInfo) => {\n        const openStringMidi = stringInfo.midi;\n        const stringNumber = stringInfo.string || 0;\n        const fret = midiNote - openStringMidi;\n\n        if (fret >= 0 && fret <= 24) {\n            positions.push({\n                string: stringNumber,\n                fret: fret\n            });\n        }\n    });\n\n    return positions;\n}\n\n// Export as namespace for backward compatibility\nexport const MusicTheory = {\n    noteNames,\n    vexflowNoteNames,\n    midiToNoteName,\n    noteNameToMidi,\n    midiToVexflow,\n    generateRandomNote,\n    generateRandomNoteFromMidiRange,\n    validateNote,\n    validatePitchWithCents,\n    midiToFrequency,\n    frequencyToMidi,\n    getCentsDeviation,\n    getCentsFromMidi,\n    generateMajorScale,\n    generateMinorScale,\n    generateScale,\n    generateChord,\n    getAllKeySignatures,\n    getInterval,\n    isFrequencyInRange,\n    midiToTabPosition,\n    getAllTabPositions\n};\n\n// Make available globally for legacy code\nif (typeof window !== 'undefined') {\n    (window as any).MusicTheory = MusicTheory;\n}\n","'use strict';\n\nfunction FFT(size) {\n  this.size = size | 0;\n  if (this.size <= 1 || (this.size & (this.size - 1)) !== 0)\n    throw new Error('FFT size must be a power of two and bigger than 1');\n\n  this._csize = size << 1;\n\n  // NOTE: Use of `var` is intentional for old V8 versions\n  var table = new Array(this.size * 2);\n  for (var i = 0; i < table.length; i += 2) {\n    const angle = Math.PI * i / this.size;\n    table[i] = Math.cos(angle);\n    table[i + 1] = -Math.sin(angle);\n  }\n  this.table = table;\n\n  // Find size's power of two\n  var power = 0;\n  for (var t = 1; this.size > t; t <<= 1)\n    power++;\n\n  // Calculate initial step's width:\n  //   * If we are full radix-4 - it is 2x smaller to give inital len=8\n  //   * Otherwise it is the same as `power` to give len=4\n  this._width = power % 2 === 0 ? power - 1 : power;\n\n  // Pre-compute bit-reversal patterns\n  this._bitrev = new Array(1 << this._width);\n  for (var j = 0; j < this._bitrev.length; j++) {\n    this._bitrev[j] = 0;\n    for (var shift = 0; shift < this._width; shift += 2) {\n      var revShift = this._width - shift - 2;\n      this._bitrev[j] |= ((j >>> shift) & 3) << revShift;\n    }\n  }\n\n  this._out = null;\n  this._data = null;\n  this._inv = 0;\n}\nmodule.exports = FFT;\n\nFFT.prototype.fromComplexArray = function fromComplexArray(complex, storage) {\n  var res = storage || new Array(complex.length >>> 1);\n  for (var i = 0; i < complex.length; i += 2)\n    res[i >>> 1] = complex[i];\n  return res;\n};\n\nFFT.prototype.createComplexArray = function createComplexArray() {\n  const res = new Array(this._csize);\n  for (var i = 0; i < res.length; i++)\n    res[i] = 0;\n  return res;\n};\n\nFFT.prototype.toComplexArray = function toComplexArray(input, storage) {\n  var res = storage || this.createComplexArray();\n  for (var i = 0; i < res.length; i += 2) {\n    res[i] = input[i >>> 1];\n    res[i + 1] = 0;\n  }\n  return res;\n};\n\nFFT.prototype.completeSpectrum = function completeSpectrum(spectrum) {\n  var size = this._csize;\n  var half = size >>> 1;\n  for (var i = 2; i < half; i += 2) {\n    spectrum[size - i] = spectrum[i];\n    spectrum[size - i + 1] = -spectrum[i + 1];\n  }\n};\n\nFFT.prototype.transform = function transform(out, data) {\n  if (out === data)\n    throw new Error('Input and output buffers must be different');\n\n  this._out = out;\n  this._data = data;\n  this._inv = 0;\n  this._transform4();\n  this._out = null;\n  this._data = null;\n};\n\nFFT.prototype.realTransform = function realTransform(out, data) {\n  if (out === data)\n    throw new Error('Input and output buffers must be different');\n\n  this._out = out;\n  this._data = data;\n  this._inv = 0;\n  this._realTransform4();\n  this._out = null;\n  this._data = null;\n};\n\nFFT.prototype.inverseTransform = function inverseTransform(out, data) {\n  if (out === data)\n    throw new Error('Input and output buffers must be different');\n\n  this._out = out;\n  this._data = data;\n  this._inv = 1;\n  this._transform4();\n  for (var i = 0; i < out.length; i++)\n    out[i] /= this.size;\n  this._out = null;\n  this._data = null;\n};\n\n// radix-4 implementation\n//\n// NOTE: Uses of `var` are intentional for older V8 version that do not\n// support both `let compound assignments` and `const phi`\nFFT.prototype._transform4 = function _transform4() {\n  var out = this._out;\n  var size = this._csize;\n\n  // Initial step (permute and transform)\n  var width = this._width;\n  var step = 1 << width;\n  var len = (size / step) << 1;\n\n  var outOff;\n  var t;\n  var bitrev = this._bitrev;\n  if (len === 4) {\n    for (outOff = 0, t = 0; outOff < size; outOff += len, t++) {\n      const off = bitrev[t];\n      this._singleTransform2(outOff, off, step);\n    }\n  } else {\n    // len === 8\n    for (outOff = 0, t = 0; outOff < size; outOff += len, t++) {\n      const off = bitrev[t];\n      this._singleTransform4(outOff, off, step);\n    }\n  }\n\n  // Loop through steps in decreasing order\n  var inv = this._inv ? -1 : 1;\n  var table = this.table;\n  for (step >>= 2; step >= 2; step >>= 2) {\n    len = (size / step) << 1;\n    var quarterLen = len >>> 2;\n\n    // Loop through offsets in the data\n    for (outOff = 0; outOff < size; outOff += len) {\n      // Full case\n      var limit = outOff + quarterLen;\n      for (var i = outOff, k = 0; i < limit; i += 2, k += step) {\n        const A = i;\n        const B = A + quarterLen;\n        const C = B + quarterLen;\n        const D = C + quarterLen;\n\n        // Original values\n        const Ar = out[A];\n        const Ai = out[A + 1];\n        const Br = out[B];\n        const Bi = out[B + 1];\n        const Cr = out[C];\n        const Ci = out[C + 1];\n        const Dr = out[D];\n        const Di = out[D + 1];\n\n        // Middle values\n        const MAr = Ar;\n        const MAi = Ai;\n\n        const tableBr = table[k];\n        const tableBi = inv * table[k + 1];\n        const MBr = Br * tableBr - Bi * tableBi;\n        const MBi = Br * tableBi + Bi * tableBr;\n\n        const tableCr = table[2 * k];\n        const tableCi = inv * table[2 * k + 1];\n        const MCr = Cr * tableCr - Ci * tableCi;\n        const MCi = Cr * tableCi + Ci * tableCr;\n\n        const tableDr = table[3 * k];\n        const tableDi = inv * table[3 * k + 1];\n        const MDr = Dr * tableDr - Di * tableDi;\n        const MDi = Dr * tableDi + Di * tableDr;\n\n        // Pre-Final values\n        const T0r = MAr + MCr;\n        const T0i = MAi + MCi;\n        const T1r = MAr - MCr;\n        const T1i = MAi - MCi;\n        const T2r = MBr + MDr;\n        const T2i = MBi + MDi;\n        const T3r = inv * (MBr - MDr);\n        const T3i = inv * (MBi - MDi);\n\n        // Final values\n        const FAr = T0r + T2r;\n        const FAi = T0i + T2i;\n\n        const FCr = T0r - T2r;\n        const FCi = T0i - T2i;\n\n        const FBr = T1r + T3i;\n        const FBi = T1i - T3r;\n\n        const FDr = T1r - T3i;\n        const FDi = T1i + T3r;\n\n        out[A] = FAr;\n        out[A + 1] = FAi;\n        out[B] = FBr;\n        out[B + 1] = FBi;\n        out[C] = FCr;\n        out[C + 1] = FCi;\n        out[D] = FDr;\n        out[D + 1] = FDi;\n      }\n    }\n  }\n};\n\n// radix-2 implementation\n//\n// NOTE: Only called for len=4\nFFT.prototype._singleTransform2 = function _singleTransform2(outOff, off,\n                                                             step) {\n  const out = this._out;\n  const data = this._data;\n\n  const evenR = data[off];\n  const evenI = data[off + 1];\n  const oddR = data[off + step];\n  const oddI = data[off + step + 1];\n\n  const leftR = evenR + oddR;\n  const leftI = evenI + oddI;\n  const rightR = evenR - oddR;\n  const rightI = evenI - oddI;\n\n  out[outOff] = leftR;\n  out[outOff + 1] = leftI;\n  out[outOff + 2] = rightR;\n  out[outOff + 3] = rightI;\n};\n\n// radix-4\n//\n// NOTE: Only called for len=8\nFFT.prototype._singleTransform4 = function _singleTransform4(outOff, off,\n                                                             step) {\n  const out = this._out;\n  const data = this._data;\n  const inv = this._inv ? -1 : 1;\n  const step2 = step * 2;\n  const step3 = step * 3;\n\n  // Original values\n  const Ar = data[off];\n  const Ai = data[off + 1];\n  const Br = data[off + step];\n  const Bi = data[off + step + 1];\n  const Cr = data[off + step2];\n  const Ci = data[off + step2 + 1];\n  const Dr = data[off + step3];\n  const Di = data[off + step3 + 1];\n\n  // Pre-Final values\n  const T0r = Ar + Cr;\n  const T0i = Ai + Ci;\n  const T1r = Ar - Cr;\n  const T1i = Ai - Ci;\n  const T2r = Br + Dr;\n  const T2i = Bi + Di;\n  const T3r = inv * (Br - Dr);\n  const T3i = inv * (Bi - Di);\n\n  // Final values\n  const FAr = T0r + T2r;\n  const FAi = T0i + T2i;\n\n  const FBr = T1r + T3i;\n  const FBi = T1i - T3r;\n\n  const FCr = T0r - T2r;\n  const FCi = T0i - T2i;\n\n  const FDr = T1r - T3i;\n  const FDi = T1i + T3r;\n\n  out[outOff] = FAr;\n  out[outOff + 1] = FAi;\n  out[outOff + 2] = FBr;\n  out[outOff + 3] = FBi;\n  out[outOff + 4] = FCr;\n  out[outOff + 5] = FCi;\n  out[outOff + 6] = FDr;\n  out[outOff + 7] = FDi;\n};\n\n// Real input radix-4 implementation\nFFT.prototype._realTransform4 = function _realTransform4() {\n  var out = this._out;\n  var size = this._csize;\n\n  // Initial step (permute and transform)\n  var width = this._width;\n  var step = 1 << width;\n  var len = (size / step) << 1;\n\n  var outOff;\n  var t;\n  var bitrev = this._bitrev;\n  if (len === 4) {\n    for (outOff = 0, t = 0; outOff < size; outOff += len, t++) {\n      const off = bitrev[t];\n      this._singleRealTransform2(outOff, off >>> 1, step >>> 1);\n    }\n  } else {\n    // len === 8\n    for (outOff = 0, t = 0; outOff < size; outOff += len, t++) {\n      const off = bitrev[t];\n      this._singleRealTransform4(outOff, off >>> 1, step >>> 1);\n    }\n  }\n\n  // Loop through steps in decreasing order\n  var inv = this._inv ? -1 : 1;\n  var table = this.table;\n  for (step >>= 2; step >= 2; step >>= 2) {\n    len = (size / step) << 1;\n    var halfLen = len >>> 1;\n    var quarterLen = halfLen >>> 1;\n    var hquarterLen = quarterLen >>> 1;\n\n    // Loop through offsets in the data\n    for (outOff = 0; outOff < size; outOff += len) {\n      for (var i = 0, k = 0; i <= hquarterLen; i += 2, k += step) {\n        var A = outOff + i;\n        var B = A + quarterLen;\n        var C = B + quarterLen;\n        var D = C + quarterLen;\n\n        // Original values\n        var Ar = out[A];\n        var Ai = out[A + 1];\n        var Br = out[B];\n        var Bi = out[B + 1];\n        var Cr = out[C];\n        var Ci = out[C + 1];\n        var Dr = out[D];\n        var Di = out[D + 1];\n\n        // Middle values\n        var MAr = Ar;\n        var MAi = Ai;\n\n        var tableBr = table[k];\n        var tableBi = inv * table[k + 1];\n        var MBr = Br * tableBr - Bi * tableBi;\n        var MBi = Br * tableBi + Bi * tableBr;\n\n        var tableCr = table[2 * k];\n        var tableCi = inv * table[2 * k + 1];\n        var MCr = Cr * tableCr - Ci * tableCi;\n        var MCi = Cr * tableCi + Ci * tableCr;\n\n        var tableDr = table[3 * k];\n        var tableDi = inv * table[3 * k + 1];\n        var MDr = Dr * tableDr - Di * tableDi;\n        var MDi = Dr * tableDi + Di * tableDr;\n\n        // Pre-Final values\n        var T0r = MAr + MCr;\n        var T0i = MAi + MCi;\n        var T1r = MAr - MCr;\n        var T1i = MAi - MCi;\n        var T2r = MBr + MDr;\n        var T2i = MBi + MDi;\n        var T3r = inv * (MBr - MDr);\n        var T3i = inv * (MBi - MDi);\n\n        // Final values\n        var FAr = T0r + T2r;\n        var FAi = T0i + T2i;\n\n        var FBr = T1r + T3i;\n        var FBi = T1i - T3r;\n\n        out[A] = FAr;\n        out[A + 1] = FAi;\n        out[B] = FBr;\n        out[B + 1] = FBi;\n\n        // Output final middle point\n        if (i === 0) {\n          var FCr = T0r - T2r;\n          var FCi = T0i - T2i;\n          out[C] = FCr;\n          out[C + 1] = FCi;\n          continue;\n        }\n\n        // Do not overwrite ourselves\n        if (i === hquarterLen)\n          continue;\n\n        // In the flipped case:\n        // MAi = -MAi\n        // MBr=-MBi, MBi=-MBr\n        // MCr=-MCr\n        // MDr=MDi, MDi=MDr\n        var ST0r = T1r;\n        var ST0i = -T1i;\n        var ST1r = T0r;\n        var ST1i = -T0i;\n        var ST2r = -inv * T3i;\n        var ST2i = -inv * T3r;\n        var ST3r = -inv * T2i;\n        var ST3i = -inv * T2r;\n\n        var SFAr = ST0r + ST2r;\n        var SFAi = ST0i + ST2i;\n\n        var SFBr = ST1r + ST3i;\n        var SFBi = ST1i - ST3r;\n\n        var SA = outOff + quarterLen - i;\n        var SB = outOff + halfLen - i;\n\n        out[SA] = SFAr;\n        out[SA + 1] = SFAi;\n        out[SB] = SFBr;\n        out[SB + 1] = SFBi;\n      }\n    }\n  }\n};\n\n// radix-2 implementation\n//\n// NOTE: Only called for len=4\nFFT.prototype._singleRealTransform2 = function _singleRealTransform2(outOff,\n                                                                     off,\n                                                                     step) {\n  const out = this._out;\n  const data = this._data;\n\n  const evenR = data[off];\n  const oddR = data[off + step];\n\n  const leftR = evenR + oddR;\n  const rightR = evenR - oddR;\n\n  out[outOff] = leftR;\n  out[outOff + 1] = 0;\n  out[outOff + 2] = rightR;\n  out[outOff + 3] = 0;\n};\n\n// radix-4\n//\n// NOTE: Only called for len=8\nFFT.prototype._singleRealTransform4 = function _singleRealTransform4(outOff,\n                                                                     off,\n                                                                     step) {\n  const out = this._out;\n  const data = this._data;\n  const inv = this._inv ? -1 : 1;\n  const step2 = step * 2;\n  const step3 = step * 3;\n\n  // Original values\n  const Ar = data[off];\n  const Br = data[off + step];\n  const Cr = data[off + step2];\n  const Dr = data[off + step3];\n\n  // Pre-Final values\n  const T0r = Ar + Cr;\n  const T1r = Ar - Cr;\n  const T2r = Br + Dr;\n  const T3r = inv * (Br - Dr);\n\n  // Final values\n  const FAr = T0r + T2r;\n\n  const FBr = T1r;\n  const FBi = -T3r;\n\n  const FCr = T0r - T2r;\n\n  const FDr = T1r;\n  const FDi = T3r;\n\n  out[outOff] = FAr;\n  out[outOff + 1] = 0;\n  out[outOff + 2] = FBr;\n  out[outOff + 3] = FBi;\n  out[outOff + 4] = FCr;\n  out[outOff + 5] = 0;\n  out[outOff + 6] = FDr;\n  out[outOff + 7] = FDi;\n};\n","import FFT from \"fft.js\";\n\n/**\n * @typedef {Float32Array | Float64Array | number[]} Buffer One of the supported\n * buffer types. Other numeric array types may not work correctly.\n */\n\n/**\n * A class that can perform autocorrelation on input arrays of a given size.\n *\n * The class holds internal buffers so that no additional allocations are\n * necessary while performing the operation.\n *\n * @template {Buffer} T the buffer type to use. While inputs to the\n * autocorrelation process can be any array-like type, the output buffer\n * (whether provided explicitly or using a fresh buffer) is always of this type.\n */\nexport class Autocorrelator {\n  /** @private @readonly @type {number} */\n  _inputLength;\n  /** @private @type {FFT} */\n  _fft;\n  /** @private @type {(size: number) => T} */\n  _bufferSupplier;\n  /** @private @type {T} */\n  _paddedInputBuffer;\n  /** @private @type {T} */\n  _transformBuffer;\n  /** @private @type {T} */\n  _inverseBuffer;\n\n  /**\n   * A helper method to create an {@link Autocorrelator} using\n   * {@link Float32Array} buffers.\n   *\n   * @param inputLength {number} the input array length to support\n   * @returns {Autocorrelator<Float32Array>}\n   */\n  static forFloat32Array(inputLength) {\n    return new Autocorrelator(\n      inputLength,\n      (length) => new Float32Array(length),\n    );\n  }\n\n  /**\n   * A helper method to create an {@link Autocorrelator} using\n   * {@link Float64Array} buffers.\n   *\n   * @param inputLength {number} the input array length to support\n   * @returns {Autocorrelator<Float64Array>}\n   */\n  static forFloat64Array(inputLength) {\n    return new Autocorrelator(\n      inputLength,\n      (length) => new Float64Array(length),\n    );\n  }\n\n  /**\n   * A helper method to create an {@link Autocorrelator} using `number[]`\n   * buffers.\n   *\n   * @param inputLength {number} the input array length to support\n   * @returns {Autocorrelator<number[]>}\n   */\n  static forNumberArray(inputLength) {\n    return new Autocorrelator(inputLength, (length) => Array(length));\n  }\n\n  /**\n   * Constructs a new {@link Autocorrelator} able to handle input arrays of the\n   * given length.\n   *\n   * @param inputLength {number} the input array length to support. This\n   * `Autocorrelator` will only support operation on arrays of this length.\n   * @param bufferSupplier {(length: number) => T} the function to use for\n   * creating buffers, accepting the length of the buffer to create and\n   * returning a new buffer of that length. The values of the returned buffer\n   * need not be initialized in any particular way.\n   */\n  constructor(inputLength, bufferSupplier) {\n    if (inputLength < 1) {\n      throw new Error(`Input length must be at least one`);\n    }\n    this._inputLength = inputLength;\n    // We need to double the input length to get correct results, and the FFT\n    // algorithm we use requires a length that's a power of 2\n    this._fft = new FFT(ceilPow2(2 * inputLength));\n    this._bufferSupplier = bufferSupplier;\n    this._paddedInputBuffer = this._bufferSupplier(this._fft.size);\n    this._transformBuffer = this._bufferSupplier(2 * this._fft.size);\n    this._inverseBuffer = this._bufferSupplier(2 * this._fft.size);\n  }\n\n  /**\n   * Returns the supported input length.\n   *\n   * @returns {number} the supported input length\n   */\n  get inputLength() {\n    return this._inputLength;\n  }\n\n  /**\n   * Autocorrelates the given input data.\n   *\n   * @param input {ArrayLike<number>} the input data to autocorrelate\n   * @param output {T} the output buffer into which to write the autocorrelated\n   * data. If not provided, a new buffer will be created.\n   * @returns {T} `output`\n   */\n  autocorrelate(input, output = this._bufferSupplier(input.length)) {\n    if (input.length !== this._inputLength) {\n      throw new Error(\n        `Input must have length ${this._inputLength} but had length ${input.length}`,\n      );\n    }\n    // Step 0: pad the input array with zeros\n    for (let i = 0; i < input.length; i++) {\n      this._paddedInputBuffer[i] = input[i];\n    }\n    for (let i = input.length; i < this._paddedInputBuffer.length; i++) {\n      this._paddedInputBuffer[i] = 0;\n    }\n\n    // Step 1: get the DFT of the input array\n    this._fft.realTransform(this._transformBuffer, this._paddedInputBuffer);\n    // We need to fill in the right half of the array too\n    this._fft.completeSpectrum(this._transformBuffer);\n    // Step 2: multiply each entry by its conjugate\n    const tb = this._transformBuffer;\n    for (let i = 0; i < tb.length; i += 2) {\n      tb[i] = tb[i] * tb[i] + tb[i + 1] * tb[i + 1];\n      tb[i + 1] = 0;\n    }\n    // Step 3: perform the inverse transform\n    this._fft.inverseTransform(this._inverseBuffer, this._transformBuffer);\n\n    // This last result (the inverse transform) contains the autocorrelation\n    // data, which is completely real\n    for (let i = 0; i < input.length; i++) {\n      output[i] = this._inverseBuffer[2 * i];\n    }\n    return output;\n  }\n}\n\n/**\n * Returns an array of all the key maximum positions in the given input array.\n *\n * In McLeod's paper, a key maximum is the highest maximum between a positively\n * sloped zero crossing and a negatively sloped one.\n *\n * TODO: it may be more efficient not to construct a new output array each time,\n * but that would also make the code more complicated (more so than the changes\n * that were needed to remove the other allocations).\n *\n * @param input {ArrayLike<number>}\n * @returns {number[]}\n */\nfunction getKeyMaximumIndices(input) {\n  // The indices of the key maxima\n  /** @type {number[]} */ const keyIndices = [];\n  // Whether the last zero crossing found was positively sloped; equivalently,\n  // whether we're looking for a key maximum\n  let lookingForMaximum = false;\n  // The largest local maximum found so far\n  let max = -Infinity;\n  // The index of the largest local maximum so far\n  let maxIndex = -1;\n\n  for (let i = 1; i < input.length - 1; i++) {\n    if (input[i - 1] <= 0 && input[i] > 0) {\n      // Positively sloped zero crossing\n      lookingForMaximum = true;\n      maxIndex = i;\n      max = input[i];\n    } else if (input[i - 1] > 0 && input[i] <= 0) {\n      // Negatively sloped zero crossing\n      lookingForMaximum = false;\n      if (maxIndex !== -1) {\n        keyIndices.push(maxIndex);\n      }\n    } else if (lookingForMaximum && input[i] > max) {\n      max = input[i];\n      maxIndex = i;\n    }\n  }\n\n  return keyIndices;\n}\n\n/**\n * Refines the chosen key maximum index chosen from the given data by\n * interpolating a parabola using the key maximum index and its two neighbors\n * and finding the position of that parabola's maximum value.\n *\n * This is described in section 5 of the MPM paper as a way to refine the\n * position of the maximum.\n *\n * @param index {number} the chosen key maximum index. This must be between `1`\n * and `data.length - 2`, inclusive, since it and its two neighbors need to be\n * valid indexes of `data`.\n * @param data {ArrayLike<number>} the input array from which `index` was chosen\n * @returns {[number, number]} a pair consisting of the refined key maximum index and the\n * interpolated value of `data` at that index (the latter of which is used as a\n * measure of clarity)\n */\nfunction refineResultIndex(index, data) {\n  const [x0, x1, x2] = [index - 1, index, index + 1];\n  const [y0, y1, y2] = [data[x0], data[x1], data[x2]];\n\n  // The parabola going through the three data points can be written as\n  // y = y0(x - x1)(x - x2)/(x0 - x1)(x0 - x2)\n  //   + y1(x - x0)(x - x2)/(x1 - x0)(x1 - x2)\n  //   + y2(x - x0)(x - x1)/(x2 - x0)(x2 - x1)\n  // Given the definitions of x0, x1, and x2, we can simplify the denominators:\n  // y = y0(x - x1)(x - x2)/2\n  //   - y1(x - x0)(x - x2)\n  //   + y2(x - x0)(x - x1)/2\n  // We can expand this out and get the coefficients in standard form:\n  // a = y0/2 - y1 + y2/2\n  // b = -(y0/2)(x1 + x2) + y1(x0 + x2) - (y2/2)(x0 + x1)\n  // c = y0x1x2/2 - y1x0x2 + y2x0x1/2\n  // The index of the maximum is -b / 2a (by solving for x where the derivative\n  // is 0).\n\n  const a = y0 / 2 - y1 + y2 / 2;\n  const b = -(y0 / 2) * (x1 + x2) + y1 * (x0 + x2) - (y2 / 2) * (x0 + x1);\n  const c = (y0 * x1 * x2) / 2 - y1 * x0 * x2 + (y2 * x0 * x1) / 2;\n\n  const xMax = -b / (2 * a);\n  const yMax = a * xMax * xMax + b * xMax + c;\n  return [xMax, yMax];\n}\n\n/**\n * A class that can detect the pitch of a note from a time-domain input array.\n *\n * This class uses the McLeod pitch method (MPM) to detect pitches. MPM is\n * described in the paper 'A Smarter Way to Find Pitch' by Philip McLeod and\n * Geoff Wyvill\n * (http://miracle.otago.ac.nz/tartini/papers/A_Smarter_Way_to_Find_Pitch.pdf).\n *\n * The class holds internal buffers so that a minimal number of additional\n * allocations are necessary while performing the operation.\n *\n * @template {Buffer} T the buffer type to use internally. Inputs to the\n * pitch-detection process can be any numeric array type.\n */\nexport class PitchDetector {\n  /** @private @type {Autocorrelator<T>} */\n  _autocorrelator;\n  /** @private @type {T} */\n  _nsdfBuffer;\n  /** @private @type {number} */\n  _clarityThreshold = 0.9;\n  /** @private @type {number} */\n  _minVolumeAbsolute = 0.0;\n  /** @private @type {number} */\n  _maxInputAmplitude = 1.0;\n\n  /**\n   * A helper method to create an {@link PitchDetector} using {@link Float32Array} buffers.\n   *\n   * @param inputLength {number} the input array length to support\n   * @returns {PitchDetector<Float32Array>}\n   */\n  static forFloat32Array(inputLength) {\n    return new PitchDetector(inputLength, (length) => new Float32Array(length));\n  }\n\n  /**\n   * A helper method to create an {@link PitchDetector} using {@link Float64Array} buffers.\n   *\n   * @param inputLength {number} the input array length to support\n   * @returns {PitchDetector<Float64Array>}\n   */\n  static forFloat64Array(inputLength) {\n    return new PitchDetector(inputLength, (length) => new Float64Array(length));\n  }\n\n  /**\n   * A helper method to create an {@link PitchDetector} using `number[]` buffers.\n   *\n   * @param inputLength {number} the input array length to support\n   * @returns {PitchDetector<number[]>}\n   */\n  static forNumberArray(inputLength) {\n    return new PitchDetector(inputLength, (length) => Array(length));\n  }\n\n  /**\n   * Constructs a new {@link PitchDetector} able to handle input arrays of the\n   * given length.\n   *\n   * @param inputLength {number} the input array length to support. This\n   * `PitchDetector` will only support operation on arrays of this length.\n   * @param bufferSupplier {(inputLength: number) => T} the function to use for\n   * creating buffers, accepting the length of the buffer to create and\n   * returning a new buffer of that length. The values of the returned buffer\n   * need not be initialized in any particular way.\n   */\n  constructor(inputLength, bufferSupplier) {\n    this._autocorrelator = new Autocorrelator(inputLength, bufferSupplier);\n    this._nsdfBuffer = bufferSupplier(inputLength);\n  }\n\n  /**\n   * Returns the supported input length.\n   *\n   * @returns {number} the supported input length\n   */\n  get inputLength() {\n    return this._autocorrelator.inputLength;\n  }\n\n  /**\n   * Sets the clarity threshold used when identifying the correct pitch (the constant\n   * `k` from the MPM paper). The value must be between 0 (exclusive) and 1\n   * (inclusive), with the most suitable range being between 0.8 and 1.\n   *\n   * @param threshold {number} the clarity threshold\n   */\n  set clarityThreshold(threshold) {\n    if (!Number.isFinite(threshold) || threshold <= 0 || threshold > 1) {\n      throw new Error(\"clarityThreshold must be a number in the range (0, 1]\");\n    }\n    this._clarityThreshold = threshold;\n  }\n\n  /**\n   * Sets the minimum detectable volume, as an absolute number between 0 and\n   * `maxInputAmplitude`, inclusive, to consider in a sample when detecting the\n   * pitch. If a sample fails to meet this minimum volume, `findPitch` will\n   * return a clarity of 0.\n   *\n   * Volume is calculated as the RMS (root mean square) of the input samples.\n   *\n   * @param volume {number} the minimum volume as an absolute amplitude value\n   */\n  set minVolumeAbsolute(volume) {\n    if (\n      !Number.isFinite(volume) ||\n      volume < 0 ||\n      volume > this._maxInputAmplitude\n    ) {\n      throw new Error(\n        `minVolumeAbsolute must be a number in the range [0, ${this._maxInputAmplitude}]`,\n      );\n    }\n    this._minVolumeAbsolute = volume;\n  }\n\n  /**\n   * Sets the minimum volume using a decibel measurement. Must be less than or\n   * equal to 0: 0 indicates the loudest possible sound (see\n   * `maxInputAmplitude`), -10 is a sound with a tenth of the volume of the\n   * loudest possible sound, etc.\n   *\n   * Volume is calculated as the RMS (root mean square) of the input samples.\n   *\n   * @param db {number} the minimum volume in decibels, with 0 being the loudest\n   * sound\n   */\n  set minVolumeDecibels(db) {\n    if (!Number.isFinite(db) || db > 0) {\n      throw new Error(\"minVolumeDecibels must be a number <= 0\");\n    }\n    this._minVolumeAbsolute = this._maxInputAmplitude * 10 ** (db / 10);\n  }\n\n  /**\n   * Sets the maximum amplitude of an input reading. Must be greater than 0.\n   *\n   * @param amplitude {number} the maximum amplitude (absolute value) of an input reading\n   */\n  set maxInputAmplitude(amplitude) {\n    if (!Number.isFinite(amplitude) || amplitude <= 0) {\n      throw new Error(\"maxInputAmplitude must be a number > 0\");\n    }\n    this._maxInputAmplitude = amplitude;\n  }\n\n  /**\n   * Returns the pitch detected using McLeod Pitch Method (MPM) along with a\n   * measure of its clarity.\n   *\n   * The clarity is a value between 0 and 1 (potentially inclusive) that\n   * represents how \"clear\" the pitch was. A clarity value of 1 indicates that\n   * the pitch was very distinct, while lower clarity values indicate less\n   * definite pitches.\n   *\n   * @param input {ArrayLike<number>} the time-domain input data\n   * @param sampleRate {number} the sample rate at which the input data was\n   * collected\n   * @returns {[number, number]} the detected pitch, in Hz, followed by the\n   * clarity. If a pitch cannot be determined from the input, such as if the\n   * volume is too low (see `minVolumeAbsolute` and `minVolumeDecibels`), this\n   * will be `[0, 0]`.\n   */\n  findPitch(input, sampleRate) {\n    // If the highest key maximum is less than the minimum volume, we don't need\n    // to bother detecting the pitch, as the sample is too quiet.\n    if (this._belowMinimumVolume(input)) return [0, 0];\n    this._nsdf(input);\n    const keyMaximumIndices = getKeyMaximumIndices(this._nsdfBuffer);\n    if (keyMaximumIndices.length === 0) {\n      // No key maxima means that we either don't have enough data to analyze or\n      // that the data was flawed (such as an input array of zeroes)\n      return [0, 0];\n    }\n    // The highest key maximum\n    const nMax = Math.max(...keyMaximumIndices.map((i) => this._nsdfBuffer[i]));\n    // Following the paper, we return the pitch corresponding to the first key\n    // maximum higher than K * nMax. This is guaranteed not to be undefined, since\n    // we know of at least one key maximum satisfying this condition (whichever\n    // key maximum gave us nMax).\n    const resultIndex = keyMaximumIndices.find(\n      (i) => this._nsdfBuffer[i] >= this._clarityThreshold * nMax,\n    );\n    const [refinedResultIndex, clarity] = refineResultIndex(\n      // @ts-expect-error resultIndex is guaranteed to be defined\n      resultIndex,\n      this._nsdfBuffer,\n    );\n\n    // Due to floating point errors, the clarity may occasionally come out to be\n    // slightly over 1.0. We can avoid incorrect results by clamping the value.\n    return [sampleRate / refinedResultIndex, Math.min(clarity, 1.0)];\n  }\n\n  /**\n   * Returns whether the input audio data is below the minimum volume allowed by\n   * the pitch detector.\n   *\n   * @private\n   * @param input {ArrayLike<number>}\n   * @returns {boolean}\n   */\n  _belowMinimumVolume(input) {\n    if (this._minVolumeAbsolute === 0) return false;\n    let squareSum = 0;\n    for (let i = 0; i < input.length; i++) {\n      squareSum += input[i] ** 2;\n    }\n    return Math.sqrt(squareSum / input.length) < this._minVolumeAbsolute;\n  }\n\n  /**\n   * Computes the NSDF of the input and stores it in the internal buffer. This\n   * is equation (9) in the McLeod pitch method paper.\n   *\n   * @private\n   * @param input {ArrayLike<number>}\n   */\n  _nsdf(input) {\n    // The function r'(tau) is the autocorrelation\n    this._autocorrelator.autocorrelate(input, this._nsdfBuffer);\n    // The function m'(tau) (defined in equation (6)) can be computed starting\n    // with m'(0), which is equal to 2r'(0), and then iteratively modified to\n    // get m'(1), m'(2), etc. For example, to get m'(1), we take m'(0) and\n    // subtract x_0^2 and x_{W-1}^2. Then, to get m'(2), we take m'(1) and\n    // subtract x_1^2 and x_{W-2}^2, and further values are similar (see the\n    // note at the end of section 6 in the MPM paper).\n    //\n    // The resulting array values are 2 * r'(tau) / m'(tau). We use m below as\n    // the incremental value of m'.\n    let m = 2 * this._nsdfBuffer[0];\n    /** @type {number} */ let i;\n    // As pointed out by issuefiler on GitHub, we can take advantage of the fact\n    // that m will never increase to avoid division by zero by ending this loop\n    // once m === 0. The rest of the array values after m becomes 0 will just be\n    // set to 0 themselves. We actually check for m > 0 rather than m === 0\n    // because there may be small floating-point errors that cause m to become\n    // negative rather than exactly 0.\n    for (i = 0; i < this._nsdfBuffer.length && m > 0; i++) {\n      this._nsdfBuffer[i] = (2 * this._nsdfBuffer[i]) / m;\n      m -= input[i] ** 2 + input[input.length - i - 1] ** 2;\n    }\n    // If there are any array values remaining, it means m === 0 for those\n    // values of tau, so we can just set them to 0\n    for (; i < this._nsdfBuffer.length; i++) {\n      this._nsdfBuffer[i] = 0;\n    }\n  }\n}\n\n/**\n * Rounds up the input to the next power of 2.\n *\n * @param {number} v\n * @returns {number} the next power of 2 at least as large as `v`\n */\nfunction ceilPow2(v) {\n  // https://graphics.stanford.edu/~seander/bithacks.html#RoundUpPowerOf2\n  v--;\n  v |= v >> 1;\n  v |= v >> 2;\n  v |= v >> 4;\n  v |= v >> 8;\n  v |= v >> 16;\n  v++;\n  return v;\n}\n","/**\n * Pitch Detector\n * Wraps the pitchy library for real-time monophonic pitch detection\n * Uses McLeod Pitch Method (MPM) for accurate fundamental frequency detection\n */\n\nimport { PitchDetector as PitchyDetector } from 'pitchy';\nimport { frequencyToMidi, getCentsFromMidi } from './music-theory';\n\n// Type definitions\nexport interface PitchResult {\n    frequency: number;\n    midi: number;\n    cents: number;\n    clarity: number;\n    detected: boolean;\n}\n\nexport interface DetectorConfig {\n    bufferSize: number;\n    sampleRate: number;\n    minClarity: number;\n    minFrequency: number;\n    maxFrequency: number;\n}\n\nexport class PitchDetector {\n    private detector: PitchyDetector<Float32Array>;\n    private config: DetectorConfig;\n\n    constructor(config: Partial<DetectorConfig> = {}) {\n        // Default configuration optimized for musical instruments\n        this.config = {\n            bufferSize: config.bufferSize || 2048,\n            sampleRate: config.sampleRate || 44100,\n            minClarity: config.minClarity || 0.75,\n            minFrequency: config.minFrequency || 70,  // Below E2 (guitar low E)\n            maxFrequency: config.maxFrequency || 1600 // Above G6 (violin high range)\n        };\n\n        // Initialize pitchy detector\n        this.detector = PitchyDetector.forFloat32Array(this.config.bufferSize);\n        this.detector.minVolumeDecibels = -40; // Noise gate\n    }\n\n    /**\n     * Detect pitch from audio buffer\n     * @param buffer - Float32Array of audio samples\n     * @param sampleRate - Sample rate of the audio (optional, uses config default)\n     * @returns PitchResult with frequency, MIDI note, and clarity\n     */\n    detectPitch(buffer: Float32Array, sampleRate?: number): PitchResult {\n        const rate = sampleRate || this.config.sampleRate;\n\n        // Use pitchy's findPitch method (returns [frequency, clarity])\n        const [frequency, clarity] = this.detector.findPitch(buffer, rate);\n\n        // Check if detection is valid\n        const isValid = this.isValidDetection(frequency, clarity);\n\n        if (!isValid) {\n            return {\n                frequency: 0,\n                midi: 0,\n                cents: 0,\n                clarity: clarity || 0,\n                detected: false\n            };\n        }\n\n        // Convert frequency to MIDI note\n        const midi = frequencyToMidi(frequency);\n\n        // Calculate cents deviation from the MIDI note\n        const cents = getCentsFromMidi(frequency, midi);\n\n        return {\n            frequency,\n            midi,\n            cents,\n            clarity: clarity || 0,\n            detected: true\n        };\n    }\n\n    /**\n     * Check if detected pitch is valid based on clarity and frequency range\n     */\n    private isValidDetection(frequency: number, clarity: number): boolean {\n        if (!frequency || frequency <= 0) return false;\n        if (!clarity || clarity < this.config.minClarity) return false;\n        if (frequency < this.config.minFrequency) return false;\n        if (frequency > this.config.maxFrequency) return false;\n        return true;\n    }\n\n    /**\n     * Update detector configuration\n     */\n    updateConfig(config: Partial<DetectorConfig>): void {\n        this.config = { ...this.config, ...config };\n\n        // Recreate detector if buffer size changed\n        if (config.bufferSize && config.bufferSize !== this.config.bufferSize) {\n            this.detector = PitchyDetector.forFloat32Array(this.config.bufferSize);\n            this.detector.minVolumeDecibels = -40;\n        }\n    }\n\n    /**\n     * Get current configuration\n     */\n    getConfig(): DetectorConfig {\n        return { ...this.config };\n    }\n\n    /**\n     * Set minimum clarity threshold\n     */\n    setMinClarity(clarity: number): void {\n        this.config.minClarity = Math.max(0, Math.min(1, clarity));\n    }\n\n    /**\n     * Set frequency range for detection\n     */\n    setFrequencyRange(min: number, max: number): void {\n        this.config.minFrequency = min;\n        this.config.maxFrequency = max;\n    }\n\n    /**\n     * Create detector optimized for specific instrument\n     */\n    static forInstrument(instrument: 'guitar' | 'violin' | 'voice'): PitchDetector {\n        const configs = {\n            guitar: {\n                bufferSize: 2048,\n                minClarity: 0.75,\n                minFrequency: 70,   // E2\n                maxFrequency: 1400  // E6\n            },\n            violin: {\n                bufferSize: 2048,\n                minClarity: 0.80,\n                minFrequency: 180,  // Below G3\n                maxFrequency: 1600  // Above G6\n            },\n            voice: {\n                bufferSize: 2048,\n                minClarity: 0.85,\n                minFrequency: 80,   // E2\n                maxFrequency: 1200  // D6\n            }\n        };\n\n        return new PitchDetector(configs[instrument]);\n    }\n}\n\n/**\n * Helper function to create a pitch detector with default settings\n */\nexport function createPitchDetector(config?: Partial<DetectorConfig>): PitchDetector {\n    return new PitchDetector(config);\n}\n\n/**\n * Simplified pitch detection function for quick use\n * @param buffer - Audio buffer\n * @param sampleRate - Sample rate\n * @param minClarity - Minimum clarity threshold (0-1)\n * @returns Detected frequency or null if no pitch detected\n */\nexport function detectFrequency(\n    buffer: Float32Array,\n    sampleRate: number = 44100,\n    minClarity: number = 0.75\n): number | null {\n    const detector = new PitchDetector({ sampleRate, minClarity });\n    const result = detector.detectPitch(buffer);\n    return result.detected ? result.frequency : null;\n}\n","/**\n * Audio Manager\n * Manages microphone access and real-time pitch detection for stringed/bowed instruments\n */\n\nimport { PitchDetector, PitchResult } from '../utils/pitch-detector';\nimport { midiToNoteName } from '../utils/music-theory';\n\n// Type definitions\nexport interface AudioConfig {\n    bufferSize: number;\n    smoothing: number;\n    minClarity: number;\n    minFrequency: number;\n    maxFrequency: number;\n}\n\nexport interface PitchDetectedEvent {\n    frequency: number;\n    midi: number;\n    cents: number;\n    clarity: number;\n    noteName: string;\n    timestamp: number;\n}\n\nexport interface AudioLevelEvent {\n    level: number; // 0-1\n    timestamp: number;\n}\n\nexport interface ErrorEvent {\n    message: string;\n    error?: Error;\n}\n\nexport interface StatusChangeEvent {\n    listening: boolean;\n    microphoneActive: boolean;\n}\n\ntype EventCallback<T> = (event: T) => void;\n\ninterface Listeners {\n    pitchDetected: EventCallback<PitchDetectedEvent>[];\n    audioLevel: EventCallback<AudioLevelEvent>[];\n    error: EventCallback<ErrorEvent>[];\n    statusChange: EventCallback<StatusChangeEvent>[];\n}\n\nexport type EventType = keyof Listeners;\n\nexport class AudioManager {\n    private audioContext: AudioContext | null = null;\n    private microphone: MediaStreamAudioSourceNode | null = null;\n    private analyser: AnalyserNode | null = null;\n    private pitchDetector: PitchDetector | null = null;\n    private animationFrameId: number | null = null;\n    private stream: MediaStream | null = null;\n\n    private config: AudioConfig;\n    private listeners: Listeners;\n    private isListening: boolean = false;\n    private buffer: Float32Array<ArrayBuffer> | null = null;\n\n    // Debouncing for note detection\n    private lastDetectedMidi: number | null = null;\n    private lastDetectedTime: number = 0;\n    private noteDebounceMs: number = 100; // Min time between note detections\n\n    constructor(config: Partial<AudioConfig> = {}) {\n        this.config = {\n            bufferSize: config.bufferSize || 2048,\n            smoothing: config.smoothing || 0.8,\n            minClarity: config.minClarity || 0.75,\n            minFrequency: config.minFrequency || 70,\n            maxFrequency: config.maxFrequency || 1600\n        };\n\n        this.listeners = {\n            pitchDetected: [],\n            audioLevel: [],\n            error: [],\n            statusChange: []\n        };\n    }\n\n    /**\n     * Initialize audio context and request microphone access\n     * @param deviceId - Optional specific device ID to use\n     */\n    async init(deviceId?: string): Promise<boolean> {\n        try {\n            // Check if getUserMedia is supported\n            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n                console.error('Microphone access is not supported in this browser');\n                return false;\n            }\n\n            // Create audio context\n            this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n\n            if (!this.audioContext) {\n                console.error('Failed to create audio context');\n                return false;\n            }\n\n            // Set up error handler for audio context\n            this.setupAudioContextErrorHandlers();\n\n            // Resume audio context if it's suspended\n            if (this.audioContext.state === 'suspended') {\n                await this.audioContext.resume();\n            }\n\n            // Request microphone access\n            const audioConstraints: MediaTrackConstraints = {\n                echoCancellation: false,\n                noiseSuppression: false,\n                autoGainControl: false,\n                sampleRate: 44100\n            };\n\n            // Add device ID if specified\n            if (deviceId) {\n                audioConstraints.deviceId = { exact: deviceId };\n            }\n\n            this.stream = await navigator.mediaDevices.getUserMedia({\n                audio: audioConstraints\n            });\n\n            // Verify audio context is still valid\n            if (!this.audioContext) {\n                console.error('Audio context was lost during initialization');\n                return false;\n            }\n\n            // Create audio nodes\n            this.microphone = this.audioContext.createMediaStreamSource(this.stream);\n            this.analyser = this.audioContext.createAnalyser();\n            this.analyser.fftSize = this.config.bufferSize * 2;\n            this.analyser.smoothingTimeConstant = this.config.smoothing;\n\n            // Connect nodes\n            this.microphone.connect(this.analyser);\n\n            // Create buffer for time-domain data\n            this.buffer = new Float32Array(this.config.bufferSize) as Float32Array<ArrayBuffer>;\n\n            // Initialize pitch detector\n            this.pitchDetector = new PitchDetector({\n                bufferSize: this.config.bufferSize,\n                sampleRate: this.audioContext.sampleRate,\n                minClarity: this.config.minClarity,\n                minFrequency: this.config.minFrequency,\n                maxFrequency: this.config.maxFrequency\n            });\n\n            console.log('Audio Manager initialized successfully');\n            console.log('Sample rate:', this.audioContext.sampleRate);\n            console.log('Buffer size:', this.config.bufferSize);\n            console.log('Audio context state:', this.audioContext.state);\n\n            this.emitStatusChange({ listening: false, microphoneActive: true });\n            return true;\n        } catch (error) {\n            console.error('Failed to initialize audio:', error);\n            // Don't emit error event during init - let the caller handle it\n            // Clean up audio context if it was created\n            if (this.audioContext) {\n                this.audioContext.close().catch(() => {});\n                this.audioContext = null;\n            }\n            return false;\n        }\n    }\n\n    /**\n     * Setup error handlers for AudioContext\n     */\n    private stateChangeHandler = () => {\n        if (!this.audioContext) return;\n\n        console.log('AudioContext state changed to:', this.audioContext.state);\n\n        if (this.audioContext.state === 'suspended') {\n            console.warn('AudioContext suspended, attempting to resume...');\n            this.audioContext.resume().catch(err => {\n                console.error('Failed to resume AudioContext:', err);\n            });\n        } else if (this.audioContext.state === 'closed') {\n            console.error('AudioContext closed');\n            // Don't emit error for intentional disconnects\n        }\n    };\n\n    private setupAudioContextErrorHandlers(): void {\n        if (!this.audioContext) return;\n\n        // Handle state changes\n        this.audioContext.addEventListener('statechange', this.stateChangeHandler);\n    }\n\n    /**\n     * Start listening for pitch\n     */\n    startListening(): void {\n        if (!this.audioContext || !this.analyser || !this.pitchDetector || !this.buffer) {\n            console.error('Audio Manager not initialized');\n            return;\n        }\n\n        if (this.isListening) {\n            console.warn('Already listening');\n            return;\n        }\n\n        this.isListening = true;\n        this.emitStatusChange({ listening: true, microphoneActive: true });\n        this.detectPitchLoop();\n        console.log('Started listening for pitch');\n    }\n\n    /**\n     * Stop listening for pitch\n     */\n    stopListening(): void {\n        if (!this.isListening) return;\n\n        this.isListening = false;\n        if (this.animationFrameId !== null) {\n            cancelAnimationFrame(this.animationFrameId);\n            this.animationFrameId = null;\n        }\n\n        this.emitStatusChange({ listening: false, microphoneActive: this.stream !== null });\n        console.log('Stopped listening for pitch');\n    }\n\n    /**\n     * Main pitch detection loop\n     */\n    private detectPitchLoop(): void {\n        if (!this.isListening || !this.analyser || !this.pitchDetector || !this.buffer || !this.audioContext) {\n            return;\n        }\n\n        // Check if audio context is in a valid state\n        if (this.audioContext.state === 'suspended') {\n            console.warn('AudioContext suspended during pitch detection, attempting resume...');\n            this.audioContext.resume().then(() => {\n                console.log('AudioContext resumed successfully');\n            }).catch(err => {\n                console.error('Failed to resume AudioContext:', err);\n                this.stopListening();\n                this.emitError('Audio system paused. Please restart your practice session.');\n            });\n            return;\n        }\n\n        if (this.audioContext.state === 'closed') {\n            console.error('AudioContext closed during pitch detection');\n            this.stopListening();\n            this.emitError('Audio system closed. Please reconnect your microphone.');\n            return;\n        }\n\n        try {\n            // Get time-domain data from analyser\n            this.analyser.getFloatTimeDomainData(this.buffer);\n\n            // Calculate audio level (RMS)\n            const level = this.calculateRMS(this.buffer);\n            this.emitAudioLevel(level);\n\n            // Detect pitch\n            const result: PitchResult = this.pitchDetector.detectPitch(this.buffer, this.audioContext.sampleRate);\n\n            // Emit pitch detected event if valid\n            if (result.detected) {\n                // Debounce rapid detections of the same note\n                const now = Date.now();\n                if (\n                    result.midi !== this.lastDetectedMidi ||\n                    now - this.lastDetectedTime > this.noteDebounceMs\n                ) {\n                    this.emitPitchDetected({\n                        frequency: result.frequency,\n                        midi: result.midi,\n                        cents: result.cents,\n                        clarity: result.clarity,\n                        noteName: midiToNoteName(result.midi),\n                        timestamp: now\n                    });\n\n                    this.lastDetectedMidi = result.midi;\n                    this.lastDetectedTime = now;\n                }\n            }\n        } catch (error) {\n            console.error('Error in pitch detection loop:', error);\n            // Don't stop the loop on error, just log and continue\n        }\n\n        // Continue loop\n        if (this.isListening) {\n            this.animationFrameId = requestAnimationFrame(() => this.detectPitchLoop());\n        }\n    }\n\n    /**\n     * Calculate RMS (Root Mean Square) for audio level\n     */\n    private calculateRMS(buffer: Float32Array<ArrayBuffer>): number {\n        let sum = 0;\n        for (let i = 0; i < buffer.length; i++) {\n            sum += buffer[i] * buffer[i];\n        }\n        return Math.sqrt(sum / buffer.length);\n    }\n\n    /**\n     * Disconnect microphone and clean up resources\n     */\n    disconnect(): void {\n        this.stopListening();\n\n        if (this.microphone) {\n            this.microphone.disconnect();\n            this.microphone = null;\n        }\n\n        if (this.stream) {\n            this.stream.getTracks().forEach(track => track.stop());\n            this.stream = null;\n        }\n\n        if (this.audioContext) {\n            // Remove event listener before closing to prevent statechange events\n            this.audioContext.removeEventListener('statechange', this.stateChangeHandler);\n            this.audioContext.close();\n            this.audioContext = null;\n        }\n\n        this.analyser = null;\n        this.pitchDetector = null;\n        this.buffer = null;\n\n        this.emitStatusChange({ listening: false, microphoneActive: false });\n        console.log('Audio Manager disconnected');\n    }\n\n    /**\n     * Update configuration\n     */\n    updateConfig(config: Partial<AudioConfig>): void {\n        this.config = { ...this.config, ...config };\n\n        if (this.pitchDetector) {\n            this.pitchDetector.updateConfig({\n                minClarity: this.config.minClarity,\n                minFrequency: this.config.minFrequency,\n                maxFrequency: this.config.maxFrequency\n            });\n        }\n\n        if (this.analyser) {\n            this.analyser.smoothingTimeConstant = this.config.smoothing;\n        }\n    }\n\n    /**\n     * Set note debounce time\n     */\n    setDebounceTime(ms: number): void {\n        this.noteDebounceMs = Math.max(0, ms);\n    }\n\n    /**\n     * Register an event listener\n     */\n    on<T extends EventType>(event: T, callback: Listeners[T][number]): void {\n        if (this.listeners[event]) {\n            this.listeners[event].push(callback as any);\n        } else {\n            console.warn('Unknown event type:', event);\n        }\n    }\n\n    /**\n     * Remove an event listener\n     */\n    off<T extends EventType>(event: T, callback: Listeners[T][number]): void {\n        if (this.listeners[event]) {\n            const index = this.listeners[event].indexOf(callback as any);\n            if (index > -1) {\n                this.listeners[event].splice(index, 1);\n            }\n        }\n    }\n\n    /**\n     * Emit pitch detected event\n     */\n    private emitPitchDetected(data: PitchDetectedEvent): void {\n        this.listeners.pitchDetected.forEach(callback => {\n            try {\n                callback(data);\n            } catch (error) {\n                console.error('Error in pitchDetected listener:', error);\n            }\n        });\n    }\n\n    /**\n     * Emit audio level event\n     */\n    private emitAudioLevel(level: number): void {\n        this.listeners.audioLevel.forEach(callback => {\n            try {\n                callback({ level, timestamp: Date.now() });\n            } catch (error) {\n                console.error('Error in audioLevel listener:', error);\n            }\n        });\n    }\n\n    /**\n     * Emit error event\n     */\n    private emitError(message: string, error?: Error): void {\n        this.listeners.error.forEach(callback => {\n            try {\n                callback({ message, error });\n            } catch (err) {\n                console.error('Error in error listener:', err);\n            }\n        });\n    }\n\n    /**\n     * Emit status change event\n     */\n    private emitStatusChange(status: StatusChangeEvent): void {\n        this.listeners.statusChange.forEach(callback => {\n            try {\n                callback(status);\n            } catch (error) {\n                console.error('Error in statusChange listener:', error);\n            }\n        });\n    }\n\n    /**\n     * Get current audio level (0-1)\n     */\n    getCurrentLevel(): number {\n        if (!this.buffer) return 0;\n        return this.calculateRMS(this.buffer);\n    }\n\n    /**\n     * Check if microphone is active\n     */\n    isMicrophoneActive(): boolean {\n        return this.stream !== null && this.audioContext !== null;\n    }\n\n    /**\n     * Check if currently listening\n     */\n    isCurrentlyListening(): boolean {\n        return this.isListening;\n    }\n\n    /**\n     * Get audio context sample rate\n     */\n    getSampleRate(): number {\n        return this.audioContext?.sampleRate || 44100;\n    }\n\n    /**\n     * Simulate frequency detection (for testing without microphone)\n     */\n    simulateFrequency(frequency: number): void {\n        const midi = Math.round(12 * Math.log2(frequency / 440) + 69);\n        this.emitPitchDetected({\n            frequency,\n            midi,\n            cents: 0,\n            clarity: 1.0,\n            noteName: midiToNoteName(midi),\n            timestamp: Date.now()\n        });\n    }\n\n    /**\n     * Get available audio input devices\n     */\n    static async getAudioInputDevices(): Promise<MediaDeviceInfo[]> {\n        try {\n            // First request permission to enumerate devices\n            await navigator.mediaDevices.getUserMedia({ audio: true });\n\n            // Then enumerate all devices\n            const devices = await navigator.mediaDevices.enumerateDevices();\n            return devices.filter(device => device.kind === 'audioinput');\n        } catch (error) {\n            console.error('Failed to enumerate audio devices:', error);\n            return [];\n        }\n    }\n\n    /**\n     * Get the currently active audio input device\n     */\n    getActiveDevice(): MediaDeviceInfo | null {\n        if (!this.stream) return null;\n\n        const audioTrack = this.stream.getAudioTracks()[0];\n        if (!audioTrack) return null;\n\n        // Return basic device info from the track\n        return {\n            deviceId: audioTrack.getSettings().deviceId || '',\n            groupId: audioTrack.getSettings().groupId || '',\n            kind: 'audioinput',\n            label: audioTrack.label,\n            toJSON: () => ({})\n        } as MediaDeviceInfo;\n    }\n\n    /**\n     * Check if microphone access is supported\n     */\n    static isSupported(): boolean {\n        return !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);\n    }\n}\n\n// Make available globally for legacy code\nif (typeof window !== 'undefined') {\n    (window as any).AudioManager = AudioManager;\n}\n","/**\n * Storage Utilities\n * Handles local storage for progress tracking and session data\n */\n\n// Type definitions\nexport interface ModuleStats {\n    sessions: number;\n    correct: number;\n    incorrect: number;\n}\n\nexport interface Stats {\n    totalSessions: number;\n    totalCorrect: number;\n    totalIncorrect: number;\n    totalNotes: number;\n    avgResponseTime: number;\n    bestStreak: number;\n    lastPracticeDate: number | null;\n    byModule: Record<string, ModuleStats>;\n    // Game mode stats\n    lifetimeScore: number;\n    currentLevel: number;\n    highestStreak: number;\n}\n\nexport interface SessionData {\n    module?: string;\n    correct?: number;\n    incorrect?: number;\n    avgResponseTime?: number;\n    bestStreak?: number;\n    instrument?: string;\n    clef?: string;\n    range?: string;\n    timestamp?: number;\n    id?: string;\n    // Game mode data\n    gameMode?: 'practice' | 'timed';\n    roundScore?: number;\n    timeLeft?: number;\n    livesRemaining?: number;\n    [key: string]: any; // Allow additional properties\n}\n\nexport interface Session extends SessionData {\n    timestamp: number;\n    id: string;\n}\n\nexport interface Settings {\n    theme: 'light' | 'dark';\n    clef: 'treble' | 'bass';\n    range: string;\n    fallingNotesMode: boolean;\n    allowOctaveError: boolean;\n    midiDeviceId: string | null;\n    audioDeviceId: string | null;\n    virtualKeyboard: boolean;\n    instrument?: string;\n    pitchTolerance?: number;\n    // Game mode settings\n    gameMode?: 'practice' | 'timed';\n    soundEffectsEnabled?: boolean;\n    soundEffectsVolume?: number;\n    animationsEnabled?: boolean;\n    confettiEnabled?: boolean;\n    [key: string]: any; // Allow additional settings\n}\n\nexport interface ExportData {\n    sessions: Session[];\n    stats: Stats;\n    settings: Settings;\n    exportDate: number;\n}\n\n// Storage keys\nconst KEYS = {\n    SESSIONS: 'music_practice_sessions',\n    SETTINGS: 'music_practice_settings',\n    STATS: 'music_practice_stats'\n} as const;\n\n/**\n * Check if localStorage is available\n */\nfunction isLocalStorageAvailable(): boolean {\n    try {\n        return typeof window !== 'undefined' && typeof localStorage !== 'undefined';\n    } catch {\n        return false;\n    }\n}\n\n/**\n * Save a practice session\n */\nexport function saveSession(sessionData: SessionData): void {\n    if (!isLocalStorageAvailable()) {\n        console.warn('localStorage not available');\n        return;\n    }\n\n    try {\n        const sessions = getSessions();\n        const newSession: Session = {\n            ...sessionData,\n            timestamp: Date.now(),\n            id: generateId()\n        };\n        sessions.push(newSession);\n\n        // Keep only last 100 sessions\n        if (sessions.length > 100) {\n            sessions.shift();\n        }\n\n        localStorage.setItem(KEYS.SESSIONS, JSON.stringify(sessions));\n        updateStats(sessionData);\n    } catch (error) {\n        console.error('Error saving session:', error);\n    }\n}\n\n/**\n * Get all saved sessions\n */\nexport function getSessions(): Session[] {\n    if (!isLocalStorageAvailable()) {\n        return [];\n    }\n\n    try {\n        const data = localStorage.getItem(KEYS.SESSIONS);\n        return data ? JSON.parse(data) : [];\n    } catch (error) {\n        console.error('Error loading sessions:', error);\n        return [];\n    }\n}\n\n/**\n * Get sessions by instrument\n */\nexport function getSessionsByInstrument(instrumentId: string): Session[] {\n    return getSessions().filter(session => session.instrument === instrumentId);\n}\n\n/**\n * Update overall statistics\n */\nexport function updateStats(sessionData: SessionData): void {\n    if (!isLocalStorageAvailable()) {\n        return;\n    }\n\n    try {\n        const stats = getStats();\n\n        // Update counts\n        stats.totalSessions++;\n        stats.totalCorrect += sessionData.correct || 0;\n        stats.totalIncorrect += sessionData.incorrect || 0;\n        stats.totalNotes += (sessionData.correct || 0) + (sessionData.incorrect || 0);\n\n        // Update averages\n        if (sessionData.avgResponseTime) {\n            const totalTime = stats.avgResponseTime * (stats.totalSessions - 1) + sessionData.avgResponseTime;\n            stats.avgResponseTime = totalTime / stats.totalSessions;\n        }\n\n        // Track best streak\n        if ((sessionData.bestStreak || 0) > stats.bestStreak) {\n            stats.bestStreak = sessionData.bestStreak || 0;\n        }\n\n        // Track by module\n        const module = sessionData.module || 'sightReading';\n        if (!stats.byModule[module]) {\n            stats.byModule[module] = {\n                sessions: 0,\n                correct: 0,\n                incorrect: 0\n            };\n        }\n\n        stats.byModule[module].sessions++;\n        stats.byModule[module].correct += sessionData.correct || 0;\n        stats.byModule[module].incorrect += sessionData.incorrect || 0;\n\n        // Save last practice date\n        stats.lastPracticeDate = Date.now();\n\n        localStorage.setItem(KEYS.STATS, JSON.stringify(stats));\n    } catch (error) {\n        console.error('Error updating stats:', error);\n    }\n}\n\n/**\n * Get overall statistics\n */\nexport function getStats(): Stats {\n    if (!isLocalStorageAvailable()) {\n        return getDefaultStats();\n    }\n\n    try {\n        const data = localStorage.getItem(KEYS.STATS);\n        return data ? JSON.parse(data) : getDefaultStats();\n    } catch (error) {\n        console.error('Error loading stats:', error);\n        return getDefaultStats();\n    }\n}\n\n/**\n * Get default statistics object\n */\nexport function getDefaultStats(): Stats {\n    return {\n        totalSessions: 0,\n        totalCorrect: 0,\n        totalIncorrect: 0,\n        totalNotes: 0,\n        avgResponseTime: 0,\n        bestStreak: 0,\n        lastPracticeDate: null,\n        byModule: {},\n        lifetimeScore: 0,\n        currentLevel: 1,\n        highestStreak: 0\n    };\n}\n\n/**\n * Save user settings\n */\nexport function saveSettings(settings: Partial<Settings>): void {\n    if (!isLocalStorageAvailable()) {\n        console.warn('localStorage not available');\n        return;\n    }\n\n    try {\n        const currentSettings = getSettings();\n        const updatedSettings = { ...currentSettings, ...settings };\n        localStorage.setItem(KEYS.SETTINGS, JSON.stringify(updatedSettings));\n    } catch (error) {\n        console.error('Error saving settings:', error);\n    }\n}\n\n/**\n * Get user settings\n */\nexport function getSettings(): Settings {\n    if (!isLocalStorageAvailable()) {\n        return getDefaultSettings();\n    }\n\n    try {\n        const data = localStorage.getItem(KEYS.SETTINGS);\n        return data ? JSON.parse(data) : getDefaultSettings();\n    } catch (error) {\n        console.error('Error loading settings:', error);\n        return getDefaultSettings();\n    }\n}\n\n/**\n * Get default settings\n */\nexport function getDefaultSettings(): Settings {\n    return {\n        theme: 'light',\n        clef: 'treble',\n        range: 'c4-c5',\n        fallingNotesMode: false,\n        allowOctaveError: true,\n        midiDeviceId: null,\n        audioDeviceId: null,\n        virtualKeyboard: false,\n        instrument: 'piano',\n        pitchTolerance: 50,\n        gameMode: 'practice',\n        soundEffectsEnabled: true,\n        soundEffectsVolume: 0.7,\n        animationsEnabled: true,\n        confettiEnabled: true\n    };\n}\n\n/**\n * Clear all data (keep settings)\n */\nexport function clearAll(): void {\n    if (!isLocalStorageAvailable()) {\n        return;\n    }\n\n    try {\n        localStorage.removeItem(KEYS.SESSIONS);\n        localStorage.removeItem(KEYS.STATS);\n        // Keep settings\n    } catch (error) {\n        console.error('Error clearing data:', error);\n    }\n}\n\n/**\n * Clear all data including settings\n */\nexport function clearAllIncludingSettings(): void {\n    if (!isLocalStorageAvailable()) {\n        return;\n    }\n\n    try {\n        localStorage.removeItem(KEYS.SESSIONS);\n        localStorage.removeItem(KEYS.STATS);\n        localStorage.removeItem(KEYS.SETTINGS);\n    } catch (error) {\n        console.error('Error clearing data:', error);\n    }\n}\n\n/**\n * Export data as JSON\n */\nexport function exportData(): string {\n    return JSON.stringify({\n        sessions: getSessions(),\n        stats: getStats(),\n        settings: getSettings(),\n        exportDate: Date.now()\n    }, null, 2);\n}\n\n/**\n * Import data from JSON\n */\nexport function importData(jsonData: string): boolean {\n    if (!isLocalStorageAvailable()) {\n        console.warn('localStorage not available');\n        return false;\n    }\n\n    try {\n        const data: Partial<ExportData> = JSON.parse(jsonData);\n\n        if (data.sessions) {\n            localStorage.setItem(KEYS.SESSIONS, JSON.stringify(data.sessions));\n        }\n        if (data.stats) {\n            localStorage.setItem(KEYS.STATS, JSON.stringify(data.stats));\n        }\n        if (data.settings) {\n            localStorage.setItem(KEYS.SETTINGS, JSON.stringify(data.settings));\n        }\n\n        return true;\n    } catch (error) {\n        console.error('Error importing data:', error);\n        return false;\n    }\n}\n\n/**\n * Generate a unique ID\n */\nexport function generateId(): string {\n    return Date.now().toString(36) + Math.random().toString(36).substr(2);\n}\n\n// Export as namespace for backward compatibility\nexport const Storage = {\n    KEYS,\n    saveSession,\n    getSessions,\n    getSessionsByInstrument,\n    updateStats,\n    getStats,\n    getDefaultStats,\n    saveSettings,\n    getSettings,\n    getDefaultSettings,\n    clearAll,\n    clearAllIncludingSettings,\n    exportData,\n    importData,\n    generateId\n};\n\n// Make available globally for legacy code\nif (typeof window !== 'undefined') {\n    (window as any).Storage = Storage;\n}\n"],"names":["Piano","createLucideIcon","isNamedPitch","src","isPitch","pitch2","FIFTHS","STEPS_TO_OCTS","fifths","coordinates","step","alt","oct","dir","f","o","FIFTHS_TO_STEPS","pitch","coord","unaltered","i","fillStr","s","n","NoInterval","INTERVAL_TONAL_REGEX","INTERVAL_SHORTHAND_REGEX","REGEX","tokenizeInterval","str","m","cache","interval","parse","pitchName","SIZES","TYPES","tokens","num","q","t","type","name","simple","qToAlt","semitones","chroma","coordToInterval","forceDescending","isDescending","ivl","props","calcNum","d","altToQ","NoNote","stepToLetter","altToAcc","accToAlt","acc","note","stringSrc","cached","value","tokenizeNote","coordToNote","noteCoord","mod","SEMI","noteName","letter","octStr","pc","height","midi","freq","transpose","intervalName","asNote","intervalCoord","asInterval","tr","distance","fromNote","toNote","from","to","fcoord","tcoord","octs","rotate","times","arr","len","EmptyPcset","setNumToChroma","num2","chromaToNumber","chroma2","isChroma","set","isPcsetNum","isPcset","get","listToChroma","chromaToPcset","IVLS","chromaToIntervals","intervals2","chromaRotations","binary","_","setNum","normalizedNum","normalized","CHORDS","data_default","NoChordType","dictionary","index","add","intervals","aliases","fullName","quality","getQuality","chord","pcset","alias","addAlias","has","ivls","names2","a","b","subtract","combinator","fn","coordA","coordB","SCALES","NoScaleType","scale","NoChord","tokenize","tokenizeBass","note2","chord2","split","getChord","tonic","bass","typeName","optionalTonic","optionalBass","getChordType","bassInterval","bassIndex","hasRoot","root","rootDegree","hasBass","newNum","notes2","transposeNote","symbol","DATA","denominator","shorthand","SHARPS","FLATS","midiToNoteName","options","fromMidi","midi2","MODES","NoMode","modes","toMode","mode2","modeNum","triad","seventh","getType","chords","chords2","modeName","triads2","tonics","x","NoScale","st","getScaleType","notes","InstrumentType","InputMethod","Clef","INSTRUMENTS","getInstrument","instrumentId","instrument","requiresMIDI","getTuning","noteNames","vexflowNoteNames","midiNote","Note.fromMidi","noteNameToMidi","Note.midi","midiToVexflow","clef","octave","noteIndex","generateRandomNote","range","naturalsOnly","start","end","startMidi","endMidi","availableNotes","randomIndex","generateRandomNoteFromMidiRange","minMidi","maxMidi","validateNote","playedMidi","targetMidi","allowOctaveError","tolerance","pitchToleranceCents","playedPitch","targetPitch","validatePitchWithCents","playedFrequency","toleranceCents","targetFrequency","midiToFrequency","frequencyToMidi","centsOff","getCentsDeviation","message","Note.freq","frequency","getCentsFromMidi","generateMajorScale","Scale.get","generateMinorScale","generateScale","scaleType","generateChord","Chord.get","getAllKeySignatures","getInterval","note1","midi1","isFrequencyInRange","minFreq","maxFreq","midiToTabPosition","tuning","possiblePositions","stringInfo","openStringMidi","stringNumber","fret","aMiddleBonus","bMiddleBonus","getAllTabPositions","positions","MusicTheory","FFT","size","table","angle","power","j","shift","revShift","fft","complex","storage","res","input","spectrum","half","out","data","width","outOff","bitrev","off","inv","quarterLen","limit","k","A","B","C","D","Ar","Ai","Br","Bi","Cr","Ci","Dr","Di","MAr","MAi","tableBr","tableBi","MBr","MBi","tableCr","tableCi","MCr","MCi","tableDr","tableDi","MDr","MDi","T0r","T0i","T1r","T1i","T2r","T2i","T3r","T3i","FAr","FAi","FCr","FCi","FBr","FBi","FDr","FDi","evenR","evenI","oddR","oddI","leftR","leftI","rightR","rightI","step2","step3","halfLen","hquarterLen","ST0r","ST0i","ST1r","ST1i","ST2r","ST2i","ST3r","ST3i","SFAr","SFAi","SFBr","SFBi","SA","SB","Autocorrelator","inputLength","bufferSupplier","__publicField","ceilPow2","length","output","tb","getKeyMaximumIndices","keyIndices","lookingForMaximum","max","maxIndex","refineResultIndex","x0","x1","x2","y0","y1","y2","c","xMax","yMax","PitchDetector$1","PitchDetector","threshold","volume","db","amplitude","sampleRate","keyMaximumIndices","nMax","resultIndex","refinedResultIndex","clarity","squareSum","v","config","PitchyDetector","buffer","rate","cents","min","configs","AudioManager","err","deviceId","audioConstraints","error","level","result","now","sum","track","ms","event","callback","status","_a","device","audioTrack","KEYS","isLocalStorageAvailable","saveSession","sessionData","sessions","getSessions","newSession","generateId","updateStats","getSessionsByInstrument","session","stats","getStats","totalTime","module","getDefaultStats","saveSettings","settings","updatedSettings","getSettings","getDefaultSettings","clearAll","clearAllIncludingSettings","exportData","importData","jsonData","Storage"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,18,19]}