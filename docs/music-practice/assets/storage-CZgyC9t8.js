var qe=Object.defineProperty;var ze=(e,t,n)=>t in e?qe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var A=(e,t,n)=>ze(e,typeof t!="symbol"?t+"":t,n);import{c as $e,e as Le}from"./index-RP11MDmN.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vr=$e("Piano",[["path",{d:"M18.5 8c-1.4 0-2.6-.8-3.2-2A6.87 6.87 0 0 0 2 9v11a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-8.5C22 9.6 20.4 8 18.5 8",key:"lag0yf"}],["path",{d:"M2 14h20",key:"myj16y"}],["path",{d:"M6 14v4",key:"9ng0ue"}],["path",{d:"M10 14v4",key:"1v8uk5"}],["path",{d:"M14 14v4",key:"1tqops"}],["path",{d:"M18 14v4",key:"18uqwm"}]]);function Zt(e){return e!==null&&typeof e=="object"&&"name"in e&&typeof e.name=="string"}function te(e){return e!==null&&typeof e=="object"&&"step"in e&&typeof e.step=="number"&&"alt"in e&&typeof e.alt=="number"&&!isNaN(e.step)&&!isNaN(e.alt)}var ee=[0,2,4,-1,1,3,5],ne=ee.map(e=>Math.floor(e*7/12));function re(e){const{step:t,alt:n,oct:r,dir:i=1}=e,o=ee[t]+7*n;if(r===void 0)return[i*o];const s=r-ne[t]-4*n;return[i*o,i*s]}var Ve=[3,0,4,1,5,2,6];function ie(e){const[t,n,r]=e,i=Ve[Oe(t)],o=Math.floor((t+1)/7);if(n===void 0)return{step:i,alt:o,dir:r};const s=n+4*o+ne[i];return{step:i,alt:o,oct:s,dir:r}}function Oe(e){const t=(e+1)%7;return t<0?7+t:t}var Vt=(e,t)=>Array(Math.abs(t)+1).join(e),Tt=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),ke="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",Ge="(AA|A|P|M|m|d|dd)([-+]?\\d+)",Ue=new RegExp("^"+ke+"|"+Ge+"$");function He(e){const t=Ue.exec(`${e}`);return t===null?["",""]:t[1]?[t[1],t[2]]:[t[4],t[3]]}var Ot={};function V(e){return typeof e=="string"?Ot[e]||(Ot[e]=Je(e)):te(e)?V(Xe(e)):Zt(e)?V(e.name):Tt}var kt=[0,2,4,5,7,9,11],oe="PMMPPMM";function Je(e){const t=He(e);if(t[0]==="")return Tt;const n=+t[0],r=t[1],i=(Math.abs(n)-1)%7,o=oe[i];if(o==="M"&&r==="P")return Tt;const s=o==="M"?"majorable":"perfectable",a=""+n+r,c=n<0?-1:1,l=n===8||n===-8?n:c*(i+1),m=Ke(s,r),u=Math.floor((Math.abs(n)-1)/7),h=c*(kt[i]+m+12*u),M=(c*(kt[i]+m)%12+12)%12,P=re({step:i,alt:m,oct:u,dir:c});return{empty:!1,name:a,num:n,q:r,step:i,alt:m,dir:c,type:s,simple:l,semitones:h,chroma:M,coord:P,oct:u}}function se(e,t){const[n,r=0]=e,i=n*7+r*12<0,o=t||i?[-n,-r,-1]:[n,r,1];return V(ie(o))}function Ke(e,t){return t==="M"&&e==="majorable"||t==="P"&&e==="perfectable"?0:t==="m"&&e==="majorable"?-1:/^A+$/.test(t)?t.length:/^d+$/.test(t)?-1*(e==="perfectable"?t.length:t.length+1):0}function Xe(e){const{step:t,alt:n,oct:r=0,dir:i}=e;if(!i)return"";const o=t+1+7*r,s=o===0?t+1:o,a=i<0?"-":"",c=oe[t]==="M"?"majorable":"perfectable";return a+s+Ye(c,n)}function Ye(e,t){return t===0?e==="majorable"?"M":"P":t===-1&&e==="majorable"?"m":t>0?Vt("A",t):Vt("d",e==="perfectable"?t:t+1)}var Gt=(e,t)=>Array(Math.abs(t)+1).join(e),ae=Object.freeze({empty:!0,name:"",letter:"",acc:"",pc:"",step:NaN,alt:NaN,chroma:NaN,height:NaN,coord:[],midi:null,freq:null}),Ut=new Map,Qe=e=>"CDEFGAB".charAt(e),We=e=>e<0?Gt("b",-e):Gt("#",e),Ze=e=>e[0]==="b"?-e.length:e.length;function b(e){const t=JSON.stringify(e),n=Ut.get(t);if(n)return n;const r=typeof e=="string"?rn(e):te(e)?b(on(e)):Zt(e)?b(e.name):ae;return Ut.set(t,r),r}var tn=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function Nt(e){const t=tn.exec(e);return t?[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]:["","","",""]}function en(e){return b(ie(e))}var nn=(e,t)=>(e%t+t)%t,St=[0,2,4,5,7,9,11];function rn(e){const t=Nt(e);if(t[0]===""||t[3]!=="")return ae;const n=t[0],r=t[1],i=t[2],o=(n.charCodeAt(0)+3)%7,s=Ze(r),a=i.length?+i:void 0,c=re({step:o,alt:s,oct:a}),l=n+r+i,m=n+r,u=(St[o]+s+120)%12,h=a===void 0?nn(St[o]+s,12)-1188:St[o]+s+12*(a+1),M=h>=0&&h<=127?h:null,P=a===void 0?null:Math.pow(2,(h-69)/12)*440;return{empty:!1,acc:r,alt:s,chroma:u,coord:c,freq:P,height:h,letter:n,midi:M,name:l,oct:a,pc:m,step:o}}function on(e){const{step:t,alt:n,oct:r}=e,i=Qe(t);if(!i)return"";const o=i+We(n);return r||r===0?o+r:o}function It(e,t){const n=b(e),r=Array.isArray(t)?t:V(t).coord;if(n.empty||!r||r.length<2)return"";const i=n.coord,o=i.length===1?[i[0]+r[0]]:[i[0]+r[0],i[1]+r[1]];return en(o).name}function Ht(e,t){const n=b(e),r=b(t);if(n.empty||r.empty)return"";const i=n.coord,o=r.coord,s=o[0]-i[0],a=i.length===2&&o.length===2?o[1]-i[1]:-Math.floor(s*7/12),c=r.height===n.height&&r.midi!==null&&n.oct===r.oct&&n.step>r.step;return se([s,a],c).name}function ce(e,t){const n=t.length,r=(e%n+n)%n;return t.slice(r,n).concat(t.slice(0,r))}var O={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},me=e=>Number(e).toString(2).padStart(12,"0"),Jt=e=>parseInt(e,2),sn=/^[01]{12}$/;function ue(e){return sn.test(e)}var an=e=>typeof e=="number"&&e>=0&&e<=4095,cn=e=>e&&ue(e.chroma),Kt={[O.chroma]:O};function le(e){const t=ue(e)?e:an(e)?me(e):Array.isArray(e)?dn(e):cn(e)?e.chroma:O.chroma;return Kt[t]=Kt[t]||hn(t)}var mn=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function un(e){const t=[];for(let n=0;n<12;n++)e.charAt(n)==="1"&&t.push(mn[n]);return t}function ln(e){const t=e.split("");return t.map((n,r)=>ce(r,t).join(""))}function hn(e){const t=Jt(e),n=ln(e).map(Jt).filter(o=>o>=2048).sort()[0],r=me(n),i=un(e);return{empty:!1,name:"",setNum:t,chroma:e,normalized:r,intervals:i}}function dn(e){if(e.length===0)return O.chroma;let t;const n=[0,0,0,0,0,0,0,0,0,0,0,0];for(let r=0;r<e.length;r++)t=b(e[r]),t.empty&&(t=V(e[r])),t.empty||(n[t.chroma]=1);return n.join("")}var fn=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7 Î” ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 Î”9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 Î”#4 Î”#11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -Î”7 mÎ” -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim Â° o"],["1P 3m 5d 7d","diminished seventh","dim7 Â°7 o7"],["1P 3m 5d 7m","half-diminished","m7b5 Ã¸ -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 Î”9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],Mn=fn,Pn={...O,name:"",quality:"Unknown",intervals:[],aliases:[]},he=[],st={};function pn(e){return st[e]||Pn}function gn(e,t,n){const r=yn(e),i={...le(e),name:n||"",quality:r,intervals:e,aliases:t};he.push(i),i.name&&(st[i.name]=i),st[i.setNum]=i,st[i.chroma]=i,i.aliases.forEach(o=>vn(i,o))}function vn(e,t){st[t]=e}function yn(e){const t=n=>e.indexOf(n)!==-1;return t("5A")?"Augmented":t("3M")?"Major":t("5d")?"Diminished":t("3m")?"Minor":"Unknown"}Mn.forEach(([e,t,n])=>gn(e.split(" "),n.split(" "),t));he.sort((e,t)=>e.setNum-t.setNum);var bn=An((e,t)=>[e[0]-t[0],e[1]-t[1]]);function An(e){return(t,n)=>{const r=V(t).coord,i=V(n).coord;if(r&&i){const o=e(r,i);return se(o).name}}}var Sn=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2M 3m 4P 5P 6m 7m","minor","aeolian"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 6A","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2m 2A 3M 4A 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4","ukrainian dorian","romanian minor","altered dorian"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]],xn=Sn,Cn={...O,intervals:[],aliases:[]},at={};function de(e){return at[e]||Cn}function _n(e,t,n=[]){const r={...le(e),name:t,intervals:e,aliases:n};return at[r.name]=r,at[r.setNum]=r,at[r.chroma]=r,r.aliases.forEach(i=>Tn(r,i)),r}function Tn(e,t){at[t]=e}xn.forEach(([e,t,...n])=>_n(e.split(" "),t,n));var fe={empty:!0,name:"",symbol:"",root:"",bass:"",rootDegree:0,type:"",tonic:null,setNum:NaN,quality:"Unknown",chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function wn(e){const[t,n,r,i]=Nt(e);return t===""?xt("",e):t==="A"&&i==="ug"?xt("","aug"):xt(t+n,r+i)}function xt(e,t){const n=t.split("/");if(n.length===1)return[e,n[0],""];const[r,i,o,s]=Nt(n[1]);return r!==""&&o===""&&s===""?[e,n[0],r+i]:[e,t,""]}function Nn(e){if(Array.isArray(e))return Ct(e[1]||"",e[0],e[2]);if(e==="")return fe;{const[t,n,r]=wn(e),i=Ct(n,t,r);return i.empty?Ct(e):i}}function Ct(e,t,n){const r=pn(e),i=b(t||""),o=b(n||"");if(r.empty||t&&i.empty||n&&o.empty)return fe;const s=Ht(i.pc,o.pc),a=r.intervals.indexOf(s),c=a>=0,l=c?o:b(""),m=a===-1?NaN:a+1,u=o.pc&&o.pc!==i.pc,h=Array.from(r.intervals);if(c)for(let d=1;d<m;d++){const p=h[0][0],g=h[0][1],v=parseInt(p,10)+7;h.push(`${v}${g}`),h.shift()}else if(u){const d=bn(Ht(i.pc,o.pc),"8P");d&&h.unshift(d)}const M=i.empty?[]:h.map(d=>It(i.pc,d));e=r.aliases.indexOf(e)!==-1?e:r.aliases[0];const P=`${i.empty?"":i.pc}${e}${c&&m>1?"/"+l.pc:u?"/"+o.pc:""}`,f=`${t?i.pc+" ":""}${r.name}${c&&m>1?" over "+l.pc:u?" over "+o.pc:""}`;return{...r,name:f,symbol:P,tonic:i.pc,type:r.name,root:l.pc,bass:u?o.pc:"",intervals:h,rootDegree:m,notes:M}}var In=[[.125,"dl",["large","duplex longa","maxima","octuple","octuple whole"]],[.25,"l",["long","longa"]],[.5,"d",["double whole","double","breve"]],[1,"w",["whole","semibreve"]],[2,"h",["half","minim"]],[4,"q",["quarter","crotchet"]],[8,"e",["eighth","quaver"]],[16,"s",["sixteenth","semiquaver"]],[32,"t",["thirty-second","demisemiquaver"]],[64,"sf",["sixty-fourth","hemidemisemiquaver"]],[128,"h",["hundred twenty-eighth"]],[256,"th",["two hundred fifty-sixth"]]],En=In;En.forEach(([e,t,n])=>void 0);var Fn="C C# D D# E F F# G G# A A# B".split(" "),Dn="C Db D Eb E F Gb G Ab A Bb B".split(" ");function jn(e,t={}){if(isNaN(e)||e===-1/0||e===1/0)return"";e=Math.round(e);const r=(t.sharps===!0?Fn:Dn)[e%12];if(t.pitchClass)return r;const i=Math.floor(e/12)-1;return r+i}var Me=b,Rn=e=>Me(e).midi,Bn=e=>Me(e).freq;function Pe(e){return jn(e)}var Et=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],Xt={...O,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},qn=Et.map(zn),wt={};qn.forEach(e=>{wt[e.name]=e,e.aliases.forEach(t=>{wt[t]=e})});function pe(e){return typeof e=="string"?wt[e.toLowerCase()]||Xt:e&&e.name?pe(e.name):Xt}function zn(e){const[t,n,r,i,o,s,a]=e,c=a?[a]:[],l=Number(n).toString(2);return{empty:!1,intervals:de(i).intervals,modeNum:t,chroma:l,normalized:l,name:i,setNum:n,alt:r,triad:o,seventh:s,aliases:c}}function ge(e){return(t,n)=>{const r=pe(t);if(r.empty)return[];const i=ce(r.modeNum,e),o=r.intervals.map(s=>It(n,s));return i.map((s,a)=>o[a]+s)}}ge(Et.map(e=>e[4]));ge(Et.map(e=>e[5]));var $n={empty:!0,name:"",type:"",tonic:null,setNum:NaN,chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function Ln(e){if(typeof e!="string")return["",""];const t=e.indexOf(" "),n=b(e.substring(0,t));if(n.empty){const i=b(e);return i.empty?["",e.toLowerCase()]:[i.name,""]}const r=e.substring(n.name.length+1).toLowerCase();return[n.name,r.length?r:""]}function Ft(e){const t=Array.isArray(e)?e:Ln(e),n=b(t[0]).name,r=de(t[1]);if(r.empty)return $n;const i=r.name,o=n?r.intervals.map(a=>It(n,a)):[],s=n?n+" "+i:i;return{...r,name:s,type:i,tonic:n,notes:o}}const T={PIANO:"piano",PIANO_VIRTUAL:"piano-virtual",VIOLIN:"violin",GUITAR:"guitar"},ot={MIDI:"midi",MICROPHONE:"microphone",VIRTUAL:"virtual"},x={TREBLE:"treble",BASS:"bass"},Yt={[T.PIANO]:{id:T.PIANO,name:"Piano",displayName:"Piano/Keyboard",emoji:"ðŸŽ¹",inputType:ot.MIDI,range:{min:21,max:108,default:{min:48,max:84}},clefs:[x.TREBLE,x.BASS],defaultClef:x.TREBLE,polyphonic:!0,requiresSustain:!1,validation:{exactMatch:!0,pitchTolerance:0,octaveFlexible:!1,minDuration:0},practice:{defaultNoteCount:20,adaptiveDifficulty:!0,supportedModes:["sight-reading","scales","chords","arpeggios","key-signatures"]},ui:{showVirtualKeyboard:!1,showMidiStatus:!0,showPitchAccuracy:!1}},[T.PIANO_VIRTUAL]:{id:T.PIANO_VIRTUAL,name:"Piano (Virtual)",displayName:"Piano/Keyboard (Virtual)",emoji:"ðŸŽ¹",inputType:ot.VIRTUAL,range:{min:21,max:108,default:{min:48,max:84}},clefs:[x.TREBLE,x.BASS],defaultClef:x.TREBLE,polyphonic:!0,requiresSustain:!1,validation:{exactMatch:!0,pitchTolerance:0,octaveFlexible:!1,minDuration:0},practice:{defaultNoteCount:20,adaptiveDifficulty:!0,supportedModes:["sight-reading","scales","chords","arpeggios","key-signatures"]},ui:{showVirtualKeyboard:!0,showMidiStatus:!1,showPitchAccuracy:!1}},[T.VIOLIN]:{id:T.VIOLIN,name:"Violin",displayName:"Violin",emoji:"ðŸŽ»",inputType:ot.MICROPHONE,range:{min:55,max:91,default:{min:60,max:72}},clefs:[x.TREBLE],defaultClef:x.TREBLE,polyphonic:!1,requiresSustain:!0,tuning:[{note:"G3",midi:55,frequency:196},{note:"D4",midi:62,frequency:293.66},{note:"A4",midi:69,frequency:440},{note:"E5",midi:76,frequency:659.26}],validation:{exactMatch:!1,pitchTolerance:50,pitchToleranceAdvanced:20,octaveFlexible:!1,minDuration:500,minClarity:.8},practice:{defaultNoteCount:15,adaptiveDifficulty:!0,supportedModes:["sight-reading","scales","arpeggios","intonation","key-signatures"],calibrationRequired:!0,tuningCheckRecommended:!0},ui:{showVirtualKeyboard:!1,showMidiStatus:!1,showPitchAccuracy:!0,showMicrophoneLevel:!0,showTuningReference:!0,showCentsDeviation:!0},audio:{bufferSize:2048,noiseGate:-40,minFrequency:180,maxFrequency:1600}},[T.GUITAR]:{id:T.GUITAR,name:"Guitar",displayName:"Guitar",emoji:"ðŸŽ¸",inputType:ot.MICROPHONE,range:{min:40,max:88,default:{min:40,max:76}},clefs:[x.TREBLE],defaultClef:x.TREBLE,polyphonic:!1,requiresSustain:!0,tuning:[{note:"E2",midi:40,frequency:82.41,string:6},{note:"A2",midi:45,frequency:110,string:5},{note:"D3",midi:50,frequency:146.83,string:4},{note:"G3",midi:55,frequency:196,string:3},{note:"B3",midi:59,frequency:246.94,string:2},{note:"E4",midi:64,frequency:329.63,string:1}],validation:{exactMatch:!1,pitchTolerance:50,pitchToleranceAdvanced:30,octaveFlexible:!1,minDuration:400,minClarity:.75},practice:{defaultNoteCount:15,adaptiveDifficulty:!0,supportedModes:["sight-reading","scales","arpeggios","key-signatures"],calibrationRequired:!1,tuningCheckRecommended:!0,fretIndependent:!0},ui:{showVirtualKeyboard:!1,showMidiStatus:!1,showPitchAccuracy:!0,showMicrophoneLevel:!0,showTuningReference:!0,showCentsDeviation:!0,showFretboardReference:!1},audio:{bufferSize:2048,noiseGate:-35,minFrequency:70,maxFrequency:1400}}};function ve(e){const t=Yt[e];return t||(console.warn(`Unknown instrument: ${e}, defaulting to piano`),Yt[T.PIANO])}function yr(e){return ve(e).inputType===ot.MIDI}function ye(e){return ve(e).tuning||null}const be=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Ae={treble:{"c/4":60,"d/4":62,"e/4":64,"f/4":65,"g/4":67,"a/4":69,"b/4":71,"c/5":72,"d/5":74,"e/5":76,"f/5":77,"g/5":79,"a/5":81,"b/5":83,"c/6":84},bass:{"a/2":45,"b/2":47,"c/3":48,"d/3":50,"e/3":52,"f/3":53,"g/3":55,"a/3":57,"b/3":59,"c/4":60,"d/4":62,"e/4":64,"f/4":65}};function mt(e){return Pe(e)||""}function w(e){const t=Rn(e);return t!==null?t:-1}function Vn(e,t="treble"){const n=Math.floor(e/12)-1,r=e%12,i=be[r].toLowerCase().replace("#","#");return i.includes("#")?null:`${i}/${n}`}function On(e="c4-c5",t="treble",n=!0){const[r,i]=e.split("-"),o=w(r.toUpperCase()),s=w(i.toUpperCase());if(o===-1||s===-1)return console.error("Invalid range"),null;const a=Object.entries(Ae[t]).filter(([l,m])=>m>=o&&m<=s).map(([l,m])=>({vexflowNote:l,midiNote:m}));if(a.length===0)return console.error("No notes available in range"),null;const c=Math.floor(Math.random()*a.length);return a[c]}function kn(e,t,n=!0){const r=[];for(let i=e;i<=t;i++)if(n){const o=i%12;[1,3,6,8,10].includes(o)||r.push(i)}else r.push(i);return r.length===0?e:r[Math.floor(Math.random()*r.length)]}function Gn(e,t,n={}){const{allowOctaveError:r=!0,tolerance:i=0,pitchToleranceCents:o=0}=n;if(e===t)return{isCorrect:!0,message:"Perfect!",centsOff:0};if(r){const s=e%12,a=t%12;if(s===a)return{isCorrect:!0,message:"Correct note, wrong octave!"}}return i>0&&Math.abs(e-t)<=i?{isCorrect:!0,message:"Close enough!"}:{isCorrect:!1,message:`Try again. You played ${mt(e)}`}}function Un(e,t,n=50){const r=Dt(t),i=jt(e),o=Rt(e,r);if(Math.abs(o)<=n){let s="Perfect!";return Math.abs(o)>5&&(s=`${Math.abs(o).toFixed(0)} cents ${o>0?"sharp":"flat"}`),{isCorrect:!0,message:s,centsOff:o}}return{isCorrect:!1,message:`Try again. You played ${mt(i)} (${Math.abs(o).toFixed(0)} cents ${o>0?"sharp":"flat"})`,centsOff:o}}function Dt(e){const t=Pe(e);return t&&Bn(t)||440}function jt(e){return Math.round(12*Math.log2(e/440)+69)}function Rt(e,t){return 1200*Math.log2(e/t)}function Se(e,t){const n=Dt(t);return Rt(e,n)}function Hn(e){return Ft(`${e} major`).notes.map(n=>w(n)).filter(n=>n!==-1)}function Jn(e){return Ft(`${e} minor`).notes.map(n=>w(n)).filter(n=>n!==-1)}function Kn(e,t="major"){return Ft(`${e} ${t}`).notes.map(r=>w(r)).filter(r=>r!==-1)}function Xn(e,t="major"){return Nn(`${e}${t}`).notes.map(r=>w(r)).filter(r=>r!==-1)}function Yn(){return[{name:"C Major / A Minor",sharps:0,flats:0},{name:"G Major / E Minor",sharps:1,flats:0},{name:"D Major / B Minor",sharps:2,flats:0},{name:"A Major / F# Minor",sharps:3,flats:0},{name:"E Major / C# Minor",sharps:4,flats:0},{name:"B Major / G# Minor",sharps:5,flats:0},{name:"F# Major / D# Minor",sharps:6,flats:0},{name:"F Major / D Minor",sharps:0,flats:1},{name:"Bb Major / G Minor",sharps:0,flats:2},{name:"Eb Major / C Minor",sharps:0,flats:3},{name:"Ab Major / F Minor",sharps:0,flats:4},{name:"Db Major / Bb Minor",sharps:0,flats:5},{name:"Gb Major / Eb Minor",sharps:0,flats:6}]}function Qn(e,t){const n=w(e),r=w(t);return Math.abs(r-n)}function Wn(e,t,n){return e>=t&&e<=n}function Zn(e,t="guitar"){const n=ye(t);if(!n)return console.error("No tuning information available for instrument:",t),null;const r=[];return n.forEach(i=>{const o=i.midi,s=i.string||0,a=e-o;a>=0&&a<=24&&r.push({string:s,fret:a})}),r.length===0?(console.warn("Note out of range for tablature:",e),null):(r.sort((i,o)=>{if(i.fret!==o.fret)return i.fret-o.fret;const s=i.string>=2&&i.string<=4?-1:0,a=o.string>=2&&o.string<=4?-1:0;return s-a}),r[0])}function tr(e,t="guitar"){const n=ye(t);if(!n)return[];const r=[];return n.forEach(i=>{const o=i.midi,s=i.string||0,a=e-o;a>=0&&a<=24&&r.push({string:s,fret:a})}),r}const er={noteNames:be,vexflowNoteNames:Ae,midiToNoteName:mt,noteNameToMidi:w,midiToVexflow:Vn,generateRandomNote:On,generateRandomNoteFromMidiRange:kn,validateNote:Gn,validatePitchWithCents:Un,midiToFrequency:Dt,frequencyToMidi:jt,getCentsDeviation:Rt,getCentsFromMidi:Se,generateMajorScale:Hn,generateMinorScale:Jn,generateScale:Kn,generateChord:Xn,getAllKeySignatures:Yn,getInterval:Qn,isFrequencyInRange:Wn,midiToTabPosition:Zn,getAllTabPositions:tr};typeof window<"u"&&(window.MusicTheory=er);var _t,Qt;function nr(){if(Qt)return _t;Qt=1;function e(t){if(this.size=t|0,this.size<=1||(this.size&this.size-1)!==0)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=t<<1;for(var n=new Array(this.size*2),r=0;r<n.length;r+=2){const l=Math.PI*r/this.size;n[r]=Math.cos(l),n[r+1]=-Math.sin(l)}this.table=n;for(var i=0,o=1;this.size>o;o<<=1)i++;this._width=i%2===0?i-1:i,this._bitrev=new Array(1<<this._width);for(var s=0;s<this._bitrev.length;s++){this._bitrev[s]=0;for(var a=0;a<this._width;a+=2){var c=this._width-a-2;this._bitrev[s]|=(s>>>a&3)<<c}}this._out=null,this._data=null,this._inv=0}return _t=e,e.prototype.fromComplexArray=function(n,r){for(var i=r||new Array(n.length>>>1),o=0;o<n.length;o+=2)i[o>>>1]=n[o];return i},e.prototype.createComplexArray=function(){const n=new Array(this._csize);for(var r=0;r<n.length;r++)n[r]=0;return n},e.prototype.toComplexArray=function(n,r){for(var i=r||this.createComplexArray(),o=0;o<i.length;o+=2)i[o]=n[o>>>1],i[o+1]=0;return i},e.prototype.completeSpectrum=function(n){for(var r=this._csize,i=r>>>1,o=2;o<i;o+=2)n[r-o]=n[o],n[r-o+1]=-n[o+1]},e.prototype.transform=function(n,r){if(n===r)throw new Error("Input and output buffers must be different");this._out=n,this._data=r,this._inv=0,this._transform4(),this._out=null,this._data=null},e.prototype.realTransform=function(n,r){if(n===r)throw new Error("Input and output buffers must be different");this._out=n,this._data=r,this._inv=0,this._realTransform4(),this._out=null,this._data=null},e.prototype.inverseTransform=function(n,r){if(n===r)throw new Error("Input and output buffers must be different");this._out=n,this._data=r,this._inv=1,this._transform4();for(var i=0;i<n.length;i++)n[i]/=this.size;this._out=null,this._data=null},e.prototype._transform4=function(){var n=this._out,r=this._csize,i=this._width,o=1<<i,s=r/o<<1,a,c,l=this._bitrev;if(s===4)for(a=0,c=0;a<r;a+=s,c++){const d=l[c];this._singleTransform2(a,d,o)}else for(a=0,c=0;a<r;a+=s,c++){const d=l[c];this._singleTransform4(a,d,o)}var m=this._inv?-1:1,u=this.table;for(o>>=2;o>=2;o>>=2){s=r/o<<1;var h=s>>>2;for(a=0;a<r;a+=s)for(var M=a+h,P=a,f=0;P<M;P+=2,f+=o){const d=P,p=d+h,g=p+h,v=g+h,C=n[d],I=n[d+1],_=n[p],S=n[p+1],E=n[g],F=n[g+1],D=n[v],j=n[v+1],R=C,B=I,q=u[f],z=m*u[f+1],$=_*q-S*z,L=_*z+S*q,J=u[2*f],K=m*u[2*f+1],X=E*J-F*K,Y=E*K+F*J,Q=u[3*f],W=m*u[3*f+1],Z=D*Q-j*W,tt=D*W+j*Q,et=R+X,k=B+Y,G=R-X,nt=B-Y,rt=$+Z,U=L+tt,H=m*($-Z),it=m*(L-tt),ut=et+rt,Mt=k+U,Pt=et-rt,pt=k-U,gt=G+it,vt=nt-H,yt=G-it,bt=nt+H;n[d]=ut,n[d+1]=Mt,n[p]=gt,n[p+1]=vt,n[g]=Pt,n[g+1]=pt,n[v]=yt,n[v+1]=bt}}},e.prototype._singleTransform2=function(n,r,i){const o=this._out,s=this._data,a=s[r],c=s[r+1],l=s[r+i],m=s[r+i+1],u=a+l,h=c+m,M=a-l,P=c-m;o[n]=u,o[n+1]=h,o[n+2]=M,o[n+3]=P},e.prototype._singleTransform4=function(n,r,i){const o=this._out,s=this._data,a=this._inv?-1:1,c=i*2,l=i*3,m=s[r],u=s[r+1],h=s[r+i],M=s[r+i+1],P=s[r+c],f=s[r+c+1],d=s[r+l],p=s[r+l+1],g=m+P,v=u+f,C=m-P,I=u-f,_=h+d,S=M+p,E=a*(h-d),F=a*(M-p),D=g+_,j=v+S,R=C+F,B=I-E,q=g-_,z=v-S,$=C-F,L=I+E;o[n]=D,o[n+1]=j,o[n+2]=R,o[n+3]=B,o[n+4]=q,o[n+5]=z,o[n+6]=$,o[n+7]=L},e.prototype._realTransform4=function(){var n=this._out,r=this._csize,i=this._width,o=1<<i,s=r/o<<1,a,c,l=this._bitrev;if(s===4)for(a=0,c=0;a<r;a+=s,c++){const At=l[c];this._singleRealTransform2(a,At>>>1,o>>>1)}else for(a=0,c=0;a<r;a+=s,c++){const At=l[c];this._singleRealTransform4(a,At>>>1,o>>>1)}var m=this._inv?-1:1,u=this.table;for(o>>=2;o>=2;o>>=2){s=r/o<<1;var h=s>>>1,M=h>>>1,P=M>>>1;for(a=0;a<r;a+=s)for(var f=0,d=0;f<=P;f+=2,d+=o){var p=a+f,g=p+M,v=g+M,C=v+M,I=n[p],_=n[p+1],S=n[g],E=n[g+1],F=n[v],D=n[v+1],j=n[C],R=n[C+1],B=I,q=_,z=u[d],$=m*u[d+1],L=S*z-E*$,J=S*$+E*z,K=u[2*d],X=m*u[2*d+1],Y=F*K-D*X,Q=F*X+D*K,W=u[3*d],Z=m*u[3*d+1],tt=j*W-R*Z,et=j*Z+R*W,k=B+Y,G=q+Q,nt=B-Y,rt=q-Q,U=L+tt,H=J+et,it=m*(L-tt),ut=m*(J-et),Mt=k+U,Pt=G+H,pt=nt+ut,gt=rt-it;if(n[p]=Mt,n[p+1]=Pt,n[g]=pt,n[g+1]=gt,f===0){var vt=k-U,yt=G-H;n[v]=vt,n[v+1]=yt;continue}if(f!==P){var bt=nt,_e=-rt,Te=k,we=-G,Ne=-m*ut,Ie=-m*it,Ee=-m*H,Fe=-m*U,De=bt+Ne,je=_e+Ie,Re=Te+Fe,Be=we-Ee,$t=a+M-f,Lt=a+h-f;n[$t]=De,n[$t+1]=je,n[Lt]=Re,n[Lt+1]=Be}}}},e.prototype._singleRealTransform2=function(n,r,i){const o=this._out,s=this._data,a=s[r],c=s[r+i],l=a+c,m=a-c;o[n]=l,o[n+1]=0,o[n+2]=m,o[n+3]=0},e.prototype._singleRealTransform4=function(n,r,i){const o=this._out,s=this._data,a=this._inv?-1:1,c=i*2,l=i*3,m=s[r],u=s[r+i],h=s[r+c],M=s[r+l],P=m+h,f=m-h,d=u+M,p=a*(u-M),g=P+d,v=f,C=-p,I=P-d,_=f,S=p;o[n]=g,o[n+1]=0,o[n+2]=v,o[n+3]=C,o[n+4]=I,o[n+5]=0,o[n+6]=_,o[n+7]=S},_t}var rr=nr();const ir=Le(rr);class ct{constructor(t,n){A(this,"_inputLength");A(this,"_fft");A(this,"_bufferSupplier");A(this,"_paddedInputBuffer");A(this,"_transformBuffer");A(this,"_inverseBuffer");if(t<1)throw new Error("Input length must be at least one");this._inputLength=t,this._fft=new ir(ar(2*t)),this._bufferSupplier=n,this._paddedInputBuffer=this._bufferSupplier(this._fft.size),this._transformBuffer=this._bufferSupplier(2*this._fft.size),this._inverseBuffer=this._bufferSupplier(2*this._fft.size)}static forFloat32Array(t){return new ct(t,n=>new Float32Array(n))}static forFloat64Array(t){return new ct(t,n=>new Float64Array(n))}static forNumberArray(t){return new ct(t,n=>Array(n))}get inputLength(){return this._inputLength}autocorrelate(t,n=this._bufferSupplier(t.length)){if(t.length!==this._inputLength)throw new Error(`Input must have length ${this._inputLength} but had length ${t.length}`);for(let i=0;i<t.length;i++)this._paddedInputBuffer[i]=t[i];for(let i=t.length;i<this._paddedInputBuffer.length;i++)this._paddedInputBuffer[i]=0;this._fft.realTransform(this._transformBuffer,this._paddedInputBuffer),this._fft.completeSpectrum(this._transformBuffer);const r=this._transformBuffer;for(let i=0;i<r.length;i+=2)r[i]=r[i]*r[i]+r[i+1]*r[i+1],r[i+1]=0;this._fft.inverseTransform(this._inverseBuffer,this._transformBuffer);for(let i=0;i<t.length;i++)n[i]=this._inverseBuffer[2*i];return n}}function or(e){const t=[];let n=!1,r=-1/0,i=-1;for(let o=1;o<e.length-1;o++)e[o-1]<=0&&e[o]>0?(n=!0,i=o,r=e[o]):e[o-1]>0&&e[o]<=0?(n=!1,i!==-1&&t.push(i)):n&&e[o]>r&&(r=e[o],i=o);return t}function sr(e,t){const[n,r,i]=[e-1,e,e+1],[o,s,a]=[t[n],t[r],t[i]],c=o/2-s+a/2,l=-(o/2)*(r+i)+s*(n+i)-a/2*(n+r),m=o*r*i/2-s*n*i+a*n*r/2,u=-l/(2*c),h=c*u*u+l*u+m;return[u,h]}let Wt=class lt{constructor(t,n){A(this,"_autocorrelator");A(this,"_nsdfBuffer");A(this,"_clarityThreshold",.9);A(this,"_minVolumeAbsolute",0);A(this,"_maxInputAmplitude",1);this._autocorrelator=new ct(t,n),this._nsdfBuffer=n(t)}static forFloat32Array(t){return new lt(t,n=>new Float32Array(n))}static forFloat64Array(t){return new lt(t,n=>new Float64Array(n))}static forNumberArray(t){return new lt(t,n=>Array(n))}get inputLength(){return this._autocorrelator.inputLength}set clarityThreshold(t){if(!Number.isFinite(t)||t<=0||t>1)throw new Error("clarityThreshold must be a number in the range (0, 1]");this._clarityThreshold=t}set minVolumeAbsolute(t){if(!Number.isFinite(t)||t<0||t>this._maxInputAmplitude)throw new Error(`minVolumeAbsolute must be a number in the range [0, ${this._maxInputAmplitude}]`);this._minVolumeAbsolute=t}set minVolumeDecibels(t){if(!Number.isFinite(t)||t>0)throw new Error("minVolumeDecibels must be a number <= 0");this._minVolumeAbsolute=this._maxInputAmplitude*10**(t/10)}set maxInputAmplitude(t){if(!Number.isFinite(t)||t<=0)throw new Error("maxInputAmplitude must be a number > 0");this._maxInputAmplitude=t}findPitch(t,n){if(this._belowMinimumVolume(t))return[0,0];this._nsdf(t);const r=or(this._nsdfBuffer);if(r.length===0)return[0,0];const i=Math.max(...r.map(c=>this._nsdfBuffer[c])),o=r.find(c=>this._nsdfBuffer[c]>=this._clarityThreshold*i),[s,a]=sr(o,this._nsdfBuffer);return[n/s,Math.min(a,1)]}_belowMinimumVolume(t){if(this._minVolumeAbsolute===0)return!1;let n=0;for(let r=0;r<t.length;r++)n+=t[r]**2;return Math.sqrt(n/t.length)<this._minVolumeAbsolute}_nsdf(t){this._autocorrelator.autocorrelate(t,this._nsdfBuffer);let n=2*this._nsdfBuffer[0],r;for(r=0;r<this._nsdfBuffer.length&&n>0;r++)this._nsdfBuffer[r]=2*this._nsdfBuffer[r]/n,n-=t[r]**2+t[t.length-r-1]**2;for(;r<this._nsdfBuffer.length;r++)this._nsdfBuffer[r]=0}};function ar(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}class Bt{constructor(t={}){this.config={bufferSize:t.bufferSize||2048,sampleRate:t.sampleRate||44100,minClarity:t.minClarity||.75,minFrequency:t.minFrequency||70,maxFrequency:t.maxFrequency||1600},this.detector=Wt.forFloat32Array(this.config.bufferSize),this.detector.minVolumeDecibels=-40}detectPitch(t,n){const r=n||this.config.sampleRate,[i,o]=this.detector.findPitch(t,r);if(!this.isValidDetection(i,o))return{frequency:0,midi:0,cents:0,clarity:o||0,detected:!1};const a=jt(i),c=Se(i,a);return{frequency:i,midi:a,cents:c,clarity:o||0,detected:!0}}isValidDetection(t,n){return!(!t||t<=0||!n||n<this.config.minClarity||t<this.config.minFrequency||t>this.config.maxFrequency)}updateConfig(t){this.config={...this.config,...t},t.bufferSize&&t.bufferSize!==this.config.bufferSize&&(this.detector=Wt.forFloat32Array(this.config.bufferSize),this.detector.minVolumeDecibels=-40)}getConfig(){return{...this.config}}setMinClarity(t){this.config.minClarity=Math.max(0,Math.min(1,t))}setFrequencyRange(t,n){this.config.minFrequency=t,this.config.maxFrequency=n}static forInstrument(t){const n={guitar:{bufferSize:2048,minClarity:.75,minFrequency:70,maxFrequency:1400},violin:{bufferSize:2048,minClarity:.8,minFrequency:180,maxFrequency:1600},voice:{bufferSize:2048,minClarity:.85,minFrequency:80,maxFrequency:1200}};return new Bt(n[t])}}class cr{constructor(t={}){this.audioContext=null,this.microphone=null,this.analyser=null,this.pitchDetector=null,this.animationFrameId=null,this.stream=null,this.isListening=!1,this.buffer=null,this.lastDetectedMidi=null,this.lastDetectedTime=0,this.noteDebounceMs=100,this.stateChangeHandler=()=>{this.audioContext&&(console.log("AudioContext state changed to:",this.audioContext.state),this.audioContext.state==="suspended"?(console.warn("AudioContext suspended, attempting to resume..."),this.audioContext.resume().catch(n=>{console.error("Failed to resume AudioContext:",n)})):this.audioContext.state==="closed"&&console.error("AudioContext closed"))},this.config={bufferSize:t.bufferSize||2048,smoothing:t.smoothing||.8,minClarity:t.minClarity||.75,minFrequency:t.minFrequency||70,maxFrequency:t.maxFrequency||1600},this.listeners={pitchDetected:[],audioLevel:[],error:[],statusChange:[]}}async init(t){try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return console.error("Microphone access is not supported in this browser"),!1;if(this.audioContext=new(window.AudioContext||window.webkitAudioContext),!this.audioContext)return console.error("Failed to create audio context"),!1;this.setupAudioContextErrorHandlers(),this.audioContext.state==="suspended"&&await this.audioContext.resume();const n={echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,sampleRate:44100};return t&&(n.deviceId={exact:t}),this.stream=await navigator.mediaDevices.getUserMedia({audio:n}),this.audioContext?(this.microphone=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.config.bufferSize*2,this.analyser.smoothingTimeConstant=this.config.smoothing,this.microphone.connect(this.analyser),this.buffer=new Float32Array(this.config.bufferSize),this.pitchDetector=new Bt({bufferSize:this.config.bufferSize,sampleRate:this.audioContext.sampleRate,minClarity:this.config.minClarity,minFrequency:this.config.minFrequency,maxFrequency:this.config.maxFrequency}),console.log("Audio Manager initialized successfully"),console.log("Sample rate:",this.audioContext.sampleRate),console.log("Buffer size:",this.config.bufferSize),console.log("Audio context state:",this.audioContext.state),this.emitStatusChange({listening:!1,microphoneActive:!0}),!0):(console.error("Audio context was lost during initialization"),!1)}catch(n){return console.error("Failed to initialize audio:",n),this.audioContext&&(this.audioContext.close().catch(()=>{}),this.audioContext=null),!1}}setupAudioContextErrorHandlers(){this.audioContext&&this.audioContext.addEventListener("statechange",this.stateChangeHandler)}startListening(){if(!this.audioContext||!this.analyser||!this.pitchDetector||!this.buffer){console.error("Audio Manager not initialized");return}if(this.isListening){console.warn("Already listening");return}this.isListening=!0,this.emitStatusChange({listening:!0,microphoneActive:!0}),this.detectPitchLoop(),console.log("Started listening for pitch")}stopListening(){this.isListening&&(this.isListening=!1,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.emitStatusChange({listening:!1,microphoneActive:this.stream!==null}),console.log("Stopped listening for pitch"))}detectPitchLoop(){if(!(!this.isListening||!this.analyser||!this.pitchDetector||!this.buffer||!this.audioContext)){if(this.audioContext.state==="suspended"){console.warn("AudioContext suspended during pitch detection, attempting resume..."),this.audioContext.resume().then(()=>{console.log("AudioContext resumed successfully")}).catch(t=>{console.error("Failed to resume AudioContext:",t),this.stopListening(),this.emitError("Audio system paused. Please restart your practice session.")});return}if(this.audioContext.state==="closed"){console.error("AudioContext closed during pitch detection"),this.stopListening(),this.emitError("Audio system closed. Please reconnect your microphone.");return}try{this.analyser.getFloatTimeDomainData(this.buffer);const t=this.calculateRMS(this.buffer);this.emitAudioLevel(t);const n=this.pitchDetector.detectPitch(this.buffer,this.audioContext.sampleRate);if(n.detected){const r=Date.now();(n.midi!==this.lastDetectedMidi||r-this.lastDetectedTime>this.noteDebounceMs)&&(this.emitPitchDetected({frequency:n.frequency,midi:n.midi,cents:n.cents,clarity:n.clarity,noteName:mt(n.midi),timestamp:r}),this.lastDetectedMidi=n.midi,this.lastDetectedTime=r)}}catch(t){console.error("Error in pitch detection loop:",t)}this.isListening&&(this.animationFrameId=requestAnimationFrame(()=>this.detectPitchLoop()))}}calculateRMS(t){let n=0;for(let r=0;r<t.length;r++)n+=t[r]*t[r];return Math.sqrt(n/t.length)}disconnect(){this.stopListening(),this.microphone&&(this.microphone.disconnect(),this.microphone=null),this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.audioContext&&(this.audioContext.removeEventListener("statechange",this.stateChangeHandler),this.audioContext.close(),this.audioContext=null),this.analyser=null,this.pitchDetector=null,this.buffer=null,this.emitStatusChange({listening:!1,microphoneActive:!1}),console.log("Audio Manager disconnected")}updateConfig(t){this.config={...this.config,...t},this.pitchDetector&&this.pitchDetector.updateConfig({minClarity:this.config.minClarity,minFrequency:this.config.minFrequency,maxFrequency:this.config.maxFrequency}),this.analyser&&(this.analyser.smoothingTimeConstant=this.config.smoothing)}setDebounceTime(t){this.noteDebounceMs=Math.max(0,t)}on(t,n){this.listeners[t]?this.listeners[t].push(n):console.warn("Unknown event type:",t)}off(t,n){if(this.listeners[t]){const r=this.listeners[t].indexOf(n);r>-1&&this.listeners[t].splice(r,1)}}emitPitchDetected(t){this.listeners.pitchDetected.forEach(n=>{try{n(t)}catch(r){console.error("Error in pitchDetected listener:",r)}})}emitAudioLevel(t){this.listeners.audioLevel.forEach(n=>{try{n({level:t,timestamp:Date.now()})}catch(r){console.error("Error in audioLevel listener:",r)}})}emitError(t,n){this.listeners.error.forEach(r=>{try{r({message:t,error:n})}catch(i){console.error("Error in error listener:",i)}})}emitStatusChange(t){this.listeners.statusChange.forEach(n=>{try{n(t)}catch(r){console.error("Error in statusChange listener:",r)}})}getCurrentLevel(){return this.buffer?this.calculateRMS(this.buffer):0}isMicrophoneActive(){return this.stream!==null&&this.audioContext!==null}isCurrentlyListening(){return this.isListening}getSampleRate(){var t;return((t=this.audioContext)==null?void 0:t.sampleRate)||44100}simulateFrequency(t){const n=Math.round(12*Math.log2(t/440)+69);this.emitPitchDetected({frequency:t,midi:n,cents:0,clarity:1,noteName:mt(n),timestamp:Date.now()})}static async getAudioInputDevices(){try{return await navigator.mediaDevices.getUserMedia({audio:!0}),(await navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="audioinput")}catch(t){return console.error("Failed to enumerate audio devices:",t),[]}}getActiveDevice(){if(!this.stream)return null;const t=this.stream.getAudioTracks()[0];return t?{deviceId:t.getSettings().deviceId||"",groupId:t.getSettings().groupId||"",kind:"audioinput",label:t.label,toJSON:()=>({})}:null}static isSupported(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}}typeof window<"u"&&(window.AudioManager=cr);const y={SESSIONS:"music_practice_sessions",SETTINGS:"music_practice_settings",STATS:"music_practice_stats"};function N(){try{return typeof window<"u"&&typeof localStorage<"u"}catch{return!1}}function mr(e){if(!N()){console.warn("localStorage not available");return}try{const t=ft(),n={...e,timestamp:Date.now(),id:Ce()};t.push(n),t.length>100&&t.shift(),localStorage.setItem(y.SESSIONS,JSON.stringify(t)),xe(e)}catch(t){console.error("Error saving session:",t)}}function ft(){if(!N())return[];try{const e=localStorage.getItem(y.SESSIONS);return e?JSON.parse(e):[]}catch(e){return console.error("Error loading sessions:",e),[]}}function ur(e){return ft().filter(t=>t.instrument===e)}function xe(e){if(N())try{const t=qt();if(t.totalSessions++,t.totalCorrect+=e.correct||0,t.totalIncorrect+=e.incorrect||0,t.totalNotes+=(e.correct||0)+(e.incorrect||0),e.avgResponseTime){const r=t.avgResponseTime*(t.totalSessions-1)+e.avgResponseTime;t.avgResponseTime=r/t.totalSessions}(e.bestStreak||0)>t.bestStreak&&(t.bestStreak=e.bestStreak||0);const n=e.module||"sightReading";t.byModule[n]||(t.byModule[n]={sessions:0,correct:0,incorrect:0}),t.byModule[n].sessions++,t.byModule[n].correct+=e.correct||0,t.byModule[n].incorrect+=e.incorrect||0,t.lastPracticeDate=Date.now(),localStorage.setItem(y.STATS,JSON.stringify(t))}catch(t){console.error("Error updating stats:",t)}}function qt(){if(!N())return ht();try{const e=localStorage.getItem(y.STATS);return e?JSON.parse(e):ht()}catch(e){return console.error("Error loading stats:",e),ht()}}function ht(){return{totalSessions:0,totalCorrect:0,totalIncorrect:0,totalNotes:0,avgResponseTime:0,bestStreak:0,lastPracticeDate:null,byModule:{},lifetimeScore:0,currentLevel:1,highestStreak:0}}function lr(e){if(!N()){console.warn("localStorage not available");return}try{const n={...zt(),...e};localStorage.setItem(y.SETTINGS,JSON.stringify(n))}catch(t){console.error("Error saving settings:",t)}}function zt(){if(!N())return dt();try{const e=localStorage.getItem(y.SETTINGS);return e?JSON.parse(e):dt()}catch(e){return console.error("Error loading settings:",e),dt()}}function dt(){return{theme:"light",clef:"treble",range:"c4-c5",fallingNotesMode:!1,allowOctaveError:!0,midiDeviceId:null,audioDeviceId:null,virtualKeyboard:!1,instrument:"piano",pitchTolerance:50,gameMode:"practice",soundEffectsEnabled:!0,soundEffectsVolume:.7,animationsEnabled:!0,confettiEnabled:!0}}function hr(){if(N())try{localStorage.removeItem(y.SESSIONS),localStorage.removeItem(y.STATS)}catch(e){console.error("Error clearing data:",e)}}function dr(){if(N())try{localStorage.removeItem(y.SESSIONS),localStorage.removeItem(y.STATS),localStorage.removeItem(y.SETTINGS)}catch(e){console.error("Error clearing data:",e)}}function fr(){return JSON.stringify({sessions:ft(),stats:qt(),settings:zt(),exportDate:Date.now()},null,2)}function Mr(e){if(!N())return console.warn("localStorage not available"),!1;try{const t=JSON.parse(e);return t.sessions&&localStorage.setItem(y.SESSIONS,JSON.stringify(t.sessions)),t.stats&&localStorage.setItem(y.STATS,JSON.stringify(t.stats)),t.settings&&localStorage.setItem(y.SETTINGS,JSON.stringify(t.settings)),!0}catch(t){return console.error("Error importing data:",t),!1}}function Ce(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}const Pr={KEYS:y,saveSession:mr,getSessions:ft,getSessionsByInstrument:ur,updateStats:xe,getStats:qt,getDefaultStats:ht,saveSettings:lr,getSettings:zt,getDefaultSettings:dt,clearAll:hr,clearAllIncludingSettings:dr,exportData:fr,importData:Mr,generateId:Ce};typeof window<"u"&&(window.Storage=Pr);export{cr as A,er as M,vr as P,Pr as S,mt as a,Zn as b,Vn as c,ve as d,On as g,Dt as m,yr as r,Gn as v};
//# sourceMappingURL=storage-CZgyC9t8.js.map
